{"version":3,"file":"ose.js","sources":["../node_modules/tslib/tslib.es6.js","../../src/module/actor/data-model-classes/data-model-character-encumbrance.ts","../../src/module/actor/data-model-classes/data-model-character-encumbrance-basic.ts","../../src/module/actor/data-model-classes/data-model-character-encumbrance-complete.ts","../../src/module/actor/data-model-classes/data-model-character-encumbrance-detailed.ts","../../src/module/actor/data-model-classes/data-model-character-encumbrance-disabled.ts","../../src/module/actor/data-model-classes/data-model-character-encumbrance-item-based.ts","../../src/module/config.ts","../src/module/helpers-dice.js","../src/module/dialog/character-creation.js","../src/module/dialog/character-gp-cost.js","../src/module/dialog/character-modifiers.js","../src/module/helpers-behaviour.js","../src/module/dialog/entity-tweaks.js","../src/module/actor/actor-sheet.js","../src/module/actor/character-sheet.js","../../src/module/actor/data-model-classes/data-model-character-ac.ts","../../src/module/actor/data-model-classes/data-model-character-move.ts","../../src/module/actor/data-model-classes/data-model-character-scores.ts","../../src/module/actor/data-model-classes/data-model-character-spells.ts","../src/module/actor/data-model-character.js","../src/module/actor/data-model-monster.js","../src/module/item/entity.js","../src/module/actor/entity.js","../src/module/actor/monster-sheet.js","../../src/module/helpers-tags.ts","../src/module/item/data-model-ability.js","../src/module/item/data-model-armor.js","../src/module/item/data-model-container.js","../src/module/item/data-model-item.js","../src/module/item/data-model-spell.js","../src/module/item/data-model-weapon.js","../src/module/item/item-sheet.js","../../src/module/helpers-chat.ts","../src/module/combat.js","../src/module/helpers-treasure.js","../src/module/helpers-macros.js","../src/module/party/party.js","../src/module/party/party-xp.js","../src/module/party/party-sheet.js","../src/module/helpers-party.js","../../src/e2e/testUtils.ts","../../src/module/actor/__tests__/data-model-character.test.ts","../../src/module/actor/data-model-classes/__tests__/data-model-character-ac.test.ts","../../src/module/actor/data-model-classes/__tests__/data-model-character-encumbrance.test.ts","../../src/module/actor/data-model-classes/__tests__/data-model-character-move.test.ts","../../src/module/actor/data-model-classes/__tests__/data-model-character-scores.test.ts","../../src/module/actor/data-model-classes/__tests__/data-model-character-spells.test.ts","../../src/module/actor/__tests__/data-model-monster.test.ts","../../src/module/actor/__tests__/entity-actor.test.ts","../../src/module/actor/__tests__/sheet-actor.test.ts","../../src/module/actor/__tests__/sheet-actor/sheet-actor-e2e-dragndrop.test.ts","../../src/module/actor/__tests__/sheet-character.test.ts","../../src/module/actor/__tests__/sheet-monster.test.ts","../../src/module/dialog/__tests__/sheet-character-modifiers.test.ts","../../src/module/dialog/__tests__/sheet-entity-tweaks.test.ts","../../src/module/item/__tests__/data-model-item-ability.test.ts","../../src/module/item/__tests__/data-model-item-armor.test.ts","../../src/module/item/__tests__/data-model-item-container.test.ts","../../src/module/item/__tests__/data-model-item-misc.test.ts","../../src/module/item/__tests__/data-model-item-spell.test.ts","../../src/module/item/__tests__/data-model-item-weapon.test.ts","../../src/module/item/__tests__/entity-item.test.ts","../../src/module/item/__tests__/sheet-item.test.ts","../../src/module/party/__tests__/entity-party.test.ts","../../src/module/party/__tests__/sheet-party.test.ts","../../src/module/party/__tests__/sheet-party-xp.test.ts","../../src/module/__tests__/helpers-behaviour.test.ts","../../src/module/__tests__/helpers-chat.test.ts","../../src/module/__tests__/helpers-dice.test.ts","../../src/module/__tests__/helpers-handlebars.test.ts","../../src/module/__tests__/helpers-macros.test.ts","../../src/module/__tests__/helpers-party.test.ts","../../src/module/__tests__/helpers-treasure.test.ts","../../src/e2e/index.ts","../src/ose.js","../../src/module/helpers-handlebars.ts","../../src/module/settings.ts","../src/module/fvttModuleAPIs.js","../../src/module/preloadTemplates.ts","../src/module/renderList.js"],"sourcesContent":["/******************************************************************************\r\nCopyright (c) Microsoft Corporation.\r\n\r\nPermission to use, copy, modify, and/or distribute this software for any\r\npurpose with or without fee is hereby granted.\r\n\r\nTHE SOFTWARE IS PROVIDED \"AS IS\" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH\r\nREGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY\r\nAND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,\r\nINDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM\r\nLOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR\r\nOTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR\r\nPERFORMANCE OF THIS SOFTWARE.\r\n***************************************************************************** */\r\n/* global Reflect, Promise */\r\n\r\nvar extendStatics = function(d, b) {\r\n    extendStatics = Object.setPrototypeOf ||\r\n        ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\r\n        function (d, b) { for (var p in b) if (Object.prototype.hasOwnProperty.call(b, p)) d[p] = b[p]; };\r\n    return extendStatics(d, b);\r\n};\r\n\r\nexport function __extends(d, b) {\r\n    if (typeof b !== \"function\" && b !== null)\r\n        throw new TypeError(\"Class extends value \" + String(b) + \" is not a constructor or null\");\r\n    extendStatics(d, b);\r\n    function __() { this.constructor = d; }\r\n    d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\r\n}\r\n\r\nexport var __assign = function() {\r\n    __assign = Object.assign || function __assign(t) {\r\n        for (var s, i = 1, n = arguments.length; i < n; i++) {\r\n            s = arguments[i];\r\n            for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p)) t[p] = s[p];\r\n        }\r\n        return t;\r\n    }\r\n    return __assign.apply(this, arguments);\r\n}\r\n\r\nexport function __rest(s, e) {\r\n    var t = {};\r\n    for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p) && e.indexOf(p) < 0)\r\n        t[p] = s[p];\r\n    if (s != null && typeof Object.getOwnPropertySymbols === \"function\")\r\n        for (var i = 0, p = Object.getOwnPropertySymbols(s); i < p.length; i++) {\r\n            if (e.indexOf(p[i]) < 0 && Object.prototype.propertyIsEnumerable.call(s, p[i]))\r\n                t[p[i]] = s[p[i]];\r\n        }\r\n    return t;\r\n}\r\n\r\nexport function __decorate(decorators, target, key, desc) {\r\n    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;\r\n    if (typeof Reflect === \"object\" && typeof Reflect.decorate === \"function\") r = Reflect.decorate(decorators, target, key, desc);\r\n    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;\r\n    return c > 3 && r && Object.defineProperty(target, key, r), r;\r\n}\r\n\r\nexport function __param(paramIndex, decorator) {\r\n    return function (target, key) { decorator(target, key, paramIndex); }\r\n}\r\n\r\nexport function __metadata(metadataKey, metadataValue) {\r\n    if (typeof Reflect === \"object\" && typeof Reflect.metadata === \"function\") return Reflect.metadata(metadataKey, metadataValue);\r\n}\r\n\r\nexport function __awaiter(thisArg, _arguments, P, generator) {\r\n    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }\r\n    return new (P || (P = Promise))(function (resolve, reject) {\r\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\r\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\r\n        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }\r\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\r\n    });\r\n}\r\n\r\nexport function __generator(thisArg, body) {\r\n    var _ = { label: 0, sent: function() { if (t[0] & 1) throw t[1]; return t[1]; }, trys: [], ops: [] }, f, y, t, g;\r\n    return g = { next: verb(0), \"throw\": verb(1), \"return\": verb(2) }, typeof Symbol === \"function\" && (g[Symbol.iterator] = function() { return this; }), g;\r\n    function verb(n) { return function (v) { return step([n, v]); }; }\r\n    function step(op) {\r\n        if (f) throw new TypeError(\"Generator is already executing.\");\r\n        while (_) try {\r\n            if (f = 1, y && (t = op[0] & 2 ? y[\"return\"] : op[0] ? y[\"throw\"] || ((t = y[\"return\"]) && t.call(y), 0) : y.next) && !(t = t.call(y, op[1])).done) return t;\r\n            if (y = 0, t) op = [op[0] & 2, t.value];\r\n            switch (op[0]) {\r\n                case 0: case 1: t = op; break;\r\n                case 4: _.label++; return { value: op[1], done: false };\r\n                case 5: _.label++; y = op[1]; op = [0]; continue;\r\n                case 7: op = _.ops.pop(); _.trys.pop(); continue;\r\n                default:\r\n                    if (!(t = _.trys, t = t.length > 0 && t[t.length - 1]) && (op[0] === 6 || op[0] === 2)) { _ = 0; continue; }\r\n                    if (op[0] === 3 && (!t || (op[1] > t[0] && op[1] < t[3]))) { _.label = op[1]; break; }\r\n                    if (op[0] === 6 && _.label < t[1]) { _.label = t[1]; t = op; break; }\r\n                    if (t && _.label < t[2]) { _.label = t[2]; _.ops.push(op); break; }\r\n                    if (t[2]) _.ops.pop();\r\n                    _.trys.pop(); continue;\r\n            }\r\n            op = body.call(thisArg, _);\r\n        } catch (e) { op = [6, e]; y = 0; } finally { f = t = 0; }\r\n        if (op[0] & 5) throw op[1]; return { value: op[0] ? op[1] : void 0, done: true };\r\n    }\r\n}\r\n\r\nexport var __createBinding = Object.create ? (function(o, m, k, k2) {\r\n    if (k2 === undefined) k2 = k;\r\n    var desc = Object.getOwnPropertyDescriptor(m, k);\r\n    if (!desc || (\"get\" in desc ? !m.__esModule : desc.writable || desc.configurable)) {\r\n        desc = { enumerable: true, get: function() { return m[k]; } };\r\n    }\r\n    Object.defineProperty(o, k2, desc);\r\n}) : (function(o, m, k, k2) {\r\n    if (k2 === undefined) k2 = k;\r\n    o[k2] = m[k];\r\n});\r\n\r\nexport function __exportStar(m, o) {\r\n    for (var p in m) if (p !== \"default\" && !Object.prototype.hasOwnProperty.call(o, p)) __createBinding(o, m, p);\r\n}\r\n\r\nexport function __values(o) {\r\n    var s = typeof Symbol === \"function\" && Symbol.iterator, m = s && o[s], i = 0;\r\n    if (m) return m.call(o);\r\n    if (o && typeof o.length === \"number\") return {\r\n        next: function () {\r\n            if (o && i >= o.length) o = void 0;\r\n            return { value: o && o[i++], done: !o };\r\n        }\r\n    };\r\n    throw new TypeError(s ? \"Object is not iterable.\" : \"Symbol.iterator is not defined.\");\r\n}\r\n\r\nexport function __read(o, n) {\r\n    var m = typeof Symbol === \"function\" && o[Symbol.iterator];\r\n    if (!m) return o;\r\n    var i = m.call(o), r, ar = [], e;\r\n    try {\r\n        while ((n === void 0 || n-- > 0) && !(r = i.next()).done) ar.push(r.value);\r\n    }\r\n    catch (error) { e = { error: error }; }\r\n    finally {\r\n        try {\r\n            if (r && !r.done && (m = i[\"return\"])) m.call(i);\r\n        }\r\n        finally { if (e) throw e.error; }\r\n    }\r\n    return ar;\r\n}\r\n\r\n/** @deprecated */\r\nexport function __spread() {\r\n    for (var ar = [], i = 0; i < arguments.length; i++)\r\n        ar = ar.concat(__read(arguments[i]));\r\n    return ar;\r\n}\r\n\r\n/** @deprecated */\r\nexport function __spreadArrays() {\r\n    for (var s = 0, i = 0, il = arguments.length; i < il; i++) s += arguments[i].length;\r\n    for (var r = Array(s), k = 0, i = 0; i < il; i++)\r\n        for (var a = arguments[i], j = 0, jl = a.length; j < jl; j++, k++)\r\n            r[k] = a[j];\r\n    return r;\r\n}\r\n\r\nexport function __spreadArray(to, from, pack) {\r\n    if (pack || arguments.length === 2) for (var i = 0, l = from.length, ar; i < l; i++) {\r\n        if (ar || !(i in from)) {\r\n            if (!ar) ar = Array.prototype.slice.call(from, 0, i);\r\n            ar[i] = from[i];\r\n        }\r\n    }\r\n    return to.concat(ar || Array.prototype.slice.call(from));\r\n}\r\n\r\nexport function __await(v) {\r\n    return this instanceof __await ? (this.v = v, this) : new __await(v);\r\n}\r\n\r\nexport function __asyncGenerator(thisArg, _arguments, generator) {\r\n    if (!Symbol.asyncIterator) throw new TypeError(\"Symbol.asyncIterator is not defined.\");\r\n    var g = generator.apply(thisArg, _arguments || []), i, q = [];\r\n    return i = {}, verb(\"next\"), verb(\"throw\"), verb(\"return\"), i[Symbol.asyncIterator] = function () { return this; }, i;\r\n    function verb(n) { if (g[n]) i[n] = function (v) { return new Promise(function (a, b) { q.push([n, v, a, b]) > 1 || resume(n, v); }); }; }\r\n    function resume(n, v) { try { step(g[n](v)); } catch (e) { settle(q[0][3], e); } }\r\n    function step(r) { r.value instanceof __await ? Promise.resolve(r.value.v).then(fulfill, reject) : settle(q[0][2], r); }\r\n    function fulfill(value) { resume(\"next\", value); }\r\n    function reject(value) { resume(\"throw\", value); }\r\n    function settle(f, v) { if (f(v), q.shift(), q.length) resume(q[0][0], q[0][1]); }\r\n}\r\n\r\nexport function __asyncDelegator(o) {\r\n    var i, p;\r\n    return i = {}, verb(\"next\"), verb(\"throw\", function (e) { throw e; }), verb(\"return\"), i[Symbol.iterator] = function () { return this; }, i;\r\n    function verb(n, f) { i[n] = o[n] ? function (v) { return (p = !p) ? { value: __await(o[n](v)), done: n === \"return\" } : f ? f(v) : v; } : f; }\r\n}\r\n\r\nexport function __asyncValues(o) {\r\n    if (!Symbol.asyncIterator) throw new TypeError(\"Symbol.asyncIterator is not defined.\");\r\n    var m = o[Symbol.asyncIterator], i;\r\n    return m ? m.call(o) : (o = typeof __values === \"function\" ? __values(o) : o[Symbol.iterator](), i = {}, verb(\"next\"), verb(\"throw\"), verb(\"return\"), i[Symbol.asyncIterator] = function () { return this; }, i);\r\n    function verb(n) { i[n] = o[n] && function (v) { return new Promise(function (resolve, reject) { v = o[n](v), settle(resolve, reject, v.done, v.value); }); }; }\r\n    function settle(resolve, reject, d, v) { Promise.resolve(v).then(function(v) { resolve({ value: v, done: d }); }, reject); }\r\n}\r\n\r\nexport function __makeTemplateObject(cooked, raw) {\r\n    if (Object.defineProperty) { Object.defineProperty(cooked, \"raw\", { value: raw }); } else { cooked.raw = raw; }\r\n    return cooked;\r\n};\r\n\r\nvar __setModuleDefault = Object.create ? (function(o, v) {\r\n    Object.defineProperty(o, \"default\", { enumerable: true, value: v });\r\n}) : function(o, v) {\r\n    o[\"default\"] = v;\r\n};\r\n\r\nexport function __importStar(mod) {\r\n    if (mod && mod.__esModule) return mod;\r\n    var result = {};\r\n    if (mod != null) for (var k in mod) if (k !== \"default\" && Object.prototype.hasOwnProperty.call(mod, k)) __createBinding(result, mod, k);\r\n    __setModuleDefault(result, mod);\r\n    return result;\r\n}\r\n\r\nexport function __importDefault(mod) {\r\n    return (mod && mod.__esModule) ? mod : { default: mod };\r\n}\r\n\r\nexport function __classPrivateFieldGet(receiver, state, kind, f) {\r\n    if (kind === \"a\" && !f) throw new TypeError(\"Private accessor was defined without a getter\");\r\n    if (typeof state === \"function\" ? receiver !== state || !f : !state.has(receiver)) throw new TypeError(\"Cannot read private member from an object whose class did not declare it\");\r\n    return kind === \"m\" ? f : kind === \"a\" ? f.call(receiver) : f ? f.value : state.get(receiver);\r\n}\r\n\r\nexport function __classPrivateFieldSet(receiver, state, value, kind, f) {\r\n    if (kind === \"m\") throw new TypeError(\"Private method is not writable\");\r\n    if (kind === \"a\" && !f) throw new TypeError(\"Private accessor was defined without a setter\");\r\n    if (typeof state === \"function\" ? receiver !== state || !f : !state.has(receiver)) throw new TypeError(\"Cannot write private member to an object whose class did not declare it\");\r\n    return (kind === \"a\" ? f.call(receiver, value) : f ? f.value = value : state.set(receiver, value)), value;\r\n}\r\n\r\nexport function __classPrivateFieldIn(state, receiver) {\r\n    if (receiver === null || (typeof receiver !== \"object\" && typeof receiver !== \"function\")) throw new TypeError(\"Cannot use 'in' operator on non-object\");\r\n    return typeof state === \"function\" ? receiver === state : state.has(receiver);\r\n}\r\n","/**\r\n * @file The base class for all encumbrance schemes. Feel free to extend this to make your own schemes!\r\n */\r\nexport interface CharacterEncumbrance {\r\n  variant: string;\r\n  enabled: boolean;\r\n  pct: number;\r\n  encumbered: boolean;\r\n  steps: number[];\r\n  value: number;\r\n  max: number;\r\n  atFirstBreakpoint: boolean | null;\r\n  atSecondBreakpoint: boolean | null;\r\n  atThirdBreakpoint: boolean | null;\r\n}\r\n\r\n/**\r\n * A class to handle character encumbrance.\r\n */\r\nexport default class OseDataModelCharacterEncumbrance\r\n  implements CharacterEncumbrance\r\n{\r\n  static baseEncumbranceCap = 1600;\r\n  // Default encumbrance steps used by the 'complete' and 'detailed' encumbrance variants\r\n  static encumbranceSteps = {\r\n    quarter: 25,\r\n    threeEighths: 37.5,\r\n    half: 50\r\n  };\r\n\r\n  #encumbranceVariant;\r\n\r\n  #max;\r\n\r\n  #weight = 0;\r\n\r\n  /**\r\n   * The constructor\r\n   *\r\n   * @param {string} variant - The name of this encumbrance variant.\r\n   * @param {number} max - The max weight this character can carry\r\n   * @param {Item[]} items - The items this character is carrying. Note: we're not using this in the base class.\r\n   */\r\n  constructor(\r\n    variant = \"disabled\",\r\n    max = OseDataModelCharacterEncumbrance.baseEncumbranceCap,\r\n    items = [] // eslint-disable-line @typescript-eslint/no-unused-vars\r\n  ) {\r\n    this.#encumbranceVariant = variant;\r\n    this.#max = max;\r\n  }\r\n\r\n  get variant() {\r\n    return this.#encumbranceVariant;\r\n  }\r\n\r\n  get enabled() {\r\n    return this.#encumbranceVariant !== \"disabled\";\r\n  }\r\n\r\n  get pct() {\r\n    return Math.clamped((100 * this.value) / this.max, 0, 100);\r\n  }\r\n\r\n  get encumbered() {\r\n    return this.value > this.max;\r\n  }\r\n\r\n  // eslint-disable-next-line class-methods-use-this\r\n  get steps(): number[] {\r\n    return [];\r\n  }\r\n\r\n  get value(): number {\r\n    return this.#weight;\r\n  }\r\n\r\n  get max() {\r\n    return this.#max;\r\n  }\r\n\r\n  set max(value) {\r\n    this.#max = value;\r\n  }\r\n\r\n  get #delta() {\r\n    return this.max - OseDataModelCharacterEncumbrance.baseEncumbranceCap;\r\n  }\r\n\r\n  get atThirdBreakpoint() {\r\n    return (\r\n      this.value >\r\n      this.max *\r\n        (OseDataModelCharacterEncumbrance.encumbranceSteps.half / 100) +\r\n        (this.#delta || 0)\r\n    );\r\n  }\r\n\r\n  get atSecondBreakpoint() {\r\n    return (\r\n      this.value >\r\n      this.max *\r\n        (OseDataModelCharacterEncumbrance.encumbranceSteps.threeEighths / 100) +\r\n        (this.#delta || 0)\r\n    );\r\n  }\r\n\r\n  get atFirstBreakpoint() {\r\n    return (\r\n      this.value >\r\n      this.max *\r\n        (OseDataModelCharacterEncumbrance.encumbranceSteps.quarter / 100) +\r\n        (this.#delta || 0)\r\n    );\r\n  }\r\n}\r\n","/**\r\n * @file A class representing the \"Basic\" encumbrance scheme from Old School Essentials: Classic Fantasy\r\n */\r\nimport OseDataModelCharacterEncumbrance, {\r\n  CharacterEncumbrance,\r\n} from \"./data-model-character-encumbrance\";\r\n\r\n// import { OSE } from '../../config';\r\n\r\n/**\r\n * A set of options for configuring the\r\n * Basic encumbrance scheme\r\n */\r\ntype Options = {\r\n  significantTreasure: number;\r\n};\r\n\r\n/**\r\n * @todo Add template path for encumbrance bar\r\n * @todo Add template path for inventory item row\r\n */\r\nexport default class OseDataModelCharacterEncumbranceBasic\r\n  extends OseDataModelCharacterEncumbrance\r\n  implements CharacterEncumbrance\r\n{\r\n  static templateEncumbranceBar = \"\";\r\n\r\n  static templateInventoryRow = \"\";\r\n\r\n  /**\r\n   * The machine-readable label for this encumbrance scheme\r\n   */\r\n  static type = \"basic\";\r\n\r\n  /**\r\n   * The human-readable label for this encumbrance scheme\r\n   */\r\n  static localizedLabel = \"OSE.Setting.EncumbranceBasic\";\r\n\r\n  /**\r\n   * The base value for the amount of treasure that slows a character down\r\n   */\r\n  static significantTreasure = 800;\r\n\r\n  /**\r\n   * A map of strings to numbers indicating how heavy a set of armor is.\r\n   * The heavier the armor, the slower you move.\r\n   */\r\n  static armorWeight = {\r\n    unarmored: 0,\r\n    light: 1,\r\n    heavy: 2,\r\n  };\r\n\r\n  #weight;\r\n\r\n  #treasureEncumbrance;\r\n\r\n  #heaviestArmor;\r\n\r\n  constructor(\r\n    max = OseDataModelCharacterEncumbrance.baseEncumbranceCap,\r\n    items: Item[] = [],\r\n    options: Options = {} as Options\r\n  ) {\r\n    super(OseDataModelCharacterEncumbranceBasic.type, max);\r\n    this.#treasureEncumbrance =\r\n      options?.significantTreasure ||\r\n      OseDataModelCharacterEncumbranceBasic.significantTreasure;\r\n\r\n    this.#weight = items.reduce(\r\n      (acc: number, { type, system: { treasure, quantity, weight } }: Item) =>\r\n        type !== \"item\" || !treasure ? acc : acc + quantity.value * weight,\r\n      0\r\n    );\r\n\r\n    this.#heaviestArmor = items.reduce(\r\n      (heaviest, { type, system: { type: armorType, equipped } }) => {\r\n        if (type !== \"armor\" || !equipped) return heaviest;\r\n        if (\r\n          armorType === \"light\" &&\r\n          heaviest ===\r\n            OseDataModelCharacterEncumbranceBasic.armorWeight.unarmored\r\n        )\r\n          return OseDataModelCharacterEncumbranceBasic.armorWeight.light;\r\n        if (armorType === \"heavy\")\r\n          return OseDataModelCharacterEncumbranceBasic.armorWeight.heavy;\r\n        return heaviest;\r\n      },\r\n      OseDataModelCharacterEncumbranceBasic.armorWeight.unarmored\r\n    );\r\n  }\r\n\r\n  get steps() {\r\n    return [(100 * this.#treasureEncumbrance) / this.max];\r\n  }\r\n\r\n  get overTreasureThreshold() {\r\n    return this.value >= this.#treasureEncumbrance;\r\n  }\r\n\r\n  get value() {\r\n    return this.#weight;\r\n  }\r\n\r\n  get overSignificantTreasureThreshold() {\r\n    return this.value >= this.#treasureEncumbrance;\r\n  }\r\n\r\n  get atThirdBreakpoint() {\r\n    return (\r\n      this.#heaviestArmor ===\r\n        OseDataModelCharacterEncumbranceBasic.armorWeight.heavy &&\r\n      this.value >= this.#treasureEncumbrance\r\n    );\r\n  }\r\n\r\n  get atSecondBreakpoint() {\r\n    const isHeavy =\r\n      this.#heaviestArmor ===\r\n      OseDataModelCharacterEncumbranceBasic.armorWeight.heavy;\r\n    const isLightWithTreasure =\r\n      this.#heaviestArmor ===\r\n        OseDataModelCharacterEncumbranceBasic.armorWeight.light &&\r\n      this.value >= this.#treasureEncumbrance;\r\n    return isHeavy || isLightWithTreasure;\r\n  }\r\n\r\n  get atFirstBreakpoint() {\r\n    return (\r\n      this.#heaviestArmor ===\r\n        OseDataModelCharacterEncumbranceBasic.armorWeight.light ||\r\n      this.overSignificantTreasureThreshold\r\n    );\r\n  }\r\n}\r\n","/**\r\n * @file A class representing the \"Complete\" encumbrance scheme from Old School Essentials: Classic Fantasy\r\n */\r\nimport OseDataModelCharacterEncumbrance, {\r\n  CharacterEncumbrance,\r\n} from \"./data-model-character-encumbrance\";\r\n\r\n// import { OSE } from '../../config';\r\n\r\n/**\r\n * @todo Add template path for encumbrance bar\r\n * @todo Add template path for inventory item row\r\n */\r\nexport default class OseDataModelCharacterEncumbranceComplete\r\n  extends OseDataModelCharacterEncumbrance\r\n  implements CharacterEncumbrance\r\n{\r\n  static templateEncumbranceBar = \"\";\r\n\r\n  static templateInventoryRow = \"\";\r\n\r\n  /**\r\n   * The machine-readable label for this encumbrance scheme\r\n   */\r\n  static type = \"complete\";\r\n\r\n  /**\r\n   * The human-readable label for this encumbrance scheme\r\n   */\r\n  static localizedLabel = \"OSE.Setting.EncumbranceComplete\";\r\n\r\n  #weight;\r\n\r\n  constructor(\r\n    max = OseDataModelCharacterEncumbrance.baseEncumbranceCap,\r\n    items: Item[] = []\r\n  ) {\r\n    super(OseDataModelCharacterEncumbranceComplete.type, max);\r\n    this.#weight = items.reduce(\r\n      (acc, { type, system: { quantity, weight } }: Item) => {\r\n        if (type === \"item\") return acc + quantity.value * weight;\r\n        if ([\"weapon\", \"armor\", \"container\"].includes(type))\r\n          return acc + weight;\r\n        return acc;\r\n      },\r\n      0\r\n    );\r\n  }\r\n\r\n  // eslint-disable-next-line class-methods-use-this\r\n  get steps() {\r\n    return Object.values(OseDataModelCharacterEncumbrance.encumbranceSteps);\r\n  }\r\n\r\n  get value(): number {\r\n    return this.#weight;\r\n  }\r\n}\r\n","/**\r\n * @file A class representing the \"Detailed\" encumbrance scheme from Old School Essentials: Classic Fantasy\r\n */\r\nimport OseDataModelCharacterEncumbrance, {\r\n  CharacterEncumbrance,\r\n} from \"./data-model-character-encumbrance\";\r\n\r\n// import { OSE } from '../../config';\r\n\r\n/**\r\n * @todo Add template path for encumbrance bar\r\n * @todo Add template path for inventory item row\r\n */\r\nexport default class OseDataModelCharacterEncumbranceDetailed\r\n  extends OseDataModelCharacterEncumbrance\r\n  implements CharacterEncumbrance\r\n{\r\n  static templateEncumbranceBar = \"\";\r\n\r\n  static templateInventoryRow = \"\";\r\n\r\n  /**\r\n   * The machine-readable label for this encumbrance scheme\r\n   */\r\n  static type = \"detailed\";\r\n\r\n  /**\r\n   * The human-readable label for this encumbrance scheme\r\n   */\r\n  static localizedLabel = \"OSE.Setting.EncumbranceDetailed\";\r\n\r\n  /**\r\n   * The weight (in coins) to add to the total weight value if the character has adventuring gear\r\n   */\r\n  static gearWeight = 80;\r\n\r\n  #weight = 0;\r\n\r\n  #hasAdventuringGear;\r\n\r\n  constructor(\r\n    max = OseDataModelCharacterEncumbrance.baseEncumbranceCap,\r\n    items: Item[] = []\r\n  ) {\r\n    super(OseDataModelCharacterEncumbranceDetailed.type, max);\r\n    this.#hasAdventuringGear = items.some(\r\n      (i: Item) => i.type === \"item\" && !i.system.treasure\r\n    );\r\n    this.#weight =\r\n      items.reduce(\r\n        (acc, { type, system: { treasure, quantity, weight } }: Item) => {\r\n          if (type === \"spell\" || type === \"ability\") return acc;\r\n\r\n          let value = acc;\r\n\r\n          if (type === \"item\" && treasure) value += quantity.value * weight;\r\n          if ([\"weapon\", \"armor\", \"container\"].includes(type)) value += weight;\r\n\r\n          return value;\r\n        },\r\n        0\r\n      ) +\r\n      (this.#hasAdventuringGear\r\n        ? OseDataModelCharacterEncumbranceDetailed.gearWeight\r\n        : 0);\r\n  }\r\n\r\n  // eslint-disable-next-line class-methods-use-this\r\n  get steps() {\r\n    return Object.values(OseDataModelCharacterEncumbrance.encumbranceSteps);\r\n  }\r\n\r\n  get value(): number {\r\n    return this.#weight;\r\n  }\r\n}\r\n","/**\r\n * @file A class representing the \"Disabled\" encumbrance scheme;\r\n *       we aren't tracking carry weight here.\r\n */\r\nimport OseDataModelCharacterEncumbrance, {\r\n  CharacterEncumbrance,\r\n} from \"./data-model-character-encumbrance\";\r\n\r\n// import { OSE } from '../../config';\r\n\r\n/**\r\n * @todo Add template path for encumbrance bar\r\n * @todo Add template path for inventory item row\r\n */\r\nexport default class OseDataModelCharacterEncumbranceDisabled\r\n  extends OseDataModelCharacterEncumbrance\r\n  implements CharacterEncumbrance\r\n{\r\n  static templateEncumbranceBar = \"\";\r\n\r\n  static templateInventoryRow = \"\";\r\n\r\n  /**\r\n   * The machine-readable label for this encumbrance scheme\r\n   */\r\n  static type = \"disabled\";\r\n\r\n  /**\r\n   * The human-readable label for this encumbrance scheme\r\n   */\r\n  static localizedLabel = \"OSE.Setting.EncumbranceDisabled\";\r\n\r\n  constructor() {\r\n    super(OseDataModelCharacterEncumbranceDisabled.type);\r\n  }\r\n\r\n  // eslint-disable-next-line class-methods-use-this\r\n  get value(): number {\r\n    return 0;\r\n  }\r\n}\r\n","/**\r\n * @file A class representing the \"Item-based\" encumbrance scheme from Carcass Crawler Issue Two\r\n */\r\nimport OseDataModelCharacterEncumbrance, {\r\n  CharacterEncumbrance,\r\n} from \"./data-model-character-encumbrance\";\r\n\r\n// import { OSE } from '../../config';\r\n\r\n/**\r\n * @todo Add template path for encumbrance bar\r\n * @todo Add template path for inventory item row\r\n */\r\nexport default class OseDataModelCharacterEncumbranceItemBased\r\n  extends OseDataModelCharacterEncumbrance\r\n  implements CharacterEncumbrance\r\n{\r\n  static packedEncumbranceSteps = {\r\n    fiveEighths: 62.5,\r\n    threeQuarters: 75,\r\n    sevenEighths: 87.5,\r\n  };\r\n\r\n  static equippedEncumbranceSteps = {\r\n    oneThird: 33.33,\r\n    fiveNinths: 55.55,\r\n    sevenNinths: 77.77,\r\n  };\r\n\r\n  #equippedMax;\r\n\r\n  #packedMax;\r\n\r\n  #max;\r\n\r\n  #atFiveEighths;\r\n  #atThreeQuarters;\r\n  #atSevenEights;\r\n\r\n  #atOneThird;\r\n  #atFiveNinths;\r\n  #atSevenNinths;\r\n\r\n  static templateEncumbranceBar = \"\";\r\n\r\n  static templateInventoryRow = \"\";\r\n\r\n  /**\r\n   * The machine-readable label for this encumbrance scheme\r\n   */\r\n  static type = \"itembased\";\r\n\r\n  /**\r\n   * The human-readable label for this encumbrance scheme\r\n   */\r\n  static localizedLabel = \"OSE.Setting.EncumbranceItemBased\";\r\n\r\n  #weight;\r\n\r\n  #equippedWeight;\r\n\r\n  #packedWeight;\r\n\r\n  constructor(max = 16, items: Item[] = []) {\r\n    super(OseDataModelCharacterEncumbranceItemBased.type, max);\r\n\r\n    this.#packedMax = 16;\r\n    this.#equippedMax = 9;\r\n    this.#packedWeight = Math.ceil(\r\n      items.reduce(\r\n        (acc, { type, system: { quantity, itemslots, equipped } }: Item) => {\r\n          if (type === \"item\" && !equipped)\r\n            return acc + quantity.value * itemslots;\r\n          if ([\"weapon\", \"armor\", \"container\"].includes(type) && !equipped)\r\n            return acc + itemslots;\r\n          return acc;\r\n        },\r\n        0\r\n      )\r\n    );\r\n    this.#equippedWeight = Math.ceil(\r\n      items.reduce(\r\n        (acc, { type, system: { quantity, itemslots, equipped } }: Item) => {\r\n          if (type === \"item\" && equipped)\r\n            return acc + quantity.value * itemslots;\r\n          if ([\"weapon\", \"armor\", \"container\"].includes(type) && equipped)\r\n            return acc + itemslots;\r\n          return acc;\r\n        },\r\n        0\r\n      )\r\n    );\r\n    this.#weight = this.usingEquippedEncumbrance\r\n      ? this.#equippedWeight\r\n      : this.#packedWeight;\r\n\r\n    this.#max = this.usingEquippedEncumbrance\r\n      ? this.#equippedMax\r\n      : this.#packedMax;\r\n\r\n    this.#atFiveEighths = this.#weight > this.#max * (OseDataModelCharacterEncumbranceItemBased.packedEncumbranceSteps.fiveEighths / 100);\r\n    this.#atThreeQuarters = this.#weight > this.#max * (OseDataModelCharacterEncumbranceItemBased.packedEncumbranceSteps.threeQuarters / 100);\r\n    this.#atSevenEights = this.#weight > this.#max * (OseDataModelCharacterEncumbranceItemBased.packedEncumbranceSteps.sevenEighths / 100);\r\n  \r\n    this.#atOneThird = this.#weight > this.#max * (OseDataModelCharacterEncumbranceItemBased.equippedEncumbranceSteps.oneThird / 100);\r\n    this.#atFiveNinths = this.#weight > this.#max * (OseDataModelCharacterEncumbranceItemBased.equippedEncumbranceSteps.fiveNinths / 100);\r\n    this.#atSevenNinths = this.#weight > this.#max * (OseDataModelCharacterEncumbranceItemBased.equippedEncumbranceSteps.sevenNinths / 100);\r\n      \r\n  }\r\n\r\n  // eslint-disable-next-line class-methods-use-this\r\n  get steps() {\r\n    return this.usingEquippedEncumbrance\r\n      ? Object.values(\r\n          OseDataModelCharacterEncumbranceItemBased.equippedEncumbranceSteps\r\n        )\r\n      : Object.values(\r\n          OseDataModelCharacterEncumbranceItemBased.packedEncumbranceSteps\r\n        );\r\n  }\r\n\r\n  get usingEquippedEncumbrance() {\r\n    const equippedValues = Object.values(\r\n      OseDataModelCharacterEncumbranceItemBased.equippedEncumbranceSteps\r\n    );\r\n    const packedValues = Object.values(\r\n      OseDataModelCharacterEncumbranceItemBased.packedEncumbranceSteps\r\n    );\r\n    let equippedIndex = equippedValues.findIndex(\r\n      (step) => step > (this.#equippedWeight / this.#equippedMax) * 100\r\n    );\r\n    equippedIndex = equippedIndex === -1 ? 4 : equippedIndex;\r\n    let packedIndex = packedValues.findIndex(\r\n      (step) => step > (this.#packedWeight / this.#packedMax) * 100\r\n    );\r\n    packedIndex = packedIndex === -1 ? 4 : packedIndex;\r\n    return !!(equippedIndex >= packedIndex);\r\n  }\r\n\r\n  get value(): number {\r\n    return this.#weight;\r\n  }\r\n\r\n  get max(): number {\r\n    return this.#max;\r\n  }\r\n\r\n  get atFirstBreakpoint(): boolean {\r\n    return this.usingEquippedEncumbrance\r\n      ? this.#atOneThird\r\n      : this.#atFiveEighths;\r\n  }\r\n\r\n  get atSecondBreakpoint(): boolean {\r\n    return this.usingEquippedEncumbrance\r\n      ? this.#atFiveNinths\r\n      : this.#atThreeQuarters;\r\n  }\r\n\r\n  get atThirdBreakpoint(): boolean {\r\n    return this.usingEquippedEncumbrance\r\n      ? this.#atSevenNinths\r\n      : this.#atSevenEights;\r\n  }\r\n}\r\n","/**\r\n * @file System-wide configuration settings. Should be reachable elsewhere in the system at `CONFIG.OSE`\r\n */\r\nimport OseDataModelCharacterEncumbranceBasic from \"./actor/data-model-classes/data-model-character-encumbrance-basic\";\r\nimport OseDataModelCharacterEncumbranceComplete from \"./actor/data-model-classes/data-model-character-encumbrance-complete\";\r\nimport OseDataModelCharacterEncumbranceDetailed from \"./actor/data-model-classes/data-model-character-encumbrance-detailed\";\r\nimport OseDataModelCharacterEncumbranceDisabled from \"./actor/data-model-classes/data-model-character-encumbrance-disabled\";\r\nimport OseDataModelCharacterEncumbranceItemBased from \"./actor/data-model-classes/data-model-character-encumbrance-item-based\";\r\n\r\nexport type OseConfig = typeof OSE;\r\n\r\nexport type Attribute = keyof OseConfig[\"scores\"];\r\nexport type ExplorationSkill = keyof OseConfig[\"exploration_skills\"];\r\nexport type RollType = keyof OseConfig[\"roll_type\"];\r\nexport type Save = keyof OseConfig[\"saves_long\"];\r\nexport type Armor = keyof OseConfig[\"armor\"];\r\nexport type Color = keyof OseConfig[\"colors\"];\r\nexport type InventoryItemTag = keyof OseConfig[\"tags\"];\r\nexport type EncumbranceOption = keyof OseConfig[\"encumbranceOptions\"];\r\nexport type ApplyDamageOption = keyof OseConfig[\"apply_damage_options\"];\r\n\r\nexport const OSE = {  \r\n  /** Path for system dist */\r\n  systemPath(): string {\r\n    return `${this.systemRoot}/dist`;\r\n  },  \r\n  /** Root path for OSE system */\r\n  get systemRoot(): string {\r\n    return `/systems/${game.system.id}`;\r\n  },\r\n  /** Path for system assets */\r\n  get assetsPath(): string {\r\n    return `${this.systemRoot}/assets`;\r\n  },\r\n  get encumbrance() {\r\n    const variant = game.settings.get(game.system.id, \"encumbranceOption\");\r\n    return this.encumbranceOptions[variant] || this.encumbranceOptions.disabled;\r\n  },\r\n  encumbranceOptions: {\r\n    basic: OseDataModelCharacterEncumbranceBasic,\r\n    detailed: OseDataModelCharacterEncumbranceDetailed,\r\n    complete: OseDataModelCharacterEncumbranceComplete,\r\n    disabled: OseDataModelCharacterEncumbranceDisabled,\r\n    itembased: OseDataModelCharacterEncumbranceItemBased,\r\n  },\r\n  scores: {\r\n    str: \"OSE.scores.str.long\",\r\n    int: \"OSE.scores.int.long\",\r\n    dex: \"OSE.scores.dex.long\",\r\n    wis: \"OSE.scores.wis.long\",\r\n    con: \"OSE.scores.con.long\",\r\n    cha: \"OSE.scores.cha.long\",\r\n  },\r\n  scores_short: {\r\n    str: \"OSE.scores.str.short\",\r\n    int: \"OSE.scores.int.short\",\r\n    dex: \"OSE.scores.dex.short\",\r\n    wis: \"OSE.scores.wis.short\",\r\n    con: \"OSE.scores.con.short\",\r\n    cha: \"OSE.scores.cha.short\",\r\n  },\r\n  exploration_skills: {\r\n    ld: \"OSE.exploration.ld.long\",\r\n    od: \"OSE.exploration.od.long\",\r\n    sd: \"OSE.exploration.sd.long\",\r\n    fs: \"OSE.exploration.ft.long\",\r\n  },\r\n  exploration_skills_short: {\r\n    ld: \"OSE.exploration.ld.abrev\",\r\n    od: \"OSE.exploration.od.abrev\",\r\n    sd: \"OSE.exploration.sd.abrev\",\r\n    fs: \"OSE.exploration.ft.abrev\",\r\n  },\r\n  roll_type: {\r\n    result: \"=\",\r\n    above: \"≥\",\r\n    below: \"≤\",\r\n  },\r\n  saves_short: {\r\n    death: \"OSE.saves.death.short\",\r\n    wand: \"OSE.saves.wand.short\",\r\n    paralysis: \"OSE.saves.paralysis.short\",\r\n    breath: \"OSE.saves.breath.short\",\r\n    spell: \"OSE.saves.spell.short\",\r\n  },\r\n  saves_long: {\r\n    death: \"OSE.saves.death.long\",\r\n    wand: \"OSE.saves.wand.long\",\r\n    paralysis: \"OSE.saves.paralysis.long\",\r\n    breath: \"OSE.saves.breath.long\",\r\n    spell: \"OSE.saves.spell.long\",\r\n  },\r\n  armor: {\r\n    unarmored: \"OSE.armor.unarmored\",\r\n    light: \"OSE.armor.light\",\r\n    heavy: \"OSE.armor.heavy\",\r\n    shield: \"OSE.armor.shield\",\r\n  },\r\n  apply_damage_options: {\r\n    selected : \"selected\",\r\n    targeted : \"targeted\",\r\n    originalTarget : \"originalTarget\",\r\n  },\r\n  colors: {\r\n    green: \"OSE.colors.green\",\r\n    red: \"OSE.colors.red\",\r\n    yellow: \"OSE.colors.yellow\",\r\n    purple: \"OSE.colors.purple\",\r\n    blue: \"OSE.colors.blue\",\r\n    orange: \"OSE.colors.orange\",\r\n    white: \"OSE.colors.white\",\r\n  },\r\n  languages: [\r\n    \"Common\",\r\n    \"Lawful\",\r\n    \"Chaotic\",\r\n    \"Neutral\",\r\n    \"Bugbear\",\r\n    \"Doppelgänger\",\r\n    \"Dragon\",\r\n    \"Dwarvish\",\r\n    \"Elvish\",\r\n    \"Gargoyle\",\r\n    \"Gnoll\",\r\n    \"Gnomish\",\r\n    \"Goblin\",\r\n    \"Halfling\",\r\n    \"Harpy\",\r\n    \"Hobgoblin\",\r\n    \"Kobold\",\r\n    \"Lizard Man\",\r\n    \"Medusa\",\r\n    \"Minotaur\",\r\n    \"Ogre\",\r\n    \"Orcish\",\r\n    \"Pixie\",\r\n  ],\r\n  tags: {\r\n    melee: \"OSE.items.Melee\",\r\n    missile: \"OSE.items.Missile\",\r\n    slow: \"OSE.items.Slow\",\r\n    twohanded: \"OSE.items.TwoHanded\",\r\n    blunt: \"OSE.items.Blunt\",\r\n    brace: \"OSE.items.Brace\",\r\n    splash: \"OSE.items.Splash\",\r\n    reload: \"OSE.items.Reload\",\r\n    charge: \"OSE.items.Charge\",\r\n  },\r\n  auto_tags: {\r\n    get melee() {\r\n      return {\r\n        label: CONFIG.OSE.tags.melee,\r\n        image: `${CONFIG.OSE.assetsPath}/melee.png`,\r\n        icon: \"fa-sword\",\r\n      };\r\n    },\r\n    get missile() {\r\n      return {\r\n        label: CONFIG.OSE.tags.missile,\r\n        image: `${CONFIG.OSE.assetsPath}/missile.png`,\r\n        icon: \"fa-bow-arrow\",\r\n      };\r\n    },\r\n    get slow() {\r\n      return {\r\n        label: CONFIG.OSE.tags.slow,\r\n        image: `${CONFIG.OSE.assetsPath}/slow.png`,\r\n        icon: \"fa-weight-hanging\",\r\n      };\r\n    },\r\n    get twohanded() {\r\n      return {\r\n        label: CONFIG.OSE.tags.twohanded,\r\n        image: `${CONFIG.OSE.assetsPath}/twohanded.png`,\r\n        icon: \"fa-hands-holding\",\r\n      };\r\n    },\r\n    get blunt() {\r\n      return {\r\n        label: CONFIG.OSE.tags.blunt,\r\n        image: `${CONFIG.OSE.assetsPath}/blunt.png`,\r\n        icon: \"fa-hammer-crash\",\r\n      };\r\n    },\r\n    get brace() {\r\n      return {\r\n        label: CONFIG.OSE.tags.brace,\r\n        image: `${CONFIG.OSE.assetsPath}/brace.png`,\r\n        icon: \"fa-block-brick\",\r\n      };\r\n    },\r\n    get splash() {\r\n      return {\r\n        label: CONFIG.OSE.tags.splash,\r\n        image: `${CONFIG.OSE.assetsPath}/splash.png`,\r\n        icon: \"fa-burst\",\r\n      };\r\n    },\r\n    get reload() {\r\n      return {\r\n        label: CONFIG.OSE.tags.reload,\r\n        image: `${CONFIG.OSE.assetsPath}/reload.png`,\r\n        icon: \"fa-gear\",\r\n      };\r\n    },\r\n    get charge() {\r\n      return {\r\n        label: CONFIG.OSE.tags.charge,\r\n        image: `${CONFIG.OSE.assetsPath}/charge.png`,\r\n        icon: \"fa-person-running\",\r\n      };\r\n    },\r\n  },\r\n  tag_images: {\r\n    get melee() {\r\n      return `${CONFIG.OSE.assetsPath}/melee.png`;\r\n    },\r\n    get missile() {\r\n      return `fa-bow-arrow`;\r\n    },\r\n    get slow() {\r\n      return `${CONFIG.OSE.assetsPath}/slow.png`;\r\n    },\r\n    get twohanded() {\r\n      return `${CONFIG.OSE.assetsPath}/twohanded.png`;\r\n    },\r\n    get blunt() {\r\n      return `${CONFIG.OSE.assetsPath}/blunt.png`;\r\n    },\r\n    get brace() {\r\n      return `${CONFIG.OSE.assetsPath}/brace.png`;\r\n    },\r\n    get splash() {\r\n      return `${CONFIG.OSE.assetsPath}/splash.png`;\r\n    },\r\n    get reload() {\r\n      return `${CONFIG.OSE.assetsPath}/reload.png`;\r\n    },\r\n    get charge() {\r\n      return `${CONFIG.OSE.assetsPath}/charge.png`;\r\n    },\r\n  },\r\n  monster_saves: {\r\n    0: {\r\n      d: 14,\r\n      w: 15,\r\n      p: 16,\r\n      b: 17,\r\n      s: 18,\r\n    },\r\n    1: {\r\n      d: 12,\r\n      w: 13,\r\n      p: 14,\r\n      b: 15,\r\n      s: 16,\r\n    },\r\n    4: {\r\n      d: 10,\r\n      w: 11,\r\n      p: 12,\r\n      b: 13,\r\n      s: 14,\r\n    },\r\n    7: {\r\n      d: 8,\r\n      w: 9,\r\n      p: 10,\r\n      b: 10,\r\n      s: 12,\r\n    },\r\n    10: {\r\n      d: 6,\r\n      w: 7,\r\n      p: 8,\r\n      b: 8,\r\n      s: 10,\r\n    },\r\n    13: {\r\n      d: 4,\r\n      w: 5,\r\n      p: 6,\r\n      b: 5,\r\n      s: 8,\r\n    },\r\n    16: {\r\n      d: 2,\r\n      w: 3,\r\n      p: 4,\r\n      b: 3,\r\n      s: 6,\r\n    },\r\n    19: {\r\n      d: 2,\r\n      w: 2,\r\n      p: 2,\r\n      b: 2,\r\n      s: 4,\r\n    },\r\n    22: {\r\n      d: 2,\r\n      w: 2,\r\n      p: 2,\r\n      b: 2,\r\n      s: 2,\r\n    },\r\n  },\r\n  monster_thac0: {\r\n    0: 20,\r\n    1: 19,\r\n    2: 18,\r\n    3: 17,\r\n    4: 16,\r\n    5: 15,\r\n    6: 14,\r\n    7: 13,\r\n    9: 12,\r\n    10: 11,\r\n    12: 10,\r\n    14: 9,\r\n    16: 8,\r\n    18: 7,\r\n    20: 6,\r\n    22: 5,\r\n  },\r\n};\r\n\r\nexport default OSE;\r\n","/**\r\n * @file Helpful methods for dealing with OSE-specific dice logic\r\n */\r\nimport OSE from \"./config\";\r\n\r\nconst OseDice = {\r\n  async sendRoll({\r\n    parts = [],\r\n    data = {},\r\n    title = null,\r\n    flavor = null,\r\n    speaker = null,\r\n    form = null,\r\n    chatMessage = true,\r\n  } = {}) {\r\n    const template = `${OSE.systemPath()}/templates/chat/roll-result.html`;\r\n\r\n    const chatData = {\r\n      user: game.user.id,\r\n      speaker,\r\n    };\r\n\r\n    const templateData = {\r\n      title,\r\n      flavor,\r\n      data,\r\n      config: CONFIG.OSE,\r\n    };\r\n\r\n    // Optionally include a situational bonus\r\n    if (form !== null && form.bonus.value) {\r\n      parts.push(form.bonus.value);\r\n    }\r\n\r\n    // ;\r\n    const roll = new Roll(parts.join(\"+\"), data).evaluate({ async: false });\r\n\r\n    // Convert the roll to a chat message and return the roll\r\n    let rollMode = game.settings.get(\"core\", \"rollMode\");\r\n    rollMode = form ? form.rollMode.value : rollMode;\r\n\r\n    // Force blind roll (ability formulas)\r\n    if (!form && data.roll.blindroll) {\r\n      rollMode = game.user.isGM ? \"selfroll\" : \"blindroll\";\r\n    }\r\n\r\n    if ([\"gmroll\", \"blindroll\"].includes(rollMode))\r\n      chatData.whisper = ChatMessage.getWhisperRecipients(\"GM\");\r\n    if (rollMode === \"selfroll\") chatData.whisper = [game.user._id];\r\n    if (rollMode === \"blindroll\") {\r\n      chatData.blind = true;\r\n      data.roll.blindroll = true;\r\n    }\r\n\r\n    templateData.result = OseDice.digestResult(data, roll);\r\n\r\n    return new Promise((resolve) => {\r\n      roll.render().then((r) => {\r\n        templateData.rollOSE = r;\r\n        renderTemplate(template, templateData).then((content) => {\r\n          chatData.content = content;\r\n          // Dice So Nice\r\n          if (game.dice3d) {\r\n            game.dice3d\r\n              .showForRoll(\r\n                roll,\r\n                game.user,\r\n                true,\r\n                chatData.whisper,\r\n                chatData.blind\r\n              )\r\n              .then((displayed) => {\r\n                if (chatMessage !== false) ChatMessage.create(chatData);\r\n                resolve(roll);\r\n              });\r\n          } else {\r\n            chatData.sound = CONFIG.sounds.dice;\r\n            if (chatMessage !== false) ChatMessage.create(chatData);\r\n            resolve(roll);\r\n          }\r\n        });\r\n      });\r\n    });\r\n  },\r\n\r\n  /**\r\n   * Digesting results depending on type of roll\r\n   *\r\n   * @param {object} data - Contains roll data, including what type of check\r\n   * @param {object} roll - Evaluated Roll returned object\r\n   * @returns {object} - Object containing the evaluated data // @todo DigestResult\r\n   */\r\n  digestResult(data, roll) {\r\n    // @todo: Extract this to a DigestResult type/interface\r\n    const result = {\r\n      isSuccess: false,\r\n      isFailure: false,\r\n      target: data.roll.target,\r\n      total: roll.total,\r\n    };\r\n\r\n    const die = roll.terms[0].results[0].result;\r\n    // eslint-disable-next-line default-case\r\n    switch (data.roll.type) {\r\n      case \"result\": {\r\n        if (roll.total === result.target) {\r\n          result.isSuccess = true;\r\n        } else {\r\n          result.isFailure = true;\r\n        }\r\n\r\n        break;\r\n      }\r\n\r\n      case \"above\": {\r\n        // SAVING THROWS\r\n        if (roll.total >= result.target) {\r\n          result.isSuccess = true;\r\n        } else {\r\n          result.isFailure = true;\r\n        }\r\n\r\n        break;\r\n      }\r\n\r\n      case \"below\": {\r\n        // MORALE, EXPLORATION\r\n        if (roll.total <= result.target) {\r\n          result.isSuccess = true;\r\n        } else {\r\n          result.isFailure = true;\r\n        }\r\n\r\n        break;\r\n      }\r\n\r\n      case \"check\": {\r\n        // SCORE CHECKS (1s and 20s)\r\n        if (die === 1 || (roll.total <= result.target && die < 20)) {\r\n          result.isSuccess = true;\r\n        } else {\r\n          result.isFailure = true;\r\n        }\r\n\r\n        break;\r\n      }\r\n\r\n      case \"table\": {\r\n        // Reaction\r\n        const { table } = data.roll;\r\n        let output = Object.values(table)[0];\r\n        for (let i = 0; i <= roll.total; i++) {\r\n          if (table[i]) {\r\n            output = table[i];\r\n          }\r\n        }\r\n        result.details = output;\r\n\r\n        break;\r\n      }\r\n\r\n      default : {\r\n        result.isSuccess = false;\r\n        result.isFailure = false;\r\n\r\n        break;\r\n      }\r\n    }\r\n    return result;\r\n  },\r\n\r\n  /**\r\n   * Evaluates if a roll is successful for both THAC0 and Ascending AC\r\n   *\r\n   * @param {object} roll - Evaluated roll data from a Roll\r\n   * @param {number} thac0 - THAC0 value, or Hit Target when AscendingAC\r\n   * @param {number} ac - AC Value, or Attack Bonus when AscendingAC\r\n   * @returns {boolean} - Did the attack succeed?\r\n   */\r\n  attackIsSuccess(roll, thac0, ac) {\r\n    // Natural 1\r\n    if (roll.terms[0].results[0].result === 1) {\r\n      return false;\r\n    }\r\n    // Natural 20\r\n    if (roll.terms[0].results[0].result === 20) {\r\n      return true;\r\n    }\r\n    return roll.total + ac >= thac0;\r\n  },\r\n\r\n  /**\r\n   * Digest the results of a target to reach, and an evaluated roll\r\n   * to evaluate if it does hit or not. The function adds information\r\n   * for generating chat card data too.\r\n   *\r\n   * @param {object} data - Data with at least roll target data\r\n   * @param {object} roll - Evaluation result from a Roll\r\n   * @returns {object} - DigestResult\r\n   */\r\n  digestAttackResult(data, roll) {\r\n    // @todo: Extract this to a DigestResult type/interface\r\n    const result = {\r\n      isSuccess: false,\r\n      isFailure: false,\r\n      target: \"\",\r\n      total: roll.total,\r\n    };\r\n    result.target = data.roll.thac0;\r\n    const targetActorData = data.roll.target?.actor?.system || null;\r\n\r\n    const targetAc = data.roll.target ? targetActorData.ac.value : 20;\r\n    const targetAac = data.roll.target ? targetActorData.aac.value : -20;\r\n    result.victim = data.roll.target || null;\r\n\r\n    if (game.settings.get(game.system.id, \"ascendingAC\")) {\r\n      const attackBonus = 19 - data.roll.thac0;\r\n      if (this.attackIsSuccess(roll, targetAac, attackBonus)) {\r\n        result.details = game.i18n.format(\r\n          \"OSE.messages.AttackAscendingSuccess\",\r\n          {\r\n            result: roll.total,\r\n          }\r\n        );\r\n        result.isSuccess = true;\r\n      } else {\r\n        result.details = game.i18n.format(\r\n          \"OSE.messages.AttackAscendingFailure\",\r\n          {\r\n            bonus: result.target,\r\n          }\r\n        );\r\n        result.isFailure = true;\r\n      }\r\n    } else if (this.attackIsSuccess(roll, result.target, targetAc)) {\r\n      // Answer is bounded betweewn AC -3 and 9 (unarmored) and is shown in chat card\r\n      const value = Math.clamped(result.target - roll.total, -3, 9);\r\n      result.details = game.i18n.format(\"OSE.messages.AttackSuccess\", {\r\n        result: value,\r\n        bonus: result.target,\r\n      });\r\n      result.isSuccess = true;\r\n    } else {\r\n      result.details = game.i18n.format(\"OSE.messages.AttackFailure\", {\r\n        bonus: result.target,\r\n      });\r\n      result.isFailure = true;\r\n    }\r\n    return result;\r\n  },\r\n\r\n  /**\r\n   * Puts together the information needed to roll a Roll and the\r\n   * expectations on hitting a target. Also creates the chat card\r\n   * containing the infromation about the evaluated roll.\r\n   *\r\n   * @param {object} param0 - Object to evaluate\r\n   * @param {Array<String || number>} param0.parts - Roll parts (e.g. [\"1d20\", \"3\", \"0\", \"0\"])\r\n   * @param {object} param0.data - Object containing target data\r\n   * @param {object} param0.data.roll - Roll target data\r\n   * @param {Array<String || number|} param0.data.roll.dmg - Roll parts for damage roll if hit\r\n   * @param {Actor | null} param0.data.target - Target data for the intended hit target\r\n   * @param {object} param0.flags -Not used directly in function, but may be passed on\r\n   * @param {string} param0.title - Modified in RollSave() if magic save required\r\n   * @param {string} param0.flavor - Not used directly in function\r\n   * @param {object} param0.speaker - Speaker data for the chat card\r\n   * @param {object} param0.form - Data from the Dialog Form that generates data for the function\r\n   * @returns {Promise || Void} - Either not returning anything, or a Promise for rendering a Chat Card\r\n   */\r\n  async sendAttackRoll({\r\n    parts = [],\r\n    data = {},\r\n    flags = {},\r\n    title = null,\r\n    flavor = null,\r\n    speaker = null,\r\n    form = null,\r\n  } = {}) {\r\n    if (data.roll.dmg.filter((v) => v !== \"\").length === 0) {\r\n      /**\r\n       * @todo should this error be localized?\r\n       */\r\n      ui.notifications.error(\r\n        \"Attack has no damage dice terms; be sure to set the attack's damage\"\r\n      );\r\n      return;\r\n    }\r\n    const template = `${OSE.systemPath()}/templates/chat/roll-attack.html`;\r\n    const chatData = {\r\n      user: game.user.id,\r\n      speaker,\r\n      flags,\r\n    };\r\n\r\n    const templateData = {\r\n      title,\r\n      flavor,\r\n      data,\r\n      config: CONFIG.OSE,\r\n    };\r\n\r\n    // Optionally include a situational bonus\r\n    if (form !== null && form.bonus.value) parts.push(form.bonus.value);\r\n\r\n    const roll = new Roll(parts.join(\"+\"), data).evaluate({ async: false });\r\n    const dmgRoll = new Roll(data.roll.dmg.join(\"+\"), data).evaluate({\r\n      async: false,\r\n    });\r\n\r\n    // Convert the roll to a chat message and return the roll\r\n    let rollMode = game.settings.get(\"core\", \"rollMode\");\r\n    rollMode = form ? form.rollMode.value : rollMode;\r\n\r\n    // Force blind roll (ability formulas)\r\n    if (data.roll.blindroll) {\r\n      rollMode = game.user.isGM ? \"selfroll\" : \"blindroll\";\r\n    }\r\n\r\n    if ([\"gmroll\", \"blindroll\"].includes(rollMode))\r\n      chatData.whisper = ChatMessage.getWhisperRecipients(\"GM\");\r\n    if (rollMode === \"selfroll\") chatData.whisper = [game.user._id];\r\n    if (rollMode === \"blindroll\") {\r\n      chatData.blind = true;\r\n      data.roll.blindroll = true;\r\n    }\r\n\r\n    templateData.result = OseDice.digestAttackResult(data, roll);\r\n\r\n    return new Promise((resolve) => {\r\n      roll.render().then((r) => {\r\n        templateData.rollOSE = r;\r\n        dmgRoll.render().then((dr) => {\r\n          templateData.rollDamage = dr;\r\n          renderTemplate(template, templateData).then((content) => {\r\n            chatData.content = content;\r\n            // 2 Step Dice So Nice\r\n            if (game.dice3d) {\r\n              game.dice3d\r\n                .showForRoll(\r\n                  roll,\r\n                  game.user,\r\n                  true,\r\n                  chatData.whisper,\r\n                  chatData.blind\r\n                )\r\n                .then(() => {\r\n                  if (templateData.result.isSuccess) {\r\n                    templateData.result.dmg = dmgRoll.total;\r\n                    game.dice3d\r\n                      .showForRoll(\r\n                        dmgRoll,\r\n                        game.user,\r\n                        true,\r\n                        chatData.whisper,\r\n                        chatData.blind\r\n                      )\r\n                      .then(() => {\r\n                        ChatMessage.create(chatData);\r\n                        resolve(roll);\r\n                      });\r\n                  } else {\r\n                    ChatMessage.create(chatData);\r\n                    resolve(roll);\r\n                  }\r\n                });\r\n            } else {\r\n              chatData.sound = CONFIG.sounds.dice;\r\n              ChatMessage.create(chatData);\r\n              resolve(roll);\r\n            }\r\n          });\r\n        });\r\n      });\r\n    });\r\n  },\r\n\r\n  async RollSave({\r\n    parts = [],\r\n    data = {},\r\n    skipDialog = false,\r\n    speaker = null,\r\n    flavor = null,\r\n    title = null,\r\n    chatMessage = true,\r\n  } = {}) {\r\n    let rolled = false;\r\n    const template = `${OSE.systemPath()}/templates/chat/roll-dialog.html`;\r\n    const dialogData = {\r\n      formula: parts.join(\" \"),\r\n      data,\r\n      rollMode: game.settings.get(\"core\", \"rollMode\"),\r\n      rollModes: CONFIG.Dice.rollModes,\r\n    };\r\n\r\n    const rollData = {\r\n      parts,\r\n      data,\r\n      title,\r\n      flavor,\r\n      speaker,\r\n      chatMessage,\r\n    };\r\n    if (skipDialog) {\r\n      return OseDice.sendRoll(rollData);\r\n    }\r\n\r\n    const buttons = {\r\n      ok: {\r\n        label: game.i18n.localize(\"OSE.Roll\"),\r\n        icon: '<i class=\"fas fa-dice-d20\"></i>',\r\n        callback: (html) => {\r\n          rolled = true;\r\n          rollData.form = html[0].querySelector(\"form\");\r\n          roll = OseDice.sendRoll(rollData);\r\n        },\r\n      },\r\n      magic: {\r\n        label: game.i18n.localize(\"OSE.saves.magic.short\"),\r\n        icon: '<i class=\"fas fa-magic\"></i>',\r\n        callback: (html) => {\r\n          rolled = true;\r\n          rollData.form = html[0].querySelector(\"form\");\r\n          rollData.parts.push(`${rollData.data.roll.magic}`);\r\n          rollData.title += ` ${game.i18n.localize(\"OSE.saves.magic.short\")} (${\r\n            rollData.data.roll.magic\r\n          })`;\r\n          roll = OseDice.sendRoll(rollData);\r\n        },\r\n      },\r\n      cancel: {\r\n        icon: '<i class=\"fas fa-times\"></i>',\r\n        label: game.i18n.localize(\"OSE.Cancel\"),\r\n        callback: (html) => {},\r\n      },\r\n    };\r\n\r\n    const html = await renderTemplate(template, dialogData);\r\n    let roll;\r\n\r\n    // Create Dialog window\r\n    return new Promise((resolve) => {\r\n      new Dialog({\r\n        title,\r\n        content: html,\r\n        buttons,\r\n        default: \"ok\",\r\n        close: () => {\r\n          resolve(rolled ? roll : false);\r\n        },\r\n      }).render(true);\r\n    });\r\n  },\r\n\r\n  async Roll({\r\n    parts = [],\r\n    data = {},\r\n    skipDialog = false,\r\n    speaker = null,\r\n    flavor = null,\r\n    title = null,\r\n    chatMessage = true,\r\n    flags = {},\r\n  } = {}) {\r\n    let rolled = false;\r\n    const template = `${OSE.systemPath()}/templates/chat/roll-dialog.html`;\r\n    const dialogData = {\r\n      formula: parts.join(\" \"),\r\n      data,\r\n      rollMode: data.roll.blindroll\r\n        ? \"blindroll\"\r\n        : game.settings.get(\"core\", \"rollMode\"),\r\n      rollModes: CONFIG.Dice.rollModes,\r\n    };\r\n    const rollData = {\r\n      parts,\r\n      data,\r\n      title,\r\n      flavor,\r\n      speaker,\r\n      chatMessage,\r\n      flags,\r\n    };\r\n    if (skipDialog) {\r\n      return [\"melee\", \"missile\", \"attack\"].includes(data.roll.type)\r\n        ? OseDice.sendAttackRoll(rollData)\r\n        : OseDice.sendRoll(rollData);\r\n    }\r\n\r\n    const buttons = {\r\n      ok: {\r\n        label: game.i18n.localize(\"OSE.Roll\"),\r\n        icon: '<i class=\"fas fa-dice-d20\"></i>',\r\n        callback: (html) => {\r\n          rolled = true;\r\n          rollData.form = html[0].querySelector(\"form\");\r\n          roll = [\"melee\", \"missile\", \"attack\"].includes(data.roll.type)\r\n            ? OseDice.sendAttackRoll(rollData)\r\n            : OseDice.sendRoll(rollData);\r\n        },\r\n      },\r\n      cancel: {\r\n        icon: '<i class=\"fas fa-times\"></i>',\r\n        label: game.i18n.localize(\"OSE.Cancel\"),\r\n        callback: (html) => {},\r\n      },\r\n    };\r\n\r\n    const html = await renderTemplate(template, dialogData);\r\n    let roll;\r\n\r\n    // Create Dialog window\r\n    return new Promise((resolve) => {\r\n      new Dialog({\r\n        title,\r\n        content: html,\r\n        buttons,\r\n        default: \"ok\",\r\n        close: () => {\r\n          resolve(rolled ? roll : false);\r\n        },\r\n      }).render(true);\r\n    });\r\n  },\r\n};\r\n\r\nexport default OseDice;\r\n","/**\r\n * @file The Character Creator application\r\n */\r\nimport OSE from \"../config\";\r\nimport OseDice from \"../helpers-dice\";\r\n\r\nexport default class OseCharacterCreator extends FormApplication {\r\n  static get defaultOptions() {\r\n    const options = super.defaultOptions;\r\n    options.classes = [\"ose\", \"dialog\", \"creator\"];\r\n    options.id = \"character-creator\";\r\n    options.template = `${OSE.systemPath()}/templates/actors/dialogs/character-creation.html`;\r\n    options.width = 235;\r\n    options.submitOnClose = false;\r\n    return options;\r\n  }\r\n\r\n  /* -------------------------------------------- */\r\n\r\n  /**\r\n   * Add the Entity name into the window title\r\n   *\r\n   * @type {string}\r\n   */\r\n  get title() {\r\n    return `${this.object.name}: ${game.i18n.localize(\"OSE.dialog.generator\")}`;\r\n  }\r\n\r\n  /* -------------------------------------------- */\r\n\r\n  /**\r\n   * Construct and return the data object used to render the HTML template for this form application.\r\n   *\r\n   * @returns {object} - Render data for the form application\r\n   */\r\n  getData() {\r\n    const data = foundry.utils.deepClone(this.object);\r\n    data.user = game.user;\r\n    data.config = CONFIG.OSE;\r\n    this.counters = {\r\n      str: 0,\r\n      wis: 0,\r\n      dex: 0,\r\n      int: 0,\r\n      cha: 0,\r\n      con: 0,\r\n      gold: 0,\r\n    };\r\n    this.stats = {\r\n      sum: 0,\r\n      avg: 0,\r\n      std: 0,\r\n    };\r\n    this.scores = {};\r\n    this.gold = 0;\r\n    return data;\r\n  }\r\n\r\n  /* -------------------------------------------- */\r\n\r\n  doStats(ev) {\r\n    const list = $(ev.currentTarget).closest(\".attribute-list\");\r\n    const scores = Object.values(this.scores);\r\n    const n = scores.length;\r\n    const sum = scores.reduce((acc, next) => acc + next.value, 0);\r\n    const mean = parseFloat(sum) / n;\r\n    const std = Math.sqrt(\r\n      scores\r\n        .map((x) => (x.value - mean) ** 2)\r\n        .reduce((acc, next) => acc + next, 0) / n\r\n    );\r\n\r\n    const stats = list.siblings(\".roll-stats\");\r\n    stats.find(\".sum\").text(sum);\r\n    stats.find(\".avg\").text(Math.round((10 * sum) / n) / 10);\r\n    stats.find(\".std\").text(Math.round(100 * std) / 100);\r\n\r\n    if (n >= 6) {\r\n      $(ev.currentTarget)\r\n        .closest(\"form\")\r\n        .find('button[type=\"submit\"]')\r\n        .removeAttr(\"disabled\");\r\n    }\r\n\r\n    this.object.stats = {\r\n      sum,\r\n      avg: Math.round((10 * sum) / n) / 10,\r\n      std: Math.round(100 * std) / 100,\r\n    };\r\n  }\r\n\r\n  rollScore(score, options = {}) {\r\n    // Increase counter\r\n    this.counters[score] += 1;\r\n\r\n    const label =\r\n      score === \"gold\"\r\n        ? \"Gold\"\r\n        : game.i18n.localize(`OSE.scores.${score}.long`);\r\n    const rollParts = [\"3d6\"];\r\n    const data = {\r\n      roll: {},\r\n    };\r\n    if (options.skipMessage) {\r\n      return new Roll(rollParts[0]).evaluate({ async: false });\r\n    }\r\n    // Roll and return\r\n    return OseDice.Roll({\r\n      event: options.event,\r\n      parts: rollParts,\r\n      data,\r\n      skipDialog: true,\r\n      speaker: ChatMessage.getSpeaker({ actor: this }),\r\n      flavor: game.i18n.format(\"OSE.dialog.generateScore\", {\r\n        score: label,\r\n        count: this.counters[score],\r\n      }),\r\n      title: game.i18n.format(\"OSE.dialog.generateScore\", {\r\n        score: label,\r\n        count: this.counters[score],\r\n      }),\r\n    });\r\n  }\r\n\r\n  /** @override */\r\n  activateListeners(html) {\r\n    super.activateListeners(html);\r\n    html.find(\"a.score-roll\").click((ev) => {\r\n      const el = ev.currentTarget.parentElement.parentElement;\r\n      const { score } = el.dataset;\r\n      this.rollScore(score, { event: ev }).then((r) => {\r\n        this.scores[score] = { value: r.total };\r\n        $(el).find(\"input\").val(r.total).trigger(\"change\");\r\n      });\r\n    });\r\n\r\n    html.find(\"a.gold-roll\").click((ev) => {\r\n      const el = ev.currentTarget.parentElement.parentElement.parentElement;\r\n      this.rollScore(\"gold\", { event: ev }).then((r) => {\r\n        this.gold = 10 * r.total;\r\n        $(el).find(\".gold-value\").val(this.gold);\r\n      });\r\n    });\r\n\r\n    html.find(\"input.score-value\").change((ev) => {\r\n      this.doStats(ev);\r\n    });\r\n\r\n    html.find(\"a.auto-roll\").click(async (ev) => {\r\n      const stats = [\"str\", \"int\", \"dex\", \"wis\", \"con\", \"cha\"];\r\n      for (const char of stats) {\r\n        const r = await this.rollScore(char, { event: ev, skipMessage: true });\r\n        this.scores[char] = { value: r.total };\r\n      }\r\n      this.doStats(ev);\r\n      const r = await this.rollScore(\"gold\", { event: ev, skipMessage: true });\r\n      this.gold = 10 * r.total;\r\n      this.submit();\r\n    });\r\n  }\r\n\r\n  // eslint-disable-next-line no-underscore-dangle\r\n  async _onSubmit(\r\n    event,\r\n    { updateData = null, preventClose = false, preventRender = false } = {}\r\n  ) {\r\n    const extendedData = { ...updateData, system: { scores: this.scores } };\r\n    // eslint-disable-next-line no-underscore-dangle\r\n    super._onSubmit(event, {\r\n      updateData: extendedData,\r\n      preventClose,\r\n      preventRender,\r\n    });\r\n\r\n    // Gather scores\r\n    const speaker = ChatMessage.getSpeaker({ actor: this.object.actor });\r\n    const templateData = {\r\n      config: CONFIG.OSE,\r\n      scores: this.scores,\r\n      title: game.i18n.localize(\"OSE.dialog.generator\"),\r\n      stats: this.object.stats,\r\n      gold: this.gold,\r\n    };\r\n    const content = await renderTemplate(\r\n      `${OSE.systemPath()}/templates/chat/roll-creation.html`,\r\n      templateData\r\n    );\r\n\r\n    await ChatMessage.create({\r\n      content,\r\n      speaker,\r\n    });\r\n\r\n    // Generate gold\r\n    const itemData = {\r\n      name: game.i18n.localize(\"OSE.items.gp.short\"),\r\n      type: \"item\",\r\n      img: `${OSE.assetsPath}/gold.png`,\r\n      system: {\r\n        treasure: true,\r\n        cost: 1,\r\n        weight: 1,\r\n        quantity: {\r\n          value: this.gold,\r\n        },\r\n      },\r\n    };\r\n    this.object.createEmbeddedDocuments(\"Item\", [itemData]);\r\n  }\r\n\r\n  /**\r\n   * This method is called upon form submission after form data is validated\r\n   *\r\n   * @param {Event} event - The initial triggering submission event\r\n   * @param {object} formData - The object of validated form data with which to update the object\r\n   * @private\r\n   */\r\n  // eslint-disable-next-line no-underscore-dangle\r\n  async _updateObject(event, formData) {\r\n    event.preventDefault();\r\n    // Update the actor\r\n    await this.object.update(formData);\r\n\r\n    // Re-draw the updated sheet\r\n    this.object.sheet.render(true);\r\n  }\r\n}\r\n","/**\r\n * @file An application for deducting currency from an actor using the Shopping Cart feature\r\n */\r\n// eslint-disable-next-line no-unused-vars\r\nimport OSE from \"../config\";\r\n\r\nexport default class OseCharacterGpCost extends FormApplication {\r\n  constructor(event, preparedData, position) {\r\n    super(event, position);\r\n    this.object.preparedData = preparedData;\r\n  }\r\n\r\n  static get defaultOptions() {\r\n    const options = super.defaultOptions;\r\n    options.classes = [\"ose\", \"dialog\", \"gp-cost\"];\r\n    options.id = \"sheet-gp-cost\";\r\n    options.template = `${OSE.systemPath()}/templates/actors/dialogs/gp-cost-dialog.html`;\r\n    options.width = 240;\r\n    return options;\r\n  }\r\n\r\n  /* -------------------------------------------- */\r\n\r\n  /**\r\n   * Add the Entity name into the window title\r\n   *\r\n   * @type {string}\r\n   * @returns {string} - A localized window title\r\n   */\r\n  get title() {\r\n    return `${this.object.name}: ${game.i18n.localize(\r\n      \"OSE.dialog.shoppingCart\"\r\n    )}`;\r\n  }\r\n\r\n  /* -------------------------------------------- */\r\n\r\n  /**\r\n   * Construct and return the data object used to render the HTML template for this form application.\r\n   *\r\n   * @returns {object} - The template data\r\n   */\r\n  async getData() {\r\n    const data = await foundry.utils.deepClone(this.object.preparedData);\r\n    data.totalCost = await this.#getTotalCost(data);\r\n    data.user = game.user;\r\n    this.inventory = this.object.items;\r\n    return data;\r\n  }\r\n\r\n  async close(options) {\r\n    return super.close(options);\r\n  }\r\n\r\n  /**\r\n   * An object that provides options to _onSubmit\r\n   *\r\n   * @typedef submitOptions\r\n   * @property {boolean} preventClose - Should the application be stopped from closing?\r\n   * @property {boolean} preventRender - Should the application be stopped from rendering?\r\n   */\r\n\r\n  /**\r\n   * Override Foundry's default _onSubmit event to add our own behaviors\r\n   *\r\n   * @param {Event} event - The native form submit event\r\n   * @param {submitOptions} options - Options for the _onSubmit event\r\n   */\r\n  // eslint-disable-next-line no-underscore-dangle\r\n  async _onSubmit(event, { preventClose = false, preventRender = false } = {}) {\r\n    // eslint-disable-next-line no-underscore-dangle\r\n    super._onSubmit(event, {\r\n      preventClose,\r\n      preventRender,\r\n    });\r\n    // Generate gold\r\n    const totalCost = await this.#getTotalCost(await this.getData());\r\n    const gp = await this.object.items.find((item) => {\r\n      const itemData = item.system;\r\n      return (\r\n        (item.name === game.i18n.localize(\"OSE.items.gp.short\") ||\r\n          item.name === \"GP\") && // legacy behavior used GP, even for other languages\r\n        itemData.treasure\r\n      );\r\n    });\r\n    if (!gp) {\r\n      ui.notifications.error(game.i18n.localize(\"OSE.error.noGP\"));\r\n      return;\r\n    }\r\n    const newGP = gp.system.quantity.value - totalCost;\r\n    if (newGP >= 0) {\r\n      this.object.updateEmbeddedDocuments(\"Item\", [\r\n        { _id: gp.id, \"system.quantity.value\": newGP },\r\n      ]);\r\n    } else {\r\n      ui.notifications.error(game.i18n.localize(\"OSE.error.notEnoughGP\"));\r\n    }\r\n  }\r\n\r\n  /**\r\n   * This method is called upon form submission after form data is validated\r\n   *\r\n   * @param {Event} event - The initial triggering submission event\r\n   * @param {object} formData - The object of validated form data with which to update the object\r\n   * @private\r\n   */\r\n  async #updateObject(event, formData) {\r\n    event.preventDefault();\r\n\r\n    const speaker = ChatMessage.getSpeaker({ actor: this });\r\n    const templateData = await this.getData();\r\n    const content = await renderTemplate(\r\n      `${OSE.systemPath()}/templates/chat/inventory-list.html`,\r\n      templateData\r\n    );\r\n    ChatMessage.create({\r\n      content,\r\n      speaker,\r\n    });\r\n    // Update the actor\r\n    await this.object.update(formData);\r\n\r\n    // Re-draw the updated sheet\r\n    this.object.sheet.render(true);\r\n  }\r\n\r\n  // eslint-disable-next-line class-methods-use-this\r\n  async #getTotalCost(data) {\r\n    let total = 0;\r\n    const physical = new Set([\"item\", \"container\", \"weapon\", \"armor\"]);\r\n    data.items.forEach((item) => {\r\n      const itemData = item.system;\r\n      if (physical.has(item.type) && !itemData.treasure)\r\n        total += itemData.quantity.max\r\n          ? itemData.cost\r\n          : itemData.cost * itemData.quantity.value;\r\n    });\r\n    return total;\r\n  }\r\n\r\n  /* -------------------------------------------- */\r\n\r\n  /** @override */\r\n  activateListeners(html) {\r\n    super.activateListeners(html);\r\n    html.find(\"a.auto-deduct\").click(() => {\r\n      this.submit();\r\n    });\r\n  }\r\n}\r\n","/**\r\n * @file An application used for setting up roll modifiers\r\n */\r\nimport OSE from \"../config\";\r\n\r\nexport default class OseCharacterModifiers extends FormApplication {\r\n  static get defaultOptions() {\r\n    const options = super.defaultOptions;\r\n    options.classes = [\"ose\", \"dialog\", \"modifiers\"];\r\n    options.id = \"sheet-modifiers\";\r\n    options.template = `${OSE.systemPath()}/templates/actors/dialogs/modifiers-dialog.html`;\r\n    options.width = 240;\r\n    return options;\r\n  }\r\n\r\n  /* -------------------------------------------- */\r\n\r\n  /**\r\n   * Add the Entity name into the window title\r\n   *\r\n   * @returns {string} - The app title\r\n   */\r\n  get title() {\r\n    return `${this.object.name}: Modifiers`;\r\n  }\r\n\r\n  /* -------------------------------------------- */\r\n\r\n  /**\r\n   * Construct and return the data object used to render the HTML template for this form application.\r\n   *\r\n   * @returns {object} - The template data\r\n   */\r\n  getData() {\r\n    const data = foundry.utils.deepClone(this.object);\r\n    data.user = game.user;\r\n    return data;\r\n  }\r\n\r\n  /* -------------------------------------------- */\r\n\r\n  /** @override */\r\n  activateListeners(html) {\r\n    super.activateListeners(html);\r\n  }\r\n}\r\n","/**\r\n * @file Contains helpers for various behaviors\r\n */\r\n\r\n/**\r\n * Checks if dialogs should be skipped, depending on settings\r\n *\r\n * @param {Event} event - Event that triggers a skippable dialog\r\n * @returns {boolean} - Returns true if dialog should be skipped\r\n */\r\nconst skipRollDialogCheck = (event) => {\r\n  const invertedCtrlBehavior = game.settings.get(\r\n    game.system.id,\r\n    \"invertedCtrlBehavior\"\r\n  );\r\n  return invertedCtrlBehavior\r\n    ? !(event && (event.ctrlKey || event.metaKey))\r\n    : event && (event.ctrlKey || event.metaKey);\r\n};\r\n\r\nexport default skipRollDialogCheck;\r\n","/**\r\n * @file An application used to manage Actor configuration.\r\n */\r\nimport OSE from \"../config\";\r\n\r\nexport default class OseEntityTweaks extends FormApplication {\r\n  static get defaultOptions() {\r\n    const options = super.defaultOptions;\r\n    options.id = \"sheet-tweaks\";\r\n    options.classes = [\"sheet-tweaks\"];\r\n    options.template = `${OSE.systemPath()}/templates/actors/dialogs/tweaks-dialog.html`;\r\n    options.width = 380;\r\n    return options;\r\n  }\r\n\r\n  /* -------------------------------------------- */\r\n\r\n  /**\r\n   * Add the Entity name into the window title\r\n   *\r\n   * @type {string}\r\n   * @returns {string} - The app title\r\n   */\r\n  get title() {\r\n    return `${this.object.name}: ${game.i18n.localize(\"OSE.dialog.tweaks\")}`;\r\n  }\r\n\r\n  /* -------------------------------------------- */\r\n\r\n  /**\r\n   * Construct and return the data object used to render the HTML template for this form application.\r\n   *\r\n   * @returns {object} - The template data\r\n   */\r\n  getData() {\r\n    const data = foundry.utils.deepClone(this.object);\r\n    if (data.type === \"character\") {\r\n      data.isCharacter = true;\r\n    }\r\n    data.user = game.user;\r\n    data.config = {\r\n      ...CONFIG.OSE,\r\n      ascendingAC: game.settings.get(game.system.id, \"ascendingAC\"),\r\n    };\r\n    return data;\r\n  }\r\n\r\n  /* -------------------------------------------- */\r\n\r\n  /** @override */\r\n  activateListeners(html) {\r\n    super.activateListeners(html);\r\n  }\r\n\r\n  /**\r\n   * This method is called upon form submission after form data is validated\r\n   *\r\n   * @param {Event} event - The initial triggering submission event\r\n   * @param {object} formData - The object of validated form data with which to update the object\r\n   * @private\r\n   */\r\n  // eslint-disable-next-line no-underscore-dangle\r\n  async _updateObject(event, formData) {\r\n    event.preventDefault();\r\n    // Update the actor\r\n    await this.object.update(formData);\r\n    // Re-draw the updated sheet\r\n    // eslint-disable-next-line no-underscore-dangle\r\n    await this.object.sheet._render(true);\r\n  }\r\n}\r\n","/**\r\n * @file The base class we use for Character and Monster sheets. Shared behavior goes here!\r\n */\r\nimport skipRollDialogCheck from \"../helpers-behaviour\";\r\nimport OSE from \"../config\";\r\nimport OseEntityTweaks from \"../dialog/entity-tweaks\";\r\n\r\nexport default class OseActorSheet extends ActorSheet {\r\n  getData() {\r\n    const data = foundry.utils.deepClone(super.getData().data);\r\n    data.owner = this.actor.isOwner;\r\n    data.editable = this.actor.sheet.isEditable;\r\n\r\n    data.config = {\r\n      ...CONFIG.OSE,\r\n      ascendingAC: game.settings.get(game.system.id, \"ascendingAC\"),\r\n      initiative: game.settings.get(game.system.id, \"initiative\") !== \"group\",\r\n      encumbrance: game.settings.get(game.system.id, \"encumbranceOption\"),\r\n    };\r\n    data.isNew = this.actor.isNew();\r\n\r\n    return data;\r\n  }\r\n\r\n  activateEditor(name, options, initialContent) {\r\n    // remove some controls to the editor as the space is lacking\r\n    // if (name === \"data.details.description\") {\r\n    //   options.toolbar = \"styleselect bullist hr table removeFormat save\";\r\n    // }\r\n    super.activateEditor(name, options, initialContent);\r\n  }\r\n\r\n  // Helpers\r\n\r\n  _getItemFromActor(event) {\r\n    const li = event.currentTarget.closest(\".item-entry\");\r\n    return this.actor.items.get(li.dataset.itemId);\r\n  }\r\n\r\n  // end Helpers\r\n\r\n  _toggleItemCategory(event) {\r\n    event.preventDefault();\r\n    const targetCategory = $(event.currentTarget);\r\n    const items = targetCategory.next(\".item-list\");\r\n\r\n    if (items.css(\"display\") === \"none\") {\r\n      const el = $(event.currentTarget).find(\".fas.fa-caret-right\");\r\n      el.removeClass(\"fa-caret-right\");\r\n      el.addClass(\"fa-caret-down\");\r\n\r\n      items.slideDown(200);\r\n    } else {\r\n      const el = $(event.currentTarget).find(\".fas.fa-caret-down\");\r\n      el.removeClass(\"fa-caret-down\");\r\n      el.addClass(\"fa-caret-right\");\r\n\r\n      items.slideUp(200);\r\n    }\r\n  }\r\n\r\n  _toggleContainedItems(event) {\r\n    event.preventDefault();\r\n    const targetItems = $(event.target.closest(\".container\"));\r\n    const items = targetItems.find(\".item-list.contained-items\");\r\n\r\n    if (items.css(\"display\") === \"none\") {\r\n      const el = targetItems.find(\".fas.fa-caret-right\");\r\n      el.removeClass(\"fa-caret-right\");\r\n      el.addClass(\"fa-caret-down\");\r\n\r\n      items.slideDown(200);\r\n    } else {\r\n      const el = targetItems.find(\".fas.fa-caret-down\");\r\n      el.removeClass(\"fa-caret-down\");\r\n      el.addClass(\"fa-caret-right\");\r\n\r\n      items.slideUp(200);\r\n    }\r\n  }\r\n\r\n  _toggleItemSummary(event) {\r\n    event.preventDefault();\r\n    const itemSummary = event.currentTarget\r\n      .closest(\".item-entry.item\")\r\n      .querySelector(\".item-summary\");\r\n    itemSummary.style.display = itemSummary.style.display === \"\" ? \"block\" : \"\";\r\n  }\r\n\r\n  async _displayItemInChat(event) {\r\n    const li = $(event.currentTarget).closest(\".item-entry\");\r\n    const item = this.actor.items.get(li.data(\"itemId\"));\r\n    item.show();\r\n  }\r\n\r\n  // eslint-disable-next-line no-underscore-dangle, consistent-return\r\n  async _removeItemFromActor(item) {\r\n    if (item.type === \"ability\" || item.type === \"spell\") {\r\n      // eslint-disable-next-line no-underscore-dangle\r\n      return this.actor.deleteEmbeddedDocuments(\"Item\", [item._id]);\r\n    }\r\n    if (item.type !== \"container\" && item.system.containerId !== \"\") {\r\n      const { containerId } = item.system;\r\n      const newItemIds = this.actor.items\r\n        .get(containerId)\r\n        .system.itemIds.filter((o) => o !== item.id);\r\n\r\n      await this.actor.updateEmbeddedDocuments(\"Item\", [\r\n        { _id: containerId, system: { itemIds: newItemIds } },\r\n      ]);\r\n    }\r\n    if (item.type === \"container\" && item.system.itemIds) {\r\n      const containedItems = item.system.itemIds;\r\n      const updateData = containedItems.reduce((acc, val) => {\r\n        // Only create update data for items that still exist on the actor\r\n        if(this.actor.items.get(val))\r\n          acc.push({ _id: val, \"system.containerId\": \"\" });\r\n        return acc;\r\n      }, []);\r\n\r\n      await this.actor.updateEmbeddedDocuments(\"Item\", updateData);\r\n    }\r\n\r\n    // eslint-disable-next-line no-underscore-dangle\r\n    this.actor.deleteEmbeddedDocuments(\"Item\", [item._id]);\r\n  }\r\n\r\n  /**\r\n   * @param event\r\n   * @param {bool} decrement\r\n   */\r\n  _useConsumable(event, decrement) {\r\n    const item = this._getItemFromActor(event);\r\n    if (!item) return null;\r\n    let {\r\n      quantity: { value: quantity },\r\n    } = item.system;\r\n    item.update({\r\n      \"system.quantity.value\": decrement ? --quantity : ++quantity,\r\n    });\r\n  }\r\n\r\n  async _onSpellChange(event) {\r\n    event.preventDefault();\r\n    const item = this._getItemFromActor(event);\r\n    if (event.target.dataset.field === \"cast\") {\r\n      return item.update({ \"system.cast\": parseInt(event.target.value) });\r\n    }\r\n    if (event.target.dataset.field === \"memorize\") {\r\n      return item.update({\r\n        \"system.memorized\": parseInt(event.target.value),\r\n      });\r\n    }\r\n  }\r\n\r\n  async _resetSpells(event) {\r\n    const spells = $(event.currentTarget)\r\n      .closest(\".inventory.spells\")\r\n      .find(\".item-entry\");\r\n    spells.each((_, el) => {\r\n      const { itemId } = el.dataset;\r\n      const item = this.actor.items.get(itemId);\r\n      const itemData = item?.system;\r\n      item.update({\r\n        _id: item.id,\r\n        \"system.cast\": itemData.memorized,\r\n      });\r\n    });\r\n  }\r\n\r\n  async _rollAbility(event) {\r\n    const item = this._getItemFromActor(event);\r\n    const itemData = item?.system;\r\n    if (item.type === \"weapon\") {\r\n      if (this.actor.type === \"monster\") {\r\n        item.update({\r\n          \"system.counter.value\": itemData.counter.value - 1,\r\n        });\r\n      }\r\n      item.rollWeapon({ skipDialog: skipRollDialogCheck(event) });\r\n    } else if (item.type == \"spell\") {\r\n      item.spendSpell({ skipDialog: skipRollDialogCheck(event) });\r\n    } else {\r\n      item.rollFormula({ skipDialog: skipRollDialogCheck(event) });\r\n    }\r\n  }\r\n\r\n  async _rollSave(event) {\r\n    const actorObject = this.actor;\r\n    const element = event.currentTarget;\r\n    const { save } = element.parentElement.parentElement.dataset;\r\n    actorObject.rollSave(save, { event });\r\n  }\r\n\r\n  async _rollAttack(event) {\r\n    const actorObject = this.actor;\r\n    const element = event.currentTarget;\r\n    const { attack } = element.parentElement.parentElement.dataset;\r\n    actorObject.targetAttack({ roll: {} }, attack, {\r\n      type: attack,\r\n      skipDialog: skipRollDialogCheck(event),\r\n    });\r\n  }\r\n\r\n  _onSortItem(event, itemData) {\r\n    const source = this.actor.items.get(itemData._id);\r\n    const siblings = this.actor.items.filter(\r\n      (i) => i.data._id !== source.data._id\r\n    );\r\n    const dropTarget = event.target.closest(\"[data-item-id]\");\r\n    const targetId = dropTarget ? dropTarget.dataset.itemId : null;\r\n    const target = siblings.find((s) => s.data._id === targetId);\r\n    if (!target) throw new Error(`Couldn't drop near ${event.target}`);\r\n    const targetData = target?.system;\r\n\r\n    // Dragging items into a container\r\n    if (\r\n      (target?.type === \"container\" || target?.data?.type === \"container\") &&\r\n      targetData.containerId === \"\"\r\n    ) {\r\n      this.actor.updateEmbeddedDocuments(\"Item\", [\r\n        { _id: source.id, \"system.containerId\": target.id },\r\n      ]);\r\n      return;\r\n    }\r\n    if (source?.system.containerId !== \"\") {\r\n      this.actor.updateEmbeddedDocuments(\"Item\", [\r\n        { _id: source.id, \"system.containerId\": \"\" },\r\n      ]);\r\n    }\r\n\r\n    super._onSortItem(event, itemData);\r\n  }\r\n\r\n  _onDragStart(event) {\r\n    const li = event.currentTarget;\r\n    let itemIdsArray = [];\r\n    if (event.target.classList.contains(\"content-link\")) return;\r\n\r\n    let dragData;\r\n\r\n    // Owned Items\r\n    if (li.dataset.itemId) {\r\n      const item = this.actor.items.get(li.dataset.itemId);\r\n      dragData = item.toDragData();\r\n      dragData.item = item;\r\n      dragData.type = \"Item\";\r\n      if (item.type === \"container\" && item.system.itemIds.length > 0) {\r\n        // otherwise JSON.stringify will quadruple stringify for some reason\r\n        itemIdsArray = item.system.itemIds;\r\n      }\r\n    }\r\n\r\n    // Create drag data\r\n    dragData.actorId = this.actor.id;\r\n    dragData.sceneId = this.actor.isToken ? canvas.scene?.id : null;\r\n    dragData.tokenId = this.actor.isToken ? this.actor.token.id : null;\r\n    dragData.pack = this.actor.pack;\r\n\r\n    // Active Effect\r\n    if (li.dataset.effectId) {\r\n      const effect = this.actor.effects.get(li.dataset.effectId);\r\n      dragData.type = \"ActiveEffect\";\r\n      dragData.data = effect.data;\r\n    }\r\n\r\n    // Set data transfer\r\n    event.dataTransfer.setData(\r\n      \"text/plain\",\r\n      JSON.stringify(dragData, (key, value) => {\r\n        if (key === \"itemIds\") {\r\n          // something about how this Array is created makes its elements not real Array elements\r\n          // we go through this hoop to trick stringify into creating our string\r\n          return JSON.stringify(itemIdsArray);\r\n        }\r\n        return value;\r\n      })\r\n    );\r\n  }\r\n\r\n  // eslint-disable-next-line no-underscore-dangle\r\n  async _onDropFolder(event, data) {\r\n    const folder = await fromUuid(data.uuid);\r\n    if (!folder || folder.type !== \"Item\") return;\r\n\r\n    let itemArray = folder.contents || [];\r\n\r\n    folder.getSubfolders(true).forEach((subfolder) => {\r\n      itemArray.push(...subfolder.contents);\r\n    });\r\n\r\n    // Compendium items\r\n    if (itemArray.length > 0 && itemArray[0]?.uuid?.includes(\"Compendium\")) {\r\n      const items = [];\r\n      itemArray.forEach(async (item) => {\r\n        items.push(await fromUuid(item.uuid));\r\n      });\r\n      itemArray = items;\r\n    }\r\n\r\n    this._onDropItemCreate(itemArray);\r\n  }\r\n\r\n  // eslint-disable-next-line no-underscore-dangle\r\n  async _onDropItem(event, data) {\r\n    const targetId = event.target.closest(\".item\")?.dataset?.itemId;\r\n    const targetItem = this.actor.items.get(targetId);\r\n    const targetIsContainer = targetItem?.type === \"container\";\r\n\r\n    // This eats the event.target as it is parsed with the TextEditor.\r\n    const item = await Item.implementation.fromDropData(data);\r\n    const itemData = item.toObject();\r\n\r\n    const exists = !!this.actor.items.get(item.id);\r\n\r\n    const isContainer = this.actor.items.get(item.system.containerId);\r\n\r\n    // Issue: https://github.com/vttred/ose/issues/357\r\n    if (item.id === targetId) return;\r\n\r\n    if (!exists && !targetIsContainer)\r\n      // eslint-disable-next-line no-underscore-dangle\r\n      return this._onDropItemCreate([itemData]);\r\n\r\n    // eslint-disable-next-line no-underscore-dangle\r\n    if (isContainer) return this._onContainerItemRemove(item, isContainer);\r\n\r\n    // eslint-disable-next-line no-underscore-dangle\r\n    if (targetIsContainer) return this._onContainerItemAdd(item, targetItem);\r\n  }\r\n\r\n  async _onContainerItemRemove(item, container) {\r\n    const newList = container.system.itemIds.filter((s) => s != item.id);\r\n    const itemObj = this.object.items.get(item.id);\r\n    await container.update({ system: { itemIds: newList } });\r\n    await itemObj.update({ system: { containerId: \"\" } });\r\n  }\r\n\r\n  async _onContainerItemAdd(item, target) {\r\n    const alreadyExistsInActor = target.parent.items.find(\r\n      (i) => i.id === item.id\r\n    );\r\n    let latestItem = item;\r\n    if (!alreadyExistsInActor) {\r\n      // eslint-disable-next-line no-underscore-dangle\r\n      const newItem = await this._onDropItemCreate([item.toObject()]);\r\n      latestItem = newItem.pop();\r\n    }\r\n\r\n    const alreadyExistsInContainer = target.system.itemIds.find(\r\n      (i) => i.id === latestItem.id\r\n    );\r\n    if (!alreadyExistsInContainer) {\r\n      const newList = [...target.system.itemIds, latestItem.id];\r\n      await target.update({ system: { itemIds: newList } });\r\n      await latestItem.update({ system: { containerId: target.id } });\r\n    }\r\n  }\r\n\r\n  // eslint-disable-next-line no-underscore-dangle, consistent-return\r\n  async _onDropItemCreate(droppedItem, targetContainer = false) {\r\n    // override to fix hidden items because their original containers don't exist on this actor\r\n    const droppedItemArray = Array.isArray(droppedItem)\r\n      ? droppedItem\r\n      : [droppedItem];\r\n    droppedItemArray.forEach((item) => {\r\n      if (item.system.containerId && item.system.containerId !== \"\")\r\n        // eslint-disable-next-line no-param-reassign\r\n        item.system.containerId = \"\";\r\n      if (\r\n        item.type === \"container\" &&\r\n        typeof item.system.itemIds === \"string\"\r\n      ) {\r\n        // itemIds was double stringified to fix strange behavior with stringify blanking our Arrays\r\n        const containedItems = JSON.parse(item.system.itemIds);\r\n        containedItems.forEach((containedItem) => {\r\n          // eslint-disable-next-line no-param-reassign\r\n          containedItem.system.containerId = \"\";\r\n        });\r\n        droppedItem.push(...containedItems);\r\n      }\r\n    });\r\n    if (!targetContainer) {\r\n      return this.actor.createEmbeddedDocuments(\"Item\", droppedItem);\r\n    }\r\n\r\n    const { itemIds } = targetContainer.system;\r\n    itemIds.push(droppedItem.id);\r\n    const item = this.actor.items.get(droppedItem[0].id);\r\n    await item.update({ system: { containerId: targetContainer.id } });\r\n    await targetContainer.update({ system: { itemIds } });\r\n  }\r\n\r\n  /* -------------------------------------------- */\r\n\r\n  async _chooseItemType(choices = [\"weapon\", \"armor\", \"shield\", \"gear\"]) {\r\n    const templateData = { types: choices };\r\n    const dlg = await renderTemplate(\r\n      `${OSE.systemPath()}/templates/items/entity-create.html`,\r\n      templateData\r\n    );\r\n    // Create Dialog window\r\n    return new Promise((resolve) => {\r\n      new Dialog({\r\n        title: game.i18n.localize(\"OSE.dialog.createItem\"),\r\n        content: dlg,\r\n        buttons: {\r\n          ok: {\r\n            label: game.i18n.localize(\"OSE.Ok\"),\r\n            icon: '<i class=\"fas fa-check\"></i>',\r\n            callback: (html) => {\r\n              resolve({\r\n                type: html.find('select[name=\"type\"]').val(),\r\n                name: html.find('input[name=\"name\"]').val(),\r\n              });\r\n            },\r\n          },\r\n          cancel: {\r\n            icon: '<i class=\"fas fa-times\"></i>',\r\n            label: game.i18n.localize(\"OSE.Cancel\"),\r\n          },\r\n        },\r\n        default: \"ok\",\r\n      }).render(true);\r\n    });\r\n  }\r\n\r\n  // eslint-disable-next-line no-underscore-dangle\r\n  _createItem(event) {\r\n    event.preventDefault();\r\n    const header = event.currentTarget;\r\n    const { treasure, type, lvl } = header.dataset;\r\n    const createItem = (type, name) => ({\r\n      name: name || `New ${type.capitalize()}`,\r\n      type,\r\n    });\r\n\r\n    // Getting back to main logic\r\n    if (type === \"choice\") {\r\n      const choices = header.dataset.choices.split(\",\");\r\n      this._chooseItemType(choices).then((dialogInput) => {\r\n        const itemData = createItem(dialogInput.type, dialogInput.name);\r\n        this.actor.createEmbeddedDocuments(\"Item\", [itemData], {});\r\n      });\r\n    } else {\r\n      const itemData = createItem(type);\r\n      if (treasure) itemData.system = { treasure: true };\r\n      // when creating a new spell on the character sheet, we need to set the level\r\n      if (type === \"spell\") itemData.system = lvl ? { lvl } : {lvl: 1};\r\n      return this.actor.createEmbeddedDocuments(\"Item\", [itemData], {});\r\n    }\r\n  }\r\n\r\n  async _updateItemQuantity(event) {\r\n    event.preventDefault();\r\n    const item = this._getItemFromActor(event);\r\n\r\n    if (event.target.dataset.field === \"value\") {\r\n      return item.update({\r\n        \"system.quantity.value\": parseInt(event.target.value),\r\n      });\r\n    }\r\n    if (event.target.dataset.field === \"max\") {\r\n      return item.update({\r\n        \"system.quantity.max\": parseInt(event.target.value),\r\n      });\r\n    }\r\n  }\r\n\r\n  // Override to set resizable initial size\r\n  // eslint-disable-next-line no-underscore-dangle\r\n  async _renderInner(...args) {\r\n    const html = await super._renderInner(...args);\r\n    this.form = html[0];\r\n\r\n    // Resize resizable classes\r\n    const resizable = html.find(\".resizable\");\r\n    if (resizable.length === 0) {\r\n      return;\r\n    }\r\n    resizable.each((_, el) => {\r\n      const heightDelta = this.position.height - this.options.height;\r\n      el.style.height = `${heightDelta + parseInt(el.dataset.baseSize)}px`;\r\n    });\r\n    return html;\r\n  }\r\n\r\n  // eslint-disable-next-line no-underscore-dangle\r\n  async _onResize(event) {\r\n    // eslint-disable-next-line no-underscore-dangle\r\n    super._onResize(event);\r\n\r\n    const html = $(this.form);\r\n    const resizable = html.find(\".resizable\");\r\n    if (resizable.length === 0) {\r\n      return;\r\n    }\r\n    // Resize divs\r\n    resizable.each((_, el) => {\r\n      const heightDelta = this.position.height - this.options.height;\r\n      el.style.height = `${heightDelta + parseInt(el.dataset.baseSize)}px`;\r\n    });\r\n    // Resize editors\r\n    const editors = html.find(\".editor\");\r\n    editors.each((id, editor) => {\r\n      const container = editor.closest(\".resizable-editor\");\r\n      if (container) {\r\n        const heightDelta = this.position.height - this.options.height;\r\n        editor.style.height = `${\r\n          heightDelta + parseInt(container.dataset.editorSize)\r\n        }px`;\r\n      }\r\n    });\r\n  }\r\n\r\n  // eslint-disable-next-line no-underscore-dangle\r\n  _onConfigureActor(event) {\r\n    event.preventDefault();\r\n    new OseEntityTweaks(this.actor, {\r\n      top: this.position.top + 40,\r\n      left: this.position.left + (this.position.width - 400) / 2,\r\n    }).render(true);\r\n  }\r\n\r\n  /**\r\n   * Extend and override the sheet header buttons\r\n   *\r\n   * @override\r\n   */\r\n  _getHeaderButtons() {\r\n    let buttons = super._getHeaderButtons();\r\n\r\n    // Token Configuration\r\n    const canConfigure = game.user.isGM || this.actor.isOwner;\r\n    if (this.options.editable && canConfigure) {\r\n      buttons = [\r\n        {\r\n          label: game.i18n.localize(\"OSE.dialog.tweaks\"),\r\n          class: \"configure-actor\",\r\n          icon: \"fas fa-code\",\r\n          onclick: (event) => this._onConfigureActor(event),\r\n        },\r\n      ].concat(buttons);\r\n    }\r\n    return buttons;\r\n  }\r\n\r\n  activateListeners(html) {\r\n    super.activateListeners(html);\r\n\r\n    // Attributes\r\n    html.find(\".saving-throw .attribute-name a\").click((event) => {\r\n      this._rollSave(event);\r\n    });\r\n\r\n    html.find(\".attack a\").click((event) => {\r\n      this._rollAttack(event);\r\n    });\r\n\r\n    html.find(\".hit-dice .attribute-name\").click((event) => {\r\n      this.actor.rollHitDice({ event });\r\n    });\r\n\r\n    // Items (Abilities, Inventory and Spells)\r\n    html.find(\".item-rollable .item-image\").click(async (event) => {\r\n      this._rollAbility(event);\r\n    });\r\n\r\n    html.find(\".inventory .item-category-title\").click((event) => {\r\n      this._toggleItemCategory(event);\r\n    });\r\n    html.find(\".inventory .item-category-title input\").click((event) => {\r\n      event.stopPropagation();\r\n    });\r\n    html.find(\".inventory .category-caret\").click((event) => {\r\n      this._toggleContainedItems(event);\r\n    });\r\n\r\n    html.find(\".item-name\").click((event) => {\r\n      this._toggleItemSummary(event);\r\n    });\r\n\r\n    html.find(\".item-controls .item-show\").click(async (event) => {\r\n      this._displayItemInChat(event);\r\n    });\r\n\r\n    // Everything below here is only needed if the sheet is editable\r\n    if (!this.options.editable) return;\r\n\r\n    // Item Management\r\n    html.find(\".item-create\").click((event) => {\r\n      // eslint-disable-next-line no-underscore-dangle\r\n      this._createItem(event);\r\n    });\r\n\r\n    html.find(\".item-edit\").click((event) => {\r\n      const item = this._getItemFromActor(event);\r\n      item.sheet.render(true);\r\n    });\r\n\r\n    html.find(\".item-delete\").click((event) => {\r\n      const item = this._getItemFromActor(event);\r\n\r\n      if (item?.type !== \"container\" || !item?.system?.itemIds?.length > 0)\r\n        return this._removeItemFromActor(item);\r\n\r\n      Dialog.confirm({\r\n        title: game.i18n.localize(\"OSE.dialog.deleteContainer\"),\r\n        content: game.i18n.localize(\"OSE.dialog.confirmDeleteContainer\"),\r\n        yes: () => {\r\n          this._removeItemFromActor(item);\r\n        },\r\n        defaultYes: false,\r\n      });\r\n    });\r\n\r\n    html\r\n      .find(\".quantity input\")\r\n      .click((ev) => ev.target.select())\r\n      .change(this._updateItemQuantity.bind(this));\r\n\r\n    // Consumables\r\n    html.find(\".consumable-counter .full-mark\").click((event) => {\r\n      this._useConsumable(event, true);\r\n    });\r\n    html.find(\".consumable-counter .empty-mark\").click((event) => {\r\n      this._useConsumable(event, false);\r\n    });\r\n\r\n    // Spells\r\n    html\r\n      .find(\".memorize input\")\r\n      .click((event) => event.target.select())\r\n      .change(this._onSpellChange.bind(this));\r\n\r\n    html\r\n      .find(\".spells .item-reset[data-action='reset-spells']\")\r\n      .click((event) => {\r\n        this._resetSpells(event);\r\n      });\r\n  }\r\n}\r\n","/**\r\n * @file Extend the basic ActorSheet with some very simple modifications\r\n */\r\nimport OSE from \"../config\";\r\nimport OseCharacterCreator from \"../dialog/character-creation\";\r\nimport OseCharacterGpCost from \"../dialog/character-gp-cost\";\r\nimport OseCharacterModifiers from \"../dialog/character-modifiers\";\r\nimport OseActorSheet from \"./actor-sheet\";\r\n\r\nexport default class OseActorSheetCharacter extends OseActorSheet {\r\n  /**\r\n   * Extend and override the default options used by the 5e Actor Sheet\r\n   *\r\n   * @returns {object} - The default options for this sheet.\r\n   */\r\n  static get defaultOptions() {\r\n    return foundry.utils.mergeObject(super.defaultOptions, {\r\n      classes: [\"ose\", \"sheet\", \"actor\", \"character\"],\r\n      template: `${OSE.systemPath()}/templates/actors/character-sheet.html`,\r\n      width: 450,\r\n      height: 530,\r\n      resizable: true,\r\n      tabs: [\r\n        {\r\n          navSelector: \".sheet-tabs\",\r\n          contentSelector: \".sheet-body\",\r\n          initial: \"attributes\",\r\n        },\r\n      ],\r\n      scrollY: [\".inventory\"],\r\n    });\r\n  }\r\n\r\n  /**\r\n   * Organize and classify Owned Items for Character sheets\r\n   *\r\n   * @param data\r\n   * @private\r\n   */\r\n  _prepareItems(data) {\r\n    // Assign and return\r\n    data.owned = {\r\n      items: this.actor.system.items,\r\n      armors: this.actor.system.armor,\r\n      weapons: this.actor.system.weapons,\r\n      treasures: this.actor.system.treasures,\r\n      containers: this.actor.system.containers,\r\n    };\r\n    data.treasure = this.actor.system.carriedTreasure,\r\n    data.containers = this.actor.system.containers;\r\n    data.abilities = this.actor.system.abilities;\r\n    data.spells = this.actor.system.spells.spellList;\r\n    data.slots = this.actor.system.spellSlots;\r\n\r\n    // These values are getters that aren't getting\r\n    // cloned when `this.actor.system` is cloned\r\n    data.system.usesAscendingAC = this.actor.system.usesAscendingAC;\r\n    data.system.meleeMod = this.actor.system.meleeMod;\r\n    data.system.rangedMod = this.actor.system.rangedMod;\r\n    data.system.init = this.actor.system.init;\r\n\r\n    // Sort by sort order (see ActorSheet)\r\n    [\r\n      ...Object.values(data.owned),\r\n      ...Object.values(data?.spells?.spellList || {}),\r\n      data.abilities,\r\n    ].forEach((o) => o.sort((a, b) => (a.sort || 0) - (b.sort || 0)));\r\n  }\r\n\r\n  generateScores() {\r\n    new OseCharacterCreator(this.actor, {\r\n      top: this.position.top + 40,\r\n      left: this.position.left + (this.position.width - 400) / 2,\r\n    }).render(true);\r\n  }\r\n\r\n  /**\r\n   * Prepare data for rendering the Actor sheet\r\n   * The prepared data object contains both the actor data as well as additional sheet options\r\n   */\r\n  async getData() {\r\n    const data = super.getData();\r\n    // Prepare owned items\r\n    this._prepareItems(data);\r\n\r\n    data.enrichedBiography = await TextEditor.enrichHTML(\r\n      this.object.system.details.biography,\r\n      { async: true }\r\n    );\r\n    data.enrichedNotes = await TextEditor.enrichHTML(\r\n      this.object.system.details.notes,\r\n      { async: true }\r\n    );\r\n    return data;\r\n  }\r\n\r\n  async _chooseLang() {\r\n    const choices = CONFIG.OSE.languages;\r\n\r\n    const templateData = { choices };\r\n    const dlg = await renderTemplate(\r\n      `${OSE.systemPath()}/templates/actors/dialogs/lang-create.html`,\r\n      templateData\r\n    );\r\n    // Create Dialog window\r\n    return new Promise((resolve) => {\r\n      new Dialog({\r\n        title: \"\",\r\n        content: dlg,\r\n        buttons: {\r\n          ok: {\r\n            label: game.i18n.localize(\"OSE.Ok\"),\r\n            icon: '<i class=\"fas fa-check\"></i>',\r\n            callback: (html) => {\r\n              resolve({\r\n                choice: html.find('select[name=\"choice\"]').val(),\r\n              });\r\n            },\r\n          },\r\n          cancel: {\r\n            icon: '<i class=\"fas fa-times\"></i>',\r\n            label: game.i18n.localize(\"OSE.Cancel\"),\r\n          },\r\n        },\r\n        default: \"ok\",\r\n      }).render(true);\r\n    });\r\n  }\r\n\r\n  _pushLang(table) {\r\n    const data = this.actor.system;\r\n    let update = data[table]; // V10 compatibility\r\n    this._chooseLang().then((dialogInput) => {\r\n      const name = CONFIG.OSE.languages[dialogInput.choice];\r\n      if (update.value) {\r\n        update.value.push(name);\r\n      } else {\r\n        update = { value: [name] };\r\n      }\r\n\r\n      const newData = {};\r\n      newData[table] = update;\r\n      return this.actor.update({ system: newData });\r\n    });\r\n  }\r\n\r\n  _popLang(table, lang) {\r\n    const data = this.actor.system;\r\n    const update = data[table].value.filter((el) => el != lang);\r\n    const newData = {};\r\n    newData[table] = { value: update };\r\n    return this.actor.update({ system: newData });\r\n  }\r\n\r\n  /* -------------------------------------------- */\r\n\r\n  _onShowModifiers(event) {\r\n    event.preventDefault();\r\n    new OseCharacterModifiers(this.actor, {\r\n      top: this.position.top + 40,\r\n      left: this.position.left + (this.position.width - 400) / 2,\r\n    }).render(true);\r\n  }\r\n\r\n  async _onShowGpCost(event, preparedData) {\r\n    event.preventDefault();\r\n    new OseCharacterGpCost(this.actor, preparedData, {\r\n      top: this.position.top + 40,\r\n      left: this.position.left + (this.position.width - 400) / 2,\r\n    }).render(true);\r\n  }\r\n\r\n  async _onShowItemTooltip(event) {\r\n    const templateData = {};\r\n    const dlg = await renderTemplate(\r\n      `${OSE.systemPath()}/templates/actors/partials/character-item-tooltip.html`,\r\n      templateData\r\n    );\r\n    document.querySelector(\".game\").append(dlg);\r\n  }\r\n\r\n  /**\r\n   * Activate event listeners using the prepared sheet HTML\r\n   *\r\n   * @param html - {HTML}   The prepared HTML object ready to be rendered into the DOM\r\n   */\r\n  activateListeners(html) {\r\n    super.activateListeners(html);\r\n\r\n    html.find(\".ability-score .attribute-name a\").click((ev) => {\r\n      const actorObject = this.actor;\r\n      const element = ev.currentTarget;\r\n      const { score } = element.parentElement.parentElement.dataset;\r\n      const { stat } = element.parentElement.parentElement.dataset;\r\n      if (score) {\r\n        actorObject.rollCheck(score, { event: ev });\r\n      } else if (stat === \"lr\") {\r\n        actorObject.rollLoyalty(score, { event: ev });\r\n      }\r\n    });\r\n\r\n    html.find(\".exploration .attribute-name a\").click((ev) => {\r\n      const actorObject = this.actor;\r\n      const element = ev.currentTarget;\r\n      const expl = element.parentElement.parentElement.dataset.exploration;\r\n      actorObject.rollExploration(expl, { event: ev });\r\n    });\r\n\r\n    html.find(\"a[data-action='modifiers']\").click((ev) => {\r\n      this._onShowModifiers(ev);\r\n    });\r\n\r\n    html.find(\"a[data-action='gp-cost']\").click((ev) => {\r\n      this._onShowGpCost(ev, this.getData());\r\n    });\r\n\r\n    // Everything below here is only needed if the sheet is editable\r\n    if (!this.options.editable) return;\r\n\r\n    // Language Management\r\n    html.find(\".item-push\").click((ev) => {\r\n      ev.preventDefault();\r\n      const header = ev.currentTarget;\r\n      const table = header.dataset.array;\r\n      this._pushLang(table);\r\n    });\r\n\r\n    html.find(\".item-pop\").click((ev) => {\r\n      ev.preventDefault();\r\n      const header = ev.currentTarget;\r\n      const table = header.dataset.array;\r\n      this._popLang(table, $(ev.currentTarget).closest(\".item\").data(\"lang\"));\r\n    });\r\n\r\n    // Toggle Equipment\r\n    html.find(\".item-toggle\").click(async (ev) => {\r\n      const li = $(ev.currentTarget).parents(\".item\");\r\n      const item = this.actor.items.get(li.data(\"itemId\"));\r\n      await item.update({\r\n        system: {\r\n          equipped: !item.system.equipped,\r\n        },\r\n      });\r\n    });\r\n\r\n    html.find(\"a[data-action='generate-scores']\").click((ev) => {\r\n      this.generateScores(ev);\r\n    });\r\n  }\r\n}\r\n","/**\r\n * @file A class to handle the nested AC/AAC props on OseDataModelCharacter.\r\n */\r\n\r\ninterface CharacterAC {\r\n  base: number;\r\n  naked: number;\r\n  shield: number;\r\n  value: number;\r\n  mod: number;\r\n}\r\n\r\nexport default class OseDataModelCharacterAC implements CharacterAC {\r\n  static baseAscending = 10;\r\n\r\n  static baseDescending = 9;\r\n\r\n  static propAscending = \"aac\";\r\n\r\n  static propDescending = \"ac\";\r\n\r\n  #armor;\r\n\r\n  #dexMod;\r\n\r\n  #mod;\r\n\r\n  #acProp;\r\n\r\n  #isAscending;\r\n\r\n  /**\r\n   * AC Constructor\r\n   *\r\n   * @param {boolean} isAscending - Is this meant to represent ascending or descending AC?\r\n   * @param {Item} armor - Currently equipped Items with type of armor\r\n   * @param {number} dexMod - The bonus/penalty, from -3 to +3, applied to AC.\r\n   * @param {number} mod - Miscellaneous modifier to AC\r\n   */\r\n  constructor(isAscending = false, armor: Item[] = [], dexDefMod = 0, mod = 0) {\r\n    this.#isAscending = isAscending;\r\n    this.#armor = armor;\r\n    this.#dexMod = dexDefMod;\r\n    this.#mod = mod;\r\n    this.#acProp = this.#isAscending\r\n      ? OseDataModelCharacterAC.propAscending\r\n      : OseDataModelCharacterAC.propDescending;\r\n  }\r\n\r\n  #getShieldBonus() {\r\n    return (\r\n      this.#armor.find(({ system: { type } }: Item) => type === \"shield\")\r\n        ?.system[this.#acProp].value || 0\r\n    );\r\n  }\r\n\r\n  /**\r\n   * The base AC value for a character, depending on\r\n   * if we're using ascending or descending AC\r\n   *\r\n   * @returns {boolean} - Truthy for ascending, falsy for descending\r\n   */\r\n  get base() {\r\n    return this.#isAscending\r\n      ? OseDataModelCharacterAC.baseAscending\r\n      : OseDataModelCharacterAC.baseDescending;\r\n  }\r\n\r\n  /**\r\n   * A character's armor class without armor or a shield\r\n   *\r\n   * @returns {number} - The character's naked AC\r\n   */\r\n  get naked() {\r\n    return this.#isAscending\r\n      ? this.base + this.#dexMod\r\n      : this.base - this.#dexMod;\r\n  }\r\n\r\n  /**\r\n   * A character's shield bonus, if any\r\n   *\r\n   * @returns {number} - The shield bonus\r\n   */\r\n  get shield() {\r\n    return this.#getShieldBonus();\r\n  }\r\n\r\n  /**\r\n   * The AC value from worn armor\r\n   *\r\n   * @todo After data migration, armor should be a bonus to naked AC.\r\n   * @returns {number} - The AC value from worn armor\r\n   */\r\n  get #armored() {\r\n    const armor = this.#armor.find(\r\n      ({ system: { type } }: Item) => type !== \"shield\"\r\n    )?.system[this.#acProp].value;\r\n    // Null if any falsy value but 0\r\n    if (!armor && armor !== 0) return null;\r\n\r\n    return this.#isAscending ? armor + this.#dexMod : armor - this.#dexMod;\r\n  }\r\n\r\n  /**\r\n   * A character's armor class\r\n   *\r\n   * @todo Data migration for armor with AC/AAC to act as a bonus, not an override\r\n   * @returns {number} - The creature's AC\r\n   */\r\n  get value() {\r\n    const base = this.#armored === null ? this.naked : this.#armored;\r\n    return this.#isAscending\r\n      ? base + this.shield + this.mod\r\n      : base - this.shield - this.mod;\r\n  }\r\n\r\n  // @TODO This will need to be editable once we get to creatures\r\n  // eslint-disable-next-line @typescript-eslint/no-empty-function\r\n  set value(_change: number) {} // eslint-disable-line class-methods-use-this\r\n\r\n  /**\r\n   * A character's miscellaneous armor class modifier\r\n   *\r\n   * @returns {number} - The creature's AC modifier\r\n   */\r\n  get mod() {\r\n    return this.#mod;\r\n  }\r\n\r\n  set mod(change) {\r\n    this.#mod = change;\r\n  }\r\n}\r\n","/**\r\n * @file A class representing the character's ability to move, depending on encumbrance state\r\n */\r\n// eslint-disable-next-line @typescript-eslint/ban-ts-comment\r\n// @ts-ignore\r\nimport OseDataModelCharacterEncumbrance from \"./data-model-character-encumbrance\";\r\n\r\nexport interface CharacterMove {\r\n  base: number;\r\n  encounter: number;\r\n  overland: number;\r\n}\r\n\r\n/**\r\n * A class representing a character's move speeds.\r\n */\r\nexport default class OseDataModelCharacterMove implements CharacterMove {\r\n  static baseMoveRate = 120;\r\n\r\n  #moveBase;\r\n\r\n  #autocalculate;\r\n\r\n  #encumbranceVariant;\r\n\r\n  #overEncumbranceLimit;\r\n\r\n  #atFirstBreakpoint;\r\n\r\n  #atSecondBreakpoint;\r\n\r\n  #atThirdBreakpoint;\r\n\r\n  /**\r\n   * The constructor\r\n   *\r\n   * @param {OseDataModelCharacterEncumbrance} encumbrance - An object representing the character's encumbrance values\r\n   * @param {boolean} shouldCalculateMovement - Should the class autocalculate movement?\r\n   * @param {number} base - The base move rate for the actor\r\n   */\r\n  constructor(\r\n    encumbrance: OseDataModelCharacterEncumbrance = new OseDataModelCharacterEncumbrance(),\r\n    shouldCalculateMovement = true,\r\n    base = OseDataModelCharacterMove.baseMoveRate\r\n  ) {\r\n    // Props necessary for any encumbrance variant\r\n    this.#moveBase = base;\r\n    this.#autocalculate = shouldCalculateMovement;\r\n    this.#encumbranceVariant = encumbrance.variant;\r\n    this.#overEncumbranceLimit = encumbrance.encumbered;\r\n\r\n    // Encumbrance Breakpoints\r\n    this.#atFirstBreakpoint = encumbrance.atFirstBreakpoint;\r\n    this.#atSecondBreakpoint = encumbrance.atSecondBreakpoint;\r\n    this.#atThirdBreakpoint = encumbrance.atThirdBreakpoint;\r\n  }\r\n\r\n  #derivedSpeed() {\r\n    if (this.#overEncumbranceLimit) return 0;\r\n    if (this.#atThirdBreakpoint) return this.#moveBase * 0.25;\r\n    if (this.#atSecondBreakpoint) return this.#moveBase * 0.5;\r\n    return this.#atFirstBreakpoint ? this.#moveBase * 0.75 : this.#moveBase;\r\n  }\r\n\r\n  get base() {\r\n    // Manual entry for movement\r\n    if (!this.#autocalculate || this.#encumbranceVariant === \"disabled\")\r\n      return this.#moveBase;\r\n    // Automatic calculation for movement\r\n    return this.#derivedSpeed();\r\n  }\r\n\r\n  set base(value) {\r\n    this.#moveBase = value;\r\n  }\r\n\r\n  get encounter() {\r\n    return this.base / 3;\r\n  }\r\n\r\n  get overland() {\r\n    return this.base / 5;\r\n  }\r\n}\r\n","/**\r\n * @file A class representing a Character's ability scores.\r\n */\r\ntype IncomingScore = {\r\n  value: number;\r\n  bonus: number;\r\n};\r\n\r\ntype Scores = {\r\n  str: BaseScore;\r\n  int: BaseScore;\r\n  wis: BaseScore;\r\n  dex: BaseScore;\r\n  con: BaseScore;\r\n  cha: BaseScore;\r\n};\r\n\r\ntype BaseScore = IncomingScore & { mod: number };\r\n\r\nexport interface CharacterScores {\r\n  str: BaseScore & { od: number };\r\n  int: BaseScore & { literacy: string; spoken: string };\r\n  wis: BaseScore;\r\n  dex: BaseScore & { init: number };\r\n  con: BaseScore;\r\n  cha: BaseScore & { loyalty: number; retain: number; npc: number };\r\n}\r\n\r\n/**\r\n * A class representing a character's ability scores\r\n */\r\nexport default class OseDataModelCharacterScores implements CharacterScores {\r\n  /**\r\n   * Standard modifiers, from -3 to 3.\r\n   *\r\n   * Applied to:\r\n   * - `str.mod`\r\n   * - `int.mod`\r\n   * - `wis.mod`\r\n   * - `dex.mod`\r\n   * - `con.mod`\r\n   * - `cha.mod`\r\n   * - `cha.retain` (with a +4 modifier)\r\n   * - `cha.loyalty` (with a +7 modifier)\r\n   */\r\n  static standardAttributeMods = {\r\n    0: -3,\r\n    3: -3,\r\n    4: -2,\r\n    6: -1,\r\n    9: 0,\r\n    13: 1,\r\n    16: 2,\r\n    18: 3,\r\n  };\r\n\r\n  //---HYPERBOREA CUSTOM START---\r\n\r\nstatic strengthDamageMods = {\r\n    0: -2,\r\n    3: -2,\r\n    4: -1,\r\n    9: 0,  \r\n    13: 1,\r\n    17: 2,\r\n    18: 3,\r\n};\r\n\r\n  static strengthAttackMods = {\r\n    0: -2,\r\n    3: -2,\r\n    4: -1,\r\n    7: 0,\r\n    15: 1,\r\n    18: 2,\r\n  };\r\n\r\n  static dexAttackMods = {\r\n    0: -2,\r\n    3: -2,\r\n    4: -1,\r\n    7: 0,\r\n    13: 1,\r\n    17: 2,\r\n    18: 3,\r\n  };\r\n\r\n  static dexDefenseMods = {\r\n    0: -2,\r\n    3: -2,\r\n    4: -1,\r\n    7: 0,\r\n    15: 1,\r\n    18: 2,\r\n  };\r\n\r\n\r\n  //---HYPERBOREA CUSTOM END---\r\n\r\n  /**\r\n   * Capped modifiers, from -2 to 2.\r\n   *\r\n   * Applied to:\r\n   * - `dex.init`\r\n   * - `cha.npc`\r\n   */\r\n  static cappedAttributeMods = {\r\n    0: -2,\r\n    3: -2,\r\n    4: -1,\r\n    6: -1,\r\n    9: 0,\r\n    13: 1,\r\n    16: 1,\r\n    18: 2,\r\n  };\r\n\r\n  /**\r\n   * Modifier tables for the Open Door exploration skill, from 0 to 5.\r\n   * Applied to:\r\n   * - `str.od`\r\n   */\r\n  static openDoorMods = {\r\n    0: 0,\r\n    3: 1,\r\n    9: 2,\r\n    13: 3,\r\n    16: 4,\r\n    18: 5,\r\n  };\r\n\r\n  /**\r\n   * Mapping tables for character literacy.\r\n   * Applied to:\r\n   * - `int.literacy`\r\n   */\r\n  static literacyMods = {\r\n    0: \"\",\r\n    3: \"OSE.Illiterate\",\r\n    6: \"OSE.LiteracyBasic\",\r\n    9: \"OSE.Literate\",\r\n  };\r\n\r\n  /**\r\n   * Mapping tables for character's spoken languages.\r\n   * Applied to:\r\n   * - `int.spoken`\r\n   */\r\n  static spokenMods = {\r\n    0: \"OSE.NativeBroken\",\r\n    3: \"OSE.Native\",\r\n    13: \"OSE.NativePlus1\",\r\n    16: \"OSE.NativePlus2\",\r\n    18: \"OSE.NativePlus3\",\r\n  };\r\n\r\n  static valueFromTable(table: { [str: string]: any }, val: number) {\r\n    let output;\r\n    for (let i = 0; i <= val; i += 1) {\r\n      if (table[i] !== undefined) {\r\n        output = table[i];\r\n      }\r\n    }\r\n    return output;\r\n  }\r\n\r\n  #str: IncomingScore = { value: 0, bonus: 0 };\r\n\r\n  #int: IncomingScore = { value: 0, bonus: 0 };\r\n\r\n  #wis: IncomingScore = { value: 0, bonus: 0 };\r\n\r\n  #dex: IncomingScore = { value: 0, bonus: 0 };\r\n\r\n  #con: IncomingScore = { value: 0, bonus: 0 };\r\n\r\n  #cha: IncomingScore = { value: 0, bonus: 0 };\r\n\r\n  /**\r\n   * The constructor\r\n   *\r\n   * @param {object} scores - An object containing the six primary ability scores.\r\n   * @param {string} scores.str - The character's strength\r\n   * @param {string} scores.int - The character's intelligence\r\n   * @param {string} scores.wis - The character's wisdom\r\n   * @param {string} scores.dex - The character's dexterity\r\n   * @param {string} scores.con - The character's constitution\r\n   * @param {string} scores.cha - The character's charisma\r\n   */\r\n  constructor({ str, int, wis, dex, con, cha }: Scores) {\r\n    this.#str = str;\r\n    this.#int = int;\r\n    this.#wis = wis;\r\n    this.#dex = dex;\r\n    this.#con = con;\r\n    this.#cha = cha;\r\n  }\r\n\r\n  get str() {\r\n    return {\r\n      value: this.#str.value,\r\n      bonus: this.#str.bonus,\r\n      mod: this.#strMod,\r\n      atk: this.strAtkMod,\r\n      dmg: this.strDmgMod,\r\n      od: this.#strOpenDoorsMod,\r\n    };\r\n  }\r\n\r\n  set str(change) {\r\n    this.#str = {\r\n      ...this.#str,\r\n      ...change,\r\n    };\r\n  }\r\n\r\n  get #strMod() {\r\n    return OseDataModelCharacterScores.valueFromTable(\r\n      OseDataModelCharacterScores.standardAttributeMods,\r\n      this.#str.value\r\n    );\r\n  }\r\n\r\n      // Getter for the strength attack modifier\r\n    get strAtkMod() {\r\n        return OseDataModelCharacterScores.valueFromTable(\r\n            OseDataModelCharacterScores.strengthAttackMods,\r\n            this.#str.value\r\n        );\r\n    }\r\n\r\n    // Getter for the strength damage modifier\r\n    get strDmgMod() {\r\n        return OseDataModelCharacterScores.valueFromTable(\r\n            OseDataModelCharacterScores.strengthDamageMods,\r\n            this.#str.value\r\n        );\r\n    }\r\n\r\n  get #strOpenDoorsMod() {\r\n    return OseDataModelCharacterScores.valueFromTable(\r\n      OseDataModelCharacterScores.openDoorMods,\r\n      this.#str.value\r\n    );\r\n  }\r\n\r\n  get int() {\r\n    return {\r\n      value: this.#int.value,\r\n      bonus: this.#int.bonus,\r\n      mod: this.#intMod,\r\n      literacy: this.#intLiteracyMod,\r\n      spoken: this.#intSpokenLanguagesMod,\r\n    };\r\n  }\r\n\r\n  set int(change) {\r\n    this.#int = {\r\n      ...this.#int,\r\n      ...change,\r\n    };\r\n  }\r\n\r\n  get #intMod() {\r\n    return OseDataModelCharacterScores.valueFromTable(\r\n      OseDataModelCharacterScores.standardAttributeMods,\r\n      this.#int.value\r\n    );\r\n  }\r\n\r\n  get #intLiteracyMod() {\r\n    return OseDataModelCharacterScores.valueFromTable(\r\n      OseDataModelCharacterScores.literacyMods,\r\n      this.#int.value\r\n    );\r\n  }\r\n\r\n  get #intSpokenLanguagesMod() {\r\n    return OseDataModelCharacterScores.valueFromTable(\r\n      OseDataModelCharacterScores.spokenMods,\r\n      this.#int.value\r\n    );\r\n  }\r\n\r\n  get wis() {\r\n    return {\r\n      value: this.#wis.value,\r\n      bonus: this.#wis.bonus,\r\n      mod: this.#wisMod,\r\n    };\r\n  }\r\n\r\n  set wis(change) {\r\n    this.#wis = {\r\n      ...this.#wis,\r\n      ...change,\r\n    };\r\n  }\r\n\r\n  get #wisMod() {\r\n    return OseDataModelCharacterScores.valueFromTable(\r\n      OseDataModelCharacterScores.standardAttributeMods,\r\n      this.#wis.value\r\n    );\r\n  }\r\n\r\n  get dex() {\r\n    return {\r\n      value: this.#dex.value,\r\n      bonus: this.#dex.bonus,\r\n      mod: this.#dexMod,\r\n      atk:this.#dexAtkMod,\r\n      def: this.#dexDefMod, \r\n      init: this.#dexInitMod,\r\n    };\r\n  }\r\n\r\n  set dex(change) {\r\n    this.#dex = {\r\n      ...this.#dex,\r\n      ...change,\r\n    };\r\n  }\r\n\r\n  get #dexMod() {\r\n    return OseDataModelCharacterScores.valueFromTable(\r\n      OseDataModelCharacterScores.standardAttributeMods,\r\n      this.#dex.value\r\n    );\r\n  }\r\n\r\n  get #dexAtkMod() {\r\n    return OseDataModelCharacterScores.valueFromTable(\r\n      OseDataModelCharacterScores.dexAttackMods,\r\n      this.#dex.value\r\n    );\r\n  }\r\n\r\n  get #dexDefMod() {\r\n  return OseDataModelCharacterScores.valueFromTable(\r\n    OseDataModelCharacterScores.dexDefenseMods,\r\n    this.#dex.value\r\n  );\r\n}\r\n\r\n  get #dexInitMod() {\r\n    return OseDataModelCharacterScores.valueFromTable(\r\n      OseDataModelCharacterScores.cappedAttributeMods,\r\n      this.#dex.value\r\n    );\r\n  }\r\n\r\n  get con() {\r\n    return {\r\n      value: this.#con.value,\r\n      bonus: this.#con.bonus,\r\n      mod: this.#conMod,\r\n    };\r\n  }\r\n\r\n  set con(change) {\r\n    this.#con = {\r\n      ...this.#con,\r\n      ...change,\r\n    };\r\n  }\r\n\r\n  get #conMod() {\r\n    return OseDataModelCharacterScores.valueFromTable(\r\n      OseDataModelCharacterScores.standardAttributeMods,\r\n      this.#con.value\r\n    );\r\n  }\r\n\r\n  get cha() {\r\n    return {\r\n      value: this.#cha.value,\r\n      bonus: this.#cha.bonus,\r\n      mod: this.#chaMod,\r\n      loyalty: this.#chaLoyaltyMod,\r\n      retain: this.#chaRetainMod,\r\n      npc: this.#chaReactionMod,\r\n    };\r\n  }\r\n\r\n  set cha(change) {\r\n    this.#cha = {\r\n      ...this.#cha,\r\n      ...change,\r\n    };\r\n  }\r\n\r\n  get #chaMod() {\r\n    return OseDataModelCharacterScores.valueFromTable(\r\n      OseDataModelCharacterScores.standardAttributeMods,\r\n      this.#cha.value\r\n    );\r\n  }\r\n\r\n  get #chaReactionMod() {\r\n    return OseDataModelCharacterScores.valueFromTable(\r\n      OseDataModelCharacterScores.cappedAttributeMods,\r\n      this.#cha.value\r\n    );\r\n  }\r\n\r\n  get #chaRetainMod() {\r\n    return this.#chaMod + 4;\r\n  }\r\n\r\n  get #chaLoyaltyMod() {\r\n    return this.#chaMod + 7;\r\n  }\r\n}\r\n","/**\r\n * @file A class representing a creature's spellcasting abilities\r\n */\r\ntype Slot = {\r\n  used: number;\r\n  max: number;\r\n};\r\n\r\ntype Slots = {\r\n  [n: number]: Slot;\r\n};\r\n\r\ntype Spells = {\r\n  [n: number]: Item[];\r\n};\r\n\r\nconst reducedSpells = (list: Spells, item: Item) => {\r\n  const { lvl } = item.system;\r\n  const othersAtLvl = list[lvl] || [];\r\n  return {\r\n    ...list,\r\n    [lvl]: [...othersAtLvl, item].sort((a, b) => a.name.localeCompare(b.name)),\r\n  };\r\n};\r\n\r\nexport interface CharacterSpells {\r\n  enabled: boolean;\r\n  spellList: Spells;\r\n  slots: Slots;\r\n}\r\n\r\nexport default class OseDataModelCharacterSpells implements CharacterSpells {\r\n  #slots = {};\r\n\r\n  #spellList: Item[] = [];\r\n\r\n  #enabled: boolean;\r\n\r\n  constructor(\r\n    {\r\n      enabled,\r\n      ...maxSlots\r\n    }: { enabled?: boolean; [n: number]: { max: number } },\r\n    spellList: Item[] = []\r\n  ) {\r\n    this.#spellList = spellList;\r\n    this.#enabled = enabled || false;\r\n\r\n    const usedSlots = this.#spellList?.reduce(this.#reducedUsedSlots, {}) || {};\r\n\r\n    this.#slots = Object.keys(maxSlots || {}).reduce(\r\n      (list, item, idx) =>\r\n        this.#usedAndMaxSlots(list, item, idx, usedSlots, maxSlots),\r\n      {}\r\n    );\r\n  }\r\n\r\n  get enabled() {\r\n    return this.#enabled;\r\n  }\r\n\r\n  set enabled(state) {\r\n    this.#enabled = state;\r\n  }\r\n\r\n  get spellList() {\r\n    return this.#spellList.reduce(\r\n      (list, item) => reducedSpells(list, item),\r\n      {}\r\n    );\r\n  }\r\n\r\n  // eslint-disable-next-line class-methods-use-this\r\n  #reducedUsedSlots(list: { [n: number]: number }, item: Item) {\r\n    const { lvl } = item.system;\r\n    let { cast } = item.system;\r\n    if (Number.isNaN(cast)) cast = 0;\r\n    const usedAtLvl = list[lvl] || 0;\r\n    return {\r\n      ...list,\r\n      [lvl]: usedAtLvl + cast,\r\n    };\r\n  }\r\n\r\n  // eslint-disable-next-line class-methods-use-this\r\n  #usedAndMaxSlots(\r\n    list: Slots,\r\n    item: Item | string,\r\n    idx: number,\r\n    usedSlots: { [n: number]: number },\r\n    maxSlots: { [n: number]: { max: number } }\r\n  ) {\r\n    if (item === \"enabled\") return list;\r\n    const lv = idx + 1;\r\n    const max = maxSlots[lv]?.max || 0;\r\n    const used = usedSlots[lv];\r\n\r\n    return {\r\n      ...list,\r\n      [lv]: { used, max },\r\n    };\r\n  }\r\n\r\n  get slots(): Slots {\r\n    return this.#slots;\r\n  }\r\n}\r\n","/**\r\n * @file The data model for Actors of type Character.\r\n */\r\nimport OseDataModelCharacterAC from \"./data-model-classes/data-model-character-ac\";\r\nimport OseDataModelCharacterMove from \"./data-model-classes/data-model-character-move\";\r\nimport OseDataModelCharacterScores from \"./data-model-classes/data-model-character-scores\";\r\nimport OseDataModelCharacterSpells from \"./data-model-classes/data-model-character-spells\";\r\n\r\nconst getItemsOfActorOfType = (actor, filterType, filterFn = null) =>\r\n  actor.items\r\n    .filter(({ type }) => type === filterType)\r\n    .filter(filterFn || (() => true));\r\n\r\nexport default class OseDataModelCharacter extends foundry.abstract.DataModel {\r\n  prepareDerivedData() {\r\n    this.scores = new OseDataModelCharacterScores(this.scores);\r\n\r\n    // eslint-disable-next-line new-cap\r\n    this.encumbrance = new CONFIG.OSE.encumbrance(\r\n      this.encumbrance.max,\r\n      [...this.parent.items],\r\n      {\r\n        significantTreasure: game.settings.get(\r\n          game.system.id,\r\n          \"significantTreasure\"\r\n        ),\r\n        scores: this.scores,\r\n      }\r\n    );\r\n\r\n    this.movement = new OseDataModelCharacterMove(\r\n      this.encumbrance,\r\n      this.config.movementAuto,\r\n      this.movement.base\r\n    );\r\n\r\n    // @todo Once we create the new character sheet,\r\n    //       we shouldn't need to list both AC schemes\r\n    this.ac = new OseDataModelCharacterAC(\r\n      false,\r\n      [\r\n        ...getItemsOfActorOfType(\r\n          this.parent,\r\n          \"armor\",\r\n          (a) => a.system.equipped\r\n        ),\r\n      ],\r\n      this.scores.dex.def,\r\n      this.ac.mod\r\n    );\r\n\r\n    this.aac = new OseDataModelCharacterAC(\r\n      true,\r\n      getItemsOfActorOfType(this.parent, \"armor\", (a) => a.system.equipped),\r\n      this.scores.dex.def,\r\n      this.aac.mod\r\n    );\r\n\r\n    this.spells = new OseDataModelCharacterSpells(this.spells, this.#spellList);\r\n  }\r\n\r\n  // @todo define schema options; stuff like min/max values and so on.\r\n  static defineSchema() {\r\n    const { StringField, NumberField, BooleanField, ObjectField, SchemaField } =\r\n      foundry.data.fields;\r\n\r\n    return {\r\n      spells: new ObjectField(),\r\n      scores: new ObjectField(),\r\n      details: new ObjectField(),\r\n      ac: new ObjectField(),\r\n      aac: new ObjectField(),\r\n      encumbrance: new ObjectField(),\r\n      movement: new ObjectField(),\r\n      config: new ObjectField(),\r\n      initiative: new ObjectField(),\r\n      hp: new SchemaField({\r\n        hd: new StringField(),\r\n        value: new NumberField({ integer: true }),\r\n        max: new NumberField({ integer: true }),\r\n      }),\r\n      thac0: new ObjectField(),\r\n      languages: new ObjectField(),\r\n      saves: new SchemaField({\r\n        breath: new SchemaField({ value: new NumberField({ integer: true }) }),\r\n        death: new SchemaField({ value: new NumberField({ integer: true }) }),\r\n        paralysis: new SchemaField({\r\n          value: new NumberField({ integer: true }),\r\n        }),\r\n        spell: new SchemaField({ value: new NumberField({ integer: true }) }),\r\n        wand: new SchemaField({ value: new NumberField({ integer: true }) }),\r\n      }),\r\n      exploration: new SchemaField({\r\n        ft: new NumberField({ integer: true, positive: true }),\r\n        ld: new NumberField({ integer: true, positive: true }),\r\n        od: new NumberField({ integer: true, positive: true }),\r\n        sd: new NumberField({ integer: true, positive: true }),\r\n      }),\r\n      retainer: new SchemaField({\r\n        enabled: new BooleanField(),\r\n        loyalty: new NumberField({ integer: true }),\r\n        wage: new StringField(),\r\n      }),\r\n    };\r\n  }\r\n\r\n  // @todo This only needs to be public until\r\n  //       we can ditch sharing out AC/AAC.\r\n  // eslint-disable-next-line class-methods-use-this\r\n  get usesAscendingAC() {\r\n    return game.settings.get(game.system.id, \"ascendingAC\");\r\n  }\r\n\r\n  get meleeMod() {\r\n    const ascendingAcMod = this.usesAscendingAC ? this.thac0.bba || 0 : 0;\r\n    return (\r\n      (this.scores.str?.mod || 0) +\r\n      (this.thac0?.mod?.melee || 0) +\r\n      ascendingAcMod\r\n    );\r\n  }\r\n\r\n  get rangedMod() {\r\n    const ascendingAcMod = this.usesAscendingAC ? this.thac0.bba || 0 : 0;\r\n    return (\r\n      (this.scores.dex?.mod || 0) +\r\n      (this.thac0?.mod?.missile || 0) +\r\n      ascendingAcMod\r\n    );\r\n  }\r\n\r\n  get isNew() {\r\n    const { str, int, wis, dex, con, cha } = this.scores;\r\n    return ![str, int, wis, dex, con, cha].reduce(\r\n      (acc, el) => acc + el.value,\r\n      0\r\n    );\r\n  }\r\n\r\n  get containers() {\r\n    return getItemsOfActorOfType(\r\n      this.parent,\r\n      \"container\",\r\n      ({ system: { containerId } }) => !containerId\r\n    );\r\n  }\r\n\r\n  get treasures() {\r\n    return getItemsOfActorOfType(\r\n      this.parent,\r\n      \"item\",\r\n      ({ system: { treasure, containerId } }) => treasure && !containerId\r\n    );\r\n  }\r\n\r\n  get carriedTreasure() {\r\n    const total = this.treasures.reduce(\r\n      (acc, { system: { quantity, cost } }) => acc + quantity.value * cost,\r\n      0\r\n    );\r\n    return Math.round(total * 100) / 100;\r\n  }\r\n\r\n  get items() {\r\n    return getItemsOfActorOfType(\r\n      this.parent,\r\n      \"item\",\r\n      ({ system: { treasure, containerId } }) => !treasure && !containerId\r\n    );\r\n  }\r\n\r\n  get weapons() {\r\n    return getItemsOfActorOfType(\r\n      this.parent,\r\n      \"weapon\",\r\n      ({ system: { containerId } }) => !containerId\r\n    );\r\n  }\r\n\r\n  get armor() {\r\n    return getItemsOfActorOfType(\r\n      this.parent,\r\n      \"armor\",\r\n      ({ system: { containerId } }) => !containerId\r\n    );\r\n  }\r\n\r\n  get abilities() {\r\n    return getItemsOfActorOfType(\r\n      this.parent,\r\n      \"ability\",\r\n      ({ system: { containerId } }) => !containerId\r\n    ).sort((a, b) => (a.sort || 0) - (b.sort || 0));\r\n  }\r\n\r\n  get #spellList() {\r\n    return getItemsOfActorOfType(\r\n      this.parent,\r\n      \"spell\",\r\n      ({ system: { containerId } }) => !containerId\r\n    );\r\n  }\r\n\r\n  get isSlow() {\r\n    return this.weapons.length === 0\r\n      ? false\r\n      : this.weapons.every(\r\n          (item) =>\r\n            !(\r\n              item.type !== \"weapon\" ||\r\n              !item.system.slow ||\r\n              !item.system.equipped\r\n            )\r\n        );\r\n  }\r\n\r\n  // @todo How to test this?\r\n  get init() {\r\n    const group = game.settings.get(game.system.id, \"initiative\") !== \"group\";\r\n\r\n    return group\r\n      ? (this.initiative.value || 0) +\r\n          (this.initiative.mod || 0) +\r\n          this.scores.dex.init\r\n      : 0;\r\n  }\r\n}\r\n","/**\r\n * @file The data model for Actors of type Monster\r\n */\r\n// Encumbrance schemes\r\nimport OseDataModelCharacterEncumbranceDisabled from \"./data-model-classes/data-model-character-encumbrance-disabled\";\r\nimport OseDataModelCharacterSpells from \"./data-model-classes/data-model-character-spells\";\r\nimport OseDataModelCharacterMove from \"./data-model-classes/data-model-character-move\";\r\n\r\nconst getItemsOfActorOfType = (actor, filterType, filterFn = null) =>\r\n  actor.items\r\n    .filter(({ type }) => type === filterType)\r\n    .filter(filterFn || (() => true));\r\n\r\nexport default class OseDataModelMonster extends foundry.abstract.DataModel {\r\n  prepareDerivedData() {\r\n    this.encumbrance = new OseDataModelCharacterEncumbranceDisabled();\r\n    this.spells = new OseDataModelCharacterSpells(this.spells, this.#spellList);\r\n    this.movement = new OseDataModelCharacterMove(\r\n      this.encumbrance,\r\n      this.config.movementAuto = false,\r\n      this.movement.base\r\n      );\r\n  }\r\n\r\n  // @todo define schema options; stuff like min/max values and so on.\r\n  static defineSchema() {\r\n    const { StringField, NumberField, BooleanField, ObjectField, SchemaField } =\r\n      foundry.data.fields;\r\n\r\n    return {\r\n      spells: new ObjectField(),\r\n      details: new ObjectField(),\r\n      ac: new ObjectField(),\r\n      aac: new ObjectField(),\r\n      encumbrance: new SchemaField({\r\n        value: new NumberField({ integer: false }),\r\n        max: new NumberField({ integer: false }),\r\n      }),\r\n      movement: new ObjectField(),\r\n      config: new ObjectField(),\r\n      initiative: new ObjectField(),\r\n      hp: new SchemaField({\r\n        hd: new StringField(),\r\n        value: new NumberField({ integer: true }),\r\n        max: new NumberField({ integer: true }),\r\n      }),\r\n      thac0: new ObjectField(),\r\n      languages: new ObjectField(),\r\n      saves: new SchemaField({\r\n        breath: new SchemaField({ value: new NumberField({ integer: true }) }),\r\n        death: new SchemaField({ value: new NumberField({ integer: true }) }),\r\n        paralysis: new SchemaField({\r\n          value: new NumberField({ integer: true }),\r\n        }),\r\n        spell: new SchemaField({ value: new NumberField({ integer: true }) }),\r\n        wand: new SchemaField({ value: new NumberField({ integer: true }) }),\r\n      }),\r\n      retainer: new SchemaField({\r\n        enabled: new BooleanField(),\r\n        loyalty: new NumberField({ integer: true }),\r\n        wage: new StringField(),\r\n      }),\r\n    };\r\n  }\r\n\r\n  // @todo This only needs to be public until\r\n  //       we can ditch sharing out AC/AAC.\r\n  // eslint-disable-next-line class-methods-use-this\r\n  get usesAscendingAC() {\r\n    return game.settings.get(game.system.id, \"ascendingAC\");\r\n  }\r\n\r\n  get isNew() {\r\n    return !Object.values(this.saves).reduce(\r\n      (prev, curr) => prev + (parseInt(curr?.value, 10) || 0),\r\n      0\r\n    );\r\n  }\r\n\r\n  get containers() {\r\n    return getItemsOfActorOfType(\r\n      this.parent,\r\n      \"container\",\r\n      ({ system: { containerId } }) => !containerId\r\n    );\r\n  }\r\n\r\n  get treasures() {\r\n    return getItemsOfActorOfType(\r\n      this.parent,\r\n      \"item\",\r\n      ({ system: { treasure, containerId } }) => treasure && !containerId\r\n    ).sort((a, b) => a.name.localeCompare(b.name));\r\n  }\r\n\r\n  get items() {\r\n    return getItemsOfActorOfType(\r\n      this.parent,\r\n      \"item\",\r\n      ({ system: { treasure, containerId } }) => !treasure && !containerId\r\n    ).sort((a, b) => a.name.localeCompare(b.name));\r\n  }\r\n\r\n  get weapons() {\r\n    return getItemsOfActorOfType(\r\n      this.parent,\r\n      \"weapon\",\r\n      ({ system: { containerId } }) => !containerId\r\n    ).sort((a, b) => a.name.localeCompare(b.name));\r\n  }\r\n\r\n  get armor() {\r\n    return getItemsOfActorOfType(\r\n      this.parent,\r\n      \"armor\",\r\n      ({ system: { containerId } }) => !containerId\r\n    ).sort((a, b) => a.name.localeCompare(b.name));\r\n  }\r\n\r\n  get abilities() {\r\n    return getItemsOfActorOfType(\r\n      this.parent,\r\n      \"ability\",\r\n      ({ system: { containerId } }) => !containerId\r\n    ).sort((a, b) => (a.sort || 0) - (b.sort || 0));\r\n  }\r\n\r\n  get attackPatterns() {\r\n    return [...this.weapons, ...this.abilities]\r\n      .sort((a, b) => {\r\n        if (\r\n          a.system.pattern !== \"transparent\" &&\r\n          b.system.pattern === \"transparent\"\r\n        )\r\n          return -1;\r\n        return b.type.localeCompare(a.type) || a.name.localeCompare(b.name);\r\n      })\r\n      .reduce((prev, curr) => {\r\n        const updated = { ...prev };\r\n        const { pattern } = curr.system;\r\n        if (!updated[pattern]) updated[pattern] = [];\r\n        return { ...updated, [pattern]: [...updated[pattern], curr] };\r\n      }, {});\r\n  }\r\n\r\n  get #spellList() {\r\n    return getItemsOfActorOfType(\r\n      this.parent,\r\n      \"spell\",\r\n      ({ system: { containerId } }) => !containerId\r\n    );\r\n  }\r\n\r\n  get isSlow() {\r\n    return this.weapons.length === 0\r\n      ? false\r\n      : this.weapons.every(\r\n          (item) => !(item.type !== \"weapon\" || !item.system.slow)\r\n        );\r\n  }\r\n\r\n  get init() {\r\n    const group = game.settings.get(game.system.id, \"initiative\") !== \"group\";\r\n\r\n    return group ? this.initiative.mod : 0;\r\n  }\r\n}\r\n","/**\r\n * @file The system-specific Item entity, containing logic for operating on all available Item types.\r\n */\r\nimport OSE from \"../config\";\r\nimport OseDice from \"../helpers-dice\";\r\n\r\n/**\r\n * Override and extend the basic :class:`Item` implementation\r\n */\r\nexport default class OseItem extends Item {\r\n  // Replacing default image */\r\n  static get defaultIcons() {\r\n    return {\r\n      spell: `${OSE.assetsPath}/default/spell.png`,\r\n      ability: `${OSE.assetsPath}/default/ability.png`,\r\n      armor: `${OSE.assetsPath}/default/armor.png`,\r\n      weapon: `${OSE.assetsPath}/default/weapon.png`,\r\n      item: `${OSE.assetsPath}/default/item.png`,\r\n      container: `${OSE.assetsPath}/default/bag.png`,\r\n    };\r\n  }\r\n\r\n  static async create(data, context = {}) {\r\n    if (data.img === undefined) {\r\n      data.img = this.defaultIcons[data.type];\r\n    }\r\n    return super.create(data, context);\r\n  }\r\n\r\n  static migrateData(source) {\r\n    if (source?.img === \"\" && source.type) {\r\n      source.img = this.defaultIcons(source.type);\r\n    }\r\n    if (source?.system?.itemslots === undefined) {\r\n      if (\r\n        (source?.system?.tags ?? []).some(\r\n          (tag) => tag.value === \"Two-handed\"\r\n        ) &&\r\n        source?.type === \"weapon\"\r\n      )\r\n        source.system.itemslots = 2;\r\n      if (source?.system?.type === \"heavy\" && source.type === \"armor\")\r\n        source.system.itemslots = 2;\r\n    }\r\n\r\n    return source;\r\n  }\r\n\r\n  prepareData() {\r\n    super.prepareData();\r\n  }\r\n\r\n  async prepareDerivedData() {\r\n    // Rich text description\r\n    this.system.enrichedDescription = await TextEditor.enrichHTML(\r\n      this.system.details?.description || this.system.description,\r\n      { async: true }\r\n    );\r\n  }\r\n\r\n  static chatListeners(html) {\r\n    html.on(\"click\", \".card-buttons button\", this._onChatCardAction.bind(this));\r\n    html.on(\"click\", \".item-name\", this._onChatCardToggleContent.bind(this));\r\n  }\r\n\r\n  async getChatData(htmlOptions) {\r\n    const itemType = this.type;\r\n\r\n    const itemData = this.system;\r\n\r\n    // Item properties\r\n    const props = [];\r\n\r\n    if (itemType === \"weapon\") {\r\n      itemData.tags.forEach((t) => props.push(t.value));\r\n    }\r\n    if (itemType === \"spell\") {\r\n      props.push(\r\n        `${itemData.class} ${itemData.lvl}`,\r\n        itemData.range,\r\n        itemData.duration\r\n      );\r\n    }\r\n    if (itemData.hasOwnProperty(\"equipped\")) {\r\n      props.push(itemData.equipped ? \"Equipped\" : \"Not Equipped\");\r\n    }\r\n\r\n    // Filter properties and return\r\n    itemData.properties = props.filter((p) => !!p);\r\n    return itemData;\r\n  }\r\n\r\n  rollWeapon(options = {}) {\r\n    const isNPC = this.actor.type != \"character\";\r\n    const targets = 5;\r\n    const itemData = this.system;\r\n\r\n    let type = isNPC ? \"attack\" : \"melee\";\r\n    const rollData = {\r\n      item: this._source,\r\n      actor: this.actor,\r\n      roll: {\r\n        save: itemData.save,\r\n        target: null,\r\n      },\r\n    };\r\n\r\n    if (itemData.missile && itemData.melee && !isNPC) {\r\n      // Dialog\r\n      new Dialog({\r\n        title: \"Choose Attack Range\",\r\n        content: \"\",\r\n        buttons: {\r\n          melee: {\r\n            icon: '<i class=\"fas fa-fist-raised\"></i>',\r\n            label: \"Melee\",\r\n            callback: () => {\r\n              this.actor.targetAttack(rollData, \"melee\", options);\r\n            },\r\n          },\r\n          missile: {\r\n            icon: '<i class=\"fas fa-bullseye\"></i>',\r\n            label: \"Missile\",\r\n            callback: () => {\r\n              this.actor.targetAttack(rollData, \"missile\", options);\r\n            },\r\n          },\r\n        },\r\n        default: \"melee\",\r\n      }).render(true);\r\n      return true;\r\n    }\r\n    if (itemData.missile && !isNPC) {\r\n      type = \"missile\";\r\n    }\r\n    this.actor.targetAttack(rollData, type, options);\r\n    return true;\r\n  }\r\n\r\n  async rollFormula(options = {}) {\r\n    const itemData = this.system;\r\n\r\n    if (!itemData.roll) {\r\n      throw new Error(\"This Item does not have a formula to roll!\");\r\n    }\r\n\r\n    const label = `${this.name}`;\r\n    const rollParts = [itemData.roll];\r\n\r\n    const type = itemData.rollType;\r\n\r\n    const rollData = {\r\n      actor: this.actor,\r\n      item: this._source,\r\n      description: null,\r\n      save: itemData.save,\r\n      properties: this.system.autoTags,\r\n      roll: {\r\n        type,\r\n        target: itemData.rollTarget,\r\n        blindroll: itemData.blindroll,\r\n      },\r\n    };\r\n\r\n    if (this.type === \"spell\") {\r\n      rollData.description = itemData.description\r\n    };\r\n\r\n    // Roll and return\r\n    return OseDice.Roll({\r\n      event: options.event,\r\n      parts: rollParts,\r\n      data: rollData,\r\n      skipDialog: true,\r\n      speaker: ChatMessage.getSpeaker({ actor: this }),\r\n      flavor: game.i18n.format(\"OSE.roll.formula\", { label }),\r\n      title: game.i18n.format(\"OSE.roll.formula\", { label }),\r\n    });\r\n  }\r\n\r\n  async spendSpell() {\r\n    if (this.type !== \"spell\")\r\n      throw new Error(\r\n        \"Trying to spend a spell on an item that is not a spell.\"\r\n      );\r\n\r\n    const itemData = this.system;\r\n    await this.update({\r\n      system: {\r\n        cast: itemData.cast - 1,\r\n      },\r\n    });\r\n\r\n    if (itemData.roll) {\r\n      await this.rollFormula()\r\n    } else {\r\n      await this.show({ skipDialog: true })\r\n    };\r\n  }\r\n\r\n  _getRollTag(data) {\r\n    if (data.roll) {\r\n      const roll = `${data.roll}${data.rollTarget ? CONFIG.OSE.roll_type[data.rollType] : \"\"\r\n        }${data.rollTarget ? data.rollTarget : \"\"}`;\r\n      return {\r\n        label: `${game.i18n.localize(\"OSE.items.Roll\")} ${roll}`,\r\n      };\r\n    }\r\n  }\r\n\r\n  _getSaveTag(data) {\r\n    if (data.save) {\r\n      return {\r\n        label: CONFIG.OSE.saves_long[data.save],\r\n        icon: \"fa-skull\",\r\n      };\r\n    }\r\n  }\r\n\r\n  getAutoTagList() {\r\n    const tagList = [];\r\n    const data = this.system;\r\n    const itemType = this.type;\r\n\r\n    switch (itemType) {\r\n      case \"container\":\r\n      case \"item\": {\r\n        break;\r\n      }\r\n\r\n      case \"weapon\": {\r\n        tagList.push({ label: data.damage, icon: \"fa-tint\" });\r\n        if (data.missile) {\r\n          tagList.push({\r\n            label: `${data.range.short}/${data.range.medium}/${data.range.long}`,\r\n            icon: \"fa-bullseye\",\r\n          });\r\n        }\r\n\r\n        // Push manual tags\r\n        data.tags.forEach((t) => {\r\n          tagList.push({ label: t.value });\r\n        });\r\n        break;\r\n      }\r\n\r\n      case \"armor\": {\r\n        tagList.push({ label: CONFIG.OSE.armor[data.type], icon: \"fa-tshirt\" });\r\n        break;\r\n      }\r\n\r\n      case \"spell\": {\r\n        tagList.push(\r\n          { label: data.class },\r\n          { label: data.range },\r\n          { label: data.duration }\r\n        );\r\n        break;\r\n      }\r\n\r\n      case \"ability\": {\r\n        const reqs = data.requirements.split(\",\");\r\n        reqs.forEach((req) => tagList.push({ label: req }));\r\n        break;\r\n      }\r\n    }\r\n\r\n    const rollTag = this._getRollTag(data);\r\n    if (rollTag) {\r\n      tagList.push(rollTag);\r\n    }\r\n\r\n    const saveTag = this._getSaveTag(data);\r\n    if (saveTag) {\r\n      tagList.push(saveTag);\r\n    }\r\n\r\n    return tagList;\r\n  }\r\n\r\n  pushManualTag(values) {\r\n    const data = this?.system;\r\n    let update = [];\r\n    if (data.tags) {\r\n      update = data.tags;\r\n    }\r\n    const newData = {};\r\n    const regExp = /\\(([^)]+)\\)/;\r\n    if (update) {\r\n      values.forEach((val) => {\r\n        // Catch infos in brackets\r\n        const matches = regExp.exec(val);\r\n        let title = \"\";\r\n        if (matches) {\r\n          title = matches[1];\r\n          val = val.slice(0, Math.max(0, matches.index)).trim();\r\n        } else {\r\n          val = val.trim();\r\n          title = val;\r\n        }\r\n        // Auto fill checkboxes\r\n        switch (val) {\r\n          case CONFIG.OSE.tags.melee: {\r\n            newData.melee = true;\r\n            break;\r\n          }\r\n\r\n          case CONFIG.OSE.tags.slow: {\r\n            newData.slow = true;\r\n            break;\r\n          }\r\n\r\n          case CONFIG.OSE.tags.missile: {\r\n            newData.missile = true;\r\n            break;\r\n          }\r\n        }\r\n        if (!newData.melee && !newData.slow && !newData.missile)\r\n          update.push({ title, value: val, label: val });\r\n      });\r\n    } else {\r\n      update = values;\r\n    }\r\n    newData.tags = update;\r\n    return this.update({ system: newData });\r\n  }\r\n\r\n  popManualTag(value) {\r\n    const itemData = this.system;\r\n\r\n    const { tags } = itemData;\r\n    if (!tags) return;\r\n\r\n    const update = tags.filter((el) => el.value != value);\r\n    const newData = {\r\n      tags: update,\r\n    };\r\n    return this.update({ system: newData });\r\n  }\r\n\r\n  roll(options = {}) {\r\n    const itemData = this.system;\r\n    switch (this.type) {\r\n      case \"weapon\": {\r\n        this.rollWeapon(options);\r\n        break;\r\n      }\r\n\r\n      case \"spell\": {\r\n        this.spendSpell(options);\r\n        break;\r\n      }\r\n\r\n      case \"ability\": {\r\n        if (itemData.roll) {\r\n          this.rollFormula();\r\n        } else {\r\n          this.show();\r\n        }\r\n        break;\r\n      }\r\n\r\n      case \"item\":\r\n      case \"armor\": {\r\n        this.show();\r\n      }\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Show the item to Chat, creating a chat card which contains follow up attack or damage roll options\r\n   *\r\n   * @returns {Promise}\r\n   */\r\n  async show() {\r\n    const itemType = this.type;\r\n    // Basic template rendering data\r\n    const { token } = this.actor; // v10: prototypeToken?\r\n    const templateData = {\r\n      actor: this.actor,\r\n      tokenId: token ? `${token.parent.id}.${token.id}` : null,\r\n      item: this._source,\r\n      itemId: this._source.id,\r\n      data: await this.getChatData(),\r\n      labels: this.labels,\r\n      isHealing: this.isHealing,\r\n      hasDamage: this.hasDamage,\r\n      isSpell: itemType === \"spell\",\r\n      hasSave: this.hasSave,\r\n      config: CONFIG.OSE,\r\n    };\r\n    templateData.rollFormula = new Roll(templateData.data.roll, templateData).formula;\r\n    templateData.data.properties = this.system.autoTags;\r\n\r\n    // Render the chat card template\r\n    const template = `${OSE.systemPath()}/templates/chat/item-card.html`;\r\n    const html = await renderTemplate(template, templateData);\r\n\r\n    // Basic chat message data\r\n    const chatData = {\r\n      user: game.user.id,\r\n      type: CONST.CHAT_MESSAGE_TYPES.OTHER,\r\n      content: html,\r\n      speaker: {\r\n        actor: this.actor.id,\r\n        token: this.actor.token,\r\n        alias: this.actor.name,\r\n      },\r\n    };\r\n\r\n    // Toggle default roll mode\r\n    const rollMode = game.settings.get(\"core\", \"rollMode\");\r\n    if ([\"gmroll\", \"blindroll\"].includes(rollMode))\r\n      chatData.whisper = ChatMessage.getWhisperRecipients(\"GM\");\r\n    if (rollMode === \"selfroll\") chatData.whisper = [game.user.id];\r\n    if (rollMode === \"blindroll\") chatData.blind = true;\r\n\r\n    // Create the chat message\r\n    return ChatMessage.create(chatData);\r\n  }\r\n\r\n  /**\r\n   * Handle toggling the visibility of chat card content when the name is clicked\r\n   *\r\n   * @param {Event} event - The originating click event\r\n   * @private\r\n   */\r\n  static _onChatCardToggleContent(event) {\r\n    event.preventDefault();\r\n    const header = event.currentTarget;\r\n    const card = header.closest(\".chat-card\");\r\n    const content = card.querySelector(\".card-content\");\r\n    if (content.style.display === \"none\") {\r\n      $(content).slideDown(200);\r\n    } else {\r\n      $(content).slideUp(200);\r\n    }\r\n  }\r\n\r\n  static async _onChatCardAction(event) {\r\n    event.preventDefault();\r\n\r\n    // Extract card data\r\n    const button = event.currentTarget;\r\n    button.disabled = true;\r\n    const card = button.closest(\".chat-card\");\r\n    const { messageId } = card.closest(\".message\").dataset;\r\n    const message = game.messages.get(messageId);\r\n    const { action } = button.dataset;\r\n\r\n    // Validate permission to proceed with the roll\r\n    const isTargetted = action === \"save\";\r\n    if (!(isTargetted || game.user.isGM || message.isAuthor)) return;\r\n\r\n    // Get the Actor from a synthetic Token\r\n    const actor = this._getChatCardActor(card);\r\n    if (!actor) return;\r\n\r\n    // Get the Item\r\n    const item = actor.items.get(card.dataset.itemId);\r\n    if (!item) {\r\n      return ui.notifications.error(\r\n        game.i18n.format(\"OSE.error.itemNoLongerExistsOnActor\", {\r\n          actorName: actor.name,\r\n          itemId: card.dataset.itemId,\r\n        })\r\n      );\r\n    }\r\n\r\n    // Get card targets\r\n    let targets = [];\r\n    if (isTargetted) {\r\n      targets = this._getChatCardTargets(card);\r\n    }\r\n\r\n    // Attack and Damage Rolls\r\n    switch (action) {\r\n      case \"damage\": {\r\n        await item.rollDamage({ event });\r\n        break;\r\n      }\r\n\r\n      case \"formula\": {\r\n        await item.rollFormula({ event });\r\n        break;\r\n      }\r\n\r\n      case \"save\": {\r\n        if (targets.length === 0) {\r\n          ui.notifications.error(\r\n            game.i18n.localize(\"OSE.error.noTokenControlled\")\r\n          );\r\n          return (button.disabled = false);\r\n        }\r\n        for (const t of targets) {\r\n          await t.rollSave(button.dataset.save, { event });\r\n        }\r\n\r\n        break;\r\n      }\r\n      // No default\r\n    }\r\n\r\n    // Re-enable the button\r\n    button.disabled = false;\r\n  }\r\n\r\n  static _getChatCardActor(card) {\r\n    // Case 1 - a synthetic actor from a Token\r\n    const tokenKey = card.dataset.tokenId;\r\n    if (tokenKey) {\r\n      const [sceneId, tokenId] = tokenKey.split(\".\");\r\n      const scene = game.scenes.get(sceneId);\r\n      if (!scene) return null;\r\n      const tokenData = scene.getEmbeddedDocument(\"Token\", tokenId);\r\n      if (!tokenData) return null;\r\n      const token = new Token(tokenData);\r\n      return token.actor;\r\n    }\r\n\r\n    // Case 2 - use Actor ID directory\r\n    const { actorId } = card.dataset;\r\n    return game.actors.get(actorId) || null;\r\n  }\r\n\r\n  static _getChatCardTargets(card) {\r\n    const { character } = game.user;\r\n    const { controlled } = canvas.tokens;\r\n    const targets = controlled.reduce(\r\n      (arr, t) => (t.actor ? [...arr, t.actor] : arr),\r\n      []\r\n    );\r\n    if (character && controlled.length === 0) targets.push(character);\r\n    return targets;\r\n  }\r\n}\r\n","import OseItem from \"../item/entity\";\r\n\r\nimport skipRollDialogCheck from \"../helpers-behaviour\";\r\nimport OseDice from \"../helpers-dice\";\r\n\r\n/**\r\n * Used in the rollAttack function to remove zeroes from rollParts arrays\r\n *\r\n * @param {[]} arr - an array\r\n * @returns {[]} - an array\r\n */\r\nconst removeFalsyElements = (arr) =>\r\n  arr.reduce((a, b) => (b ? [...a, b] : a), []);\r\n\r\nexport default class OseActor extends Actor {\r\n  prepareDerivedData() {\r\n    if (game.version.startsWith(\"10\")) this.system.prepareDerivedData?.();\r\n  }\r\n\r\n  static migrateData(source) {\r\n    // Fixing missing img\r\n    if (source?.img === \"\") {\r\n      source.img = \"icons/svg/mystery-man.svg\";\r\n    }\r\n    if (source?.prototypeToken?.texture?.img === \"\") {\r\n      source.prototypeToken.texture.img = \"icons/svg/mystery-man.svg\";\r\n    }\r\n    // Fixing missing movement.value by moving it to details.movement\r\n    if (source?.system?.movement?.value && !source?.system?.details.movement){\r\n      source.system.details.movement = source.system.movement.value;\r\n      delete source.system.movement.value;\r\n    }\r\n\r\n    return source;\r\n  }\r\n\r\n  async update(data, options = {}) {\r\n    const newData = { ...data };\r\n    const {\r\n      \"system.ac.value\": acValue,\r\n      \"system.aac.value\": aacValue,\r\n      \"system.thac0.bba\": bbaValue,\r\n      \"system.thac0.value\": thac0Value,\r\n    } = newData;\r\n\r\n    // Compute AAC from AC\r\n    if (acValue) {\r\n      newData[\"system.aac.value\"] = 19 - acValue;\r\n    } else if (aacValue) {\r\n      newData[\"system.ac.value\"] = 19 - aacValue;\r\n    }\r\n\r\n    // Compute Thac0 from BBA\r\n    if (thac0Value) {\r\n      newData[\"system.thac0.bba\"] = 19 - thac0Value;\r\n    } else if (bbaValue) {\r\n      newData[\"system.thac0.value\"] = 19 - bbaValue;\r\n    }\r\n\r\n    super.update(newData, options);\r\n  }\r\n\r\n  async createEmbeddedDocuments(embeddedName, data = [], context = {}) {\r\n    data.map((item) => {\r\n      if (item.img === undefined) {\r\n        item.img = OseItem.defaultIcons[item.type];\r\n      }\r\n    });\r\n    return super.createEmbeddedDocuments(embeddedName, data, context);\r\n  }\r\n\r\n  /* -------------------------------------------- */\r\n  /*  Socket Listeners and Handlers\r\n    /* -------------------------------------------- */\r\n  getExperience(value, options = {}) {\r\n    const actorData = this.system;\r\n    const actorType = this.type;\r\n    // @TODO this seems like not the best spot for defining the xpKey const\r\n    const xpKey = \"system.details.xp.value\";\r\n\r\n    if (actorType !== \"character\") {\r\n      return;\r\n    }\r\n    const modified = Math.floor(\r\n      value + (actorData.details.xp.bonus * value) / 100\r\n    );\r\n    return this.update({\r\n      [xpKey]: modified + actorData.details.xp.value,\r\n    }).then(() => {\r\n      const speaker = ChatMessage.getSpeaker({ actor: this });\r\n      ChatMessage.create({\r\n        content: game.i18n.format(\"OSE.messages.GetExperience\", {\r\n          name: this.name,\r\n          value: modified,\r\n        }),\r\n        speaker,\r\n      });\r\n    });\r\n  }\r\n\r\n  isNew() {\r\n    return this.system.isNew;\r\n  }\r\n\r\n  generateSave(hd) {\r\n    hd = hd.includes(\"+\") ? parseInt(hd) + 1 : parseInt(hd);\r\n\r\n    // Compute saves\r\n    let saves = {};\r\n    for (let i = 0; i <= hd; i++) {\r\n      const tmp = CONFIG.OSE.monster_saves[i];\r\n      if (tmp) {\r\n        saves = tmp;\r\n      }\r\n    }\r\n\r\n    // Compute Thac0\r\n    let thac0 = 20;\r\n    Object.keys(CONFIG.OSE.monster_thac0).forEach((k) => {\r\n      if (hd < parseInt(k)) return;\r\n      thac0 = CONFIG.OSE.monster_thac0[k];\r\n    });\r\n\r\n    this.update({\r\n      \"system.thac0.value\": thac0,\r\n      \"system.thac0.bba\": 19 - thac0,\r\n      \"system.saves\": {\r\n        death: {\r\n          value: saves.d,\r\n        },\r\n        wand: {\r\n          value: saves.w,\r\n        },\r\n        paralysis: {\r\n          value: saves.p,\r\n        },\r\n        breath: {\r\n          value: saves.b,\r\n        },\r\n        spell: {\r\n          value: saves.s,\r\n        },\r\n      },\r\n    });\r\n  }\r\n\r\n  /* -------------------------------------------- */\r\n  /*  Rolls                                       */\r\n  /* -------------------------------------------- */\r\n\r\n  async rollHP(options = {}) {\r\n    const { total } = await new Roll(this.system.hp.hd).roll({ async: true });\r\n    return this.update({ \"system.hp\": { max: total, value: total } });\r\n  }\r\n\r\n  rollSave(save, options = {}) {\r\n    const label = game.i18n.localize(`OSE.saves.${save}.long`);\r\n    const rollParts = [\"1d20\"];\r\n    const actorData = this.system;\r\n    const actorType = this.type;\r\n\r\n    const data = {\r\n      actor: this,\r\n      roll: {\r\n        type: \"above\",\r\n        target: actorData.saves[save].value,\r\n        magic: actorType === \"character\" ? actorData.scores.wis.mod : 0,\r\n      },\r\n      details: game.i18n.format(\"OSE.roll.details.save\", { save: label }),\r\n    };\r\n\r\n    const rollMethod =\r\n      actorType === \"character\" ? OseDice.RollSave : OseDice.Roll;\r\n\r\n    // Roll and return\r\n    return rollMethod({\r\n      event: options.event,\r\n      parts: rollParts,\r\n      data,\r\n      skipDialog: options.fastForward || skipRollDialogCheck(options.event),\r\n      speaker: ChatMessage.getSpeaker({ actor: this }),\r\n      flavor: game.i18n.format(\"OSE.roll.save\", { save: label }),\r\n      title: game.i18n.format(\"OSE.roll.save\", { save: label }),\r\n      chatMessage: options.chatMessage,\r\n    });\r\n  }\r\n\r\n  rollMorale(options = {}) {\r\n    const actorData = this.system;\r\n\r\n    const rollParts = [\"2d6\"];\r\n\r\n    const data = {\r\n      actor: this,\r\n      roll: {\r\n        type: \"below\",\r\n        target: actorData.details.morale,\r\n      },\r\n    };\r\n\r\n    // Roll and return\r\n    return OseDice.Roll({\r\n      event: options.event,\r\n      parts: rollParts,\r\n      data,\r\n      skipDialog: true,\r\n      speaker: ChatMessage.getSpeaker({ actor: this }),\r\n      flavor: game.i18n.localize(\"OSE.roll.morale\"),\r\n      title: game.i18n.localize(\"OSE.roll.morale\"),\r\n    });\r\n  }\r\n\r\n  rollLoyalty(options = {}) {\r\n    const label = game.i18n.localize(`OSE.roll.loyalty`);\r\n    const rollParts = [\"2d6\"];\r\n\r\n    const actorData = this.system;\r\n\r\n    const data = {\r\n      actor: this,\r\n      roll: {\r\n        type: \"below\",\r\n        target: actorData.retainer.loyalty,\r\n      },\r\n    };\r\n\r\n    // Roll and return\r\n    return OseDice.Roll({\r\n      event: options.event,\r\n      parts: rollParts,\r\n      data,\r\n      skipDialog: true,\r\n      speaker: ChatMessage.getSpeaker({ actor: this }),\r\n      flavor: label,\r\n      title: label,\r\n    });\r\n  }\r\n\r\n  rollReaction(options = {}) {\r\n    const rollParts = [\"2d6\"];\r\n\r\n    const data = {\r\n      actor: this,\r\n      roll: {\r\n        type: \"table\",\r\n        table: {\r\n          2: game.i18n.format(\"OSE.reaction.Hostile\", {\r\n            name: this.name,\r\n          }),\r\n          3: game.i18n.format(\"OSE.reaction.Unfriendly\", {\r\n            name: this.name,\r\n          }),\r\n          6: game.i18n.format(\"OSE.reaction.Neutral\", {\r\n            name: this.name,\r\n          }),\r\n          9: game.i18n.format(\"OSE.reaction.Indifferent\", {\r\n            name: this.name,\r\n          }),\r\n          12: game.i18n.format(\"OSE.reaction.Friendly\", {\r\n            name: this.name,\r\n          }),\r\n        },\r\n      },\r\n    };\r\n\r\n    // Roll and return\r\n    return OseDice.Roll({\r\n      event: options.event,\r\n      parts: rollParts,\r\n      data,\r\n      skipDialog: options.fastForward || skipRollDialogCheck(options.event),\r\n      speaker: ChatMessage.getSpeaker({ actor: this }),\r\n      flavor: game.i18n.localize(\"OSE.reaction.check\"),\r\n      title: game.i18n.localize(\"OSE.reaction.check\"),\r\n    });\r\n  }\r\n\r\n  rollCheck(score, options = {}) {\r\n    const actorType = this.type;\r\n\r\n    if (actorType !== \"character\") return;\r\n\r\n    const actorData = this.system;\r\n\r\n    const label = game.i18n.localize(`OSE.scores.${score}.long`);\r\n    const rollParts = [\"1d20\"];\r\n\r\n    const data = {\r\n      actor: this,\r\n      roll: {\r\n        type: \"check\",\r\n        target: actorData.scores[score].value,\r\n      },\r\n\r\n      details: game.i18n.format(\"OSE.roll.details.attribute\", {\r\n        score: label,\r\n      }),\r\n    };\r\n\r\n    // Roll and return\r\n    return OseDice.Roll({\r\n      event: options.event,\r\n      parts: rollParts,\r\n      data,\r\n      skipDialog: options.fastForward || skipRollDialogCheck(options.event),\r\n      speaker: ChatMessage.getSpeaker({ actor: this }),\r\n      flavor: game.i18n.format(\"OSE.roll.attribute\", { attribute: label }),\r\n      title: game.i18n.format(\"OSE.roll.attribute\", { attribute: label }),\r\n      chatMessage: options.chatMessage,\r\n    });\r\n  }\r\n\r\n  rollHitDice(options = {}) {\r\n    const actorType = this.type;\r\n\r\n    const actorData = this.system;\r\n\r\n    const label = game.i18n.localize(`OSE.roll.hd`);\r\n    const rollParts = [actorData.hp.hd];\r\n    if (actorType === \"character\") {\r\n      rollParts.push(actorData.scores.con.mod * actorData.details.level);\r\n    }\r\n\r\n    const data = {\r\n      actor: this,\r\n      roll: {\r\n        type: \"hitdice\",\r\n      },\r\n    };\r\n\r\n    // Roll and return\r\n    return OseDice.Roll({\r\n      event: options.event,\r\n      parts: rollParts,\r\n      data,\r\n      skipDialog: true,\r\n      speaker: ChatMessage.getSpeaker({ actor: this }),\r\n      flavor: label,\r\n      title: label,\r\n    });\r\n  }\r\n\r\n  rollAppearing(options = {}) {\r\n    const actorType = this.type;\r\n    if (actorType !== \"monster\") return;\r\n\r\n    const actorData = this.system;\r\n\r\n    const rollParts = [];\r\n    let label = \"\";\r\n    if (options.check === \"wilderness\") {\r\n      rollParts.push(actorData.details.appearing.w);\r\n      label = \"(2)\";\r\n    } else {\r\n      rollParts.push(actorData.details.appearing.d);\r\n      label = \"(1)\";\r\n    }\r\n    const data = {\r\n      actor: this,\r\n      roll: {\r\n        type: {\r\n          type: \"appearing\",\r\n        },\r\n      },\r\n    };\r\n\r\n    // Roll and return\r\n    return OseDice.Roll({\r\n      event: options.event,\r\n      parts: rollParts,\r\n      data,\r\n      skipDialog: true,\r\n      speaker: ChatMessage.getSpeaker({ actor: this }),\r\n      flavor: game.i18n.format(\"OSE.roll.appearing\", { type: label }),\r\n      title: game.i18n.format(\"OSE.roll.appearing\", { type: label }),\r\n    });\r\n  }\r\n\r\n  rollExploration(expl, options = {}) {\r\n    const actorType = this.type;\r\n    if (actorType !== \"character\") return;\r\n    const actorData = this.system;\r\n\r\n    const label = game.i18n.localize(`OSE.exploration.${expl}.long`);\r\n    const rollParts = [\"1d6\"];\r\n\r\n    const data = {\r\n      actor: this,\r\n      roll: {\r\n        type: \"below\",\r\n        target: actorData.exploration[expl],\r\n        blindroll: true,\r\n      },\r\n      details: game.i18n.format(\"OSE.roll.details.exploration\", {\r\n        expl: label,\r\n      }),\r\n    };\r\n\r\n    // Roll and return\r\n    return OseDice.Roll({\r\n      event: options.event,\r\n      parts: rollParts,\r\n      data,\r\n      skipDialog: options.fastForward || skipRollDialogCheck(options.event),\r\n      speaker: ChatMessage.getSpeaker({ actor: this }),\r\n      flavor: game.i18n.format(\"OSE.roll.exploration\", { exploration: label }),\r\n      title: game.i18n.format(\"OSE.roll.exploration\", { exploration: label }),\r\n    });\r\n  }\r\n\r\n  rollDamage(attData, options = {}) {\r\n    const data = this.system;\r\n\r\n    const rollData = {\r\n      actor: this,\r\n      item: attData.item,\r\n      roll: {\r\n        type: \"damage\",\r\n      },\r\n    };\r\n\r\n    const dmgParts = [];\r\n    if (attData.roll.dmg) {\r\n      dmgParts.push(attData.roll.dmg);\r\n    } else {\r\n      dmgParts.push(\"1d6\");\r\n    }\r\n\r\n    // Add Str to damage\r\n    if (attData.roll.type === \"melee\" && data.scores.str.mod) {\r\n      dmgParts.push(data.scores.str.mod);\r\n    }\r\n\r\n    // Damage roll\r\n    OseDice.Roll({\r\n      event: options.event,\r\n      parts: dmgParts,\r\n      data: rollData,\r\n      skipDialog: true,\r\n      speaker: ChatMessage.getSpeaker({ actor: this }),\r\n      flavor: `${attData.label} - ${game.i18n.localize(\"OSE.Damage\")}`,\r\n      title: `${attData.label} - ${game.i18n.localize(\"OSE.Damage\")}`,\r\n    });\r\n  }\r\n\r\n  async targetAttack(data, type, options) {\r\n    if (game.user.targets.size > 0) {\r\n      for (const t of game.user.targets.values()) {\r\n        data.roll.target = t;\r\n        await this.rollAttack(data, {\r\n          type,\r\n          skipDialog: options.skipDialog,\r\n        });\r\n      }\r\n    } else {\r\n      this.rollAttack(data, { type, skipDialog: options.skipDialog });\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Constructs the attack roll formula for an attack\r\n   *\r\n   * @param {object} attData - the attack data\r\n   * @param {OseItem} attData.item - the item being used in the attack\r\n   * @param {OseActor} attData.actor - this actor (at least it should be!)\r\n   * @param {object} attData.roll - the attack roll data\r\n   * @param {string} attData.roll.save - the save roll that may be used against the attack\r\n   * @param {OseActor} attData.roll.target - the target of the attack\r\n   * @param {object} options - the type of attack and whether to skip the dialog\r\n   * @param {string} options.type - the type of attack, i.e. melee or missile\r\n   * @param {boolean} options.skipDialog - whether to skip the dialog\r\n   * @returns {OseDice.Roll} - the attack roll with completed rollParts and other data\r\n   */\r\n  rollAttack(attData, options = {}) {\r\n    const data = this.system;\r\n\r\n    const label = attData.item\r\n      ? game.i18n.format(\"OSE.roll.attacksWith\", {\r\n          name: attData.item.name,\r\n        })\r\n      : game.i18n.format(\"OSE.roll.attacks\", {\r\n          name: this.name,\r\n        });\r\n\r\n    const dmgParts = removeFalsyElements([\r\n      // Weapon damage roll value\r\n      attData.item?.system?.damage ?? \"1d6\",\r\n    ]);\r\n    if (!this.system.config?.ignoreBonusDamage && attData.item?.system?.bonus)\r\n      // Weapon Damage Bonus\r\n      dmgParts.push(attData.item?.system?.bonus);\r\n\r\n    const rollParts = [\"1d20\"];\r\n    const ascending = game.settings.get(game.system.id, \"ascendingAC\");\r\n\r\n    if (ascending && data.thac0.bba) rollParts.push(data.thac0.bba);\r\n\r\n    // for each type of attack, add the Tweaks bonus\r\n    // and str/dex modifier only if it's non-zero\r\n    let attackMods = []; \r\n    let strDmgMods= [];\r\n    let defaultMods = [0, 0];\r\n\r\n    if (data.scores?.str?.dmg !== undefined && data.thac0?.mod?.melee !== undefined) {\r\n      strDmgMods = [data.scores.str.dmg, data.thac0.mod.melee];\r\n    }\r\n    else {\r\n      strDmgMods = defaultMods;\r\n    }\r\n\r\n    if (options.type === \"melee\") {\r\n      attackMods = [data.scores.str.atk, data.thac0.mod.melee];\r\n      dmgParts.push(...removeFalsyElements(strDmgMods));\r\n    }\r\n\r\n    // Add missile mod to attack roll only (missile attacks don't get bonus damage)\r\n    if (options.type === \"missile\")\r\n      attackMods = [data.scores.dex.atk, data.thac0.mod.missile];\r\n\r\n    // Add weapon bonus to attack roll only (already added to dmgParts)\r\n    if (attData.item) attackMods.push(attData.item?.system?.bonus);\r\n\r\n    rollParts.push(...removeFalsyElements(attackMods));\r\n\r\n    const rollData = {\r\n      actor: this,\r\n      item: attData.item,\r\n      itemId: attData.item?._id,\r\n      roll: {\r\n        type: options.type,\r\n        thac0: data.thac0.value,\r\n        dmg: dmgParts,\r\n        save: attData.roll.save,\r\n        target: attData.roll.target,\r\n      },\r\n    };\r\n    // Roll and return\r\n    return OseDice.Roll({\r\n      event: options.event,\r\n      parts: rollParts,\r\n      data: rollData,\r\n      skipDialog: options.skipDialog,\r\n      speaker: ChatMessage.getSpeaker({ actor: this }),\r\n      flavor: label,\r\n      flags: { ose: { roll: \"attack\", itemId: attData.item?._id } },\r\n      title: label,\r\n    });\r\n  }\r\n\r\n  /**\r\n   * @param {number | string} amount\r\n   * @param {1 | -1} multiplier\r\n   * @returns\r\n   */\r\n  async applyDamage(amount = 0, multiplier = 1) {\r\n    amount = Math.floor(parseInt(amount) * multiplier);\r\n\r\n    const { value, max } = this.system.hp;\r\n\r\n    // Update the Actor\r\n    return this.update({\r\n      \"system.hp.value\": Math.clamped(value - amount, 0, max),\r\n    });\r\n  }\r\n}\r\n","/**\r\n * @file The sheet class for Actors of type Monster\r\n */\r\nimport OSE from \"../config\";\r\nimport OseActorSheet from \"./actor-sheet\";\r\n\r\n/**\r\n * Extend the basic ActorSheet with some very simple modifications\r\n */\r\nexport default class OseActorSheetMonster extends OseActorSheet {\r\n  /**\r\n   * Extend and override the default options used by the Actor Sheet\r\n   *\r\n   * @returns {object} - The sheet's default options\r\n   */\r\n  static get defaultOptions() {\r\n    return foundry.utils.mergeObject(super.defaultOptions, {\r\n      classes: [\"ose\", \"sheet\", \"monster\", \"actor\"],\r\n      template: `${OSE.systemPath()}/templates/actors/monster-sheet.html`,\r\n      width: 450,\r\n      height: 560,\r\n      resizable: true,\r\n      tabs: [\r\n        {\r\n          navSelector: \".tabs\",\r\n          contentSelector: \".sheet-body\",\r\n          initial: \"attributes\",\r\n        },\r\n      ],\r\n    });\r\n  }\r\n\r\n  /**\r\n   * Organize and classify Owned Items for Character sheets\r\n   *\r\n   * @param data\r\n   * @private\r\n   */\r\n  _prepareItems(data) {\r\n    // Assign and return\r\n    data.owned = {\r\n      weapons: this.actor.system.weapons,\r\n      items: this.actor.system.items,\r\n      containers: this.actor.system.containers,\r\n      armors: this.actor.system.armor,\r\n      treasures: this.actor.system.treasures,\r\n    };\r\n\r\n    data.attackPatterns = this.actor.system.attackPatterns;\r\n    data.spells = this.actor.system.spells.spellList;\r\n  }\r\n\r\n  /**\r\n   * Prepare data for rendering the Actor sheet\r\n   * The prepared data object contains both the actor data as well as additional sheet options\r\n   */\r\n  async getData() {\r\n    const data = super.getData();\r\n    // Prepare owned items\r\n    this._prepareItems(data);\r\n\r\n    const monsterData = data?.system;\r\n\r\n    // Settings\r\n    data.config.morale = game.settings.get(game.system.id, \"morale\");\r\n    monsterData.details.treasure.link = await TextEditor.enrichHTML(\r\n      monsterData.details.treasure.table,\r\n      { async: true }\r\n    );\r\n    data.isNew = this.actor.isNew();\r\n\r\n    if (isNewerVersion(game.version, \"10.264\")) {\r\n      data.enrichedBiography = await TextEditor.enrichHTML(\r\n        this.object.system.details.biography,\r\n        { async: true }\r\n      );\r\n    }\r\n    return data;\r\n  }\r\n\r\n  /**\r\n   * Monster creation helpers\r\n   */\r\n  async generateSave() {\r\n    const choices = CONFIG.OSE.monster_saves;\r\n\r\n    const templateData = { choices };\r\n    const dlg = await renderTemplate(\r\n      `${OSE.systemPath()}/templates/actors/dialogs/monster-saves.html`,\r\n      templateData\r\n    );\r\n    // Create Dialog window\r\n    new Dialog(\r\n      {\r\n        title: game.i18n.localize(\"OSE.dialog.generateSaves\"),\r\n        content: dlg,\r\n        buttons: {\r\n          ok: {\r\n            label: game.i18n.localize(\"OSE.Ok\"),\r\n            icon: '<i class=\"fas fa-check\"></i>',\r\n            callback: (html) => {\r\n              const hd = html.find('input[name=\"hd\"]').val();\r\n              this.actor.generateSave(hd);\r\n            },\r\n          },\r\n          cancel: {\r\n            icon: '<i class=\"fas fa-times\"></i>',\r\n            label: game.i18n.localize(\"OSE.Cancel\"),\r\n          },\r\n        },\r\n        default: \"ok\",\r\n      },\r\n      {\r\n        width: 250,\r\n      }\r\n    ).render(true);\r\n  }\r\n\r\n  async _onDrop(event) {\r\n    super._onDrop(event);\r\n    let data;\r\n    try {\r\n      data = JSON.parse(event.dataTransfer.getData(\"text/plain\"));\r\n      if (data.type !== \"RollTable\") return;\r\n    } catch (error) {\r\n      return false;\r\n    }\r\n\r\n    let link = \"\";\r\n    if (data.pack) {\r\n      const tableDatum = game.packs\r\n        .get(data.pack)\r\n        .index.find((el) => el._id === data.id);\r\n      link = `@UUID[${data.uuid}]{${tableDatum.name}}`;\r\n    } else {\r\n      link = `@UUID[${data.uuid}]`;\r\n    }\r\n    this.actor.update({ \"system.details.treasure.table\": link });\r\n  }\r\n\r\n  /* -------------------------------------------- */\r\n  async _resetAttacks(event) {\r\n    return Promise.all(\r\n      this.actor.items\r\n        .filter((i) => i.type === \"weapon\")\r\n        .map((weapon) =>\r\n          weapon.update({\r\n            \"system.counter.value\": parseInt(weapon.system.counter.max),\r\n          })\r\n        )\r\n    );\r\n  }\r\n\r\n  async _updateAttackCounter(event) {\r\n    event.preventDefault();\r\n    const item = this._getItemFromActor(event);\r\n\r\n    if (event.target.dataset.field === \"value\") {\r\n      return item.update({\r\n        \"system.counter.value\": parseInt(event.target.value),\r\n      });\r\n    }\r\n    if (event.target.dataset.field === \"max\") {\r\n      return item.update({\r\n        \"system.counter.max\": parseInt(event.target.value),\r\n      });\r\n    }\r\n  }\r\n\r\n  _cycleAttackPatterns(event) {\r\n    const item = super._getItemFromActor(event);\r\n    const currentColor = item.system.pattern;\r\n    // Attack patterns include all OSE colors and transparent\r\n    const colors = Object.keys(CONFIG.OSE.colors);\r\n    colors.push(\"transparent\");\r\n    let index = colors.indexOf(currentColor);\r\n    if (index + 1 === colors.length) {\r\n      index = 0;\r\n    } else {\r\n      index++;\r\n    }\r\n    item.update({\r\n      \"system.pattern\": colors[index],\r\n    });\r\n  }\r\n\r\n  /**\r\n   * Activate event listeners using the prepared sheet HTML\r\n   *\r\n   * @param html - {HTML}   The prepared HTML object ready to be rendered into the DOM\r\n   */\r\n  activateListeners(html) {\r\n    super.activateListeners(html);\r\n\r\n    html.find(\".morale-check a\").click((ev) => {\r\n      const actorObject = this.actor;\r\n      actorObject.rollMorale({ event: ev });\r\n    });\r\n\r\n    html.find(\".reaction-check a\").click((ev) => {\r\n      const actorObject = this.actor;\r\n      actorObject.rollReaction({ event: ev });\r\n    });\r\n\r\n    html.find(\".appearing-check a\").click((ev) => {\r\n      const actorObject = this.actor;\r\n      const check = $(ev.currentTarget).closest(\".check-field\").data(\"check\");\r\n      actorObject.rollAppearing({ event: ev, check });\r\n    });\r\n\r\n    html.find(\".treasure-table a\").contextmenu((ev) => {\r\n      this.actor.update({ \"system.details.treasure.table\": null });\r\n    });\r\n\r\n    // Everything below here is only needed if the sheet is editable\r\n    if (!this.options.editable) return;\r\n\r\n    html.find(\".item-reset[data-action='reset-attacks']\").click((ev) => {\r\n      this._resetAttacks(ev);\r\n    });\r\n\r\n    html\r\n      .find(\".counter input\")\r\n      .click((ev) => ev.target.select())\r\n      .change(this._updateAttackCounter.bind(this));\r\n\r\n    html.find(\".hp-roll\").click((ev) => {\r\n      this.actor.rollHP({ event: ev });\r\n    });\r\n\r\n    html.find(\".item-pattern\").click((ev) => this._cycleAttackPatterns(ev));\r\n\r\n    html\r\n      .find('button[data-action=\"generate-saves\"]')\r\n      .click(() => this.generateSave());\r\n  }\r\n}\r\n","/**\r\n * @file Contains helpers for tag generation\r\n */\r\n\r\nconst OseTags = {\r\n  /**\r\n  * Returns the formula used for dice roll calculations\r\n  * @param actor - The actor object which owns the item with roll data\r\n  * @param data.roll - The string used to generate a formula\r\n  * @returns tagFormula - The constructed roll formula\r\n  */\r\n  rollTagFormula({\r\n    actor = {},\r\n    data = {\r\n      roll: \"\",\r\n    },\r\n  } = {}) {\r\n\r\n    const formulaData = {\r\n      actor,\r\n      data,\r\n    };\r\n\r\n    const tagFormula = new Roll(data.roll, formulaData).formula;\r\n    return tagFormula;\r\n  },\r\n\r\n  /**\r\n  * Returns the roll type and target value of rolls\r\n  * @param rollType - Type of roll target used\r\n  * @returns tagTarget - The constructed type and target value\r\n  */\r\n  rollTagTarget({\r\n    rollType = \"\" as keyof typeof CONFIG.OSE.roll_type,\r\n    rollTarget = null,\r\n  } = {}) {\r\n\r\n    const tagTarget =\r\n      rollTarget === null\r\n        ? \"\"\r\n        : ` ${CONFIG.OSE.roll_type[rollType]}${rollTarget}`;\r\n\r\n    return tagTarget;\r\n  },\r\n};\r\n\r\nexport default OseTags;\r\n","/**\r\n * @file The data model for Items of type Ability\r\n */\r\nimport OseTags from \"../helpers-tags\";\r\n\r\nexport default class OseDataModelAbility extends foundry.abstract.DataModel {\r\n  static defineSchema() {\r\n    const { StringField, NumberField, BooleanField, ArrayField, ObjectField } =\r\n      foundry.data.fields;\r\n    return {\r\n      save: new StringField(),\r\n      pattern: new StringField(),\r\n      requirements: new StringField(),\r\n      roll: new StringField(),\r\n      rollType: new StringField(),\r\n      rollTarget: new NumberField(),\r\n      blindroll: new BooleanField(),\r\n      description: new StringField(),\r\n      tags: new ArrayField(new ObjectField()),\r\n    };\r\n  }\r\n\r\n  get #rollTag() {\r\n    if (!this.roll) return null;\r\n\r\n    const rollLabel = game.i18n.localize(\"OSE.items.Roll\");\r\n\r\n    const rollFormula = OseTags.rollTagFormula({\r\n      actor: this.parent.actor,\r\n      data: this._source,\r\n    });\r\n\r\n    const rollTarget = OseTags.rollTagTarget({\r\n      rollType: this.rollType,\r\n      rollTarget: this.rollTarget,\r\n    });\r\n\r\n    return {\r\n      label: `${rollLabel} ${rollFormula}${rollTarget}`\r\n    };\r\n  }\r\n\r\n  get #saveTag() {\r\n    if (!this.save) return null;\r\n\r\n    return {\r\n      label: CONFIG.OSE.saves_long[this.save],\r\n      icon: \"fa-skull\",\r\n    };\r\n  }\r\n\r\n  get manualTags() {\r\n    return this.tags || [];\r\n  }\r\n\r\n  get autoTags() {\r\n    return [\r\n      ...this.requirements.split(\",\").map((req) => ({ label: req.trim() })),\r\n      this.#rollTag,\r\n      this.#saveTag,\r\n    ].filter((t) => !!t);\r\n  }\r\n}\r\n","/**\r\n * @file The data model for Items of type Armor\r\n */\r\nexport default class OseDataModelArmor extends foundry.abstract.DataModel {\r\n  static ArmorTypes = {\r\n    unarmored: \"OSE.armor.unarmored\",\r\n    light: \"OSE.armor.light\",\r\n    heavy: \"OSE.armor.heavy\",\r\n    shield: \"OSE.armor.shield\",\r\n  };\r\n\r\n  static defineSchema() {\r\n    const {\r\n      SchemaField,\r\n      StringField,\r\n      NumberField,\r\n      BooleanField,\r\n      ArrayField,\r\n      ObjectField,\r\n    } = foundry.data.fields;\r\n    return {\r\n      type: new StringField({\r\n        initial: \"light\",\r\n        choices: Object.keys(OseDataModelArmor.ArmorTypes),\r\n      }),\r\n      ac: new SchemaField({\r\n        value: new NumberField({\r\n          initial: 9,\r\n        }),\r\n      }),\r\n      aac: new SchemaField({\r\n        value: new NumberField({\r\n          initial: 10,\r\n        }),\r\n      }),\r\n      description: new StringField(),\r\n      tags: new ArrayField(new ObjectField()),\r\n      equipped: new BooleanField(),\r\n      cost: new NumberField({ min: 0, initial: 0 }),\r\n      containerId: new StringField(),\r\n      quantity: new SchemaField({\r\n        value: new NumberField({ min: 0, initial: 0 }),\r\n        max: new NumberField({ min: 0, initial: 0 }),\r\n      }),\r\n      weight: new NumberField({ min: 0, initial: 0 }),\r\n      itemslots: new NumberField({ min: 0, initial: 1 }),\r\n    };\r\n  }\r\n\r\n  get manualTags() {\r\n    if (!this.tags) return null;\r\n\r\n    const tagNames = new Set(\r\n      Object.values(CONFIG.OSE.auto_tags).map(({ label }) => label)\r\n    );\r\n    return this.tags\r\n      .filter(({ value }) => !tagNames.has(value))\r\n      .map(({ title, value }) => ({\r\n        title,\r\n        value,\r\n        label: value,\r\n      }));\r\n  }\r\n\r\n  get autoTags() {\r\n    const tagNames = Object.values(CONFIG.OSE.auto_tags);\r\n\r\n    const autoTags = this.tags.map(({ value }) =>\r\n      tagNames.find(({ label }) => value === label)\r\n    );\r\n\r\n    return [\r\n      { label: OseDataModelArmor.ArmorTypes[this.type], icon: \"fa-tshirt\" },\r\n      ...autoTags,\r\n      ...this.manualTags,\r\n    ]\r\n      .flat()\r\n      .filter((t) => !!t);\r\n  }\r\n}\r\n","/**\r\n * @file The data model for Items of type Container\r\n */\r\nexport default class OseDataModelContainer extends foundry.abstract.DataModel {\r\n  static defineSchema() {\r\n    const {\r\n      SchemaField,\r\n      StringField,\r\n      NumberField,\r\n      ArrayField,\r\n      ObjectField,\r\n      BooleanField,\r\n    } = foundry.data.fields;\r\n    return {\r\n      itemIds: new ArrayField(new StringField()),\r\n      description: new StringField(),\r\n      tags: new ArrayField(new ObjectField()),\r\n      equipped: new BooleanField(),\r\n      cost: new NumberField({ min: 0, initial: 0 }),\r\n      containerId: new StringField(),\r\n      quantity: new SchemaField({\r\n        value: new NumberField({ min: 0, initial: 0 }),\r\n        max: new NumberField({ min: 0, initial: 0 }),\r\n      }),\r\n      weight: new NumberField({ min: 0, initial: 0 }),\r\n      itemslots: new NumberField({ min: 0, initial: 1 }),\r\n    };\r\n  }\r\n\r\n  get contents() {\r\n    if (!this.itemIds) return null;\r\n    if (!this?.parent?.parent?.items) return null;\r\n    const { id } = this.parent;\r\n    return this.parent.parent.items.filter(\r\n      ({ system: { containerId } }) => id === containerId\r\n    );\r\n  }\r\n\r\n  get totalWeight() {\r\n    return this.contents.reduce(\r\n      (acc, { system: { weight, quantity } }) =>\r\n        acc + weight * (quantity?.value || 1),\r\n      0\r\n    );\r\n  }\r\n\r\n  get manualTags() {\r\n    if (!this.tags) return null;\r\n\r\n    const tagNames = new Set(\r\n      Object.values(CONFIG.OSE.auto_tags).map(({ label }) => label)\r\n    );\r\n    return this.tags\r\n      .filter(({ value }) => !tagNames.has(value))\r\n      .map(({ title, value }) => ({ title, value, label: value }));\r\n  }\r\n\r\n  get autoTags() {\r\n    const tagNames = Object.values(CONFIG.OSE.auto_tags);\r\n\r\n    const autoTags = this.tags.map(({ value }) =>\r\n      tagNames.find(({ label }) => value === label)\r\n    );\r\n\r\n    return [...autoTags, ...this.manualTags].flat().filter((t) => !!t);\r\n  }\r\n}\r\n","/**\r\n * @file The data model for Items of type Ability\r\n */\r\nexport default class OseDataModelItem extends foundry.abstract.DataModel {\r\n  static defineSchema() {\r\n    const {\r\n      SchemaField,\r\n      StringField,\r\n      NumberField,\r\n      BooleanField,\r\n      ArrayField,\r\n      ObjectField,\r\n    } = foundry.data.fields;\r\n    return {\r\n      treasure: new BooleanField(),\r\n      description: new StringField(),\r\n      tags: new ArrayField(new ObjectField()),\r\n      equipped: new BooleanField(),\r\n      cost: new NumberField({ min: 0, initial: 0 }),\r\n      containerId: new StringField(),\r\n      quantity: new SchemaField({\r\n        value: new NumberField({ min: 0, initial: 1 }),\r\n        max: new NumberField({ min: 0, initial: 0 }),\r\n      }),\r\n      weight: new NumberField({ min: 0, initial: 0 }),\r\n      itemslots: new NumberField({ min: 0, initial: 0 }),\r\n    };\r\n  }\r\n  get cumulativeWeight(){\r\n    return this.weight * this.quantity.value;\r\n  }\r\n\r\n  get cumulativeCost(){\r\n    return this.cost * this.quantity.value;\r\n  }\r\n\r\n  get cumulativeItemslots(){\r\n    return Math.ceil(this.itemslots * this.quantity.value);\r\n  }\r\n\r\n  static migrateData(source) {\r\n    if (source.details?.description && !source.description)\r\n      source.description = source.details.description;\r\n    return source;\r\n  }\r\n\r\n  get manualTags() {\r\n    if (!this.tags) return null;\r\n\r\n    const tagNames = new Set(\r\n      Object.values(CONFIG.OSE.auto_tags).map(({ label }) => label)\r\n    );\r\n    return this.tags\r\n      .filter(({ value }) => !tagNames.has(value))\r\n      .map(({ title, value }) => ({ title, value, label: value }));\r\n  }\r\n\r\n  get autoTags() {\r\n    const tagNames = Object.values(CONFIG.OSE.auto_tags);\r\n\r\n    const autoTags = this.tags.map(({ value }) =>\r\n      tagNames.find(({ label }) => value === label)\r\n    );\r\n\r\n    return [...autoTags, ...this.manualTags].flat().filter((t) => !!t);\r\n  }\r\n}\r\n","/**\r\n * @file The data model for Items of type Spell\r\n */\r\nimport OseTags from \"../helpers-tags\";\r\n\r\nexport default class OseDataModelSpell extends foundry.abstract.DataModel {\r\n  static defineSchema() {\r\n    const { StringField, NumberField, ArrayField, ObjectField } =\r\n      foundry.data.fields;\r\n    return {\r\n      save: new StringField(),\r\n      lvl: new NumberField({ positive: true, min: 0 }),\r\n      class: new StringField(),\r\n      duration: new StringField(),\r\n      range: new StringField(),\r\n      roll: new StringField(),\r\n      memorized: new NumberField({ min: 0 }),\r\n      cast: new NumberField({ min: 0 }),\r\n      description: new StringField(),\r\n      tags: new ArrayField(new ObjectField()),\r\n    };\r\n  }\r\n\r\n  get #rollTag() {\r\n    if (!this.roll) return null;\r\n\r\n    const rollLabel = game.i18n.localize(\"OSE.items.Roll\");\r\n\r\n    const rollFormula = OseTags.rollTagFormula({\r\n      actor: this.parent.actor,\r\n      data: this._source,\r\n    });\r\n\r\n    return {\r\n      label: `${rollLabel} ${rollFormula}`\r\n    };\r\n  }\r\n\r\n  get #saveTag() {\r\n    if (!this.save) return null;\r\n\r\n    return {\r\n      label: CONFIG.OSE.saves_long[this.save],\r\n      icon: \"fa-skull\",\r\n    };\r\n  }\r\n\r\n  get manualTags() {\r\n    return this.tags || [];\r\n  }\r\n\r\n  get autoTags() {\r\n    return [\r\n      { label: this.class },\r\n      { label: this.range },\r\n      { label: this.duration },\r\n      this.#rollTag,\r\n      this.#saveTag,\r\n    ].filter((t) => !!t);\r\n  }\r\n}\r\n","/**\r\n * @file The data model for Items of type Weapon\r\n */\r\nexport default class OseDataModelWeapon extends foundry.abstract.DataModel {\r\n  static defineSchema() {\r\n    const {\r\n      SchemaField,\r\n      StringField,\r\n      NumberField,\r\n      BooleanField,\r\n      ArrayField,\r\n      ObjectField,\r\n    } = foundry.data.fields;\r\n    return {\r\n      damage: new StringField(),\r\n      description: new StringField(),\r\n      tags: new ArrayField(new ObjectField()),\r\n      equipped: new BooleanField(),\r\n      save: new StringField(),\r\n      range: new SchemaField({\r\n        short: new NumberField({ integer: true, min: 0, initial: 0 }),\r\n        medium: new NumberField({ integer: true, min: 0, initial: 0 }),\r\n        long: new NumberField({ integer: true, min: 0, initial: 0 }),\r\n      }),\r\n      bonus: new NumberField({}),\r\n      pattern: new StringField(),\r\n      missile: new BooleanField(),\r\n      melee: new BooleanField(),\r\n      slow: new BooleanField(),\r\n      counter: new SchemaField({\r\n        value: new NumberField({ integer: true, min: 0, initial: 0 }),\r\n        max: new NumberField({ integer: true, min: 0, initial: 0 }),\r\n      }),\r\n      cost: new NumberField({ min: 0, initial: 0 }),\r\n      containerId: new StringField(),\r\n      quantity: new SchemaField({\r\n        value: new NumberField({ min: 0 }),\r\n        max: new NumberField({ min: 0 }),\r\n      }),\r\n      weight: new NumberField({ min: 0 }),\r\n      itemslots: new NumberField({ min: 0, initial: 1 }),\r\n    };\r\n  }\r\n\r\n  get #missileTag() {\r\n    if (!this.missile) return null;\r\n    return [\r\n      CONFIG.OSE.auto_tags.missile,\r\n      {\r\n        label: `${this.range.short}/${this.range.medium}/${this.range.long}`,\r\n        icon: \"fa-bullseye\",\r\n      },\r\n    ];\r\n  }\r\n\r\n  get #meleeTag() {\r\n    if (!this.melee) return null;\r\n    return CONFIG.OSE.auto_tags.melee;\r\n  }\r\n\r\n  get #slowTag() {\r\n    if (!this.slow) return null;\r\n    return CONFIG.OSE.auto_tags.slow;\r\n  }\r\n\r\n  get #saveTag() {\r\n    if (!this.save) return null;\r\n\r\n    return {\r\n      label: CONFIG.OSE.saves_long[this.save],\r\n      icon: \"fa-skull\",\r\n    };\r\n  }\r\n\r\n  get manualTags() {\r\n    if (!this.tags) return null;\r\n\r\n    const tagNames = new Set(\r\n      Object.values(CONFIG.OSE.auto_tags).map(({ label }) => label)\r\n    );\r\n    return this.tags.filter(({ value }) => !tagNames.has(value));\r\n  }\r\n\r\n  /**\r\n   * Icons that display in the inventory grid's weapon row, under \"Qualities\"\r\n   *\r\n   * @returns {Array} - An array of qualities that display in the \"Qualities\" column on an Actor's Inventory sheet\r\n   */\r\n  get qualities() {\r\n    return [\r\n      ...this.autoTags\r\n        .filter((t) => !!t.image)\r\n        .map((t) => ({\r\n          ...t,\r\n          title: t.label,\r\n        })),\r\n      ...this.manualTags,\r\n    ];\r\n  }\r\n\r\n  get autoTags() {\r\n    const tagNames = Object.values(CONFIG.OSE.auto_tags);\r\n\r\n    const autoTags = this.tags.map(({ value }) =>\r\n      tagNames.find(({ label }) => value === label)\r\n    );\r\n\r\n    return [\r\n      { label: this.damage, icon: \"fa-tint\" },\r\n      this.#meleeTag,\r\n      this.#missileTag,\r\n      this.#slowTag,\r\n      ...autoTags,\r\n      this.#saveTag,\r\n    ]\r\n      .flat()\r\n      .filter((t) => !!t);\r\n  }\r\n}\r\n","/**\r\n * @file The system-level sheet for items of any type\r\n */\r\nimport OSE from \"../config\";\r\n\r\n/**\r\n * Extend the basic ItemSheet with some very simple modifications\r\n */\r\nexport default class OseItemSheet extends ItemSheet {\r\n  /**\r\n   * Extend and override the default options used by the Simple Item Sheet\r\n   *\r\n   * @returns {object}\r\n   */\r\n  static get defaultOptions() {\r\n    return foundry.utils.mergeObject(super.defaultOptions, {\r\n      classes: [\"ose\", \"sheet\", \"item\"],\r\n      width: 520,\r\n      height: 390,\r\n      resizable: true,\r\n      tabs: [\r\n        {\r\n          navSelector: \".tabs\",\r\n          contentSelector: \".sheet-body\",\r\n          initial: \"description\",\r\n        },\r\n      ],\r\n    });\r\n  }\r\n\r\n  /* -------------------------------------------- */\r\n\r\n  /** @override */\r\n  get template() {\r\n    const path = `${OSE.systemPath()}/templates/items`;\r\n    return `${path}/${this.item.type}-sheet.html`;\r\n  }\r\n\r\n  /**\r\n   * Prepare data for rendering the Item sheet\r\n   * The prepared data object contains both the actor data as well as additional sheet options\r\n   *\r\n   * @returns {object} Data for the Handlebars template\r\n   */\r\n  async getData() {\r\n    const { data } = super.getData();\r\n    data.editable = this.document.sheet.isEditable;\r\n    data.config = {\r\n      ...CONFIG.OSE,\r\n      encumbrance: game.settings.get(game.system.id, \"encumbranceOption\"),\r\n    };\r\n    data.enriched = {\r\n      description: await TextEditor.enrichHTML(\r\n        this.item.system?.description || \"\",\r\n        { async: true }\r\n      ),\r\n    };\r\n    return data;\r\n  }\r\n\r\n  /* -------------------------------------------- */\r\n\r\n  /**\r\n   * Activate event listeners using the prepared sheet HTML\r\n   *\r\n   * @param {JQuery} html - The prepared HTML object ready to be rendered into the DOM\r\n   */\r\n  activateListeners(html) {\r\n    html.find('input[data-action=\"add-tag\"]').keypress((ev) => {\r\n      if (ev.which === 13) {\r\n        const value = $(ev.currentTarget).val();\r\n        const values = value.split(\",\");\r\n        this.object.pushManualTag(values);\r\n      }\r\n    });\r\n    html.find(\".tag-delete\").click((ev) => {\r\n      const value = ev.currentTarget.parentElement.dataset.tag;\r\n      this.object.popManualTag(value);\r\n    });\r\n    html.find(\"a.melee-toggle\").click(() => {\r\n      this.object.update({ \"system.melee\": !this.object.system.melee });\r\n    });\r\n\r\n    html.find(\"a.missile-toggle\").click(() => {\r\n      this.object.update({ \"system.missile\": !this.object.system.missile });\r\n    });\r\n\r\n    super.activateListeners(html);\r\n  }\r\n}\r\n","/**\r\n * @file A collection of helper utils for chat cards\r\n */\r\nimport OseActor from \"./actor/entity\";\r\n\r\n/**\r\n * Apply rolled dice damage to the token or tokens which are currently controlled.\r\n * This allows for damage to be scaled by a multiplier to account for healing, critical hits, or resistance\r\n *\r\n * @param {HTMLElement} html - The chat entry which contains the roll data\r\n * @param {number} multiplier - A damage multiplier to apply to the rolled damage.\r\n */\r\nfunction applyChatCardDamage(html: JQuery, multiplier: 1 | -1) {\r\n  const amount = html.find(\".dice-total\").last().text();\r\n  const dmgTgt = game.settings.get(game.system.id, \"applyDamageOption\");\r\n  if (dmgTgt === CONFIG.OSE.apply_damage_options.originalTarget) {\r\n    const victimId = html.find(\".chat-target\").last().data(\"id\");\r\n    (async () => {\r\n      const actor = ((await fromUuid(victimId || '')) as TokenDocument)?.actor;\r\n      await applyDamageToTarget(actor, amount, multiplier, actor?.name || victimId || 'original target');\r\n    })();\r\n  }\r\n  if (dmgTgt === CONFIG.OSE.apply_damage_options.targeted) {\r\n    game.user?.targets.forEach((t) => applyDamageToTarget(t.actor, amount, multiplier, t.name));\r\n  }\r\n  if (dmgTgt === CONFIG.OSE.apply_damage_options.selected) {\r\n    canvas.tokens?.controlled.forEach((t) => applyDamageToTarget(t.actor, amount, multiplier, t.name));\r\n  }\r\n}\r\n\r\nasync function applyDamageToTarget(actor: Actor | null, amount: string, multiplier: 1 | -1, nameOrId: string) {\r\n  if (!game.user?.isGM || !(actor instanceof OseActor)) {\r\n    ui.notifications?.error(game.i18n.format(\"OSE.error.cantDealDamageTo\", { nameOrId }));\r\n    return;\r\n  }\r\n  await actor.applyDamage(amount, multiplier);\r\n}\r\n\r\nconst canApply: ContextMenuEntry[\"condition\"] = (li) =>\r\n  canApplyDamage(li) && !!li.find(\".dice-roll\").length;;\r\n\r\nfunction canApplyDamage(html: JQuery) {\r\n  if (!html.find('.dice-total').length) return false;\r\n  const applyDamageOption = game.settings.get(game.system.id, \"applyDamageOption\");\r\n  switch (applyDamageOption) {\r\n    case CONFIG.OSE.apply_damage_options.originalTarget:\r\n      return !!html.find(\".chat-target\").last().data(\"id\");\r\n    case CONFIG.OSE.apply_damage_options.targeted:\r\n      return !!game.user?.targets?.size;\r\n    case CONFIG.OSE.apply_damage_options.selected:\r\n      return !!canvas.tokens?.controlled.length;\r\n    default: {\r\n      ui.notifications?.error(game.i18n.format(\"OSE.error.unexpectedSettings\", {\r\n        configName: 'applyDamageOption',\r\n        configValue: applyDamageOption,\r\n      }));\r\n      return false;\r\n    }\r\n  }\r\n}\r\n\r\n/**\r\n * This function is used to hook into the Chat Log context menu to add additional options to each message\r\n * These options make it easy to conveniently apply damage to controlled tokens based on the value of a Roll\r\n *\r\n * @param {object} _ - Unused jQuery collection\r\n * @param {Array} options - The list of context menu options\r\n * @returns {undefined}\r\n */\r\nexport const addChatMessageContextOptions = (\r\n  _: JQuery,\r\n  options: ContextMenuEntry[]\r\n) => {\r\n  options.push(\r\n    {\r\n      name: game.i18n.localize(\"OSE.messages.applyDamage\"),\r\n      icon: '<i class=\"fas fa-user-minus\"></i>',\r\n      condition: canApply,\r\n      callback: (li) => applyChatCardDamage(li, 1),\r\n    },\r\n    {\r\n      name: game.i18n.localize(\"OSE.messages.applyHealing\"),\r\n      icon: '<i class=\"fas fa-user-plus\"></i>',\r\n      condition: canApply,\r\n      callback: (li) => applyChatCardDamage(li, -1),\r\n    }\r\n  );\r\n  return options;\r\n};\r\n\r\n/* -------------------------------------------- */\r\n\r\nexport const addChatMessageButtons = (msg: ChatMessage, html: JQuery) => {\r\n  // Hide blind rolls\r\n  const blindable = html.find(\".blindable\");\r\n  if (\r\n    // @ts-ignore need to add ChatMessage document property updates.\r\n    msg?.blind &&\r\n    !game.user?.isGM &&\r\n    blindable &&\r\n    blindable.data(\"blind\") === true\r\n  ) {\r\n    blindable.replaceWith(\r\n      \"<div class='dice-roll'><div class='dice-result'><div class='dice-formula'>???</div></div></div>\"\r\n    );\r\n  }\r\n  // Buttons\r\n  const roll = html.find(\".damage-roll\");\r\n  if (roll.length > 0 && canApplyDamage(html)) {\r\n    roll.append(\r\n      $(\r\n        `<div class=\"dice-damage\"><button type=\"button\" data-action=\"apply-damage\"><i class=\"fas fa-tint\"></i></button></div>`\r\n      )\r\n    );\r\n    roll.find('button[data-action=\"apply-damage\"]').on(\"click\", (ev) => {\r\n      ev.preventDefault();\r\n      applyChatCardDamage(html, 1);\r\n    });\r\n  }\r\n};\r\n\r\nexport const functionsForTesting = {\r\n  applyChatCardDamage,\r\n};\r\n","/**\r\n * @file System-level odifications to the way combat works\r\n */\r\nimport OSE from \"./config\";\r\n\r\nconst OseCombat = {\r\n  STATUS_SLOW: -789,\r\n  STATUS_DIZZY: -790,\r\n\r\n  debounce(callback, wait) {\r\n    let timeoutId = null;\r\n    return (...args) => {\r\n      window.clearTimeout(timeoutId);\r\n      timeoutId = window.setTimeout(() => {\r\n        callback.apply(null, args);\r\n      }, wait);\r\n    };\r\n  },\r\n  async rollInitiative(combat, data) {\r\n    // Check groups\r\n    data.combatants = [];\r\n    const groups = {};\r\n    const combatants = combat?.combatants;\r\n    combatants.forEach((cbt) => {\r\n      const group = cbt.getFlag(game.system.id, \"group\");\r\n      groups[group] = { present: true };\r\n      data.combatants.push(cbt);\r\n    });\r\n    // Roll init\r\n    for (const group in groups) {\r\n      // Object.keys(groups).forEach((group) => {\r\n      const roll = new Roll(\"1d6\").evaluate({ async: false });\r\n      await roll.toMessage({\r\n        flavor: game.i18n.format(\"OSE.roll.initiative\", {\r\n          group: CONFIG.OSE.colors[group],\r\n        }),\r\n      });\r\n      groups[group].initiative = roll.total;\r\n      // });\r\n    }\r\n    // Set init\r\n    for (let i = 0; i < data.combatants.length; ++i) {\r\n      if (game.user.isGM) {\r\n        if (!data.combatants[i].actor) {\r\n          return;\r\n        }\r\n        const actorData = data.combatants[i].actor?.system;\r\n        if (actorData.isSlow) {\r\n          await data.combatants[i].update({\r\n            initiative: OseCombat.STATUS_SLOW,\r\n          });\r\n        } else {\r\n          const group = data.combatants[i].getFlag(game.system.id, \"group\");\r\n          this.debounce(\r\n            data.combatants[i].update({ initiative: groups[group].initiative }),\r\n            500\r\n          );\r\n        }\r\n      }\r\n    }\r\n\r\n    await combat.setupTurns();\r\n  },\r\n\r\n  async resetInitiative(combat, data) {\r\n    const reroll = game.settings.get(game.system.id, \"rerollInitiative\");\r\n    if (![\"reset\", \"reroll\"].includes(reroll)) {\r\n      return;\r\n    }\r\n    combat.resetAll();\r\n  },\r\n\r\n  async individualInitiative(combat, data) {\r\n    const updates = [];\r\n    const rolls = [];\r\n    const combatants = combat?.combatants;\r\n    for (let i = 0; i < combatants.size; i++) {\r\n      const c = combatants.contents[i];\r\n      // check if actor initiative has already been set for round 1\r\n      if (c?.initiative && combat.round === 0) {\r\n        continue;\r\n      }\r\n      // This comes from foundry.js, had to remove the update turns thing\r\n      // Roll initiative\r\n      const cf = await c._getInitiativeFormula(c);\r\n      const roll = await c.getInitiativeRoll(cf);\r\n      rolls.push(roll);\r\n      const data = { _id: c.id };\r\n      updates.push(data);\r\n    }\r\n    // combine init rolls\r\n    const pool = PoolTerm.fromRolls(rolls);\r\n    const combinedRoll = await Roll.fromTerms([pool]);\r\n    // get evaluated chat message\r\n    const evalRoll = await combinedRoll.toMessage({}, { create: false });\r\n    const rollArr = combinedRoll.terms[0].rolls;\r\n    let msgContent = ``;\r\n    for (const [i, roll] of rollArr.entries()) {\r\n      // get combatant\r\n      const cbt = game.combats.viewed.combatants.find(\r\n        (c) => c.id === updates[i]._id\r\n      );\r\n      // add initiative value to update\r\n      // check if actor is slow\r\n      let value = cbt.actor?.system?.isSlow\r\n        ? OseCombat.STATUS_SLOW\r\n        : roll.total;\r\n      // check if actor is defeated\r\n      if (combat.settings.skipDefeated && cbt.isDefeated) {\r\n        value = OseCombat.STATUS_DIZZY;\r\n      }\r\n      updates[i].initiative = value;\r\n\r\n      // render template\r\n      const template = `${OSE.systemPath()}/templates/chat/roll-individual-initiative.html`;\r\n      const tData = {\r\n        name: cbt.name,\r\n        formula: roll.formula,\r\n        result: roll.result,\r\n        total: roll.total,\r\n      };\r\n      const rendered = await renderTemplate(template, tData);\r\n      msgContent += rendered;\r\n    }\r\n    evalRoll.content = `\r\n    <details>\r\n    <summary>${game.i18n.localize(\"OSE.roll.individualInitGroup\")}</summary>\r\n    ${msgContent}\r\n    </details>`;\r\n    ChatMessage.create(evalRoll);\r\n    // update tracker\r\n    if (game.user.isGM)\r\n      await combat.updateEmbeddedDocuments(\"Combatant\", updates);\r\n    data.turn = 0;\r\n  },\r\n\r\n  format(object, html, user) {\r\n    html.find(\".initiative\").each((_, span) => {\r\n      span.innerHTML =\r\n        span.innerHTML === `${OseCombat.STATUS_SLOW}`\r\n          ? '<i class=\"fas fa-weight-hanging\"></i>'\r\n          : span.innerHTML;\r\n      span.innerHTML =\r\n        span.innerHTML === `${OseCombat.STATUS_DIZZY}`\r\n          ? '<i class=\"fas fa-dizzy\"></i>'\r\n          : span.innerHTML;\r\n    });\r\n\r\n    html.find(\".combatant\").each((_, ct) => {\r\n      // Append spellcast and retreat\r\n      const controls = $(ct).find(\".combatant-controls .combatant-control\");\r\n      const cmbtant = object.viewed.combatants.get(ct.dataset.combatantId);\r\n      const moveInCombat = cmbtant.getFlag(game.system.id, \"moveInCombat\");\r\n      const preparingSpell = cmbtant.getFlag(game.system.id, \"prepareSpell\");\r\n      const moveActive = moveInCombat ? \"active\" : \"\";\r\n      controls\r\n        .eq(1)\r\n        .after(\r\n          `<a class='combatant-control move-combat ${moveActive}' title=\"${game.i18n.localize(\r\n            \"OSE.CombatFlag.RetreatFromMeleeDeclared\"\r\n          )}\"><i class='fas fa-walking'></i></a>`\r\n        );\r\n      const spellActive = preparingSpell ? \"active\" : \"\";\r\n      controls\r\n        .eq(1)\r\n        .after(\r\n          `<a class='combatant-control prepare-spell ${spellActive}' title=\"${game.i18n.localize(\r\n            \"OSE.CombatFlag.SpellDeclared\"\r\n          )}\"><i class='fas fa-magic'></i></a>`\r\n        );\r\n    });\r\n    OseCombat.announceListener(html);\r\n\r\n    const init = game.settings.get(game.system.id, \"initiative\") === \"group\";\r\n    if (!init) {\r\n      return;\r\n    }\r\n\r\n    html.find('.combat-control[data-control=\"rollNPC\"]').remove();\r\n    html.find('.combat-control[data-control=\"rollAll\"]').remove();\r\n    const trash = html.find(\r\n      '.encounters .combat-control[data-control=\"endCombat\"]'\r\n    );\r\n    $(\r\n      '<a class=\"combat-control\" data-control=\"reroll\"><i class=\"fas fa-dice\"></i></a>'\r\n    ).insertBefore(trash);\r\n\r\n    html.find(\".combatant\").each((_, ct) => {\r\n      // Can't roll individual inits\r\n      $(ct).find(\".roll\").remove();\r\n\r\n      // Get group color\r\n      const cmbtant = object.viewed.combatants.get(ct.dataset.combatantId);\r\n      const color = cmbtant.getFlag(game.system.id, \"group\");\r\n\r\n      // Append colored flag\r\n      const controls = $(ct).find(\".combatant-controls\");\r\n      controls.prepend(\r\n        `<a class='combatant-control flag' style='color:${color}' title=\"${CONFIG.OSE.colors[color]}\"><i class='fas fa-flag'></i></a>`\r\n      );\r\n    });\r\n    OseCombat.addListeners(html);\r\n  },\r\n\r\n  updateCombatant(combatant, data) {\r\n    const init = game.settings.get(game.system.id, \"initiative\");\r\n    // Why do you reroll ?\r\n    const actorData = combatant.actor?.system;\r\n    if (actorData.isSlow) {\r\n      data.initiative = -789;\r\n      return;\r\n    }\r\n    if (data.initiative && init === \"group\") {\r\n      const groupInit = data.initiative;\r\n      const cmbtGroup = combatant.getFlag(game.system.id, \"group\");\r\n      // Check if there are any members of the group with init\r\n      game.combats.viewed.combatants.forEach((ct) => {\r\n        const group = ct.getFlag(game.system.id, \"group\");\r\n        if (\r\n          ct.initiative &&\r\n          ct.initiative != \"-789.00\" &&\r\n          ct.id != data.id &&\r\n          group === cmbtGroup &&\r\n          game.user.isGM\r\n        ) {\r\n          // Set init\r\n          combatant.update({ initiative: parseInt(groupInit) });\r\n        }\r\n      });\r\n    }\r\n  },\r\n\r\n  announceListener(html) {\r\n    html.find(\".combatant-control.prepare-spell\").click((ev) => {\r\n      ev.preventDefault();\r\n      // Toggle spell announcement\r\n      const id = $(ev.currentTarget).closest(\".combatant\")[0].dataset\r\n        .combatantId;\r\n      const isActive = ev.currentTarget.classList.contains(\"active\");\r\n      const combatant = game.combat.combatants.get(id);\r\n      combatant.setFlag(game.system.id, \"prepareSpell\", !isActive);\r\n    });\r\n    html.find(\".combatant-control.move-combat\").click((ev) => {\r\n      ev.preventDefault();\r\n      // Toggle spell announcement\r\n      const id = $(ev.currentTarget).closest(\".combatant\")[0].dataset\r\n        .combatantId;\r\n      const isActive = ev.currentTarget.classList.contains(\"active\");\r\n      const combatant = game.combat.combatants.get(id);\r\n      if (game.user.isGM) {\r\n        combatant.setFlag(game.system.id, \"moveInCombat\", !isActive);\r\n      }\r\n    });\r\n  },\r\n\r\n  addListeners(html) {\r\n    // Cycle through colors\r\n    html.find(\".combatant-control.flag\").click((ev) => {\r\n      if (!game.user.isGM) {\r\n        return;\r\n      }\r\n      const currentColor = ev.currentTarget.style.color;\r\n      const colors = Object.keys(CONFIG.OSE.colors);\r\n      let index = colors.indexOf(currentColor);\r\n      if (index + 1 === colors.length) {\r\n        index = 0;\r\n      } else {\r\n        index++;\r\n      }\r\n      const id = $(ev.currentTarget).closest(\".combatant\")[0].dataset\r\n        .combatantId;\r\n      const combatant = game.combat.combatants.get(id);\r\n      if (game.user.isGM) {\r\n        combatant.setFlag(game.system.id, \"group\", colors[index]);\r\n      }\r\n    });\r\n\r\n    html.find('.combat-control[data-control=\"reroll\"]').click((ev) => {\r\n      if (!game.combat) {\r\n        return;\r\n      }\r\n      const data = {};\r\n      OseCombat.rollInitiative(game.combat, data);\r\n      if (game.user.isGM) {\r\n        game.combat.update({ data }).then(() => {\r\n          game.combat.setupTurns();\r\n        });\r\n      }\r\n    });\r\n  },\r\n\r\n  addCombatant(combat, data, options, id) {\r\n    const token = canvas.tokens.get(data.tokenId);\r\n    let color = \"black\";\r\n    const disposition = token?.disposition || token?.data?.disposition;\r\n    switch (disposition) {\r\n      case -1: {\r\n        color = \"red\";\r\n        break;\r\n      }\r\n\r\n      case 0: {\r\n        color = \"yellow\";\r\n        break;\r\n      }\r\n\r\n      case 1: {\r\n        color = \"green\";\r\n        break;\r\n      }\r\n    }\r\n    data.flags = {\r\n      ose: {\r\n        group: color,\r\n      },\r\n    };\r\n    combat.updateSource({ flags: { ose: { group: color } } });\r\n  },\r\n\r\n  activateCombatant(li) {\r\n    const turn = game.combat.turns.findIndex(\r\n      (turn) => turn.id === li.data(\"combatant-id\")\r\n    );\r\n    if (game.user.isGM) {\r\n      game.combat.update({ turn });\r\n    }\r\n  },\r\n\r\n  addContextEntry(html, options) {\r\n    options.unshift({\r\n      name: \"Set Active\",\r\n      icon: '<i class=\"fas fa-star-of-life\"></i>',\r\n      callback: OseCombat.activateCombatant,\r\n    });\r\n  },\r\n\r\n  async preUpdateCombat(combat, data, diff, id) {\r\n    const init = game.settings.get(game.system.id, \"initiative\");\r\n    const reroll = game.settings.get(game.system.id, \"rerollInitiative\");\r\n    if (!data.round) {\r\n      return;\r\n    }\r\n    if (data.round !== 1) {\r\n      if (reroll === \"reset\") {\r\n        OseCombat.resetInitiative(combat, data, diff, id);\r\n        return;\r\n      }\r\n      if (reroll === \"keep\") {\r\n        return;\r\n      }\r\n    }\r\n    if (init === \"group\") {\r\n      OseCombat.rollInitiative(combat, data, diff, id);\r\n    } else if (init === \"individual\") {\r\n      OseCombat.individualInitiative(combat, data, diff, id);\r\n    }\r\n  },\r\n};\r\n\r\nexport default OseCombat;\r\n","/**\r\n * @file Helper functions related to treasure table rolls\r\n */\r\nimport OSE from \"./config\";\r\n\r\n// eslint-disable-next-line import/prefer-default-export\r\nexport const augmentTable = (table, html) => {\r\n  // Treasure Toggle\r\n  const isTreasureTable = Boolean(\r\n    table.object.getFlag(game.system.id, \"treasure\")\r\n  );\r\n\r\n  const treasureTableToggle = $(\r\n    \"<div class='toggle-treasure' title='Toggle Treasure Table'></div>\"\r\n  );\r\n  treasureTableToggle.toggleClass(\"active\", isTreasureTable);\r\n\r\n  const head = html.find(\".sheet-header\");\r\n  head.append(treasureTableToggle);\r\n\r\n  html.find(\".toggle-treasure\").click((ev) => {\r\n    const isTreasure = Boolean(\r\n      table.object.getFlag(game.system.id, \"treasure\")\r\n    );\r\n    table.object.setFlag(game.system.id, \"treasure\", !isTreasure);\r\n  });\r\n\r\n  // Treasure table formatting\r\n  if (!isTreasureTable) {\r\n    return;\r\n  }\r\n\r\n  // Hide irrelevant standard fields\r\n  html.find(\".result-range\").hide(); // We only hide this column because the underlying model requires two fields for the range and throw an error if they are missing\r\n  html.find(\".normalize-results\").remove();\r\n\r\n  const chanceHeader = html.find(\".table-header .result-weight\");\r\n  chanceHeader.text(\"Chance (%)\");\r\n\r\n  const chanceColumn = html.find(\".result-weight\");\r\n  chanceColumn.css(\"flex\", \"0 0 75px\");\r\n\r\n  const formula = html.find(\"input[name=formula]\");\r\n  formula.attr(\"value\", \"1d100\");\r\n  formula.attr(\"disabled\", true);\r\n\r\n  // Replace Roll button\r\n  const roll = `<button class=\"roll-treasure\" type=\"button\"><i class=\"fas fa-gem\"></i> ${game.i18n.localize(\r\n    \"OSE.table.treasure.roll\"\r\n  )}</button>`;\r\n  html.find(\".sheet-footer .roll\").replaceWith(roll);\r\n\r\n  html.find(\".roll-treasure\").click((ev) => {\r\n    rollTreasure(table.object, { event: ev });\r\n  });\r\n};\r\n\r\n/**\r\n *\r\n * @param table\r\n * @param data\r\n */\r\nasync function drawTreasure(table, data) {\r\n  const percent = (chance) => {\r\n    const roll = new Roll(\"1d100\");\r\n    roll.evaluate({ async: false });\r\n    return roll.total <= chance;\r\n  };\r\n  data.treasure = {};\r\n  if (table.getFlag(game.system.id, \"treasure\")) {\r\n    table.results.forEach(async (r) => {\r\n      if (percent(r.weight)) {\r\n        const text = r.getChatText(r);\r\n        data.treasure[r.id] = {\r\n          img: r.img,\r\n          text: TextEditor.enrichHTML(text, { async: false }),\r\n        };\r\n        if (\r\n          r.type === CONST.TABLE_RESULT_TYPES.DOCUMENT &&\r\n          r.collection === \"RollTable\"\r\n        ) {\r\n          const embeddedTable = game.tables.get(r.resultId);\r\n          await drawTreasure(embeddedTable, data.treasure[r.id]);\r\n        }\r\n      }\r\n    });\r\n  } else {\r\n    const { results } = await table.roll();\r\n    results.forEach((s) => {\r\n      data.treasure[s.id] = { img: s.img, text: s.text };\r\n    });\r\n  }\r\n  return data;\r\n}\r\n\r\n/**\r\n *\r\n * @param table\r\n * @param options\r\n */\r\nexport async function rollTreasure(table, options = {}) {\r\n  // Draw treasure\r\n  const data = await drawTreasure(table, {});\r\n  const templateData = {\r\n    treasure: data.treasure,\r\n    table,\r\n  };\r\n\r\n  // Animation\r\n  if (options.event) {\r\n    const results = $(options.event.currentTarget.parentElement)\r\n      .prev()\r\n      .find(\".table-result\");\r\n    results.each((_, item) => {\r\n      item.classList.remove(\"active\");\r\n      if (data.treasure[item.dataset.resultId]) {\r\n        item.classList.add(\"active\");\r\n      }\r\n    });\r\n  }\r\n\r\n  const html = await renderTemplate(\r\n    `${OSE.systemPath()}/templates/chat/roll-treasure.html`,\r\n    templateData\r\n  );\r\n\r\n  const chatData = {\r\n    content: html,\r\n    // sound: \"systems/ose/assets/coins.mp3\"\r\n  };\r\n\r\n  const rollMode = game.settings.get(\"core\", \"rollMode\");\r\n  if ([\"gmroll\", \"blindroll\"].includes(rollMode))\r\n    chatData.whisper = ChatMessage.getWhisperRecipients(\"GM\");\r\n  if (rollMode === \"selfroll\") chatData.whisper = [game.user._id];\r\n  if (rollMode === \"blindroll\") chatData.blind = true;\r\n\r\n  ChatMessage.create(chatData);\r\n}\r\n\r\nexport const functionsForTesting = {\r\n  drawTreasure,\r\n  rollTreasure,\r\n};\r\n","/**\r\n * @file Functions that make working with hotbar macros easier\r\n */\r\nimport {rollTreasure} from \"./helpers-treasure\";\r\n/* -------------------------------------------- */\r\n/*  Hotbar Macros                               */\r\n/* -------------------------------------------- */\r\n\r\n/**\r\n * Create a Macro from an Item drop.\r\n * Get an existing item macro if one exists, otherwise create a new one.\r\n *\r\n * @param {object} data - The dropped data\r\n * @param {number} slot - The hotbar slot to use\r\n * @returns {Promise} - Promise of assigned macro or a notification\r\n */\r\nexport async function createOseMacro(data, slot) {\r\n  if (data.type === \"Macro\") {\r\n    return game.user.assignHotbarMacro(await fromUuid(data.uuid), slot);\r\n  }\r\n  if (data.type === \"RollTable\") {\r\n    const command = `game.ose.rollTableMacro(\"${data.uuid}\");`;\r\n    const table = await fromUuid(data.uuid);\r\n    const macro = await Macro.create({\r\n      name: table.name,\r\n      type: \"script\",\r\n      img: table.img,\r\n      command,\r\n      flags: { \"ose.tableMacro\": true },\r\n    });\r\n    return game.user.assignHotbarMacro(macro, slot);\r\n  }\r\n  if (data.type !== \"Item\")\r\n    return ui.notifications.warn(\r\n      game.i18n.localize(\"OSE.warn.macrosNotAnItem\")\r\n    );\r\n  if (data.uuid.indexOf(\"Item.\") <= 0)\r\n    return ui.notifications.warn(\r\n      game.i18n.localize(\"OSE.warn.macrosOnlyForOwnedItems\")\r\n    );\r\n  const { item } = data;\r\n\r\n  // Create the macro command\r\n  const command = `game.ose.rollItemMacro(\"${item.name}\");`;\r\n  let macro = game.macros.contents.find(\r\n    (m) => m.name === item.name && m.command === command\r\n  );\r\n  if (!macro || macro.ownership[game.userId] === undefined) {\r\n    macro = await Macro.create({\r\n      name: item.name,\r\n      type: \"script\",\r\n      img: item.img,\r\n      command,\r\n      flags: { \"ose.itemMacro\": true },\r\n    });\r\n  }\r\n  return game.user.assignHotbarMacro(macro, slot);\r\n}\r\n\r\n/* -------------------------------------------- */\r\n\r\n/**\r\n * Create a Macro from an Item drop.\r\n * Get an existing item macro if one exists, otherwise create a new one.\r\n *\r\n * @param {string} itemName - Name of item to roll\r\n * @returns {Promise} - Promise of item roll or notification\r\n */\r\nexport function rollItemMacro(itemName) {\r\n  const speaker = ChatMessage.getSpeaker();\r\n  // Active actor, or inactive actor + token on scene allowed\r\n  if (!(speaker.actor && speaker.scene))\r\n    return ui.notifications.warn(\r\n      game.i18n.localize(\"OSE.warn.macrosNoTokenOwnedInScene\")\r\n    );\r\n\r\n  let actor;\r\n  if (speaker.token) actor = game.actors.tokens[speaker.token];\r\n  if (!actor) actor = game.actors.get(speaker.actor);\r\n\r\n  // Get matching items\r\n  const items = actor ? actor.items.filter((i) => i.name === itemName) : [];\r\n  if (items.length > 1) {\r\n    ui.notifications.warn(\r\n      game.i18n.format(\"OSE.warn.moreThanOneItemWithName\", {\r\n        actorName: actor.name,\r\n        itemName,\r\n      })\r\n    );\r\n  } else if (items.length === 0) {\r\n    return ui.notifications.error(\r\n      game.i18n.format(\"OSE.error.noItemWithName\", {\r\n        actorName: actor.name,\r\n        itemName,\r\n      })\r\n    );\r\n  }\r\n  const item = items[0];\r\n\r\n  // Trigger the item roll\r\n  return item.roll();\r\n}\r\n\r\n/**\r\n * Roll on a RollTable by uuid if it exists.\r\n *\r\n * @param {string} tableUuId - UuId of the RollTable\r\n */\r\nexport function rollTableMacro(tableUuId) {\r\n  fromUuid(tableUuId).then((table) => {\r\n    if (table === null) {\r\n      return ui.notifications.error(\r\n        game.i18n.format(\"OSE.error.noRollTableWithUuId\", {\r\n          uuid: tableUuId,\r\n        })\r\n      );\r\n    }\r\n    //\r\n\r\n    if (table.getFlag(game.system.id, \"treasure\")) {\r\n      return rollTreasure(table);\r\n    }\r\n    return table.draw({ displayChat: true });\r\n  });\r\n}\r\n","/**\r\n * @file Static OseParty methods\r\n */\r\n\r\nconst OseParty = {\r\n  /**\r\n   * Returns all characters currently in the Party\r\n   *\r\n   * @public\r\n   * @returns {OseActor[]} - A list of party members\r\n   */\r\n  get currentParty() {\r\n    return game.actors.filter(\r\n      (act) =>\r\n        act.type === \"character\" &&\r\n        act.flags[game.system.id] &&\r\n        act.flags[game.system.id].party === true\r\n    );\r\n  },\r\n};\r\n\r\nexport default OseParty;\r\n","/**\r\n * @file An application for dispensing XP to party members\r\n */\r\nimport OSE from \"../config\";\r\nimport OseParty from \"./party\";\r\n\r\nexport default class OsePartyXP extends FormApplication {\r\n  static get defaultOptions() {\r\n    return foundry.utils.mergeObject(super.defaultOptions, {\r\n      classes: [\"ose\", \"dialog\", \"party-xp\"],\r\n      template: `${OSE.systemPath()}/templates/apps/party-xp.html`,\r\n      width: 300,\r\n      height: \"auto\",\r\n      resizable: false,\r\n      closeOnSubmit: true,\r\n    });\r\n  }\r\n\r\n  /* -------------------------------------------- */\r\n\r\n  /**\r\n   * Add the Entity name into the window title\r\n   *\r\n   * @type {string}\r\n   */\r\n  // eslint-disable-next-line class-methods-use-this\r\n  get title() {\r\n    return game.i18n.localize(\"OSE.dialog.xp.deal\");\r\n  }\r\n\r\n  /* -------------------------------------------- */\r\n\r\n  /**\r\n   * Construct and return the data object used to render the HTML template for this form application.\r\n   *\r\n   * @returns {object}\r\n   */\r\n  getData() {\r\n    return {\r\n      actors: OseParty.currentParty,\r\n      data: this.object,\r\n      config: CONFIG.OSE,\r\n      user: game.user,\r\n      settings: game.settings,\r\n    };\r\n  }\r\n\r\n  // eslint-disable-next-line no-underscore-dangle, class-methods-use-this\r\n  _onDrop(event) {\r\n    event.preventDefault();\r\n    // WIP Drop Item Quantity\r\n    let data;\r\n    try {\r\n      data = JSON.parse(event.dataTransfer.getData(\"text/plain\"));\r\n      if (data.type !== \"Item\") return;\r\n    } catch (error) {\r\n      return false;\r\n    }\r\n  }\r\n  /* -------------------------------------------- */\r\n\r\n  // eslint-disable-next-line no-underscore-dangle\r\n  _updateObject(event) {\r\n    // eslint-disable-next-line no-underscore-dangle\r\n    this._dealXP(event);\r\n  }\r\n\r\n  // eslint-disable-next-line no-underscore-dangle\r\n  _calculateShare() {\r\n    const { currentParty } = OseParty;\r\n\r\n    const html = $(this.form);\r\n    const totalXP = html.find('input[name=\"total\"]').val();\r\n    const baseXpShare = parseFloat(totalXP) / currentParty.length;\r\n\r\n    currentParty.forEach((a) => {\r\n      const actorData = a?.system;\r\n      const xpShare = Math.floor(\r\n        (actorData.details.xp.share / 100) * baseXpShare\r\n      );\r\n      html.find(`li[data-actor-id='${a.id}'] input`).val(xpShare);\r\n    });\r\n  }\r\n\r\n  // eslint-disable-next-line no-underscore-dangle\r\n  _dealXP() {\r\n    const html = $(this.form);\r\n    const rows = html.find(\".actor\");\r\n    rows.each((_, row) => {\r\n      const qRow = $(row);\r\n      const value = qRow.find(\"input\").val();\r\n      const id = qRow.data(\"actorId\");\r\n      const actor = OseParty.currentParty.find((e) => e.id === id);\r\n      if (value) {\r\n        actor.getExperience(Math.floor(parseInt(value, 10)));\r\n      }\r\n    });\r\n  }\r\n\r\n  activateListeners(html) {\r\n    super.activateListeners(html);\r\n\r\n    const totalField = html.find('input[name=\"total\"]');\r\n    // eslint-disable-next-line no-underscore-dangle\r\n    totalField.on(\"input\", this._calculateShare.bind(this));\r\n\r\n    html.find('button[data-action=\"deal-xp\"').click((event) => {\r\n      super.submit(event);\r\n    });\r\n  }\r\n}\r\n","/**\r\n * @file An application for managing the current party.\r\n */\r\nimport OSE from \"../config\";\r\nimport OseParty from \"./party\";\r\nimport OsePartyXP from \"./party-xp\";\r\n\r\nconst Party = {\r\n  partySheet: void 0,\r\n};\r\n\r\nexport default class OsePartySheet extends FormApplication {\r\n  static get defaultOptions() {\r\n    return foundry.utils.mergeObject(super.defaultOptions, {\r\n      classes: [\"ose\", \"dialog\", \"party-sheet\"],\r\n      template: `${OSE.systemPath()}/templates/apps/party-sheet.html`,\r\n      width: 280,\r\n      height: 400,\r\n      resizable: true,\r\n      dragDrop: [\r\n        { dragSelector: \".actor-list .actor\", dropSelector: \".party-members\" },\r\n      ],\r\n      closeOnSubmit: false,\r\n    });\r\n  }\r\n\r\n  static init() {\r\n    Party.partySheet = new OsePartySheet();\r\n  }\r\n\r\n  static showPartySheet(options = {}) {\r\n    OsePartySheet.partySheet.render(true, { focus: true, ...options });\r\n  }\r\n\r\n  static get partySheet() {\r\n    return Party.partySheet;\r\n  }\r\n\r\n  /* -------------------------------------------- */\r\n\r\n  /**\r\n   * Add the Entity name into the window title\r\n   *\r\n   * @type {string}\r\n   */\r\n  get title() {\r\n    return game.i18n.localize(\"OSE.dialog.partysheet\");\r\n  }\r\n\r\n  /* -------------------------------------------- */\r\n\r\n  /**\r\n   * Construct and return the data object used to render the HTML template for this form application.\r\n   *\r\n   * @returns {object}\r\n   */\r\n  getData() {\r\n    const settings = {\r\n      ascending: game.settings.get(game.system.id, \"ascendingAC\"),\r\n    };\r\n\r\n    return {\r\n      partyActors: OseParty.currentParty,\r\n      // data: this.object,\r\n      config: CONFIG.OSE,\r\n      user: game.user,\r\n      settings,\r\n    };\r\n  }\r\n\r\n  async _addActorToParty(actor) {\r\n    if (actor.type !== \"character\") {\r\n      return;\r\n    }\r\n\r\n    await actor.setFlag(game.system.id, \"party\", true);\r\n  }\r\n\r\n  async _removeActorFromParty(actor) {\r\n    await actor.setFlag(game.system.id, \"party\", false);\r\n  }\r\n\r\n  /* ---------------------- */\r\n  /* --Drag&Drop Behavior-- */\r\n  /* ---------------------- */\r\n\r\n  /* - Adding to the Party Sheet -*/\r\n  _onDrop(event) {\r\n    event.preventDefault();\r\n    // WIP Drop Items\r\n    let data;\r\n    try {\r\n      data = JSON.parse(event.dataTransfer.getData(\"text/plain\"));\r\n\r\n      switch (data.type) {\r\n        case \"Actor\": {\r\n          return this._onDropActor(event, data);\r\n        }\r\n\r\n        case \"Folder\": {\r\n          return this._onDropFolder(event, data);\r\n        }\r\n      }\r\n    } catch (error) {\r\n      return false;\r\n    }\r\n  }\r\n\r\n  async _onDropActor(event, data) {\r\n    if (data.type !== \"Actor\") {\r\n      return;\r\n    }\r\n\r\n    const { actors } = game;\r\n    const droppedActor = await fromUuid(data.uuid);\r\n\r\n    this._addActorToParty(droppedActor);\r\n  }\r\n\r\n  _recursiveAddFolder(folder) {\r\n    folder.contents.forEach((actor) => this._addActorToParty(actor));\r\n    folder.children.forEach((folder) => this._recursiveAddFolder(folder.folder));\r\n  }\r\n\r\n  async _onDropFolder(event, data) {\r\n    if (data.documentName !== \"Actor\") {\r\n      return;\r\n    }\r\n\r\n    const folder = await fromUuid(data.uuid);\r\n    if (!folder) return;\r\n\r\n    this._recursiveAddFolder(folder);\r\n  }\r\n\r\n  /* - Dragging from the Party Sheet - */\r\n  async _onDragStart(event) {\r\n    try {\r\n      const { uuid } = event.currentTarget.dataset;\r\n      const dragData = (await fromUuid(uuid)).toDragData();\r\n      // Set data transfer\r\n      event.dataTransfer.setData(\"text/plain\", JSON.stringify(dragData));\r\n    } catch (error) {\r\n      return false;\r\n    }\r\n\r\n    return true;\r\n  }\r\n\r\n  /* -------------------------------------------- */\r\n\r\n  async _dealXP(ev) {\r\n    new OsePartyXP(this.object, {}).render(true);\r\n  }\r\n\r\n  /** @override */\r\n  activateListeners(html) {\r\n    super.activateListeners(html);\r\n\r\n    html.find(\".header #deal-xp\").click(this._dealXP.bind(this));\r\n\r\n    // Actor buttons\r\n    const getActor = (event) => {\r\n      const id = event.currentTarget.closest(\".actor\").dataset.actorId;\r\n      return game.actors.get(id);\r\n    };\r\n\r\n    html.find(\".field-img button[data-action='open-sheet']\").click((event) => {\r\n      getActor(event).sheet.render(true);\r\n    });\r\n\r\n    html\r\n      .find(\".field-img button[data-action='remove-actor']\")\r\n      .click(async (event) => {\r\n        await this._removeActorFromParty(getActor(event));\r\n      });\r\n  }\r\n}\r\n","/**\r\n * @file Helper functions for managing the Party Sheet\r\n */\r\nimport OsePartySheet from \"./party/party-sheet\";\r\n\r\nexport const addControl = (object, html) => {\r\n  const control = `<button class='ose-party-sheet' type=\"button\" title='${game.i18n.localize(\r\n    \"OSE.dialog.partysheet\"\r\n  )}'><i class='fas fa-users'></i></button>`;\r\n  html.find(\".fas.fa-search\").replaceWith($(control));\r\n  html.find(\".ose-party-sheet\").click((ev) => {\r\n    ev.preventDefault();\r\n    Hooks.call(\"OSE.Party.showSheet\");\r\n  });\r\n};\r\n\r\nexport const update = (actor) => {\r\n  const partyFlag = actor.getFlag(game.system.id, \"party\");\r\n\r\n  if (partyFlag === null) {\r\n    return;\r\n  }\r\n\r\n  OsePartySheet.partySheet.render();\r\n};\r\n","/**\r\n * @file Utilities for our Quench tests\r\n */\r\n\r\nconst inputDelay = 120;\r\n\r\nexport const delay = (ms: number) =>\r\n  new Promise((resolve) => {\r\n    setTimeout(resolve, ms);\r\n  });\r\n\r\n/**\r\n * If there are messages, purge them.\r\n */\r\nexport const trashChat = (): any => {\r\n  if (game.messages?.size)\r\n    game.messages?.documentClass.deleteDocuments([], { deleteAll: true });\r\n};\r\n\r\n/**\r\n * Delays execution so the UI can catch up.\r\n *\r\n * @returns {Promise} The delay.\r\n */\r\nexport const waitForInput = () => delay(inputDelay);\r\n\r\nexport const openWindows = (className: string) =>\r\n  Object.values(ui.windows).filter((o) =>\r\n    o.options.classes.includes(className)\r\n  );\r\n\r\nexport const openDialogs = () =>\r\n  Object.values(ui.windows).filter((o) => o.options.classes.includes(\"dialog\"));\r\n\r\nexport const closeDialogs = async () => {\r\n  openDialogs()?.forEach(async (o) => {\r\n    await o.close();\r\n  });\r\n};\r\n\r\nexport const closeSheets = async () => {\r\n  openWindows(\"sheet\").forEach(async (w) => w.close());\r\n  waitForInput();\r\n};\r\n\r\n/**\r\n * MOCKING HELPERS\r\n */\r\n\r\nexport const createMockActorKey = async (\r\n  type: string,\r\n  data: object = {},\r\n  key: string = \"\"\r\n) =>\r\n  Actor.create({\r\n    ...data,\r\n    name: `Test Actor ${key}`,\r\n    type,\r\n  });\r\n\r\nexport const createWorldTestItem = async (\r\n  type: string,\r\n  name: string = `New World Test ${type.capitalize()}`\r\n) =>\r\n  Item.create({\r\n    type,\r\n    name,\r\n  });\r\n\r\nexport const createActorTestItem = async (\r\n  actor: StoredDocument<Actor> | undefined,\r\n  type: string,\r\n  name: string = `New Actor Test ${type.capitalize()}`,\r\n  data: object = {}\r\n) => actor?.createEmbeddedDocuments(\"Item\", [{ type, name, ...data }]);\r\n\r\nexport const createMockMacro = async () =>\r\n  Macro.create({\r\n    name: `Mock Macro ${foundry.utils.randomID()}`,\r\n    type: \"script\",\r\n    command: \"console.log('Testing Macro');\",\r\n  });\r\n\r\nexport const createMockScene = async () =>\r\n  Scene.create({ name: \"Mock Scene\", tokenVision: true });\r\n\r\nexport const getMockActorKey = async (key: string) =>\r\n  game.actors?.getName(`Test Actor ${key}`);\r\n\r\n/**\r\n * CLEANUP HELPERS\r\n */\r\n\r\nexport const cleanUpMacros = async () => {\r\n  const mockMacros = game.macros?.filter((o) => o.name?.includes(\"Mock Macro\"));\r\n  mockMacros?.forEach(async (o) => await o.delete());\r\n  return true;\r\n};\r\n\r\nexport const cleanUpActorsByKey = async (key: string) => {\r\n  game.actors\r\n    ?.filter((a) => a.name === `Test Actor ${key}`)\r\n    .forEach(async (a) => await a.delete());\r\n};\r\n\r\nexport const cleanUpWorldItems = async () => {\r\n  game.items\r\n    ?.filter((a) => a?.name?.includes(\"New World Test\"))\r\n    .forEach(async (a) => await a.delete());\r\n};\r\n\r\nexport const cleanUpScenes = async () => {\r\n  game.scenes\r\n    ?.filter((s) => s.name === \"Mock Scene\")\r\n    .forEach(async (s) => await s.delete());\r\n};\r\n\r\n/**\r\n * CONSTS\r\n */\r\nexport const itemTypes = new Set([\r\n  \"spell\",\r\n  \"ability\",\r\n  \"armor\",\r\n  \"weapon\",\r\n  \"item\",\r\n  \"container\",\r\n]);\r\n","/**\r\n * @file Quench unit tests for the Character data model class.\r\n */\r\n// eslint-disable-next-line import/no-cycle\r\nimport { QuenchMethods } from \"../../../e2e\";\r\nimport {\r\n  cleanUpActorsByKey,\r\n  createMockActorKey,\r\n  getMockActorKey,\r\n} from \"../../../e2e/testUtils\";\r\nimport OseDataModelCharacter from \"../data-model-character\";\r\n\r\nexport const key = \"ose.actor.datamodel.character\";\r\nexport const options = { displayName: \"OSE: Actor: Data Model: Character\" };\r\n\r\nconst createMockActor = () => createMockActorKey(\"character\", {}, key);\r\n\r\nexport default ({ describe, it, expect, after, before }: QuenchMethods) => {\r\n  const dataModel = new OseDataModelCharacter();\r\n  const ascendingACSetting = game.settings.get(game.system.id, \"ascendingAC\");\r\n  const initiativeSetting = game.settings.get(game.system.id, \"initiative\");\r\n\r\n  after(() => {\r\n    game.settings.set(game.system.id, \"ascendingAC\", ascendingACSetting);\r\n    game.settings.set(game.system.id, \"initiative\", initiativeSetting);\r\n    cleanUpActorsByKey(key);\r\n  });\r\n\r\n  // @todo: Can this be tested without creating an actor?\r\n  describe(\"prepareDerivedData()\", () => {\r\n    before(async () => {\r\n      await createMockActor();\r\n    });\r\n\r\n    it(\"has scores\", async () => {\r\n      const actor = await getMockActorKey(key);\r\n      expect(actor?.system.scores).not.undefined;\r\n      expect(actor?.system.scores.str).not.undefined;\r\n      expect(actor?.system.scores.str.od).not.undefined;\r\n      expect(actor?.system.scores.int).not.undefined;\r\n      expect(actor?.system.scores.int.literacy).not.undefined;\r\n      expect(actor?.system.scores.int.spoken).not.undefined;\r\n      expect(actor?.system.scores.wis).not.undefined;\r\n      expect(actor?.system.scores.dex).not.undefined;\r\n      expect(actor?.system.scores.dex.init).not.undefined;\r\n      expect(actor?.system.scores.con).not.undefined;\r\n      expect(actor?.system.scores.cha).not.undefined;\r\n      expect(actor?.system.scores.cha.loyalty).not.undefined;\r\n      expect(actor?.system.scores.cha.retain).not.undefined;\r\n      expect(actor?.system.scores.cha.npc).not.undefined;\r\n    });\r\n\r\n    it(\"has encumbrance\", async () => {\r\n      const actor = await getMockActorKey(key);\r\n      expect(actor?.system.encumbrance).not.undefined;\r\n      expect(actor?.system.encumbrance.variant).not.undefined;\r\n      expect(actor?.system.encumbrance.enabled).not.undefined;\r\n      expect(actor?.system.encumbrance.pct).not.undefined;\r\n      expect(actor?.system.encumbrance.encumbered).not.undefined;\r\n      expect(actor?.system.encumbrance.steps).not.undefined;\r\n      expect(actor?.system.encumbrance.value).not.undefined;\r\n      expect(actor?.system.encumbrance.max).not.undefined;\r\n      expect(actor?.system.encumbrance.atHalfEncumbered).not.undefined;\r\n      expect(actor?.system.encumbrance.atQuarterEncumbered).not.undefined;\r\n      expect(actor?.system.encumbrance.atEighthEncumbered).not.undefined;\r\n    });\r\n\r\n    it(\"has movement\", async () => {\r\n      const actor = await getMockActorKey(key);\r\n      expect(actor?.system.movement).not.undefined;\r\n      expect(actor?.system.movement.base).not.undefined;\r\n      expect(actor?.system.movement.encounter).not.undefined;\r\n      expect(actor?.system.movement.overland).not.undefined;\r\n    });\r\n\r\n    it(\"has ac\", async () => {\r\n      const actor = await getMockActorKey(key);\r\n      expect(actor?.system.ac).not.undefined;\r\n      expect(actor?.system.ac.base).not.undefined;\r\n      expect(actor?.system.ac.naked).not.undefined;\r\n      expect(actor?.system.ac.shield).not.undefined;\r\n      expect(actor?.system.ac.value).not.undefined;\r\n      expect(actor?.system.ac.mod).not.undefined;\r\n    });\r\n\r\n    it(\"has aac\", async () => {\r\n      const actor = await getMockActorKey(key);\r\n      expect(actor?.system.aac).not.undefined;\r\n      expect(actor?.system.aac.base).not.undefined;\r\n      expect(actor?.system.aac.naked).not.undefined;\r\n      expect(actor?.system.aac.shield).not.undefined;\r\n      expect(actor?.system.aac.value).not.undefined;\r\n      expect(actor?.system.aac.mod).not.undefined;\r\n    });\r\n\r\n    describe(\"has spells\", () => {\r\n      const spellLevels = new Set([\"1\", \"2\", \"3\", \"4\", \"5\", \"6\"]);\r\n\r\n      it(\"has spells\", async () => {\r\n        const actor = await getMockActorKey(key);\r\n        expect(actor?.system.spells).not.undefined;\r\n        expect(actor?.system.spells.enabled).not.undefined;\r\n        expect(actor?.system.spells.spellList).not.undefined;\r\n        expect(actor?.system.spells.slots).not.undefined;\r\n      });\r\n\r\n      spellLevels.forEach((lvl) => {\r\n        it(`has spell level ${lvl}`, async () => {\r\n          const actor = await getMockActorKey(key);\r\n          expect(actor?.system.spells.slots[lvl]).not.undefined;\r\n          expect(Object.keys(actor?.system.spells.slots[lvl])).contain(\"used\");\r\n          expect(Object.keys(actor?.system.spells.slots[lvl])).contain(\"max\");\r\n        });\r\n      });\r\n    });\r\n\r\n    after(() => {\r\n      cleanUpActorsByKey(key);\r\n    });\r\n  });\r\n\r\n  describe(\"defineSchema()\", () => {\r\n    before(async () => {\r\n      await createMockActor();\r\n    });\r\n\r\n    const flatFields = [\"config\", \"initiative\", \"thac0\", \"languages\"];\r\n    flatFields.forEach((field) => {\r\n      it(`has ${field}`, async () => {\r\n        const actor = await getMockActorKey(key);\r\n        expect(actor?.system[field]).not.undefined;\r\n      });\r\n    });\r\n\r\n    const recursiveFields = [\r\n      { field: \"hp\", subFields: [\"hd\", \"value\", \"max\"] },\r\n      { field: \"exploration\", subFields: [\"ft\", \"ld\", \"od\", \"sd\"] },\r\n      { field: \"retainer\", subFields: [\"enabled\", \"loyalty\", \"wage\"] },\r\n    ];\r\n    recursiveFields.forEach(({ field, subFields }) => {\r\n      subFields.forEach((subField) => {\r\n        it(`${field} field has ${subField} subfield`, async () => {\r\n          const actor = await getMockActorKey(key);\r\n          expect(actor?.system[field]).not.undefined;\r\n          expect(actor?.system[field][subField]).not.undefined;\r\n        });\r\n      });\r\n    });\r\n\r\n    const doubleRecursiveFields = [\r\n      {\r\n        field: \"saves\",\r\n        subFields: [\r\n          { subField: \"breath\", subSubField: [\"value\"] },\r\n          { subField: \"death\", subSubField: [\"value\"] },\r\n          { subField: \"paralysis\", subSubField: [\"value\"] },\r\n          { subField: \"spell\", subSubField: [\"value\"] },\r\n          { subField: \"wand\", subSubField: [\"value\"] },\r\n        ],\r\n      },\r\n    ];\r\n    doubleRecursiveFields.forEach(({ field, subFields }) => {\r\n      subFields.forEach(({ subField, subSubField }) => {\r\n        it(`${field} field has ${subField} subfield, which has ${subSubField} field`, async () => {\r\n          const actor = await getMockActorKey(key);\r\n          expect(actor?.system[field]).not.undefined;\r\n          expect(actor?.system[field][subField]).not.undefined;\r\n          expect(actor?.system[field][subField][subSubField]).not.undefined;\r\n        });\r\n      });\r\n    });\r\n\r\n    after(() => {\r\n      cleanUpActorsByKey(key);\r\n    });\r\n  });\r\n\r\n  describe(\"usesAscendingAC()\", () => {\r\n    it(\"successfully reads from settings\", () => {\r\n      expect(dataModel.usesAscendingAC).equal(\r\n        game.settings.get(game.system.id, \"ascendingAC\")\r\n      );\r\n    });\r\n  });\r\n\r\n  describe(\"meleeMod()\", () => {\r\n    describe(\"ascendingAC on\", () => {\r\n      before(async () => {\r\n        await game.settings.set(game.system.id, \"ascendingAC\", true);\r\n      });\r\n\r\n      it(\"without scores, return 0 if bba undefined\", () => {\r\n        expect(dataModel.meleeMod).equal(0);\r\n      });\r\n\r\n      it(\"without scores, return thac0.bba when bba defined\", () => {\r\n        dataModel.thac0.bba = 12;\r\n        expect(dataModel.meleeMod).equal(12);\r\n        dataModel.thac0.bba = 0;\r\n        expect(dataModel.thac0.bba).equal(0);\r\n      });\r\n    });\r\n\r\n    describe(\"ascendingAC off\", () => {\r\n      before(async () => {\r\n        await game.settings.set(game.system.id, \"ascendingAC\", false);\r\n      });\r\n\r\n      it(\"without scores, return 0\", async () => {\r\n        expect(dataModel.meleeMod).equal(0);\r\n      });\r\n    });\r\n\r\n    it(\"adds str modifier\", () => {\r\n      dataModel.scores.str = { mod: 10 };\r\n      expect(dataModel.meleeMod).equal(10);\r\n      dataModel.scores.str.mod = 0;\r\n      expect(dataModel.scores.str.mod).equal(0);\r\n    });\r\n\r\n    it(\"adds thac0 melee modifier\", () => {\r\n      dataModel.thac0.mod = { melee: 5 };\r\n      expect(dataModel.meleeMod).equal(5);\r\n      dataModel.thac0.mod.melee = 0;\r\n      expect(dataModel.thac0.mod.melee).equal(0);\r\n    });\r\n  });\r\n\r\n  describe(\"rangedMod()\", () => {\r\n    describe(\"ascendingAC on\", () => {\r\n      before(async () => {\r\n        await game.settings.set(game.system.id, \"ascendingAC\", true);\r\n      });\r\n\r\n      it(\"without scores, return 0 if bba undefined\", () => {\r\n        expect(dataModel.rangedMod).equal(0);\r\n      });\r\n\r\n      it(\"without scores, return thac0.bba when bba defined\", () => {\r\n        dataModel.thac0.bba = 12;\r\n        expect(dataModel.rangedMod).equal(12);\r\n        dataModel.thac0.bba = 0;\r\n        expect(dataModel.thac0.bba).equal(0);\r\n      });\r\n    });\r\n\r\n    describe(\"ascendingAC off\", () => {\r\n      before(async () => {\r\n        await game.settings.set(game.system.id, \"ascendingAC\", false);\r\n      });\r\n\r\n      it(\"without scores, return 0\", async () => {\r\n        expect(dataModel.rangedMod).equal(0);\r\n      });\r\n    });\r\n\r\n    it(\"adds dex modifier\", () => {\r\n      dataModel.scores.dex = { mod: 10 };\r\n      expect(dataModel.rangedMod).equal(10);\r\n      dataModel.scores.dex.mod = 0;\r\n      expect(dataModel.scores.dex.mod).equal(0);\r\n    });\r\n\r\n    it(\"adds thac0 missile modifier\", () => {\r\n      dataModel.thac0.mod = { missile: 5 };\r\n      expect(dataModel.rangedMod).equal(5);\r\n      dataModel.thac0.mod.missile = 0;\r\n      expect(dataModel.thac0.mod.missile).equal(0);\r\n    });\r\n  });\r\n\r\n  describe(\"isNew()\", () => {\r\n    it(\"New when all ability scores are at 0\", async () => {\r\n      const testActor = await createMockActorKey(\r\n        \"character\",\r\n        {\r\n          system: {\r\n            scores: {\r\n              str: { value: 0 },\r\n              int: { value: 0 },\r\n              wis: { value: 0 },\r\n              dex: { value: 0 },\r\n              con: { value: 0 },\r\n              cha: { value: 0 },\r\n            },\r\n          },\r\n        },\r\n        key\r\n      );\r\n      expect(testActor?.system.isNew).to.be.true;\r\n    });\r\n\r\n    it(\"Not new when any ability score is above 0\", async () => {\r\n      const testActor = await createMockActorKey(\r\n        \"character\",\r\n        {\r\n          system: {\r\n            scores: {\r\n              str: { value: 10 },\r\n              int: { value: 0 },\r\n              wis: { value: 0 },\r\n              dex: { value: 0 },\r\n              con: { value: 0 },\r\n              cha: { value: 0 },\r\n            },\r\n          },\r\n        },\r\n        key\r\n      );\r\n      expect(testActor?.system.isNew).to.be.false;\r\n    });\r\n\r\n    it(\"New when all saves are at 0\", async () => {\r\n      const testActor = await createMockActorKey(\r\n        \"monster\",\r\n        {\r\n          system: {\r\n            saves: {\r\n              breath: { value: 0 },\r\n              death: { value: 0 },\r\n              paralysis: { value: 0 },\r\n              spell: { value: 0 },\r\n              wand: { value: 0 },\r\n            },\r\n          },\r\n        },\r\n        key\r\n      );\r\n      expect(testActor?.system.isNew).to.be.true;\r\n    });\r\n\r\n    it(\"Not new when any save is above 0\", async () => {\r\n      const testActor = await createMockActorKey(\r\n        \"monster\",\r\n        {\r\n          system: {\r\n            saves: {\r\n              breath: { value: 10 },\r\n              death: { value: 0 },\r\n              paralysis: { value: 0 },\r\n              spell: { value: 0 },\r\n              wand: { value: 0 },\r\n            },\r\n          },\r\n        },\r\n        key\r\n      );\r\n      expect(testActor?.system.isNew).to.be.false;\r\n    });\r\n  });\r\n\r\n  describe(\"containers()\", () => {\r\n    it(\"returns all containers\", async () => {\r\n      const actor = await createMockActor();\r\n      expect(actor?.items.contents.length).equal(0);\r\n      expect(actor?.system.containers.length).equal(0);\r\n      await actor?.createEmbeddedDocuments(\"Item\", [\r\n        { type: \"container\", name: \"test container\" },\r\n      ]);\r\n      expect(actor?.items.contents.length).equal(1);\r\n      expect(actor?.items.contents[0].name).equal(\"test container\");\r\n      // eslint-disable-next-line no-underscore-dangle\r\n      const itemId = actor?.items.contents[0].id;\r\n      expect(actor?.system.containers.length).equal(1);\r\n      // eslint-disable-next-line no-underscore-dangle\r\n      expect(actor?.system.containers[0]._id).equal(itemId);\r\n      actor?.delete();\r\n    });\r\n\r\n    after(() => {\r\n      cleanUpActorsByKey(key);\r\n    });\r\n  });\r\n\r\n  describe(\"treasures()\", () => {\r\n    it(\"returns treasures on actor\", async () => {\r\n      const actor = await createMockActor();\r\n      expect(actor?.items.contents.length).equal(0);\r\n      expect(actor?.system.treasures.length).equal(0);\r\n      await actor?.createEmbeddedDocuments(\"Item\", [\r\n        { type: \"item\", name: \"test treasure\", system: { treasure: true } },\r\n      ]);\r\n      expect(actor?.items.contents.length).equal(1);\r\n      expect(actor?.items.contents[0].name).equal(\"test treasure\");\r\n      expect(actor?.items.contents[0].system.treasure).is.true;\r\n      // eslint-disable-next-line no-underscore-dangle\r\n      const itemId = actor?.items.contents[0].id;\r\n      expect(actor?.system.treasures.length).equal(1);\r\n      // eslint-disable-next-line no-underscore-dangle\r\n      expect(actor?.system.treasures[0]._id).equal(itemId);\r\n      actor?.delete();\r\n    });\r\n\r\n    it(\"doesn't returns treasures on actor if in container\", async () => {\r\n      const actor = await createMockActor();\r\n      expect(actor?.items.contents.length).equal(0);\r\n      expect(actor?.system.treasures.length).equal(0);\r\n      await actor?.createEmbeddedDocuments(\"Item\", [\r\n        { type: \"container\", name: \"test container\" },\r\n      ]);\r\n      const container = actor?.items.getName(\"test container\");\r\n      await actor?.createEmbeddedDocuments(\"Item\", [\r\n        // eslint-disable-next-line no-underscore-dangle\r\n        {\r\n          type: \"item\",\r\n          name: \"test treasure\",\r\n          system: { treasure: true, containerId: container?.id },\r\n        },\r\n      ]);\r\n      expect(actor?.items.contents.length).equal(2);\r\n      expect(actor?.items.contents[0].name).equal(\"test container\");\r\n      expect(actor?.items.contents[1].name).equal(\"test treasure\");\r\n      expect(actor?.items.contents[1].system.treasure).is.true;\r\n      expect(actor?.items.contents[1].system.containerId).equal(container?.id);\r\n      expect(actor?.system.treasures.length).equal(0);\r\n      actor?.delete();\r\n    });\r\n\r\n    after(() => {\r\n      cleanUpActorsByKey(key);\r\n    });\r\n  });\r\n\r\n  describe(\"carriedTreasure()\", () => {\r\n    it(\"return treasure value on actor\", async () => {\r\n      const actor = await createMockActor();\r\n      expect(actor?.items.contents.length).equal(0);\r\n      expect(actor?.system.carriedTreasure).equal(0);\r\n      await actor?.createEmbeddedDocuments(\"Item\", [\r\n        {\r\n          type: \"item\",\r\n          name: \"test treasure\",\r\n          system: { treasure: true, quantity: { value: 1 }, cost: 10 },\r\n        },\r\n      ]);\r\n      expect(actor?.items.contents.length).equal(1);\r\n      expect(actor?.items.contents[0].name).equal(\"test treasure\");\r\n      expect(actor?.items.contents[0].system.treasure).is.true;\r\n      expect(actor?.system.carriedTreasure).equal(10);\r\n      actor?.delete();\r\n    });\r\n\r\n    it(\"return multiple treasure value on actor\", async () => {\r\n      const actor = await createMockActor();\r\n      expect(actor?.items.contents.length).equal(0);\r\n      expect(actor?.system.carriedTreasure).equal(0);\r\n      await actor?.createEmbeddedDocuments(\"Item\", [\r\n        {\r\n          type: \"item\",\r\n          name: \"test treasure\",\r\n          system: { treasure: true, quantity: { value: 1 }, cost: 10 },\r\n        },\r\n        {\r\n          type: \"item\",\r\n          name: \"test treasure 2\",\r\n          system: { treasure: true, quantity: { value: 3 }, cost: 4 },\r\n        },\r\n      ]);\r\n      expect(actor?.items.contents.length).equal(2);\r\n      expect(actor?.items.contents[0].name).equal(\"test treasure\");\r\n      expect(actor?.items.contents[0].system.treasure).is.true;\r\n      expect(actor?.items.contents[1].name).equal(\"test treasure 2\");\r\n      expect(actor?.items.contents[1].system.treasure).is.true;\r\n      expect(actor?.system.carriedTreasure).equal(10 + 3 * 4);\r\n      actor?.delete();\r\n    });\r\n\r\n    it(\"doesn't returns treasure value on actor if in container\", async () => {\r\n      const actor = await createMockActor();\r\n      expect(actor?.items.contents.length).equal(0);\r\n      expect(actor?.system.carriedTreasure).equal(0);\r\n      await actor?.createEmbeddedDocuments(\"Item\", [\r\n        { type: \"container\", name: \"test container\" },\r\n      ]);\r\n      const container = actor?.items.getName(\"test container\");\r\n      await actor?.createEmbeddedDocuments(\"Item\", [\r\n        // eslint-disable-next-line no-underscore-dangle\r\n        {\r\n          type: \"item\",\r\n          name: \"test treasure\",\r\n          system: {\r\n            treasure: true,\r\n            containerId: container?.id,\r\n            quantity: { value: 1 },\r\n            cost: 10,\r\n          },\r\n        },\r\n      ]);\r\n      expect(actor?.items.contents.length).equal(2);\r\n      expect(actor?.items.contents[0].name).equal(\"test container\");\r\n      expect(actor?.items.contents[1].name).equal(\"test treasure\");\r\n      expect(actor?.items.contents[1].system.treasure).is.true;\r\n      // eslint-disable-next-line no-underscore-dangle\r\n      expect(actor?.items.contents[1].system.containerId).equal(container?.id);\r\n      expect(actor?.system.carriedTreasure).equal(0);\r\n      actor?.delete();\r\n    });\r\n\r\n    after(() => {\r\n      cleanUpActorsByKey(key);\r\n    });\r\n  });\r\n\r\n  describe(\"items()\", () => {\r\n    it(\"only returns other items than treasure\", async () => {\r\n      const actor = await createMockActor();\r\n      expect(actor?.items.contents.length).equal(0);\r\n      expect(actor?.system.items.length).equal(0);\r\n      await actor?.createEmbeddedDocuments(\"Item\", [\r\n        {\r\n          type: \"item\",\r\n          name: \"test item\",\r\n        },\r\n        {\r\n          type: \"item\",\r\n          name: \"test treasure\",\r\n          system: { treasure: true, quantity: { value: 3 }, cost: 4 },\r\n        },\r\n      ]);\r\n      expect(actor?.items.contents.length).equal(2);\r\n      expect(actor?.items.contents[0].name).equal(\"test item\");\r\n      expect(actor?.items.contents[1].name).equal(\"test treasure\");\r\n      expect(actor?.items.contents[1].system.treasure).is.true;\r\n      expect(actor?.system.items.length).equal(1);\r\n      expect(actor?.system.items[0].name).equal(\"test item\");\r\n      actor?.delete();\r\n    });\r\n\r\n    it(\"only returns other items than stored in containers\", async () => {\r\n      const actor = await createMockActor();\r\n      expect(actor?.items.contents.length).equal(0);\r\n      expect(actor?.system.items.length).equal(0);\r\n      await actor?.createEmbeddedDocuments(\"Item\", [\r\n        {\r\n          type: \"container\",\r\n          name: \"test container\",\r\n        },\r\n      ]);\r\n      const container = actor?.items.getName(\"test container\");\r\n      await actor?.createEmbeddedDocuments(\"Item\", [\r\n        // eslint-disable-next-line no-underscore-dangle\r\n        {\r\n          type: \"item\",\r\n          name: \"test item in container\",\r\n          system: { containerId: container?.id },\r\n        },\r\n        {\r\n          type: \"item\",\r\n          name: \"test item\",\r\n        },\r\n      ]);\r\n      expect(actor?.items.contents.length).equal(3);\r\n      expect(actor?.items.contents[0].name).equal(\"test container\");\r\n      expect(actor?.items.contents[1].name).equal(\"test item in container\");\r\n      expect(actor?.items.contents[2].name).equal(\"test item\");\r\n      expect(actor?.system.items.length).equal(1);\r\n      expect(actor?.system.items[0].name).equal(\"test item\");\r\n      actor?.delete();\r\n    });\r\n  });\r\n\r\n  const testTypes = [\r\n    { type: \"weapon\", getter: \"weapons\" },\r\n    { type: \"ability\", getter: \"abilities\" },\r\n    { type: \"armor\", getter: \"armor\" },\r\n    { type: \"spell\", getter: \"#spellList\" },\r\n  ];\r\n  testTypes.forEach(({ type, getter }) => {\r\n    describe(`${getter}()`, () => {\r\n      it(`returns all ${getter}`, async () => {\r\n        const actor = await createMockActor();\r\n        expect(actor?.items.contents.length).equal(0);\r\n        expect(actor?.system[getter].length).equal(0);\r\n        await actor?.createEmbeddedDocuments(\"Item\", [\r\n          { type, name: `test ${type}` },\r\n        ]);\r\n        expect(actor?.items.contents.length).equal(1);\r\n        expect(actor?.items.contents[0].name).equal(`test ${type}`);\r\n        // eslint-disable-next-line no-underscore-dangle\r\n        const itemId = actor?.items.contents[0].id;\r\n        expect(actor?.system[getter].length).equal(1);\r\n        // eslint-disable-next-line no-underscore-dangle\r\n        expect(actor?.system[getter][0]._id).equal(itemId);\r\n        actor?.delete();\r\n      });\r\n\r\n      it(`returns all ${getter} except ones in container`, async () => {\r\n        if (getter === \"abilities\") return;\r\n\r\n        const actor = await createMockActor();\r\n        expect(actor?.items.contents.length).equal(0);\r\n        expect(actor?.system[getter].length).equal(0);\r\n        await actor?.createEmbeddedDocuments(\"Item\", [\r\n          {\r\n            type: \"container\",\r\n            name: \"test container\",\r\n          },\r\n        ]);\r\n        const container = actor?.items.getName(\"test container\");\r\n        await actor?.createEmbeddedDocuments(\"Item\", [\r\n          // eslint-disable-next-line no-underscore-dangle\r\n          {\r\n            type,\r\n            name: `test ${type} in container`,\r\n            system: { containerId: container?.id },\r\n          },\r\n          {\r\n            type,\r\n            name: `test ${type}`,\r\n          },\r\n        ]);\r\n        expect(actor?.items.contents.length).equal(3);\r\n        expect(actor?.items.contents[0].name).equal(\"test container\");\r\n        expect(actor?.items.contents[1].name).equal(\r\n          `test ${type} in container`\r\n        );\r\n        expect(actor?.items.contents[2].name).equal(`test ${type}`);\r\n        // eslint-disable-next-line no-underscore-dangle\r\n        const itemId = actor?.items.contents[2].id;\r\n        expect(actor?.system[getter].length).equal(1);\r\n        // eslint-disable-next-line no-underscore-dangle\r\n        expect(actor?.system[getter][0]._id).equal(itemId);\r\n        actor?.delete();\r\n      });\r\n\r\n      after(() => {\r\n        cleanUpActorsByKey(key);\r\n      });\r\n    });\r\n  });\r\n\r\n  describe(\"isSlow()\", () => {\r\n    it(\"returns false if no weapons\", async () => {\r\n      const actor = await createMockActor();\r\n      expect(actor?.system.isSlow).is.false;\r\n      actor?.delete();\r\n    });\r\n\r\n    it(\"returns false if weapon that has slow tag and not equipped\", async () => {\r\n      const actor = await createMockActor();\r\n      expect(actor?.items.contents.length).equal(0);\r\n      await actor?.createEmbeddedDocuments(\"Item\", [\r\n        {\r\n          type: \"weapon\",\r\n          name: \"test weapon\",\r\n          system: { slow: true, equipped: false },\r\n        },\r\n      ]);\r\n      expect(actor?.items.contents.length).equal(1);\r\n      expect(actor?.items.contents[0].name).equal(\"test weapon\");\r\n      expect(actor?.system.isSlow).is.false;\r\n      actor?.delete();\r\n    });\r\n\r\n    it(\"returns false if weapon that doesn't have slow tag and not equipped\", async () => {\r\n      const actor = await createMockActor();\r\n      expect(actor?.items.contents.length).equal(0);\r\n      await actor?.createEmbeddedDocuments(\"Item\", [\r\n        {\r\n          type: \"weapon\",\r\n          name: \"test weapon\",\r\n          system: { slow: false, equipped: true },\r\n        },\r\n      ]);\r\n      expect(actor?.items.contents.length).equal(1);\r\n      expect(actor?.items.contents[0].name).equal(\"test weapon\");\r\n      expect(actor?.system.isSlow).is.false;\r\n      actor?.delete();\r\n    });\r\n\r\n    it(\"returns true if weapon that has slow tag and is equipped\", async () => {\r\n      const actor = await createMockActor();\r\n      expect(actor?.items.contents.length).equal(0);\r\n      await actor?.createEmbeddedDocuments(\"Item\", [\r\n        {\r\n          type: \"weapon\",\r\n          name: \"test weapon\",\r\n          system: { slow: true, equipped: true },\r\n        },\r\n      ]);\r\n      expect(actor?.items.contents.length).equal(1);\r\n      expect(actor?.items.contents[0].name).equal(\"test weapon\");\r\n      expect(actor?.system.isSlow).is.true;\r\n      actor?.delete();\r\n    });\r\n\r\n    after(() => {\r\n      cleanUpActorsByKey(key);\r\n    });\r\n  });\r\n\r\n  describe(\"init()\", () => {\r\n    describe(\"group inititative\", () => {\r\n      before(async () => {\r\n        await game.settings.set(game.system.id, \"initiative\", \"group\");\r\n      });\r\n\r\n      it(\"returns 0\", () => {\r\n        expect(dataModel.init).equal(0);\r\n      });\r\n\r\n      it(\"returns 0 with initiative value set\", async () => {\r\n        dataModel.initiative.value = 12;\r\n        expect(dataModel.init).equal(0);\r\n        dataModel.initiative.value = 0;\r\n        expect(dataModel.initiative.value).equal(0);\r\n      });\r\n\r\n      it(\"returns 0 with initiative mod set\", async () => {\r\n        dataModel.initiative.mod = 10;\r\n        expect(dataModel.init).equal(0);\r\n        dataModel.initiative.mod = 0;\r\n        expect(dataModel.initiative.mod).equal(0);\r\n      });\r\n\r\n      it(\"returns 0 with dex mod init set\", async () => {\r\n        dataModel.dex = { mod: { init: 5 } };\r\n        expect(dataModel.init).equal(0);\r\n        dataModel.dex.mod.init = 0;\r\n        expect(dataModel.dex.mod.init).equal(0);\r\n      });\r\n    });\r\n\r\n    describe(\"individual inititative\", () => {\r\n      before(async () => {\r\n        await game.settings.set(game.system.id, \"initiative\", \"individual\");\r\n        // @todo: tests fails if scores.dex.init isn't initiated\r\n        // dataModel.scores.dex = { init: 0 };\r\n      });\r\n\r\n      it(\"returns 0 by default\", () => {\r\n        expect(dataModel.initiative.value).equal(0);\r\n        expect(dataModel.initiative.mod).equal(0);\r\n        expect(dataModel.scores.dex.init).equal(0);\r\n        expect(dataModel.init).equal(0);\r\n      });\r\n\r\n      it(\"returns correctly with initiative value set\", async () => {\r\n        dataModel.initiative.value = 12;\r\n        expect(dataModel.init).equal(12);\r\n        dataModel.initiative.value = 0;\r\n        expect(dataModel.initiative.value).equal(0);\r\n      });\r\n\r\n      it(\"returns correctly with initiative mod set\", async () => {\r\n        dataModel.initiative.mod = 10;\r\n        expect(dataModel.init).equal(10);\r\n        dataModel.initiative.mod = 0;\r\n        expect(dataModel.initiative.mod).equal(0);\r\n      });\r\n      it(\"returns correctly with dex mod init set\", async () => {\r\n        dataModel.scores.dex = { init: 5 };\r\n        expect(dataModel.init).equal(5);\r\n        dataModel.scores.dex.init = 0;\r\n        expect(dataModel.scores.dex.init).equal(0);\r\n      });\r\n    });\r\n  });\r\n};\r\n","/**\r\n * @file Tests for the class representing a creature data model's AC\r\n */\r\nimport { QuenchMethods } from \"../../../../e2e\";\r\nimport OseDataModelCharacterAC from \"../data-model-character-ac\";\r\n\r\nexport const key = \"ose.actor.datamodel.character.ac\";\r\nexport const options = { displayName: \"OSE: Actor: Data Model: Character AC\" };\r\n\r\nexport default ({ describe, it, expect }: QuenchMethods) => {\r\n  const armorAC = 4;\r\n  const shieldAC = 2;\r\n  // eslint-disable-next-line new-cap\r\n  const armor = new Item.implementation({\r\n    name: \"Armor\",\r\n    type: \"armor\",\r\n    system: {\r\n      ac: { value: armorAC },\r\n      aac: { value: armorAC },\r\n      type: \"light\",\r\n      equipped: true,\r\n    },\r\n  }) as Item;\r\n\r\n  // eslint-disable-next-line new-cap\r\n  const shield = new Item.implementation({\r\n    name: \"Shield\",\r\n    type: \"armor\",\r\n    system: {\r\n      ac: { value: shieldAC },\r\n      aac: { value: shieldAC },\r\n      type: \"shield\",\r\n      equipped: true,\r\n    },\r\n  }) as Item;\r\n\r\n  const itemsArmor = [armor];\r\n  const itemsShield = [shield] as Item[];\r\n  const itemsBoth = [armor, shield] as Item[];\r\n\r\n  const positiveDexMod = 3;\r\n  const negativeDexMod = -1;\r\n\r\n  const positiveArbitraryMod = 2;\r\n  const negativeArbitraryMod = -4;\r\n\r\n  describe(\"Naked AC values\", () => {\r\n    describe(\"Returns the default base AC\", () => {\r\n      it(\"When ascending\", () => {\r\n        const ac = new OseDataModelCharacterAC(true);\r\n        expect(ac.value).to.equal(OseDataModelCharacterAC.baseAscending);\r\n      });\r\n      it(\"When descending\", () => {\r\n        const ac = new OseDataModelCharacterAC();\r\n        expect(ac.value).to.equal(OseDataModelCharacterAC.baseDescending);\r\n      });\r\n    });\r\n  });\r\n\r\n  describe(\"Armored AC values\", () => {\r\n    describe(\"Returns the expected AC, provided equipment\", () => {\r\n      describe(\"With armor\", () => {\r\n        it(\"When ascending\", () => {\r\n          const ac = new OseDataModelCharacterAC(true, itemsArmor);\r\n          // @todo this should be the expectation, needs to happen after data migration\r\n          // expect(ac,value).to.equal(OseDataModelCharacterAC.baseAscending + armorAC)\r\n          expect(ac.value).to.equal(armorAC);\r\n        });\r\n        it(\"When descending\", () => {\r\n          const ac = new OseDataModelCharacterAC(false, itemsArmor);\r\n          // @todo this should be the expectation, needs to happen after data migration\r\n          // expect(ac,value).to.equal(OseDataModelCharacterAC.baseDescending - armorAC)\r\n          expect(ac.value).to.equal(armorAC);\r\n        });\r\n      });\r\n\r\n      describe(\"With shield\", () => {\r\n        it(\"When ascending\", () => {\r\n          const ac = new OseDataModelCharacterAC(true, itemsShield);\r\n          expect(ac.value).to.equal(\r\n            OseDataModelCharacterAC.baseAscending + shieldAC\r\n          );\r\n        });\r\n        it(\"When descending\", () => {\r\n          const ac = new OseDataModelCharacterAC(false, itemsShield);\r\n          expect(ac.value).to.equal(\r\n            OseDataModelCharacterAC.baseDescending - shieldAC\r\n          );\r\n        });\r\n      });\r\n\r\n      describe(\"With armor and shield\", () => {\r\n        it(\"When ascending\", () => {\r\n          const ac = new OseDataModelCharacterAC(true, itemsBoth);\r\n          // @todo this should be the expectation, needs to happen after data migration\r\n          // expect(ac,value).to.equal(OseDataModelCharacterAC.baseAscending + armorAC + shieldAC)\r\n          expect(ac.value).to.equal(armorAC + shieldAC);\r\n        });\r\n        it(\"When descending\", () => {\r\n          const ac = new OseDataModelCharacterAC(false, itemsBoth);\r\n          // @todo this should be the expectation, needs to happen after data migration\r\n          // expect(ac,value).to.equal(OseDataModelCharacterAC.baseDescending - armorAC - shieldAC)\r\n          expect(ac.value).to.equal(armorAC - shieldAC);\r\n        });\r\n      });\r\n    });\r\n  });\r\n\r\n  describe(\"With a dexterity modifier\", () => {\r\n    describe(\"Positive modifier\", () => {\r\n      describe(\"When ascending\", () => {\r\n        const base = OseDataModelCharacterAC.baseAscending;\r\n        it(\"Unarmored, no shield\", () => {\r\n          const ac = new OseDataModelCharacterAC(true, [], positiveDexMod);\r\n          expect(ac.value).to.equal(base + positiveDexMod);\r\n        });\r\n        it(\"Armored, no shield\", () => {\r\n          const ac = new OseDataModelCharacterAC(\r\n            true,\r\n            itemsArmor,\r\n            positiveDexMod\r\n          );\r\n          expect(ac.value).to.equal(armorAC + positiveDexMod);\r\n        });\r\n        it(\"Unarmored, shield\", () => {\r\n          const ac = new OseDataModelCharacterAC(\r\n            true,\r\n            itemsShield,\r\n            positiveDexMod\r\n          );\r\n          expect(ac.value).to.equal(base + shieldAC + positiveDexMod);\r\n        });\r\n        it(\"Armored, shield\", () => {\r\n          const ac = new OseDataModelCharacterAC(\r\n            true,\r\n            itemsBoth,\r\n            positiveDexMod\r\n          );\r\n          expect(ac.value).to.equal(armorAC + shieldAC + positiveDexMod);\r\n        });\r\n      });\r\n      describe(\"When descending\", () => {\r\n        const base = OseDataModelCharacterAC.baseDescending;\r\n        it(\"Unarmored, no shield\", () => {\r\n          const ac = new OseDataModelCharacterAC(false, [], positiveDexMod);\r\n          expect(ac.value).to.equal(base - positiveDexMod);\r\n        });\r\n        it(\"Armored, no shield\", () => {\r\n          const ac = new OseDataModelCharacterAC(\r\n            false,\r\n            itemsArmor,\r\n            positiveDexMod\r\n          );\r\n          expect(ac.value).to.equal(armorAC - positiveDexMod);\r\n        });\r\n        it(\"Unarmored, shield\", () => {\r\n          const ac = new OseDataModelCharacterAC(\r\n            false,\r\n            itemsShield,\r\n            positiveDexMod\r\n          );\r\n          expect(ac.value).to.equal(base - shieldAC - positiveDexMod);\r\n        });\r\n        it(\"Armored, shield\", () => {\r\n          const ac = new OseDataModelCharacterAC(\r\n            false,\r\n            itemsBoth,\r\n            positiveDexMod\r\n          );\r\n          expect(ac.value).to.equal(armorAC - shieldAC - positiveDexMod);\r\n        });\r\n      });\r\n    });\r\n    describe(\"Negative modifier\", () => {\r\n      describe(\"When ascending\", () => {\r\n        const base = OseDataModelCharacterAC.baseAscending;\r\n        it(\"Unarmored, no shield\", () => {\r\n          const ac = new OseDataModelCharacterAC(true, [], negativeDexMod);\r\n          expect(ac.value).to.equal(base + negativeDexMod);\r\n        });\r\n        it(\"Armored, no shield\", () => {\r\n          const ac = new OseDataModelCharacterAC(\r\n            true,\r\n            itemsArmor,\r\n            negativeDexMod\r\n          );\r\n          expect(ac.value).to.equal(armorAC + negativeDexMod);\r\n        });\r\n        it(\"Unarmored, shield\", () => {\r\n          const ac = new OseDataModelCharacterAC(\r\n            true,\r\n            itemsShield,\r\n            negativeDexMod\r\n          );\r\n          expect(ac.value).to.equal(base + shieldAC + negativeDexMod);\r\n        });\r\n        it(\"Armored, shield\", () => {\r\n          const ac = new OseDataModelCharacterAC(\r\n            true,\r\n            itemsBoth,\r\n            negativeDexMod\r\n          );\r\n          expect(ac.value).to.equal(armorAC + shieldAC + negativeDexMod);\r\n        });\r\n      });\r\n      describe(\"When descending\", () => {\r\n        const base = OseDataModelCharacterAC.baseDescending;\r\n        it(\"Unarmored, no shield\", () => {\r\n          const ac = new OseDataModelCharacterAC(false, [], negativeDexMod);\r\n          expect(ac.value).to.equal(base - negativeDexMod);\r\n        });\r\n        it(\"Armored, no shield\", () => {\r\n          const ac = new OseDataModelCharacterAC(\r\n            false,\r\n            itemsArmor,\r\n            negativeDexMod\r\n          );\r\n          expect(ac.value).to.equal(armorAC - negativeDexMod);\r\n        });\r\n        it(\"Unarmored, shield\", () => {\r\n          const ac = new OseDataModelCharacterAC(\r\n            false,\r\n            itemsShield,\r\n            negativeDexMod\r\n          );\r\n          expect(ac.value).to.equal(base - shieldAC - negativeDexMod);\r\n        });\r\n        it(\"Armored, shield\", () => {\r\n          const ac = new OseDataModelCharacterAC(\r\n            false,\r\n            itemsBoth,\r\n            negativeDexMod\r\n          );\r\n          expect(ac.value).to.equal(armorAC - shieldAC - negativeDexMod);\r\n        });\r\n      });\r\n    });\r\n  });\r\n\r\n  describe(\"With an arbitrary modifier\", () => {\r\n    describe(\"Positive modifier\", () => {\r\n      describe(\"When ascending\", () => {\r\n        const base = OseDataModelCharacterAC.baseAscending;\r\n        it(\"Unarmored, no shield\", () => {\r\n          const ac = new OseDataModelCharacterAC(\r\n            true,\r\n            [],\r\n            0,\r\n            positiveArbitraryMod\r\n          );\r\n          expect(ac.value).to.equal(base + positiveArbitraryMod);\r\n        });\r\n        it(\"Armored, no shield\", () => {\r\n          const ac = new OseDataModelCharacterAC(\r\n            true,\r\n            itemsArmor,\r\n            0,\r\n            positiveArbitraryMod\r\n          );\r\n          expect(ac.value).to.equal(armorAC + positiveArbitraryMod);\r\n        });\r\n        it(\"Unarmored, shield\", () => {\r\n          const ac = new OseDataModelCharacterAC(\r\n            true,\r\n            itemsShield,\r\n            0,\r\n            positiveArbitraryMod\r\n          );\r\n          expect(ac.value).to.equal(base + shieldAC + positiveArbitraryMod);\r\n        });\r\n        it(\"Armored, shield\", () => {\r\n          const ac = new OseDataModelCharacterAC(\r\n            true,\r\n            itemsBoth,\r\n            0,\r\n            positiveArbitraryMod\r\n          );\r\n          expect(ac.value).to.equal(armorAC + shieldAC + positiveArbitraryMod);\r\n        });\r\n      });\r\n      describe(\"When descending\", () => {\r\n        const base = OseDataModelCharacterAC.baseDescending;\r\n        it(\"Unarmored, no shield\", () => {\r\n          const ac = new OseDataModelCharacterAC(\r\n            false,\r\n            [],\r\n            0,\r\n            positiveArbitraryMod\r\n          );\r\n          expect(ac.value).to.equal(base - positiveArbitraryMod);\r\n        });\r\n        it(\"Armored, no shield\", () => {\r\n          const ac = new OseDataModelCharacterAC(\r\n            false,\r\n            itemsArmor,\r\n            0,\r\n            positiveArbitraryMod\r\n          );\r\n          expect(ac.value).to.equal(armorAC - positiveArbitraryMod);\r\n        });\r\n        it(\"Unarmored, shield\", () => {\r\n          const ac = new OseDataModelCharacterAC(\r\n            false,\r\n            itemsShield,\r\n            0,\r\n            positiveArbitraryMod\r\n          );\r\n          expect(ac.value).to.equal(base - shieldAC - positiveArbitraryMod);\r\n        });\r\n        it(\"Armored, shield\", () => {\r\n          const ac = new OseDataModelCharacterAC(\r\n            false,\r\n            itemsBoth,\r\n            0,\r\n            positiveArbitraryMod\r\n          );\r\n          expect(ac.value).to.equal(armorAC - shieldAC - positiveArbitraryMod);\r\n        });\r\n      });\r\n    });\r\n    describe(\"Negative modifier\", () => {\r\n      describe(\"When ascending\", () => {\r\n        const base = OseDataModelCharacterAC.baseAscending;\r\n        it(\"Unarmored, no shield\", () => {\r\n          const ac = new OseDataModelCharacterAC(\r\n            true,\r\n            [],\r\n            0,\r\n            negativeArbitraryMod\r\n          );\r\n          expect(ac.value).to.equal(base + negativeArbitraryMod);\r\n        });\r\n        it(\"Armored, no shield\", () => {\r\n          const ac = new OseDataModelCharacterAC(\r\n            true,\r\n            itemsArmor,\r\n            0,\r\n            negativeArbitraryMod\r\n          );\r\n          expect(ac.value).to.equal(armorAC + negativeArbitraryMod);\r\n        });\r\n        it(\"Unarmored, shield\", () => {\r\n          const ac = new OseDataModelCharacterAC(\r\n            true,\r\n            itemsShield,\r\n            0,\r\n            negativeArbitraryMod\r\n          );\r\n          expect(ac.value).to.equal(base + shieldAC + negativeArbitraryMod);\r\n        });\r\n        it(\"Armored, shield\", () => {\r\n          const ac = new OseDataModelCharacterAC(\r\n            true,\r\n            itemsBoth,\r\n            0,\r\n            negativeArbitraryMod\r\n          );\r\n          expect(ac.value).to.equal(armorAC + shieldAC + negativeArbitraryMod);\r\n        });\r\n      });\r\n      describe(\"When descending\", () => {\r\n        const base = OseDataModelCharacterAC.baseDescending;\r\n        it(\"Unarmored, no shield\", () => {\r\n          const ac = new OseDataModelCharacterAC(\r\n            false,\r\n            [],\r\n            0,\r\n            negativeArbitraryMod\r\n          );\r\n          expect(ac.value).to.equal(base - negativeArbitraryMod);\r\n        });\r\n        it(\"Armored, no shield\", () => {\r\n          const ac = new OseDataModelCharacterAC(\r\n            false,\r\n            itemsArmor,\r\n            0,\r\n            negativeArbitraryMod\r\n          );\r\n          expect(ac.value).to.equal(armorAC - negativeArbitraryMod);\r\n        });\r\n        it(\"Unarmored, shield\", () => {\r\n          const ac = new OseDataModelCharacterAC(\r\n            false,\r\n            itemsShield,\r\n            0,\r\n            negativeArbitraryMod\r\n          );\r\n          expect(ac.value).to.equal(base - shieldAC - negativeArbitraryMod);\r\n        });\r\n        it(\"Armored, shield\", () => {\r\n          const ac = new OseDataModelCharacterAC(\r\n            false,\r\n            itemsBoth,\r\n            0,\r\n            negativeArbitraryMod\r\n          );\r\n          expect(ac.value).to.equal(armorAC - shieldAC - negativeArbitraryMod);\r\n        });\r\n      });\r\n    });\r\n  });\r\n};\r\n","/**\r\n * @file Tests for encumbrance schemes that are part of the Old School Essentials SRD\r\n */\r\nimport { QuenchMethods } from \"../../../../e2e\";\r\nimport OseDataModelCharacterEncumbrance from \"../data-model-character-encumbrance\";\r\nimport EncumbranceBasic from \"../data-model-character-encumbrance-basic\";\r\nimport EncumbranceComplete from \"../data-model-character-encumbrance-complete\";\r\nimport EncumbranceDetailed from \"../data-model-character-encumbrance-detailed\";\r\nimport EncumbranceDisabled from \"../data-model-character-encumbrance-disabled\";\r\nimport EncumbranceItemBased from \"../data-model-character-encumbrance-item-based\";\r\n\r\nexport const key = \"ose.actor.datamodel.character.encumbrance\";\r\nexport const options = {\r\n  displayName: \"OSE: Actor: Data Model: Character Encumbrance\",\r\n};\r\n\r\nconst toPct = (value: number, max: number) =>\r\n  Math.clamped((100 * value) / max, 0, 100);\r\nconst createMockItem = (\r\n  type: string,\r\n  weight: number,\r\n  quantity: number,\r\n  itemOptions = {}\r\n): Item =>\r\n  // eslint-disable-next-line new-cap\r\n  new Item.implementation({\r\n    name: `Mock ${type} ${foundry.utils.randomID()}`,\r\n    type,\r\n    system: { ...itemOptions, weight, quantity: { value: quantity } },\r\n  }) as Item;\r\n\r\nexport default ({ describe, it, expect }: QuenchMethods) => {\r\n  describe(\"Disabled Encumbrance\", () => {\r\n    it(\"Is disabled\", () => {\r\n      let enc = new OseDataModelCharacterEncumbrance();\r\n      expect(enc.enabled).to.be.false;\r\n\r\n      enc = new EncumbranceDisabled();\r\n      expect(enc.enabled).to.be.false;\r\n    });\r\n  });\r\n\r\n  describe(\"Basic Encumbrance\", () => {\r\n    it(\"Is enabled\", () => {\r\n      const enc = new EncumbranceBasic();\r\n      expect(enc.enabled).to.be.true;\r\n    });\r\n\r\n    it(\"Returns the appropriate encumbrance steps\", () => {\r\n      const enc = new EncumbranceBasic();\r\n      const step = game.settings.get(game.system.id, \"significantTreasure\");\r\n      const expectedSteps = [(100 * (step as number)) / enc.max];\r\n      expect(enc.steps).to.have.members(expectedSteps);\r\n    });\r\n\r\n    describe(\"Returns current carried weight\", () => {\r\n      it(\"As Percentage\", () => {\r\n        const max = 1600;\r\n        const pct25 = 400;\r\n        const pct50 = 800;\r\n        const pct75 = 1200;\r\n\r\n        let enc = new EncumbranceBasic(max, [\r\n          createMockItem(\"item\", pct25, 1, { treasure: true }),\r\n        ]);\r\n        expect(enc.pct).to.equal(toPct(pct25, max));\r\n\r\n        enc = new EncumbranceBasic(max, [\r\n          createMockItem(\"item\", pct50, 1, { treasure: true }),\r\n        ]);\r\n        expect(enc.pct).to.equal(toPct(pct50, max));\r\n\r\n        enc = new EncumbranceBasic(max, [\r\n          createMockItem(\"item\", pct75, 1, { treasure: true }),\r\n        ]);\r\n        expect(enc.pct).to.equal(toPct(pct75, max));\r\n\r\n        enc = new EncumbranceBasic(max, [\r\n          createMockItem(\"item\", max, 1, { treasure: true }),\r\n        ]);\r\n        expect(enc.pct).to.equal(100);\r\n\r\n        enc = new EncumbranceBasic(max, [\r\n          createMockItem(\"item\", max, 1, { treasure: false }),\r\n        ]);\r\n        expect(enc.pct).to.equal(0);\r\n      });\r\n      it(\"As Value\", () => {\r\n        const max = 1600;\r\n        const pct25 = 400;\r\n        const pct50 = 800;\r\n        const pct75 = 1200;\r\n\r\n        let enc = new EncumbranceBasic(max, [\r\n          createMockItem(\"item\", pct25, 1, { treasure: true }),\r\n        ]);\r\n        expect(enc.value).to.equal(pct25);\r\n\r\n        enc = new EncumbranceBasic(max, [\r\n          createMockItem(\"item\", pct50, 1, { treasure: true }),\r\n        ]);\r\n        expect(enc.value).to.equal(pct50);\r\n\r\n        enc = new EncumbranceBasic(max, [\r\n          createMockItem(\"item\", pct75, 1, { treasure: true }),\r\n        ]);\r\n        expect(enc.value).to.equal(pct75);\r\n\r\n        enc = new EncumbranceBasic(max, [\r\n          createMockItem(\"item\", max, 1, { treasure: true }),\r\n        ]);\r\n        expect(enc.value).to.equal(max);\r\n\r\n        enc = new EncumbranceBasic(max, [\r\n          createMockItem(\"item\", max, 1, { treasure: false }),\r\n        ]);\r\n        expect(enc.value).to.equal(0);\r\n      });\r\n      describe(\"As fully encumbered flag\", () => {\r\n        it(\"Encumbered over full load (1600.1)\", () => {\r\n          const enc = new EncumbranceBasic(1600, [\r\n            createMockItem(\"item\", 1600.1, 1, { treasure: true }),\r\n          ]);\r\n          expect(enc.encumbered).to.be.true;\r\n        });\r\n        describe(\"Not encumbered\", () => {\r\n          it(\"from non-treasure items\", () => {\r\n            const enc = new EncumbranceBasic(1600, [\r\n              createMockItem(\"weapon\", 1600.1, 1),\r\n              createMockItem(\"armor\", 1600.1, 1),\r\n              createMockItem(\"container\", 1600.1, 1),\r\n              createMockItem(\"item\", 1600.1, 1),\r\n            ]);\r\n            expect(enc.encumbered).to.be.false;\r\n          });\r\n          it(\"from a partial load\", () => {\r\n            const enc = new EncumbranceBasic(1600, [\r\n              createMockItem(\"item\", 400, 1, { treasure: true }),\r\n            ]);\r\n            expect(enc.encumbered).to.be.false;\r\n          });\r\n        });\r\n      });\r\n      it('As \"over significant treasure threshold\" flag', () => {\r\n        let enc = new EncumbranceBasic(1600, [\r\n          createMockItem(\"item\", 400, 1, { treasure: true }),\r\n        ]);\r\n        expect(enc.overSignificantTreasureThreshold).to.be.false;\r\n\r\n        enc = new EncumbranceBasic(1600, [\r\n          createMockItem(\"item\", 800, 1, { treasure: true }),\r\n        ]);\r\n        expect(enc.overSignificantTreasureThreshold).to.be.true;\r\n\r\n        enc = new EncumbranceBasic(1600, [createMockItem(\"weapon\", 800, 1)]);\r\n        expect(enc.overSignificantTreasureThreshold).to.be.false;\r\n      });\r\n    });\r\n\r\n    it(\"Returns max carry weight\", () => {\r\n      const setMax = 2000;\r\n\r\n      let enc = new EncumbranceBasic(setMax);\r\n      expect(enc.max).to.equal(setMax);\r\n\r\n      enc = new EncumbranceBasic();\r\n      expect(enc.max).to.equal(\r\n        OseDataModelCharacterEncumbrance.baseEncumbranceCap\r\n      );\r\n    });\r\n  });\r\n\r\n  describe(\"Detailed Encumbrance\", () => {\r\n    it(\"Is enabled\", () => {\r\n      const enc = new EncumbranceDetailed();\r\n      expect(enc.enabled).to.be.true;\r\n    });\r\n    it(\"Returns the appropriate encumbrance steps\", () => {\r\n      const enc = new EncumbranceDetailed();\r\n      expect(enc.steps).to.have.members(\r\n        Object.values(OseDataModelCharacterEncumbrance.encumbranceSteps)\r\n      );\r\n    });\r\n    describe(\"Returns current carried weight\", () => {\r\n      it(\"As Percentage\", () => {\r\n        const max = 1600;\r\n        const pct25 = 400;\r\n        const pct50 = 800;\r\n        const pct75 = 1200;\r\n\r\n        let enc = new EncumbranceDetailed(max, [\r\n          createMockItem(\"item\", pct25, 1, { treasure: true }),\r\n        ]);\r\n        expect(enc.pct).to.equal(toPct(pct25, max));\r\n\r\n        enc = new EncumbranceDetailed(max, [\r\n          createMockItem(\"item\", pct50, 1, { treasure: true }),\r\n        ]);\r\n        expect(enc.pct).to.equal(toPct(pct50, max));\r\n\r\n        enc = new EncumbranceDetailed(max, [\r\n          createMockItem(\"item\", pct75, 1, { treasure: true }),\r\n        ]);\r\n        expect(enc.pct).to.equal(toPct(pct75, max));\r\n\r\n        enc = new EncumbranceDetailed(max, [\r\n          createMockItem(\"item\", max, 1, { treasure: true }),\r\n        ]);\r\n        expect(enc.pct).to.equal(100);\r\n\r\n        enc = new EncumbranceDetailed(max, [\r\n          createMockItem(\"item\", max, 1, { treasure: false }),\r\n        ]);\r\n        expect(enc.pct).to.equal(toPct(EncumbranceDetailed.gearWeight, max));\r\n      });\r\n      it(\"As Value\", () => {\r\n        const max = 1600;\r\n        const pct25 = 400;\r\n        const pct50 = 800;\r\n        const pct75 = 1200;\r\n\r\n        let enc = new EncumbranceDetailed(max, [\r\n          createMockItem(\"item\", pct25, 1, { treasure: true }),\r\n        ]);\r\n        expect(enc.value).to.equal(pct25);\r\n\r\n        enc = new EncumbranceDetailed(max, [\r\n          createMockItem(\"item\", pct50, 1, { treasure: true }),\r\n        ]);\r\n        expect(enc.value).to.equal(pct50);\r\n\r\n        enc = new EncumbranceDetailed(max, [\r\n          createMockItem(\"item\", pct75, 1, { treasure: true }),\r\n        ]);\r\n        expect(enc.value).to.equal(pct75);\r\n\r\n        enc = new EncumbranceDetailed(max, [\r\n          createMockItem(\"item\", max, 1, { treasure: true }),\r\n        ]);\r\n        expect(enc.value).to.equal(max);\r\n\r\n        enc = new EncumbranceDetailed(max, [\r\n          createMockItem(\"item\", max, 1, { treasure: false }),\r\n        ]);\r\n        expect(enc.value).to.equal(EncumbranceDetailed.gearWeight);\r\n      });\r\n      describe(\"As fully encumbered flag\", () => {\r\n        it(\"Encumbered over full load (1600.1)\", () => {\r\n          const enc = new EncumbranceDetailed(1600, [\r\n            createMockItem(\"item\", 1600.1, 1, { treasure: true }),\r\n          ]);\r\n          expect(enc.encumbered).to.be.true;\r\n        });\r\n        describe(\"Not encumbered\", () => {\r\n          it(\"from non-treasure items\", () => {\r\n            const enc = new EncumbranceDetailed(1600, [\r\n              createMockItem(\"item\", 1600.1, 1),\r\n            ]);\r\n            expect(enc.encumbered).to.be.false;\r\n            expect(enc.value).to.equal(80);\r\n          });\r\n          it(\"from a partial load\", () => {\r\n            const enc = new EncumbranceDetailed(1600, [\r\n              createMockItem(\"item\", 400, 1, { treasure: true }),\r\n            ]);\r\n            expect(enc.encumbered).to.be.false;\r\n          });\r\n        });\r\n      });\r\n    });\r\n\r\n    it(\"Returns max carry weight\", () => {\r\n      const setMax = 2000;\r\n\r\n      let enc = new EncumbranceDetailed(setMax);\r\n      expect(enc.max).to.equal(setMax);\r\n\r\n      enc = new EncumbranceDetailed();\r\n      expect(enc.max).to.equal(\r\n        OseDataModelCharacterEncumbrance.baseEncumbranceCap\r\n      );\r\n    });\r\n  });\r\n\r\n  describe(\"Complete Encumbrance\", () => {\r\n    it(\"Is enabled\", () => {\r\n      const enc = new EncumbranceComplete();\r\n      expect(enc.enabled).to.be.true;\r\n    });\r\n    it(\"Returns the appropriate encumbrance steps\", () => {\r\n      const enc = new EncumbranceComplete();\r\n      // eslint-disable-next-line @typescript-eslint/no-unused-expressions\r\n      expect(enc.steps).to.have.members(\r\n        Object.values(OseDataModelCharacterEncumbrance.encumbranceSteps)\r\n      );\r\n    });\r\n    describe(\"Returns current carried weight\", () => {\r\n      it(\"As Percentage\", () => {\r\n        const max = 1600;\r\n        const pct25 = 400;\r\n        const pct50 = 800;\r\n        const pct75 = 1200;\r\n\r\n        let enc = new EncumbranceComplete(max, [\r\n          createMockItem(\"item\", pct25, 1, { treasure: true }),\r\n        ]);\r\n        expect(enc.pct).to.equal(toPct(pct25, max));\r\n\r\n        enc = new EncumbranceComplete(max, [\r\n          createMockItem(\"item\", pct50, 1, { treasure: true }),\r\n        ]);\r\n        expect(enc.pct).to.equal(toPct(pct50, max));\r\n\r\n        enc = new EncumbranceComplete(max, [\r\n          createMockItem(\"item\", pct75, 1, { treasure: true }),\r\n        ]);\r\n        expect(enc.pct).to.equal(toPct(pct75, max));\r\n\r\n        enc = new EncumbranceComplete(max, [\r\n          createMockItem(\"item\", max, 1, { treasure: true }),\r\n        ]);\r\n        expect(enc.pct).to.equal(100);\r\n\r\n        enc = new EncumbranceComplete(max, [\r\n          createMockItem(\"item\", max, 1, { treasure: false }),\r\n        ]);\r\n        expect(enc.pct).to.equal(100);\r\n      });\r\n      it(\"As Value\", () => {\r\n        const max = 1600;\r\n        const pct25 = 400;\r\n        const pct50 = 800;\r\n        const pct75 = 1200;\r\n\r\n        let enc = new EncumbranceComplete(max, [\r\n          createMockItem(\"item\", pct25, 1, { treasure: true }),\r\n        ]);\r\n        expect(enc.value).to.equal(pct25);\r\n\r\n        enc = new EncumbranceComplete(max, [\r\n          createMockItem(\"item\", pct50, 1, { treasure: true }),\r\n        ]);\r\n        expect(enc.value).to.equal(pct50);\r\n\r\n        enc = new EncumbranceComplete(max, [\r\n          createMockItem(\"item\", pct75, 1, { treasure: true }),\r\n        ]);\r\n        expect(enc.value).to.equal(pct75);\r\n\r\n        enc = new EncumbranceComplete(max, [\r\n          createMockItem(\"item\", max, 1, { treasure: true }),\r\n        ]);\r\n        expect(enc.value).to.equal(max);\r\n\r\n        enc = new EncumbranceComplete(max, [\r\n          createMockItem(\"item\", max, 1, { treasure: false }),\r\n        ]);\r\n        expect(enc.value).to.equal(max);\r\n      });\r\n      describe(\"As fully encumbered flag\", () => {\r\n        it(\"Encumbered over full load (1600.1)\", () => {\r\n          let enc = new EncumbranceComplete(1600, [\r\n            createMockItem(\"item\", 1600.1, 1, { treasure: true }),\r\n          ]);\r\n          expect(enc.encumbered).to.be.true;\r\n          enc = new EncumbranceComplete(1600, [\r\n            createMockItem(\"item\", 1600.1, 1, { treasure: false }),\r\n          ]);\r\n          expect(enc.encumbered).to.be.true;\r\n        });\r\n        describe(\"Not encumbered\", () => {\r\n          it(\"from a partial load\", () => {\r\n            const enc = new EncumbranceComplete(1600, [\r\n              createMockItem(\"item\", 400, 1, { treasure: true }),\r\n            ]);\r\n            expect(enc.encumbered).to.be.false;\r\n          });\r\n          it(\"from a full load\", () => {\r\n            let enc = new EncumbranceComplete(1600, [\r\n              createMockItem(\"item\", 1600, 1, { treasure: true }),\r\n            ]);\r\n            expect(enc.encumbered).to.be.false;\r\n            enc = new EncumbranceComplete(1600, [\r\n              createMockItem(\"item\", 1600, 1, { treasure: false }),\r\n            ]);\r\n            console.info(enc);\r\n            expect(enc.encumbered).to.be.false;\r\n          });\r\n        });\r\n      });\r\n    });\r\n\r\n    it(\"Returns max carry weight\", () => {\r\n      const setMax = 2000;\r\n\r\n      let enc = new EncumbranceComplete(setMax);\r\n      expect(enc.max).to.equal(setMax);\r\n\r\n      enc = new EncumbranceComplete();\r\n\r\n      expect(enc.max).to.equal(\r\n        OseDataModelCharacterEncumbrance.baseEncumbranceCap\r\n      );\r\n    });\r\n  });\r\n\r\n  describe(\"Item-based Encumbrance\", () => {\r\n    it(\"Is enabled\", () => {\r\n      const enc = new EncumbranceItemBased();\r\n      expect(enc.enabled).to.be.true;\r\n    });\r\n    it(\"Returns the appropriate encumbrance steps\", () => {\r\n      const enc = new EncumbranceItemBased();\r\n      // eslint-disable-next-line @typescript-eslint/no-unused-expressions\r\n      expect(enc.steps).to.have.members(\r\n        Object.values(OseDataModelCharacterEncumbrance.encumbranceSteps)\r\n      );\r\n    });\r\n    describe(\"Returns current carried weight\", () => {\r\n      it(\"As Percentage\", () => {\r\n        const max = 1600;\r\n        const pct25 = 400;\r\n        const pct50 = 800;\r\n        const pct75 = 1200;\r\n\r\n        let enc = new EncumbranceItemBased(max, [\r\n          createMockItem(\"item\", pct25, 1, { treasure: true }),\r\n        ]);\r\n        expect(enc.pct).to.equal(toPct(pct25, max));\r\n\r\n        enc = new EncumbranceItemBased(max, [\r\n          createMockItem(\"item\", pct50, 1, { treasure: true }),\r\n        ]);\r\n        expect(enc.pct).to.equal(toPct(pct50, max));\r\n\r\n        enc = new EncumbranceItemBased(max, [\r\n          createMockItem(\"item\", pct75, 1, { treasure: true }),\r\n        ]);\r\n        expect(enc.pct).to.equal(toPct(pct75, max));\r\n\r\n        enc = new EncumbranceItemBased(max, [\r\n          createMockItem(\"item\", max, 1, { treasure: true }),\r\n        ]);\r\n        expect(enc.pct).to.equal(100);\r\n\r\n        enc = new EncumbranceItemBased(max, [\r\n          createMockItem(\"item\", max, 1, { treasure: false }),\r\n        ]);\r\n        expect(enc.pct).to.equal(100);\r\n      });\r\n      it(\"As Value\", () => {\r\n        const max = 1600;\r\n        const pct25 = 400;\r\n        const pct50 = 800;\r\n        const pct75 = 1200;\r\n\r\n        let enc = new EncumbranceItemBased(max, [\r\n          createMockItem(\"item\", pct25, 1, { treasure: true }),\r\n        ]);\r\n        expect(enc.value).to.equal(pct25);\r\n\r\n        enc = new EncumbranceItemBased(max, [\r\n          createMockItem(\"item\", pct50, 1, { treasure: true }),\r\n        ]);\r\n        expect(enc.value).to.equal(pct50);\r\n\r\n        enc = new EncumbranceItemBased(max, [\r\n          createMockItem(\"item\", pct75, 1, { treasure: true }),\r\n        ]);\r\n        expect(enc.value).to.equal(pct75);\r\n\r\n        enc = new EncumbranceItemBased(max, [\r\n          createMockItem(\"item\", max, 1, { treasure: true }),\r\n        ]);\r\n        expect(enc.value).to.equal(max);\r\n\r\n        enc = new EncumbranceItemBased(max, [\r\n          createMockItem(\"item\", max, 1, { treasure: false }),\r\n        ]);\r\n        expect(enc.value).to.equal(max);\r\n      });\r\n      describe(\"As fully encumbered flag\", () => {\r\n        it(\"Encumbered over full load (1600.1)\", () => {\r\n          let enc = new EncumbranceItemBased(1600, [\r\n            createMockItem(\"item\", 1600.1, 1, { treasure: true }),\r\n          ]);\r\n          expect(enc.encumbered).to.be.true;\r\n          enc = new EncumbranceItemBased(1600, [\r\n            createMockItem(\"item\", 1600.1, 1, { treasure: false }),\r\n          ]);\r\n          expect(enc.encumbered).to.be.true;\r\n        });\r\n        describe(\"Not encumbered\", () => {\r\n          it(\"from a partial load\", () => {\r\n            const enc = new EncumbranceItemBased(1600, [\r\n              createMockItem(\"item\", 400, 1, { treasure: true }),\r\n            ]);\r\n            expect(enc.encumbered).to.be.false;\r\n          });\r\n          it(\"from a full load\", () => {\r\n            let enc = new EncumbranceItemBased(1600, [\r\n              createMockItem(\"item\", 1600, 1, { treasure: true }),\r\n            ]);\r\n            expect(enc.encumbered).to.be.false;\r\n            enc = new EncumbranceItemBased(1600, [\r\n              createMockItem(\"item\", 1600, 1, { treasure: false }),\r\n            ]);\r\n            console.info(enc);\r\n            expect(enc.encumbered).to.be.false;\r\n          });\r\n        });\r\n      });\r\n    });\r\n\r\n    it(\"Returns max carry weight\", () => {\r\n      const setMax = 2000;\r\n\r\n      let enc = new EncumbranceItemBased(setMax);\r\n      expect(enc.max).to.equal(setMax);\r\n\r\n      enc = new EncumbranceItemBased();\r\n\r\n      expect(enc.max).to.equal(\r\n        OseDataModelCharacterEncumbrance.baseEncumbranceCap\r\n      );\r\n    });\r\n  });\r\n};\r\n","/**\r\n * @file Tests for the data model class that determines character movement speed\r\n */\r\nimport { QuenchMethods } from \"../../../../e2e\";\r\nimport OseDataModelCharacterEncumbrance from \"../data-model-character-encumbrance\";\r\nimport EncumbranceBasic from \"../data-model-character-encumbrance-basic\";\r\nimport EncumbranceComplete from \"../data-model-character-encumbrance-complete\";\r\nimport EncumbranceDetailed from \"../data-model-character-encumbrance-detailed\";\r\nimport OseDataModelCharacterMove from \"../data-model-character-move\";\r\n\r\nexport const key = \"ose.actor.datamodel.character.move\";\r\nexport const options = {\r\n  displayName: \"OSE: Actor: Data Model: Character Movement\",\r\n};\r\n\r\nconst createMockItem = (\r\n  type: string,\r\n  weight: number,\r\n  quantity: number,\r\n  itemOptions = {}\r\n): Item =>\r\n  // eslint-disable-next-line new-cap\r\n  new Item.implementation({\r\n    name: `Mock ${type} ${foundry.utils.randomID()}`,\r\n    type,\r\n    system: { ...itemOptions, weight, quantity: { value: quantity } },\r\n  }) as Item;\r\n\r\nexport default ({ describe, it, expect }: QuenchMethods) => {\r\n  describe(\"Prevent autocalculation when...\", () => {\r\n    it(\"Autocalculation is off\", () => {\r\n      const enc = new EncumbranceBasic();\r\n      const move = new OseDataModelCharacterMove(enc, false);\r\n      expect(move.base).to.equal(OseDataModelCharacterMove.baseMoveRate);\r\n    });\r\n    it(\"Encumbrance is disabled\", () => {\r\n      const enc = new OseDataModelCharacterEncumbrance(\"disabled\");\r\n      const move = new OseDataModelCharacterMove(enc);\r\n      expect(move.base).to.equal(OseDataModelCharacterMove.baseMoveRate);\r\n    });\r\n    it(\"Encumbrance is not provided\", () => {\r\n      const move = new OseDataModelCharacterMove();\r\n      expect(move.base).to.equal(OseDataModelCharacterMove.baseMoveRate);\r\n    });\r\n  });\r\n\r\n  describe(\"Correctly calculates from Basic Encumbrance\", () => {\r\n    it(\"While unarmored\", () => {\r\n      let enc = new EncumbranceBasic();\r\n      let move = new OseDataModelCharacterMove(enc);\r\n      expect(move.base).to.equal(OseDataModelCharacterMove.baseMoveRate);\r\n\r\n      enc = new EncumbranceBasic(undefined, [\r\n        createMockItem(\"armor\", 100, 1, { type: \"unarmored\", equipped: true }),\r\n        createMockItem(\"armor\", 100, 1, { type: \"light\", equipped: false }),\r\n        createMockItem(\"armor\", 100, 1, { type: \"heavy\", equipped: false }),\r\n      ]);\r\n      move = new OseDataModelCharacterMove(enc);\r\n      expect(move.base).to.equal(OseDataModelCharacterMove.baseMoveRate);\r\n      // eslint-disable-next-line @typescript-eslint/no-unused-expressions\r\n      expect(move.encounter).to.equal(\r\n        OseDataModelCharacterMove.baseMoveRate / 3\r\n      );\r\n      // eslint-disable-next-line @typescript-eslint/no-unused-expressions\r\n      expect(move.overland).to.equal(\r\n        OseDataModelCharacterMove.baseMoveRate / 5\r\n      );\r\n    });\r\n    it(\"While lightly armored\", () => {\r\n      const enc = new EncumbranceBasic(undefined, [\r\n        createMockItem(\"armor\", 100, 1, { type: \"unarmored\", equipped: false }),\r\n        createMockItem(\"armor\", 100, 1, { type: \"light\", equipped: true }),\r\n        createMockItem(\"armor\", 100, 1, { type: \"heavy\", equipped: false }),\r\n      ]);\r\n      const move = new OseDataModelCharacterMove(enc);\r\n      expect(move.base).to.equal(OseDataModelCharacterMove.baseMoveRate * 0.75);\r\n      // eslint-disable-next-line @typescript-eslint/no-unused-expressions\r\n      expect(move.encounter).to.equal(\r\n        (OseDataModelCharacterMove.baseMoveRate * 0.75) / 3\r\n      );\r\n      // eslint-disable-next-line @typescript-eslint/no-unused-expressions\r\n      expect(move.overland).to.equal(\r\n        (OseDataModelCharacterMove.baseMoveRate * 0.75) / 5\r\n      );\r\n    });\r\n    it(\"While heavily armored\", () => {\r\n      const enc = new EncumbranceBasic(undefined, [\r\n        createMockItem(\"armor\", 100, 1, { type: \"unarmored\", equipped: false }),\r\n        createMockItem(\"armor\", 100, 1, { type: \"light\", equipped: false }),\r\n        createMockItem(\"armor\", 100, 1, { type: \"heavy\", equipped: true }),\r\n      ]);\r\n      const move = new OseDataModelCharacterMove(enc);\r\n      expect(move.base).to.equal(OseDataModelCharacterMove.baseMoveRate * 0.5);\r\n      // eslint-disable-next-line @typescript-eslint/no-unused-expressions\r\n      expect(move.encounter).to.equal(\r\n        (OseDataModelCharacterMove.baseMoveRate * 0.5) / 3\r\n      );\r\n      // eslint-disable-next-line @typescript-eslint/no-unused-expressions\r\n      expect(move.overland).to.equal(\r\n        (OseDataModelCharacterMove.baseMoveRate * 0.5) / 5\r\n      );\r\n    });\r\n    it(\"While carrying a significant amount of treasure\", () => {\r\n      let enc = new EncumbranceBasic(undefined, [\r\n        createMockItem(\"item\", EncumbranceBasic.significantTreasure - 1, 1, {\r\n          treasure: true,\r\n        }),\r\n      ]);\r\n      let move = new OseDataModelCharacterMove(enc);\r\n      expect(move.base).to.equal(OseDataModelCharacterMove.baseMoveRate);\r\n      // eslint-disable-next-line @typescript-eslint/no-unused-expressions\r\n      expect(move.encounter).to.equal(\r\n        OseDataModelCharacterMove.baseMoveRate / 3\r\n      );\r\n      // eslint-disable-next-line @typescript-eslint/no-unused-expressions\r\n      expect(move.overland).to.equal(\r\n        OseDataModelCharacterMove.baseMoveRate / 5\r\n      );\r\n\r\n      enc = new EncumbranceBasic(undefined, [\r\n        createMockItem(\"item\", EncumbranceBasic.significantTreasure, 1, {\r\n          treasure: true,\r\n        }),\r\n      ]);\r\n      move = new OseDataModelCharacterMove(enc);\r\n      expect(move.base).to.equal(OseDataModelCharacterMove.baseMoveRate - 30);\r\n      // eslint-disable-next-line @typescript-eslint/no-unused-expressions\r\n      expect(move.encounter).to.equal(\r\n        (OseDataModelCharacterMove.baseMoveRate - 30) / 3\r\n      );\r\n      // eslint-disable-next-line @typescript-eslint/no-unused-expressions\r\n      expect(move.overland).to.equal(\r\n        (OseDataModelCharacterMove.baseMoveRate - 30) / 5\r\n      );\r\n    });\r\n  });\r\n  describe(\"Correctly calculates from Detailed Encumbrance\", () => {\r\n    it(\"At unencumbered\", () => {\r\n      const expectedBase = OseDataModelCharacterMove.baseMoveRate;\r\n      const expectedEncounter = expectedBase / 3;\r\n      const expectedOverland = expectedBase / 5;\r\n\r\n      let enc = new EncumbranceDetailed();\r\n      let move = new OseDataModelCharacterMove(enc);\r\n\r\n      expect(move.base).to.equal(expectedBase);\r\n      expect(move.encounter).to.equal(expectedEncounter);\r\n      expect(move.overland).to.equal(expectedOverland);\r\n\r\n      enc = new EncumbranceDetailed(undefined, [\r\n        createMockItem(\"item\", 800, 1),\r\n      ]);\r\n      move = new OseDataModelCharacterMove(enc);\r\n\r\n      expect(move.base).to.equal(expectedBase);\r\n      expect(move.encounter).to.equal(expectedEncounter);\r\n      expect(move.overland).to.equal(expectedOverland);\r\n    })\r\n    it('At 12.5% encumbered (100% moverate)', () => {\r\n      const expectedBase = OseDataModelCharacterMove.baseMoveRate;\r\n      const expectedEncounter = expectedBase / 3;\r\n      const expectedOverland = expectedBase / 5;\r\n\r\n      const enc = new EncumbranceDetailed(undefined, [\r\n        createMockItem(\r\n          \"item\",\r\n          OseDataModelCharacterEncumbrance.baseEncumbranceCap * 0.125,\r\n          1,\r\n          { treasure: true }\r\n        ),\r\n      ]);\r\n      const move = new OseDataModelCharacterMove(enc);\r\n\r\n      expect(move.base).to.equal(expectedBase);\r\n      expect(move.encounter).to.equal(expectedEncounter)\r\n      expect(move.overland).to.equal(expectedOverland)\r\n    })\r\n    it('At 25% encumbered (100% moverate)', () => {\r\n      const expectedBase = OseDataModelCharacterMove.baseMoveRate;\r\n      const expectedEncounter = expectedBase / 3;\r\n      const expectedOverland = expectedBase / 5;\r\n\r\n      const enc = new EncumbranceDetailed(undefined, [\r\n        createMockItem(\r\n          \"item\",\r\n          OseDataModelCharacterEncumbrance.baseEncumbranceCap * 0.25,\r\n          1,\r\n          { treasure: true }\r\n        ),\r\n      ]);\r\n      const move = new OseDataModelCharacterMove(enc);\r\n\r\n      expect(move.base).to.equal(expectedBase);\r\n      expect(move.encounter).to.equal(expectedEncounter)\r\n      expect(move.overland).to.equal(expectedOverland)\r\n    })\r\n    it('At 25.1% encumbered (75% moverate)', () => {\r\n      const expectedBase = OseDataModelCharacterMove.baseMoveRate * .75;\r\n      const expectedEncounter = expectedBase / 3;\r\n      const expectedOverland = expectedBase / 5;\r\n      \r\n      let enc = new EncumbranceDetailed(undefined, [\r\n        createMockItem('item', OseDataModelCharacterEncumbrance.baseEncumbranceCap * .251, 1, {treasure: true}),\r\n      ]);\r\n      let move = new OseDataModelCharacterMove(enc);\r\n\r\n      expect(move.base).to.equal(expectedBase);\r\n      expect(move.encounter).to.equal(expectedEncounter)\r\n      expect(move.overland).to.equal(expectedOverland)\r\n    })\r\n    it('At 37.5% encumbered (75% moverate)', () => {\r\n      const expectedBase = OseDataModelCharacterMove.baseMoveRate * .75;\r\n      const expectedEncounter = expectedBase / 3;\r\n      const expectedOverland = expectedBase / 5;\r\n      \r\n      let enc = new EncumbranceDetailed(undefined, [\r\n        createMockItem('item', OseDataModelCharacterEncumbrance.baseEncumbranceCap * .375, 1, {treasure: true}),\r\n      ]);\r\n      let move = new OseDataModelCharacterMove(enc);\r\n\r\n      expect(move.base).to.equal(expectedBase);\r\n      expect(move.encounter).to.equal(expectedEncounter)\r\n      expect(move.overland).to.equal(expectedOverland)\r\n    })\r\n    it('At 37.51% encumbered (50% moverate)', () => {\r\n      const expectedBase = OseDataModelCharacterMove.baseMoveRate * .50;\r\n      const expectedEncounter = expectedBase / 3;\r\n      const expectedOverland = expectedBase / 5;\r\n      \r\n      let enc = new EncumbranceDetailed(undefined, [\r\n        createMockItem('item', OseDataModelCharacterEncumbrance.baseEncumbranceCap * .3751, 1, {treasure: true}),\r\n      ]);\r\n      let move = new OseDataModelCharacterMove(enc);\r\n\r\n      expect(move.base).to.equal(expectedBase);\r\n      expect(move.encounter).to.equal(expectedEncounter)\r\n      expect(move.overland).to.equal(expectedOverland)\r\n    })\r\n    it('At 50% encumbered (50% moverate)', () => {\r\n      const expectedBase = OseDataModelCharacterMove.baseMoveRate * .50;\r\n      const expectedEncounter = expectedBase / 3;\r\n      const expectedOverland = expectedBase / 5;\r\n      \r\n      let enc = new EncumbranceDetailed(undefined, [\r\n        createMockItem('item', OseDataModelCharacterEncumbrance.baseEncumbranceCap * .5, 1, {treasure: true}),\r\n      ]);\r\n      let move = new OseDataModelCharacterMove(enc);\r\n\r\n      expect(move.base).to.equal(expectedBase);\r\n      expect(move.encounter).to.equal(expectedEncounter)\r\n      expect(move.overland).to.equal(expectedOverland)\r\n    })\r\n    it('At 50.1% encumbered (25% moverate)', () => {\r\n      const expectedBase = OseDataModelCharacterMove.baseMoveRate * .25;\r\n      const expectedEncounter = expectedBase / 3;\r\n      const expectedOverland = expectedBase / 5;\r\n      \r\n      let enc = new EncumbranceDetailed(undefined, [\r\n        createMockItem('item', OseDataModelCharacterEncumbrance.baseEncumbranceCap * .501, 1, {treasure: true}),\r\n      ]);\r\n      let move = new OseDataModelCharacterMove(enc);\r\n\r\n      expect(move.base).to.equal(expectedBase);\r\n      expect(move.encounter).to.equal(expectedEncounter)\r\n      expect(move.overland).to.equal(expectedOverland)\r\n    })\r\n    it('At 100% encumbered (25% moverate)', () => {\r\n      const expectedBase = OseDataModelCharacterMove.baseMoveRate * .25;\r\n      const expectedEncounter = expectedBase / 3;\r\n      const expectedOverland = expectedBase / 5;\r\n      \r\n      let enc = new EncumbranceDetailed(undefined, [\r\n        createMockItem('item', OseDataModelCharacterEncumbrance.baseEncumbranceCap, 1, {treasure: true}),\r\n      ]);\r\n      const move = new OseDataModelCharacterMove(enc);\r\n\r\n      expect(move.base).to.equal(expectedBase);\r\n      expect(move.encounter).to.equal(expectedEncounter)\r\n      expect(move.overland).to.equal(expectedOverland)\r\n    })\r\n    it('At 100.1% encumbered (0% moverate)', () => {\r\n      const expectedBase = 0;\r\n      const expectedEncounter = 0;\r\n      const expectedOverland = 0;\r\n      \r\n      let enc = new EncumbranceDetailed(undefined, [\r\n        createMockItem('item', OseDataModelCharacterEncumbrance.baseEncumbranceCap, 1.001, {treasure: true}),\r\n      ]);\r\n      let move = new OseDataModelCharacterMove(enc);\r\n\r\n      expect(move.base).to.equal(expectedBase);\r\n      expect(move.encounter).to.equal(expectedEncounter)\r\n      expect(move.overland).to.equal(expectedOverland)\r\n    })\r\n  })\r\n  describe('Correctly calculates from Complete Encumbrance', () => {\r\n    it('At 0% encumbered (100% moverate)', () => {\r\n      const expectedBase = OseDataModelCharacterMove.baseMoveRate;\r\n      const expectedEncounter = expectedBase / 3;\r\n      const expectedOverland = expectedBase / 5;\r\n\r\n      const enc = new EncumbranceComplete();\r\n      const move = new OseDataModelCharacterMove(enc);\r\n\r\n      expect(move.base).to.equal(expectedBase);\r\n      expect(move.encounter).to.equal(expectedEncounter);\r\n      expect(move.overland).to.equal(expectedOverland);\r\n    })\r\n    it('At 12.5% encumbered (100% moverate)', () => {\r\n      const expectedBase = OseDataModelCharacterMove.baseMoveRate;\r\n      const expectedEncounter = expectedBase / 3;\r\n      const expectedOverland = expectedBase / 5;\r\n      \r\n      let enc = new EncumbranceComplete(undefined, [\r\n        createMockItem('item', OseDataModelCharacterEncumbrance.baseEncumbranceCap * .125, 1 ),\r\n      ]);\r\n      let move = new OseDataModelCharacterMove(enc);\r\n\r\n      expect(move.base).to.equal(expectedBase);\r\n      expect(move.encounter).to.equal(expectedEncounter)\r\n      expect(move.overland).to.equal(expectedOverland)\r\n    })\r\n    it('At 25% encumbered (100% moverate)', () => {\r\n      const expectedBase = OseDataModelCharacterMove.baseMoveRate;\r\n      const expectedEncounter = expectedBase / 3;\r\n      const expectedOverland = expectedBase / 5;\r\n      \r\n      let enc = new EncumbranceComplete(undefined, [\r\n        createMockItem('item', OseDataModelCharacterEncumbrance.baseEncumbranceCap * .25, 1 ),\r\n      ]);\r\n      let move = new OseDataModelCharacterMove(enc);\r\n\r\n      expect(move.base).to.equal(expectedBase);\r\n      expect(move.encounter).to.equal(expectedEncounter)\r\n      expect(move.overland).to.equal(expectedOverland)\r\n    })\r\n    it('At 25.1% encumbered (75% moverate)', () => {\r\n      const expectedBase = OseDataModelCharacterMove.baseMoveRate * .75;\r\n      const expectedEncounter = expectedBase / 3;\r\n      const expectedOverland = expectedBase / 5;\r\n      \r\n      let enc = new EncumbranceComplete(undefined, [\r\n        createMockItem('item', OseDataModelCharacterEncumbrance.baseEncumbranceCap * .251, 1 ),\r\n      ]);\r\n      const move = new OseDataModelCharacterMove(enc);\r\n\r\n      expect(move.base).to.equal(expectedBase);\r\n      expect(move.encounter).to.equal(expectedEncounter)\r\n      expect(move.overland).to.equal(expectedOverland)\r\n    })\r\n    it('At 37.5% encumbered (75% moverate)', () => {\r\n      const expectedBase = OseDataModelCharacterMove.baseMoveRate * .75;\r\n      const expectedEncounter = expectedBase / 3;\r\n      const expectedOverland = expectedBase / 5;\r\n      \r\n      let enc = new EncumbranceComplete(undefined, [\r\n        createMockItem('item', OseDataModelCharacterEncumbrance.baseEncumbranceCap * .375, 1 ),\r\n      ]);\r\n      const move = new OseDataModelCharacterMove(enc);\r\n\r\n      expect(move.base).to.equal(expectedBase);\r\n      expect(move.encounter).to.equal(expectedEncounter)\r\n      expect(move.overland).to.equal(expectedOverland)\r\n    })\r\n    it('At 37.51% encumbered (50% moverate)', () => {\r\n      const expectedBase = OseDataModelCharacterMove.baseMoveRate * .50;\r\n      const expectedEncounter = expectedBase / 3;\r\n      const expectedOverland = expectedBase / 5;\r\n      \r\n      let enc = new EncumbranceComplete(undefined, [\r\n        createMockItem('item', OseDataModelCharacterEncumbrance.baseEncumbranceCap * .3751, 1 ),\r\n      ]);\r\n      let move = new OseDataModelCharacterMove(enc);\r\n\r\n      expect(move.base).to.equal(expectedBase);\r\n      expect(move.encounter).to.equal(expectedEncounter)\r\n      expect(move.overland).to.equal(expectedOverland)\r\n    })\r\n    it('At 50% encumbered (50% moverate)', () => {\r\n      const expectedBase = OseDataModelCharacterMove.baseMoveRate * .50;\r\n      const expectedEncounter = expectedBase / 3;\r\n      const expectedOverland = expectedBase / 5;\r\n      \r\n      let enc = new EncumbranceComplete(undefined, [\r\n        createMockItem('item', OseDataModelCharacterEncumbrance.baseEncumbranceCap * .5, 1 ),\r\n      ]);\r\n      let move = new OseDataModelCharacterMove(enc);\r\n\r\n      expect(move.base).to.equal(expectedBase);\r\n      expect(move.encounter).to.equal(expectedEncounter)\r\n      expect(move.overland).to.equal(expectedOverland)\r\n    })\r\n    it('At 50.1% encumbered (25% moverate)', () => {\r\n      const expectedBase = OseDataModelCharacterMove.baseMoveRate * .25;\r\n      const expectedEncounter = expectedBase / 3;\r\n      const expectedOverland = expectedBase / 5;\r\n      \r\n      let enc = new EncumbranceComplete(undefined, [\r\n        createMockItem('item', OseDataModelCharacterEncumbrance.baseEncumbranceCap * .501, 1 ),\r\n      ]);\r\n      let move = new OseDataModelCharacterMove(enc);\r\n\r\n      expect(move.base).to.equal(expectedBase);\r\n      expect(move.encounter).to.equal(expectedEncounter)\r\n      expect(move.overland).to.equal(expectedOverland)\r\n    })\r\n    it('At 100% encumbered (25% moverate)', () => {\r\n      const expectedBase = OseDataModelCharacterMove.baseMoveRate * .25;\r\n      const expectedEncounter = expectedBase / 3;\r\n      const expectedOverland = expectedBase / 5;\r\n      \r\n      let enc = new EncumbranceComplete(undefined, [\r\n        createMockItem('item', OseDataModelCharacterEncumbrance.baseEncumbranceCap, 1 ),\r\n      ]);\r\n      let move = new OseDataModelCharacterMove(enc);\r\n\r\n      expect(move.base).to.equal(expectedBase);\r\n      expect(move.encounter).to.equal(expectedEncounter)\r\n      expect(move.overland).to.equal(expectedOverland)\r\n    })\r\n    it('At 100.1% encumbered (0% moverate)', () => {\r\n      const expectedBase = 0;\r\n      const expectedEncounter = 0;\r\n      const expectedOverland = 0;\r\n      \r\n      let enc = new EncumbranceComplete(undefined, [\r\n        createMockItem('item', OseDataModelCharacterEncumbrance.baseEncumbranceCap, 1.001 ),\r\n      ]);\r\n      const move = new OseDataModelCharacterMove(enc);\r\n\r\n      expect(move.base).to.equal(expectedBase);\r\n      expect(move.encounter).to.equal(expectedEncounter);\r\n      expect(move.overland).to.equal(expectedOverland);\r\n    });\r\n  });\r\n};\r\n","/**\r\n * @file Tests for the class represening a character's ability scores\r\n */\r\nimport { QuenchMethods } from \"../../../../e2e\";\r\nimport OseDataModelCharacterScores from \"../data-model-character-scores\";\r\n\r\nexport const key = \"ose.actor.datamodel.character.scores\";\r\nexport const options = {\r\n  displayName: \"OSE: Actor: Data Model: Character Ability Scores\",\r\n};\r\n\r\nexport default ({ describe, it, expect }: QuenchMethods) => {\r\n  // An array from 0-\r\n  const scoreSpread = Array.from({ length: 21 }, (_el, idx) => idx);\r\n  const scoreKeys = [\"str\", \"int\", \"wis\", \"dex\", \"con\", \"cha\"];\r\n  const tables = [\r\n    OseDataModelCharacterScores.standardAttributeMods,\r\n    OseDataModelCharacterScores.cappedAttributeMods,\r\n    OseDataModelCharacterScores.openDoorMods,\r\n    OseDataModelCharacterScores.literacyMods,\r\n    OseDataModelCharacterScores.spokenMods,\r\n  ];\r\n  const fromTable = (tableKey: number, score: number) =>\r\n    OseDataModelCharacterScores.valueFromTable(tables[tableKey], score);\r\n  const numberToScores = (number: number) =>\r\n    Object.fromEntries(\r\n      scoreKeys.map((scoreKey) => [scoreKey, { value: number, bonus: 0 }])\r\n    );\r\n\r\n  const buildTestCases = (\r\n    score: number,\r\n    scoreKey: string,\r\n    mod: string,\r\n    table: any\r\n  ) => {\r\n    const scoresToUse = numberToScores(score);\r\n    const scoresObj = new OseDataModelCharacterScores(scoresToUse);\r\n    return it(`${score}`, () => {\r\n      expect(scoresObj[scoreKey][mod]).to.equal(fromTable(table, score));\r\n    });\r\n  };\r\n  const buildTestCasesWithModifiers = (\r\n    score: number,\r\n    scoreKey: string,\r\n    mod: string,\r\n    table: any,\r\n    added: number\r\n  ) => {\r\n    const scoresToUse = numberToScores(score);\r\n    const scoresObj = new OseDataModelCharacterScores(scoresToUse);\r\n    return it(`${score}`, () => {\r\n      // eslint-disable-next-line @typescript-eslint/no-unused-expressions\r\n      expect(scoresObj[scoreKey][mod]).to.equal(\r\n        fromTable(table, score) + added\r\n      );\r\n    });\r\n  };\r\n\r\n  const spreadToModTests = (name: string) =>\r\n    scoreKeys.map((scoreKey) =>\r\n      describe(`${name}: ${scoreKey}`, () =>\r\n        scoreSpread.map((score) => buildTestCases(score, scoreKey, \"mod\", 0)))\r\n    );\r\n\r\n  describe(\"Standard attribute modifiers\", () => spreadToModTests(\"Attribute\"));\r\n\r\n  describe(\"Strength modifiers\", () => {\r\n    describe(\"Open Doors\", () =>\r\n      scoreSpread.map((score) => buildTestCases(score, \"str\", \"od\", 2)));\r\n  });\r\n\r\n  describe(\"Intelligence modifiers\", () => {\r\n    describe(\"Literacy\", () =>\r\n      scoreSpread.map((score) => buildTestCases(score, \"int\", \"literacy\", 3)));\r\n    describe(\"Spoken Languages\", () =>\r\n      scoreSpread.map((score) => buildTestCases(score, \"int\", \"spoken\", 4)));\r\n  });\r\n\r\n  describe(\"Dexterity modifiers\", () => {\r\n    describe(\"Initiative\", () =>\r\n      scoreSpread.map((score) => buildTestCases(score, \"dex\", \"init\", 1)));\r\n  });\r\n\r\n  describe(\"Charisma modifiers\", () => {\r\n    describe(\"NPC Reaction\", () =>\r\n      scoreSpread.map((score) => buildTestCases(score, \"cha\", \"npc\", 1)));\r\n    describe(\"Loyalty\", () =>\r\n      scoreSpread.map((score) =>\r\n        buildTestCasesWithModifiers(score, \"cha\", \"retain\", 0, 4)\r\n      ));\r\n    describe(\"Number of Retainers\", () =>\r\n      scoreSpread.map((score) =>\r\n        buildTestCasesWithModifiers(score, \"cha\", \"loyalty\", 0, 7)\r\n      ));\r\n  });\r\n};\r\n","/**\r\n * @file Quench unit tests for the data model class that drives actor spells.\r\n */\r\nimport { QuenchMethods } from \"../../../../e2e\";\r\nimport OseDataModelCharacterSpells from \"../data-model-character-spells\";\r\n\r\nexport const key = \"ose.actor.datamodel.character.spells\";\r\nexport const options = {\r\n  displayName: \"OSE: Actor: Data Model: Character Spells\",\r\n};\r\n\r\nconst createMockSpell = (lvl: number, spellOptions?: any): Item =>\r\n  // eslint-disable-next-line new-cap\r\n  new Item.implementation({\r\n    name: `Mock Spell ${foundry.utils.randomID()}`,\r\n    type: \"spell\",\r\n    system: { ...spellOptions, lvl },\r\n  }) as Item;\r\n\r\nconst createMockSpellList = (spellOptions: any, ...levels: any) =>\r\n  levels.reduce(\r\n    (arr: Item[], lvCount: number, idx: number) => [\r\n      ...arr,\r\n      ...Array.from({ length: lvCount }, () =>\r\n        createMockSpell(idx + 1, spellOptions)\r\n      ),\r\n    ],\r\n    []\r\n  );\r\n\r\n// Core goes to 6, but we'll go to 9 just in case\r\n// someone wants to implement higher-level spells\r\nconst spellsPerLevel = [1, 2, 3, 4, 5, 6, 7, 8, 9];\r\n\r\nexport default ({ describe, it, expect }: QuenchMethods) => {\r\n  // Test for spells being sorted into buckets by spell level.\r\n  describe(\"Spell levels\", () => {\r\n    it(\"Sorts the incoming spell list into an object with spell level keys\", () => {\r\n      const spells = createMockSpellList({}, ...spellsPerLevel);\r\n      const spellData = new OseDataModelCharacterSpells({}, spells);\r\n      spellsPerLevel.forEach((lv) => {\r\n        expect(spellData.spellList[lv].length).to.equal(lv);\r\n      });\r\n    });\r\n  });\r\n  // Test for available/max slots\r\n  describe(\"Spell slots\", () => {\r\n    describe(\"Shows committed and max spell slots per level\", () => {\r\n      it(\"with no spells prepared\", () => {\r\n        const spells = [createMockSpell(1)];\r\n        const spellData = new OseDataModelCharacterSpells(\r\n          { 1: { max: 1 } },\r\n          spells as Item[]\r\n        );\r\n        expect(spellData.slots[1].used).to.equal(0);\r\n        expect(spellData.slots[1].max).to.equal(1);\r\n      });\r\n\r\n      it(\"with spells prepared, not cast\", () => {\r\n        const spells = [createMockSpell(1, { memorized: 1, cast: 1 })];\r\n        const spellData = new OseDataModelCharacterSpells(\r\n          { 1: { max: 1 } },\r\n          spells as Item[]\r\n        );\r\n        expect(spellData.slots[1].used).to.equal(1);\r\n        expect(spellData.slots[1].max).to.equal(1);\r\n      });\r\n\r\n      it(\"with spells prepared and cast\", () => {\r\n        const spells = [createMockSpell(1, { memorized: 1, cast: 0 })];\r\n        const spellData = new OseDataModelCharacterSpells(\r\n          { 1: { max: 1 } },\r\n          spells as Item[]\r\n        );\r\n        expect(spellData.slots[1].used).to.equal(0);\r\n        expect(spellData.slots[1].max).to.equal(1);\r\n      });\r\n    });\r\n  });\r\n  // Sanity check: can we cast spells?\r\n  describe(\"Checking for spellcasting\", () => {\r\n    it(\"Can cast spells when spellcasting is enabled\", () => {\r\n      const spellData = new OseDataModelCharacterSpells({ enabled: true }, []);\r\n      expect(spellData.enabled).to.be.true;\r\n    });\r\n    it(\"Cannot cast spells when spellcasting is disabled\", () => {\r\n      const spellData = new OseDataModelCharacterSpells({ enabled: false }, []);\r\n      expect(spellData.enabled).to.be.false;\r\n    });\r\n    it(\"Can toggle between being able and unable to cast spells\", () => {\r\n      const spellData = new OseDataModelCharacterSpells({ enabled: true }, []);\r\n      expect(spellData.enabled).to.be.true;\r\n      spellData.enabled = false;\r\n      expect(spellData.enabled).to.be.false;\r\n    });\r\n  });\r\n};\r\n","/**\r\n * @file Contains tests for Monster Data Model.\r\n */\r\n// eslint-disable-next-line import/no-cycle\r\nimport { QuenchMethods } from \"../../../e2e\";\r\nimport {\r\n  cleanUpActorsByKey,\r\n  createMockActorKey,\r\n  getMockActorKey,\r\n} from \"../../../e2e/testUtils\";\r\nimport OseDataModelMonster from \"../data-model-monster\";\r\n\r\nexport const key = \"ose.actor.datamodel.monster\";\r\nexport const options = { displayName: \"OSE: Actor: Data Model: Monster\" };\r\n\r\nconst createMockActor = () => createMockActorKey(\"monster\", {}, key);\r\n\r\nexport default ({\r\n  describe,\r\n  it,\r\n  expect,\r\n  after,\r\n  afterEach,\r\n  before,\r\n}: QuenchMethods) => {\r\n  const dataModel = new OseDataModelMonster();\r\n  const ascendingACSetting = game.settings.get(game.system.id, \"ascendingAC\");\r\n  const initiativeSetting = game.settings.get(game.system.id, \"initiative\");\r\n\r\n  after(() => {\r\n    game.settings.set(game.system.id, \"ascendingAC\", ascendingACSetting);\r\n    game.settings.set(game.system.id, \"initiative\", initiativeSetting);\r\n    cleanUpActorsByKey(key);\r\n  });\r\n\r\n  // @todo: Can this be tested without creating an actor?\r\n  describe(\"prepareDerivedData()\", () => {\r\n    afterEach(() => {\r\n      cleanUpActorsByKey(key);\r\n    });\r\n\r\n    it(\"doesnt have scores\", async () => {\r\n      const actor = await createMockActor();\r\n      expect(actor?.system.scores).is.undefined;\r\n    });\r\n\r\n    it(\"has encumbrance\", async () => {\r\n      const actor = await createMockActor();\r\n      expect(actor?.system.encumbrance).not.undefined;\r\n      expect(actor?.system.encumbrance.variant).not.undefined;\r\n      expect(actor?.system.encumbrance.enabled).not.undefined;\r\n      expect(actor?.system.encumbrance.pct).not.undefined;\r\n      expect(actor?.system.encumbrance.encumbered).not.undefined;\r\n      expect(actor?.system.encumbrance.steps).not.undefined;\r\n      expect(actor?.system.encumbrance.value).not.undefined;\r\n      expect(actor?.system.encumbrance.max).not.undefined;\r\n      expect(actor?.system.encumbrance.atHalfEncumbered).not.undefined;\r\n      expect(actor?.system.encumbrance.atQuarterEncumbered).not.undefined;\r\n      expect(actor?.system.encumbrance.atEighthEncumbered).not.undefined;\r\n    });\r\n\r\n    it(\"have movement\", async () => {\r\n      const actor = await createMockActor();\r\n      expect(actor?.system.movement).not.undefined;\r\n      expect(actor?.system.movement.base).not.undefined;\r\n    });\r\n\r\n    it(\"have ac\", async () => {\r\n      const actor = await createMockActor();\r\n      expect(actor?.system.ac).not.undefined;\r\n      expect(actor?.system.ac.value).not.undefined;\r\n      expect(actor?.system.ac.mod).not.undefined;\r\n    });\r\n\r\n    it(\"have aac\", async () => {\r\n      const actor = await createMockActor();\r\n      expect(actor?.system.aac).not.undefined;\r\n      expect(actor?.system.aac.value).not.undefined;\r\n      expect(actor?.system.aac.mod).not.undefined;\r\n    });\r\n\r\n    describe(\"has spells\", () => {\r\n      // @todo: Should we keep using numbers and keys for spell levels?\r\n      const spellLevels = new Set([\"1\", \"2\", \"3\", \"4\", \"5\", \"6\"]);\r\n\r\n      it(\"has spells\", async () => {\r\n        const actor = await createMockActor();\r\n        expect(actor?.system.spells).not.undefined;\r\n        expect(actor?.system.spells.enabled).not.undefined;\r\n        expect(actor?.system.spells.spellList).not.undefined;\r\n        expect(actor?.system.spells.slots).not.undefined;\r\n      });\r\n\r\n      spellLevels.forEach((lvl) => {\r\n        it(`has spell level ${lvl}`, async () => {\r\n          const actor = await createMockActor();\r\n          expect(actor?.system.spells.slots[lvl]).not.undefined;\r\n          expect(Object.keys(actor?.system.spells.slots[lvl])).contain(\"used\");\r\n          expect(Object.keys(actor?.system.spells.slots[lvl])).contain(\"max\");\r\n        });\r\n      });\r\n    });\r\n  });\r\n\r\n  describe(\"defineSchema()\", () => {\r\n    before(async () => {\r\n      await createMockActor();\r\n    });\r\n\r\n    const flatFields = [\"config\", \"initiative\", \"thac0\", \"languages\"];\r\n    flatFields.forEach((field) => {\r\n      it(`has ${field}`, async () => {\r\n        const actor = await getMockActorKey(key);\r\n        expect(actor?.system[field]).not.undefined;\r\n      });\r\n    });\r\n\r\n    const recursiveFields = [\r\n      { field: \"hp\", subFields: [\"hd\", \"value\", \"max\"] },\r\n      { field: \"retainer\", subFields: [\"enabled\", \"loyalty\", \"wage\"] },\r\n    ];\r\n    recursiveFields.forEach(({ field, subFields }) => {\r\n      subFields.forEach((subField) => {\r\n        it(`${field} field has ${subField} subfield`, async () => {\r\n          const actor = await getMockActorKey(key);\r\n          expect(actor?.system[field]).not.undefined;\r\n          expect(actor?.system[field][subField]).not.undefined;\r\n        });\r\n      });\r\n    });\r\n\r\n    const doubleRecursiveFields = [\r\n      {\r\n        field: \"saves\",\r\n        subFields: [\r\n          { subField: \"breath\", subSubField: [\"value\"] },\r\n          { subField: \"death\", subSubField: [\"value\"] },\r\n          { subField: \"paralysis\", subSubField: [\"value\"] },\r\n          { subField: \"spell\", subSubField: [\"value\"] },\r\n          { subField: \"wand\", subSubField: [\"value\"] },\r\n        ],\r\n      },\r\n    ];\r\n    doubleRecursiveFields.forEach(({ field, subFields }) => {\r\n      subFields.forEach(({ subField, subSubField }) => {\r\n        it(`${field} field has ${subField} subfield, which has ${subSubField} field`, async () => {\r\n          const actor = await getMockActorKey(key);\r\n          expect(actor?.system[field]).not.undefined;\r\n          expect(actor?.system[field][subField]).not.undefined;\r\n          expect(actor?.system[field][subField][subSubField]).not.undefined;\r\n        });\r\n      });\r\n    });\r\n\r\n    after(() => {\r\n      cleanUpActorsByKey(key);\r\n    });\r\n  });\r\n\r\n  describe(\"isNew()\", () => {\r\n    it(\"New when all saves are at 0\", async () => {\r\n      const testActor = await createMockActorKey(\r\n        \"monster\",\r\n        {\r\n          system: {\r\n            saves: {\r\n              breath: { value: 0 },\r\n              death: { value: 0 },\r\n              paralysis: { value: 0 },\r\n              spell: { value: 0 },\r\n              wand: { value: 0 },\r\n            },\r\n          },\r\n        },\r\n        key\r\n      );\r\n      expect(testActor?.system.isNew).to.be.true;\r\n    });\r\n\r\n    it(\"Not new when any save is above 0\", async () => {\r\n      const testActor = await createMockActorKey(\r\n        \"monster\",\r\n        {\r\n          system: {\r\n            saves: {\r\n              breath: { value: 10 },\r\n              death: { value: 0 },\r\n              paralysis: { value: 0 },\r\n              spell: { value: 0 },\r\n              wand: { value: 0 },\r\n            },\r\n          },\r\n        },\r\n        key\r\n      );\r\n      expect(testActor?.system.isNew).to.be.false;\r\n    });\r\n  });\r\n\r\n  describe(\"containers()\", () => {\r\n    it(\"returns all containers\", async () => {\r\n      const actor = await createMockActor();\r\n      expect(actor?.items.contents.length).equal(0);\r\n      expect(actor?.system.containers.length).equal(0);\r\n      await actor?.createEmbeddedDocuments(\"Item\", [\r\n        { type: \"container\", name: \"test container\" },\r\n      ]);\r\n      expect(actor?.items.contents.length).equal(1);\r\n      expect(actor?.items.contents[0].name).equal(\"test container\");\r\n      // eslint-disable-next-line no-underscore-dangle\r\n      const itemId = actor?.items.contents[0].id;\r\n      expect(actor?.system.containers.length).equal(1);\r\n      // eslint-disable-next-line no-underscore-dangle\r\n      expect(actor?.system.containers[0]._id).equal(itemId);\r\n      actor?.delete();\r\n    });\r\n\r\n    after(() => {\r\n      cleanUpActorsByKey(key);\r\n    });\r\n  });\r\n\r\n  describe(\"treasures()\", () => {\r\n    it(\"returns treasures on actor\", async () => {\r\n      const actor = await createMockActor();\r\n      expect(actor?.items.contents.length).equal(0);\r\n      expect(actor?.system.treasures.length).equal(0);\r\n      await actor?.createEmbeddedDocuments(\"Item\", [\r\n        { type: \"item\", name: \"test treasure\", system: { treasure: true } },\r\n      ]);\r\n      expect(actor?.items.contents.length).equal(1);\r\n      expect(actor?.items.contents[0].name).equal(\"test treasure\");\r\n      expect(actor?.items.contents[0].system.treasure).is.true;\r\n      // eslint-disable-next-line no-underscore-dangle\r\n      const itemId = actor?.items.contents[0].id;\r\n      expect(actor?.system.treasures.length).equal(1);\r\n      // eslint-disable-next-line no-underscore-dangle\r\n      expect(actor?.system.treasures[0]._id).equal(itemId);\r\n      actor?.delete();\r\n    });\r\n\r\n    it(\"doesn't returns treasures on actor if in container\", async () => {\r\n      const actor = await createMockActor();\r\n      expect(actor?.items.contents.length).equal(0);\r\n      expect(actor?.system.treasures.length).equal(0);\r\n      await actor?.createEmbeddedDocuments(\"Item\", [\r\n        { type: \"container\", name: \"test container\" },\r\n      ]);\r\n      const container = actor?.items.getName(\"test container\");\r\n      await actor?.createEmbeddedDocuments(\"Item\", [\r\n        // eslint-disable-next-line no-underscore-dangle\r\n        {\r\n          type: \"item\",\r\n          name: \"test treasure\",\r\n          system: { treasure: true, containerId: container?.id },\r\n        },\r\n      ]);\r\n      expect(actor?.items.contents.length).equal(2);\r\n      expect(actor?.items.contents[0].name).equal(\"test container\");\r\n      expect(actor?.items.contents[1].name).equal(\"test treasure\");\r\n      expect(actor?.items.contents[1].system.treasure).is.true;\r\n      // eslint-disable-next-line no-underscore-dangle\r\n      expect(actor?.items.contents[1].system.containerId).equal(container?.id);\r\n      expect(actor?.system.treasures.length).equal(0);\r\n      actor?.delete();\r\n    });\r\n\r\n    after(() => {\r\n      cleanUpActorsByKey(key);\r\n    });\r\n  });\r\n\r\n  describe(\"items()\", () => {\r\n    it(\"only returns other items than treasure\", async () => {\r\n      const actor = await createMockActor();\r\n      expect(actor?.items.contents.length).equal(0);\r\n      expect(actor?.system.items.length).equal(0);\r\n      await actor?.createEmbeddedDocuments(\"Item\", [\r\n        {\r\n          type: \"item\",\r\n          name: \"test item\",\r\n        },\r\n        {\r\n          type: \"item\",\r\n          name: \"test treasure\",\r\n          system: { treasure: true, quantity: { value: 3 }, cost: 4 },\r\n        },\r\n      ]);\r\n      expect(actor?.items.contents.length).equal(2);\r\n      expect(actor?.items.contents[0].name).equal(\"test item\");\r\n      expect(actor?.items.contents[1].name).equal(\"test treasure\");\r\n      expect(actor?.items.contents[1].system.treasure).is.true;\r\n      expect(actor?.system.items.length).equal(1);\r\n      expect(actor?.system.items[0].name).equal(\"test item\");\r\n      actor?.delete();\r\n    });\r\n\r\n    it(\"only returns other items than stored in containers\", async () => {\r\n      const actor = await createMockActor();\r\n      expect(actor?.items.contents.length).equal(0);\r\n      expect(actor?.system.items.length).equal(0);\r\n      await actor?.createEmbeddedDocuments(\"Item\", [\r\n        {\r\n          type: \"container\",\r\n          name: \"test container\",\r\n        },\r\n      ]);\r\n      const container = actor?.items.getName(\"test container\");\r\n      await actor?.createEmbeddedDocuments(\"Item\", [\r\n        // eslint-disable-next-line no-underscore-dangle\r\n        {\r\n          type: \"item\",\r\n          name: \"test item in container\",\r\n          system: { containerId: container?.id },\r\n        },\r\n        {\r\n          type: \"item\",\r\n          name: \"test item\",\r\n        },\r\n      ]);\r\n      expect(actor?.items.contents.length).equal(3);\r\n      expect(actor?.items.contents[0].name).equal(\"test container\");\r\n      expect(actor?.items.contents[1].name).equal(\"test item in container\");\r\n      expect(actor?.items.contents[2].name).equal(\"test item\");\r\n      expect(actor?.system.items.length).equal(1);\r\n      expect(actor?.system.items[0].name).equal(\"test item\");\r\n      actor?.delete();\r\n    });\r\n  });\r\n\r\n  const testTypes = [\r\n    { type: \"weapon\", getter: \"weapons\" },\r\n    { type: \"ability\", getter: \"abilities\" },\r\n    { type: \"armor\", getter: \"armor\" },\r\n    // @todo: { type: \"spell\", getter: \"#spellList\" },\r\n  ];\r\n  testTypes.forEach(({ type, getter }) => {\r\n    describe(`${getter}()`, () => {\r\n      it(`returns all ${getter}`, async () => {\r\n        const actor = await createMockActor();\r\n        expect(actor?.items.contents.length).equal(0);\r\n        expect(actor?.system[getter].length).equal(0);\r\n        await actor?.createEmbeddedDocuments(\"Item\", [\r\n          { type, name: `test ${type}` },\r\n        ]);\r\n        expect(actor?.items.contents.length).equal(1);\r\n        expect(actor?.items.contents[0].name).equal(`test ${type}`);\r\n        // eslint-disable-next-line no-underscore-dangle\r\n        const itemId = actor?.items.contents[0].id;\r\n        expect(actor?.system[getter].length).equal(1);\r\n        // eslint-disable-next-line no-underscore-dangle\r\n        expect(actor?.system[getter][0]._id).equal(itemId);\r\n        actor?.delete();\r\n      });\r\n\r\n      it(`returns all ${getter} except ones in container`, async () => {\r\n        if (getter === \"abilities\") return;\r\n        const actor = await createMockActor();\r\n        expect(actor?.items.contents.length).equal(0);\r\n        expect(actor?.system[getter].length).equal(0);\r\n        await actor?.createEmbeddedDocuments(\"Item\", [\r\n          {\r\n            type: \"container\",\r\n            name: \"test container\",\r\n          },\r\n        ]);\r\n        const container = actor?.items.getName(\"test container\");\r\n        await actor?.createEmbeddedDocuments(\"Item\", [\r\n          // eslint-disable-next-line no-underscore-dangle\r\n          {\r\n            type,\r\n            name: `test ${type} in container`,\r\n            system: { containerId: container?.id },\r\n          },\r\n          {\r\n            type,\r\n            name: `test ${type}`,\r\n          },\r\n        ]);\r\n        expect(actor?.items.contents.length).equal(3);\r\n        expect(actor?.items.contents[0].name).equal(\"test container\");\r\n        expect(actor?.items.contents[1].name).equal(\r\n          `test ${type} in container`\r\n        );\r\n        expect(actor?.items.contents[2].name).equal(`test ${type}`);\r\n        // eslint-disable-next-line no-underscore-dangle\r\n        const itemId = actor?.items.contents[2].id;\r\n        expect(actor?.system[getter].length).equal(1);\r\n        // eslint-disable-next-line no-underscore-dangle\r\n        expect(actor?.system[getter][0]._id).equal(itemId);\r\n        actor?.delete();\r\n      });\r\n    });\r\n\r\n    after(() => {\r\n      cleanUpActorsByKey(key);\r\n    });\r\n  });\r\n\r\n  describe(\"attackPatterns()\", () => {\r\n    it(\"returns all weapons and abilities in transparent when no pattern set\", async () => {\r\n      const actor = await createMockActor();\r\n      await actor?.createEmbeddedDocuments(\"Item\", [\r\n        // eslint-disable-next-line no-underscore-dangle\r\n        {\r\n          type: \"ability\",\r\n          name: \"test ability\",\r\n        },\r\n        {\r\n          type: \"weapon\",\r\n          name: \"test weapon\",\r\n        },\r\n      ]);\r\n      expect(Object.keys(actor?.system.attackPatterns).length).equal(1);\r\n      expect(Object.keys(actor?.system.attackPatterns)).contain(\"transparent\");\r\n      expect(actor?.system.attackPatterns.transparent.length).equal(2);\r\n      expect(actor?.system.attackPatterns.transparent[0].name).equal(\r\n        \"test weapon\"\r\n      );\r\n      expect(actor?.system.attackPatterns.transparent[1].name).equal(\r\n        \"test ability\"\r\n      );\r\n    });\r\n\r\n    it(\"returns separated weapons and abilities whith patterns patterns\", async () => {\r\n      const actor = await createMockActor();\r\n      await actor?.createEmbeddedDocuments(\"Item\", [\r\n        // eslint-disable-next-line no-underscore-dangle\r\n        {\r\n          type: \"ability\",\r\n          name: \"test ability green\",\r\n          system: { pattern: \"green\" },\r\n        },\r\n        {\r\n          type: \"weapon\",\r\n          name: \"test weapon green\",\r\n          system: { pattern: \"green\" },\r\n        },\r\n        {\r\n          type: \"ability\",\r\n          name: \"test ability\",\r\n        },\r\n        {\r\n          type: \"weapon\",\r\n          name: \"test weapon\",\r\n        },\r\n      ]);\r\n      expect(Object.keys(actor?.system.attackPatterns).length).equal(2);\r\n      expect(Object.keys(actor?.system.attackPatterns)).contain(\"transparent\");\r\n      expect(Object.keys(actor?.system.attackPatterns)).contain(\"green\");\r\n      expect(actor?.system.attackPatterns.transparent.length).equal(2);\r\n      expect(actor?.system.attackPatterns.transparent[0].name).equal(\r\n        \"test ability\"\r\n      );\r\n      expect(actor?.system.attackPatterns.transparent[1].name).equal(\r\n        \"test weapon\"\r\n      );\r\n      expect(actor?.system.attackPatterns.green.length).equal(2);\r\n      expect(actor?.system.attackPatterns.green[0].name).equal(\r\n        \"test weapon green\"\r\n      );\r\n      expect(actor?.system.attackPatterns.green[1].name).equal(\r\n        \"test ability green\"\r\n      );\r\n    });\r\n  });\r\n\r\n  describe(\"isSlow()\", () => {\r\n    it(\"returns false if no weapons\", async () => {\r\n      const actor = await createMockActor();\r\n      expect(actor?.system.isSlow).is.false;\r\n      actor?.delete();\r\n    });\r\n\r\n    it(\"returns false if weapon that doesn't have slow tag\", async () => {\r\n      const actor = await createMockActor();\r\n      expect(actor?.items.contents.length).equal(0);\r\n      await actor?.createEmbeddedDocuments(\"Item\", [\r\n        {\r\n          type: \"weapon\",\r\n          name: \"test weapon\",\r\n          system: { slow: false },\r\n        },\r\n      ]);\r\n      expect(actor?.items.contents.length).equal(1);\r\n      expect(actor?.items.contents[0].name).equal(\"test weapon\");\r\n      expect(actor?.system.isSlow).is.false;\r\n      actor?.delete();\r\n    });\r\n\r\n    it(\"returns true if weapon that has slow tag\", async () => {\r\n      const actor = await createMockActor();\r\n      expect(actor?.items.contents.length).equal(0);\r\n      await actor?.createEmbeddedDocuments(\"Item\", [\r\n        {\r\n          type: \"weapon\",\r\n          name: \"test weapon\",\r\n          system: { slow: true },\r\n        },\r\n      ]);\r\n      expect(actor?.items.contents.length).equal(1);\r\n      expect(actor?.items.contents[0].name).equal(\"test weapon\");\r\n      expect(actor?.system.isSlow).is.true;\r\n      actor?.delete();\r\n    });\r\n\r\n    after(() => {\r\n      cleanUpActorsByKey(key);\r\n    });\r\n  });\r\n\r\n  describe(\"init()\", () => {\r\n    before(async () => {\r\n      await game.settings.set(game.system.id, \"initiative\", \"individual\");\r\n      // @todo: tests fails if scores.dex.init isn't initiated\r\n      // dataModel.scores.dex = { init: 0 };\r\n    });\r\n\r\n    it(\"returns 0 by default\", () => {\r\n      expect(dataModel.initiative.value).equal(0);\r\n      expect(dataModel.initiative.mod).equal(0);\r\n      expect(dataModel.scores.dex.init).equal(0);\r\n      expect(dataModel.init).equal(0);\r\n    });\r\n\r\n    it(\"returns correctly with initiative value set\", async () => {\r\n      dataModel.initiative.value = 12;\r\n      expect(dataModel.init).equal(12);\r\n      dataModel.initiative.value = 0;\r\n      expect(dataModel.initiative.value).equal(0);\r\n    });\r\n\r\n    it(\"returns correctly with initiative mod set\", async () => {\r\n      dataModel.initiative.mod = 10;\r\n      expect(dataModel.init).equal(10);\r\n      dataModel.initiative.mod = 0;\r\n      expect(dataModel.initiative.mod).equal(0);\r\n    });\r\n\r\n    it(\"returns correctly with dex mod init set\", async () => {\r\n      dataModel.scores.dex = { init: 5 };\r\n      expect(dataModel.init).equal(5);\r\n      dataModel.scores.dex.init = 0;\r\n      expect(dataModel.scores.dex.init).equal(0);\r\n    });\r\n  });\r\n};\r\n","// eslint-disable-next-line eslint-comments/disable-enable-pair\r\n\r\n/* eslint-disable simple-import-sort/imports */\r\n\r\n/**\r\n * @file Contains tests for Actor Entity.\r\n */\r\n// eslint-disable-next-line import/no-cycle\r\nimport OseItem from \"../../item/entity\";\r\n\r\nimport * as e2e from \"../../../e2e\";\r\nimport {\r\n  cleanUpActorsByKey,\r\n  cleanUpScenes,\r\n  cleanUpWorldItems,\r\n  createMockScene,\r\n  createWorldTestItem,\r\n  itemTypes,\r\n  trashChat,\r\n  waitForInput,\r\n} from \"../../../e2e/testUtils\";\r\nimport OseActor from \"../entity\";\r\n\r\nexport const key = \"ose.actor.entity\";\r\nexport const options = {\r\n  displayName: \"OSE: Actor: Entity\",\r\n  preSelected: true,\r\n};\r\n\r\nconst createMockActor = async (type: string) =>\r\n  OseActor.create({\r\n    name: `Test Actor ${key}`,\r\n    type,\r\n  });\r\n\r\nexport default ({\r\n  describe,\r\n  it,\r\n  expect,\r\n  after,\r\n  afterEach,\r\n  before,\r\n  assert,\r\n}: e2e.QuenchMethods) => {\r\n  afterEach(async () => {\r\n    await trashChat();\r\n    cleanUpActorsByKey(key);\r\n    cleanUpWorldItems();\r\n  });\r\n\r\n  describe(\"update(data, options)\", () => {\r\n    // @todo: Write tests\r\n    it(\"AAC to AC\", async () => {\r\n      const actor = await createMockActor(\"character\");\r\n      expect(actor?.system.ac.value).equal(12);\r\n      expect(actor?.system.aac.value).equal(7);\r\n      await actor?.system.update({ ac: { value: 15 } });\r\n      await waitForInput();\r\n      expect(actor?.system.ac.value).equal(15);\r\n      expect(actor?.system.aac.value).equal(19 - 15);\r\n    });\r\n\r\n    it(\"AC to AAC\", async () => {\r\n      const actor = await createMockActor(\"character\");\r\n      expect(actor?.system.ac.value).equal(12);\r\n      expect(actor?.system.aac.value).equal(7);\r\n      await actor?.system.update({ aac: { value: 15 } });\r\n      await waitForInput();\r\n      expect(actor?.system.aac.value).equal(15);\r\n      expect(actor?.system.ac.value).equal(19 - 15);\r\n    });\r\n\r\n    it(\"THAC0 to BBA\", async () => {\r\n      const actor = await createMockActor(\"character\");\r\n      expect(actor?.system.thac0.value).equal(12);\r\n      expect(actor?.system.thac0.value).equal(7);\r\n      await actor?.system.update({ thac0: { value: 15 } });\r\n      await waitForInput();\r\n      expect(actor?.system.thac0.value).equal(15);\r\n      expect(actor?.system.thac0.value).equal(19 - 15);\r\n    });\r\n\r\n    it(\"BBA to THAC0\", async () => {\r\n      const actor = await createMockActor(\"character\");\r\n      expect(actor?.system.thac0.value).equal(12);\r\n      expect(actor?.system.thac0.value).equal(7);\r\n      await actor?.system.update({ thac0: { bba: 15 } });\r\n      await waitForInput();\r\n      expect(actor?.system.thac0.value).equal(15);\r\n      expect(actor?.system.thac0.value).equal(19 - 15);\r\n    });\r\n  });\r\n\r\n  describe(\"createEmbeddedDocuments(embeddedName, data, context)\", () => {\r\n    after(async () => {\r\n      game.items\r\n        ?.filter((i) => i?.name?.indexOf(`Test ${key}`) >= 0)\r\n        .forEach((i) => i.delete());\r\n    });\r\n    itemTypes.forEach((itemType) => {\r\n      it(`Creates ${itemType.capitalize()} with correct default icon`, async () => {\r\n        const actor = await createMockActor(\"character\");\r\n        const item = (await OseItem.create({\r\n          name: `Test ${key} ${itemType.capitalize()}`,\r\n          type: itemType,\r\n        })) as OseItem;\r\n        await actor?.createEmbeddedDocuments(\"Item\", [item]);\r\n        const actorItem = actor?.items.getName(item?.name);\r\n        expect(actorItem?.img).equal(OseItem.defaultIcons[itemType]);\r\n        item?.delete();\r\n      });\r\n    });\r\n  });\r\n\r\n  describe(\"getExperience(value, options)\", () => {\r\n    afterEach(async () => {\r\n      await trashChat();\r\n    });\r\n\r\n    it(\"Adding positive XP adds to experience\", async () => {\r\n      const actor = (await createMockActor(\"character\")) as OseActor;\r\n      expect(actor?.system.details.xp.value).equal(0);\r\n      expect(game.messages?.size).equal(0);\r\n      await actor?.getExperience(10);\r\n      expect(actor?.system.details.xp.value).equal(10);\r\n      await waitForInput();\r\n      expect(game.messages?.size).equal(1);\r\n      await actor?.delete();\r\n    });\r\n\r\n    it(\"Adding negative XP subtracts from experience\", async () => {\r\n      const actor = (await createMockActor(\"character\")) as OseActor;\r\n      expect(actor?.system.details.xp.value).equal(0);\r\n      expect(game.messages?.size).equal(0);\r\n      await actor?.getExperience(-10);\r\n      expect(actor?.system.details.xp.value).equal(-10);\r\n      await waitForInput();\r\n      expect(game.messages?.size).equal(1);\r\n      await actor?.delete();\r\n    });\r\n\r\n    it(\"Adding positive XP adds to experience modified by bonus\", async () => {\r\n      const actor = (await createMockActor(\"character\")) as OseActor;\r\n      await actor?.update({ system: { details: { xp: { bonus: 10 } } } });\r\n      expect(actor?.system.details.xp.value).equal(0);\r\n      expect(game.messages?.size).equal(0);\r\n      await actor?.getExperience(10);\r\n      expect(actor?.system.details.xp.value).equal(11);\r\n      await waitForInput();\r\n      expect(game.messages?.size).equal(1);\r\n      await actor?.delete();\r\n    });\r\n  });\r\n\r\n  describe(\"isNew()\", () => {\r\n    it(\"character\", async () => {\r\n      const actor = (await createMockActor(\"character\")) as OseActor;\r\n      expect(actor?.isNew()).equal(true);\r\n      await actor?.delete();\r\n    });\r\n\r\n    it(\"monster\", async () => {\r\n      const actor = (await createMockActor(\"monster\")) as OseActor;\r\n      expect(actor?.isNew()).equal(true);\r\n      await actor?.delete();\r\n    });\r\n  });\r\n\r\n  describe(\"generateSave(hd)\", async () => {\r\n    const saves = [\r\n      {\r\n        low: -99,\r\n        high: 1,\r\n        death: 14,\r\n        wands: 15,\r\n        paralysis: 16,\r\n        breath: 17,\r\n        spell: 18,\r\n      },\r\n      {\r\n        low: 1,\r\n        high: 3,\r\n        death: 12,\r\n        wands: 13,\r\n        paralysis: 14,\r\n        breath: 15,\r\n        spell: 16,\r\n      },\r\n      {\r\n        low: 4,\r\n        high: 6,\r\n        death: 10,\r\n        wands: 11,\r\n        paralysis: 12,\r\n        breath: 13,\r\n        spell: 14,\r\n      },\r\n      {\r\n        low: 7,\r\n        high: 9,\r\n        death: 8,\r\n        wands: 9,\r\n        paralysis: 10,\r\n        breath: 10,\r\n        spell: 12,\r\n      },\r\n      {\r\n        low: 10,\r\n        high: 12,\r\n        death: 6,\r\n        wands: 7,\r\n        paralysis: 8,\r\n        breath: 8,\r\n        spell: 10,\r\n      },\r\n      {\r\n        low: 10,\r\n        high: 12,\r\n        death: 6,\r\n        wands: 7,\r\n        paralysis: 8,\r\n        breath: 8,\r\n        spell: 10,\r\n      },\r\n      {\r\n        low: 13,\r\n        high: 15,\r\n        death: 4,\r\n        wands: 5,\r\n        paralysis: 6,\r\n        breath: 5,\r\n        spell: 8,\r\n      },\r\n      {\r\n        low: 16,\r\n        high: 18,\r\n        death: 2,\r\n        wands: 3,\r\n        paralysis: 4,\r\n        breath: 3,\r\n        spell: 6,\r\n      },\r\n      {\r\n        low: 19,\r\n        high: 21,\r\n        death: 2,\r\n        wands: 2,\r\n        paralysis: 2,\r\n        breath: 2,\r\n        spell: 4,\r\n      },\r\n      {\r\n        low: 22,\r\n        high: 99,\r\n        death: 2,\r\n        wands: 2,\r\n        paralysis: 2,\r\n        breath: 2,\r\n        spell: 2,\r\n      },\r\n    ];\r\n\r\n    const thac0 = [\r\n      { low: -100, high: 0, value: 20 },\r\n      { low: 0, high: 1, value: 19 },\r\n      { low: 1, high: 2, value: 18 },\r\n      { low: 2, high: 3, value: 17 },\r\n      { low: 3, high: 4, value: 16 },\r\n      { low: 4, high: 5, value: 15 },\r\n      { low: 5, high: 6, value: 14 },\r\n      { low: 6, high: 7, value: 13 },\r\n      { low: 7, high: 9, value: 12 },\r\n      { low: 9, high: 11, value: 11 },\r\n      { low: 11, high: 13, value: 1 },\r\n      { low: 13, high: 15, value: 9 },\r\n      { low: 15, high: 17, value: 8 },\r\n      { low: 17, high: 19, value: 7 },\r\n      { low: 19, high: 21, value: 6 },\r\n      { low: 21, high: 100, value: 5 },\r\n    ];\r\n\r\n    const scoreSpread = Array.from({ length: 23 }, (_el, idx) => idx + 1);\r\n\r\n    const actor = (await createMockActor(\"monster\")) as OseActor;\r\n\r\n    scoreSpread.forEach((hd) => {\r\n      const savesData = saves.find((s) => hd >= s.low && hd <= s.high);\r\n      const thac0Data = thac0.find((s) => hd >= s.low && hd <= s.high);\r\n      const thac0PlusData = thac0.find(\r\n        (s) => hd + 1 >= s.low && hd + 1 <= s.high\r\n      );\r\n      actor?.generateSave(`${hd}`);\r\n\r\n      it(`hd ${hd} generates correct saves`, () => {\r\n        expect(actor?.system.saves.death.value).equal(savesData?.death);\r\n        expect(actor?.system.saves.wand.value).equal(savesData?.wands);\r\n        expect(actor?.system.saves.paralysis.value).equal(savesData?.paralysis);\r\n        expect(actor?.system.saves.breath.value).equal(savesData?.breath);\r\n        expect(actor?.system.saves.spell.value).equal(savesData?.spell);\r\n      });\r\n\r\n      it(`hd ${hd} generates correct thac0`, () => {\r\n        expect(actor?.system.thac0.value).equal(thac0Data?.value);\r\n        expect(actor?.system.thac0.bba).equal(19 - thac0Data?.value);\r\n      });\r\n\r\n      actor?.generateSave(`${hd}+`);\r\n      it(`hd ${hd}+ generates correct thac0`, () => {\r\n        expect(actor?.system.thac0.value).equal(thac0PlusData?.value);\r\n        expect(actor?.system.thac0.bba).equal(19 - thac0PlusData?.value);\r\n      });\r\n    });\r\n\r\n    await actor?.delete();\r\n  });\r\n\r\n  describe(\"rollHP(options)\", async () => {\r\n    const actor = (await createMockActor(\"monster\")) as OseActor;\r\n    const conScoreSpread = Array.from({ length: 20 }, (_el, idx) => idx + 1);\r\n    const conBonusSpread = [\r\n      -3, -3, -3, -2, -2, -1, -1, -1, 0, 0, 0, 0, 1, 1, 1, 2, 2, 3, 3, 3,\r\n    ];\r\n    const hdSpread = [4, 6, 8, 10, 12, 20];\r\n    conScoreSpread.forEach((con, idx) => {\r\n      hdSpread.forEach((hd) => {\r\n        it(`${hd} hd with ${con} Con correctly rolls HP`, async () => {\r\n          await actor?.update({\r\n            system: { hp: { hd: `1d${hd}` }, scores: { con: { value: con } } },\r\n          });\r\n          await actor?.rollHP();\r\n          assert(actor?.system.hp.max - conBonusSpread[idx] >= 1);\r\n          assert(actor?.system.hp.value - conBonusSpread[idx] >= 1);\r\n          assert(actor?.system.hp.max - conBonusSpread[idx] >= hd);\r\n          assert(actor?.system.hp.value - conBonusSpread[idx] >= hd);\r\n        });\r\n      });\r\n    });\r\n    await actor?.delete();\r\n  });\r\n\r\n  describe(\"rollSave(save, options)\", () => {\r\n    afterEach(async () => {\r\n      await trashChat();\r\n    });\r\n\r\n    const saves = [\"death\", \"wand\", \"paralysis\", \"breath\", \"spell\"];\r\n    saves.forEach((save) => {\r\n      it(`is functional for ${save} saves on character`, async () => {\r\n        const actor = (await createMockActor(\"character\")) as OseActor;\r\n        expect(game.messages?.size).equal(0);\r\n        await actor?.rollSave(save, { fastForward: true });\r\n        await waitForInput();\r\n        expect(game.messages?.size).equal(1);\r\n        await actor?.delete();\r\n      });\r\n\r\n      it(`is functional for ${save} saves on monster`, async () => {\r\n        const actor = (await createMockActor(\"monster\")) as OseActor;\r\n        expect(game.messages?.size).equal(0);\r\n        await actor.rollSave(save, { fastForward: true });\r\n        await waitForInput();\r\n        expect(game.messages?.size).equal(1);\r\n        await actor?.delete();\r\n      });\r\n    });\r\n  });\r\n\r\n  describe(\"rollMorale(options)\", () => {\r\n    afterEach(async () => {\r\n      await trashChat();\r\n    });\r\n\r\n    it(\"for character\", async () => {\r\n      const actor = (await createMockActor(\"character\")) as OseActor;\r\n      expect(game.messages?.size).equal(0);\r\n      await actor.rollMorale();\r\n      await waitForInput();\r\n      expect(game.messages?.size).equal(1);\r\n      await actor?.delete();\r\n    });\r\n\r\n    it(\"for monster\", async () => {\r\n      const actor = (await createMockActor(\"monster\")) as OseActor;\r\n      expect(game.messages?.size).equal(0);\r\n      await actor.rollMorale();\r\n      await waitForInput();\r\n      expect(game.messages?.size).equal(1);\r\n      await actor?.delete();\r\n    });\r\n  });\r\n\r\n  describe(\"rollLoyalty(options)\", () => {\r\n    afterEach(async () => {\r\n      await trashChat();\r\n    });\r\n\r\n    it(\"for character\", async () => {\r\n      const actor = (await createMockActor(\"character\")) as OseActor;\r\n      expect(game.messages?.size).equal(0);\r\n      await actor.rollLoyalty();\r\n      await waitForInput();\r\n      expect(game.messages?.size).equal(1);\r\n      await actor?.delete();\r\n    });\r\n\r\n    it(\"for monster\", async () => {\r\n      const actor = (await createMockActor(\"monster\")) as OseActor;\r\n      expect(game.messages?.size).equal(0);\r\n      await actor.rollLoyalty();\r\n      await waitForInput();\r\n      expect(game.messages?.size).equal(1);\r\n      await actor?.delete();\r\n    });\r\n  });\r\n\r\n  describe(\"rollReaction(options)\", () => {\r\n    afterEach(async () => {\r\n      await trashChat();\r\n    });\r\n\r\n    it(\"for character\", async () => {\r\n      const actor = (await createMockActor(\"character\")) as OseActor;\r\n      expect(game.messages?.size).equal(0);\r\n      await actor.rollReaction({ fastForward: true });\r\n      await waitForInput();\r\n      expect(game.messages?.size).equal(1);\r\n      await actor.delete();\r\n    });\r\n\r\n    it(\"for monster\", async () => {\r\n      const actor = (await createMockActor(\"monster\")) as OseActor;\r\n      expect(game.messages?.size).equal(0);\r\n      await actor.rollReaction({ fastForward: true });\r\n      await waitForInput();\r\n      expect(game.messages?.size).equal(1);\r\n      await actor.delete();\r\n    });\r\n  });\r\n\r\n  describe(\"rollCheck(score, options)\", () => {\r\n    const scores = [\"str\", \"int\", \"dex\", \"wis\", \"con\", \"cha\"];\r\n\r\n    afterEach(async () => {\r\n      await trashChat();\r\n    });\r\n\r\n    scores.forEach((score) => {\r\n      it(`${score} for character`, async () => {\r\n        const actor = (await createMockActor(\"character\")) as OseActor;\r\n        expect(game.messages?.size).equal(0);\r\n        await actor.rollCheck(score, { fastForward: true });\r\n        await waitForInput();\r\n        expect(game.messages?.size).equal(1);\r\n        await actor.delete();\r\n      });\r\n\r\n      it(`${score} for character`, async () => {\r\n        const actor = (await createMockActor(\"monster\")) as OseActor;\r\n        expect(game.messages?.size).equal(0);\r\n        await actor.rollCheck(score, { fastForward: true });\r\n        await waitForInput();\r\n        expect(game.messages?.size).equal(0);\r\n        await actor.delete();\r\n      });\r\n    });\r\n  });\r\n\r\n  describe(\"rollHitDice(options)\", () => {\r\n    const conScoreSpread = Array.from({ length: 20 }, (_el, idx) => idx + 1);\r\n    const conBonusSpread = [\r\n      -3, -3, -3, -2, -2, -1, -1, -1, 0, 0, 0, 0, 1, 1, 1, 2, 2, 3, 3, 3,\r\n    ];\r\n    const levelSpread = Array.from({ length: 9 }, (_el, idx) => idx + 1);\r\n\r\n    conScoreSpread.forEach((con, idx) => {\r\n      const conMod = conBonusSpread[idx];\r\n      const expectedTerms = conMod >= 0 ? 5 : 6;\r\n      const modSign = conMod < 0 ? \"-\" : \"+\";\r\n      const modUnsigned = modSign === \"-\" ? conMod * -1 : conMod;\r\n      levelSpread.forEach((level) => {\r\n        it(`constructs the roll terms correctly with level ${level} and con ${con}`, async () => {\r\n          const actor = (await createMockActor(\"character\")) as OseActor;\r\n          await actor?.update({\r\n            system: { details: { level }, scores: { con: { value: con } } },\r\n          });\r\n          const roll = await actor.rollHitDice();\r\n\r\n          expect(roll.terms.length).equal(expectedTerms);\r\n          expect(roll.terms[0].expression).equal(actor?.system.hp.hd);\r\n          if (conMod < 0) {\r\n            expect(roll.terms[expectedTerms - 5].operator).equal(\"+\");\r\n          }\r\n          expect(roll.terms[expectedTerms - 4].operator).equal(modSign);\r\n          expect(roll.terms[expectedTerms - 3].expression).equal(\r\n            modUnsigned.toString()\r\n          );\r\n          expect(roll.terms[expectedTerms - 2].operator).equal(\"+\");\r\n          expect(roll.terms[expectedTerms - 1].expression).equal(\r\n            level.toString()\r\n          );\r\n          expect(actor?.system.scores.con.mod).equal(conMod);\r\n          await actor?.delete();\r\n        });\r\n      });\r\n    });\r\n  });\r\n\r\n  describe(\"rollAppearing(options)\", () => {\r\n    afterEach(async () => {\r\n      await trashChat();\r\n    });\r\n\r\n    it(\"for character\", async () => {\r\n      const actor = (await createMockActor(\"character\")) as OseActor;\r\n      expect(game.messages?.size).equal(0);\r\n      await actor.rollAppearing();\r\n      await waitForInput();\r\n      expect(game.messages?.size).equal(0);\r\n      await actor.delete();\r\n    });\r\n\r\n    describe(\"for monster\", () => {\r\n      it(\"in wilderness\", async () => {\r\n        const actor = (await createMockActor(\"monster\")) as OseActor;\r\n        expect(game.messages?.size).equal(0);\r\n        await actor.rollAppearing({ check: \"wilderness\" });\r\n        await waitForInput();\r\n        expect(game.messages?.size).equal(1);\r\n        expect(game.messages?.contents[0].content).contain(\r\n          game.i18n.format(\"OSE.roll.appearing\", { type: \"(2)\" })\r\n        );\r\n        await actor.delete();\r\n      });\r\n\r\n      it(\"in other\", async () => {\r\n        const actor = (await createMockActor(\"monster\")) as OseActor;\r\n        expect(game.messages?.size).equal(0);\r\n        await actor.rollAppearing({ check: \"other\" });\r\n        await waitForInput();\r\n        expect(game.messages?.size).equal(1);\r\n        expect(game.messages?.contents[0].content).contain(\r\n          game.i18n.format(\"OSE.roll.appearing\", { type: \"(1)\" })\r\n        );\r\n        await actor.delete();\r\n      });\r\n    });\r\n  });\r\n\r\n  describe(\"rollExploration(expl, options)\", () => {\r\n    afterEach(async () => {\r\n      await trashChat();\r\n    });\r\n\r\n    const explorationOptions = [\"ld\", \"od\", \"sd\", \"fs\"];\r\n    explorationOptions.forEach((expl) => {\r\n      it(\"for character\", async () => {\r\n        const actor = (await createMockActor(\"character\")) as OseActor;\r\n        expect(game.messages?.size).equal(0);\r\n        await actor.rollExploration(expl, { fastForward: true });\r\n        await waitForInput();\r\n        expect(game.messages?.contents[0].content).contain(\r\n          game.i18n.format(\"OSE.roll.exploration\", {\r\n            exploration: game.i18n.localize(`OSE.exploration.${expl}.long`),\r\n          })\r\n        );\r\n        await actor.delete();\r\n      });\r\n    });\r\n\r\n    it(\"for monster\", async () => {\r\n      const actor = (await createMockActor(\"monster\")) as OseActor;\r\n      expect(game.messages?.size).equal(0);\r\n      await actor.rollExploration(\"ld\", { fastForward: true });\r\n      await waitForInput();\r\n      expect(game.messages?.size).equal(0);\r\n      await actor.delete();\r\n    });\r\n  });\r\n\r\n  describe(\"rollDamage(attData, options)\", () => {\r\n    afterEach(async () => {\r\n      await trashChat();\r\n    });\r\n\r\n    it(\"for character\", async () => {\r\n      const actor = (await createMockActor(\"character\")) as OseActor;\r\n      expect(game.messages?.size).equal(0);\r\n      await actor.rollDamage({ label: \"test\" });\r\n      await waitForInput();\r\n      expect(game.messages?.size).equal(1);\r\n      expect(game.messages?.contents[0].content).contain(\r\n        `test - ${game.i18n.localize(\"OSE.Damage\")}`\r\n      );\r\n      await actor.delete();\r\n    });\r\n\r\n    it(\"for monster\", async () => {\r\n      const actor = (await createMockActor(\"monster\")) as OseActor;\r\n      expect(game.messages?.size).equal(0);\r\n      await actor.rollDamage({ label: \"test\" });\r\n      await waitForInput();\r\n      expect(game.messages?.size).equal(1);\r\n      expect(game.messages?.contents[0].content).contain(\r\n        `test - ${game.i18n.localize(\"OSE.Damage\")}`\r\n      );\r\n      await actor.delete();\r\n    });\r\n\r\n    it(\"Adds roll.dmg to damage parts if provided\", async () => {\r\n      const actor = (await createMockActor(\"character\")) as OseActor;\r\n      expect(game.messages?.size).equal(0);\r\n      await actor.rollDamage({\r\n        label: \"test\",\r\n        roll: { dmg: \"15\" },\r\n      });\r\n      await waitForInput();\r\n      expect(game.messages?.size).equal(1);\r\n      expect(game.messages?.contents[0].content).contain(\r\n        `test - ${game.i18n.localize(\"OSE.Damage\")}`\r\n      );\r\n      expect(game.messages?.contents[0].content).contain(\"15\");\r\n      await actor.delete();\r\n    });\r\n\r\n    it(\"Adds strength bonus if melee damage roll\", async () => {\r\n      const actor = (await createMockActor(\"character\")) as OseActor;\r\n      await actor?.update({ system: { scores: { str: { value: 1 } } } });\r\n      expect(actor.system.scores.str.value).equal(1);\r\n      expect(game.messages?.size).equal(0);\r\n      await actor.rollDamage({\r\n        label: \"test\",\r\n        roll: { dmg: \"15\", type: \"melee\" },\r\n      });\r\n      await waitForInput();\r\n      expect(game.messages?.size).equal(1);\r\n      expect(game.messages?.contents[0].content).contain(\r\n        `test - ${game.i18n.localize(\"OSE.Damage\")}`\r\n      );\r\n      expect(game.messages?.contents[0].content).contain(\"15 +  - 3\");\r\n      await actor.delete();\r\n    });\r\n  });\r\n\r\n  describe(\"targetAttack(data, type, options)\", () => {\r\n    before(async () => {\r\n      const scene = await createMockScene();\r\n      await scene?.activate();\r\n    });\r\n\r\n    afterEach(async () => {\r\n      await trashChat();\r\n    });\r\n\r\n    it(\"One target causes one attack roll\", async () => {\r\n      const actor = (await createMockActor(\"character\")) as OseActor;\r\n      const token = await actor.getTokenDocument();\r\n      await canvas.scene?.createEmbeddedDocuments(\"Token\", [token]);\r\n      await waitForInput();\r\n      expect(game.user?.targets.size).equal(0);\r\n      canvas.tokens?.placeables.forEach((t) =>\r\n        t.setTarget(true, { releaseOthers: false, groupSelection: true })\r\n      );\r\n      expect(canvas.tokens?.placeables[0].actor).not.null;\r\n      expect(canvas.tokens?.placeables[0].actor?.system.ac.value).not.null;\r\n      expect(game.user?.targets.size).equal(1);\r\n      expect(game.messages?.size).equal(0);\r\n      await actor.targetAttack({ roll: { target: {} } }, \"melee\", {\r\n        skipDialog: true,\r\n      });\r\n      await waitForInput();\r\n      expect(game.messages?.size).equal(1);\r\n      canvas.tokens?.placeables[0].setTarget(false, { releaseOthers: true });\r\n      expect(game.user?.targets.size).equal(0);\r\n      await actor.delete();\r\n    });\r\n\r\n    it(\"Multiple target causes multiple attack rolls\", async () => {\r\n      const actor = (await createMockActor(\"character\")) as OseActor;\r\n      const token = await actor.getTokenDocument();\r\n      await canvas.scene?.createEmbeddedDocuments(\"Token\", [token]);\r\n      await waitForInput();\r\n      expect(game.user?.targets.size).equal(0);\r\n      canvas.tokens?.placeables.forEach((t) =>\r\n        t.setTarget(true, { releaseOthers: false, groupSelection: true })\r\n      );\r\n      expect(game.user?.targets.size).equal(2);\r\n      expect(game.messages?.size).equal(0);\r\n      await actor.targetAttack({ roll: { target: {} } }, \"melee\", {\r\n        skipDialog: true,\r\n      });\r\n      await waitForInput();\r\n      expect(game.messages?.size).equal(2);\r\n      canvas.tokens?.placeables[0].setTarget(false, { releaseOthers: true });\r\n      expect(game.user?.targets.size).equal(0);\r\n      await actor.delete();\r\n    });\r\n\r\n    it(\"If no target is given, just roll attack\", async () => {\r\n      const data = {\r\n        roll: {\r\n          blindroll: false,\r\n          dmg: [\"1d6\"],\r\n          thac0: 15,\r\n          target: {\r\n            actor: { system: { ac: { value: 0 }, aac: { value: 9 } } },\r\n          },\r\n        },\r\n      };\r\n      const actor = (await createMockActor(\"character\")) as OseActor;\r\n      expect(game.user?.targets.size).equal(0);\r\n      expect(game.messages?.size).equal(0);\r\n      await actor.targetAttack(data, \"melee\", { skipDialog: true });\r\n      await waitForInput();\r\n      expect(game.messages?.size).equal(1);\r\n      await actor.delete();\r\n    });\r\n\r\n    after(() => {\r\n      cleanUpScenes();\r\n    });\r\n  });\r\n\r\n  describe(\"rollAttack(attdata, options)\", () => {\r\n    before(async () => {\r\n      await trashChat();\r\n    });\r\n\r\n    afterEach(async () => {\r\n      await trashChat();\r\n    });\r\n\r\n    it(\"rolls a d20 if supplied no data\", async () => {\r\n      const actor = (await createMockActor(\"character\")) as OseActor;\r\n      expect(game.messages?.size).equal(0);\r\n      const rolldata = await actor.rollAttack(\r\n        { roll: {} },\r\n        { skipDialog: true }\r\n      );\r\n      expect(rolldata.formula).equal(\"1d20\");\r\n      await waitForInput();\r\n      expect(game.messages?.size).equal(1);\r\n      await actor.delete();\r\n    });\r\n\r\n    it(\"Provided an item, adds item damage to dmgParts\", async () => {\r\n      // @todo: How to verify the item is being rolled?\r\n      /* const actor = await createMockActor(\"character\");\r\n      const item = await createWorldTestItem(\"weapon\");\r\n      expect(item?.system.damage).is.not.undefined;\r\n      expect(game.messages?.size).equal(0);\r\n      const rolldata = await actor.rollAttack({ roll: {}, item }, { skipDialog: true });\r\n      expect(rolldata.formula).equal(\"1d20\");\r\n      await waitForInput();\r\n      expect(game.messages?.size).equal(1);\r\n      actor?.delete();\r\n      item?.delete(); */\r\n    });\r\n\r\n    it(\"If missile attack, add dex mod to attack roll\", async () => {\r\n      const actor = (await createMockActor(\"character\")) as OseActor;\r\n      expect(game.messages?.size).equal(0);\r\n      const rolldata = await actor.rollAttack(\r\n        { roll: {} },\r\n        { type: \"missile\", skipDialog: true }\r\n      );\r\n      expect(rolldata.formula).equal(\"1d20 +  - 3 + 0\");\r\n      await waitForInput();\r\n      expect(game.messages?.size).equal(1);\r\n      await actor.delete();\r\n    });\r\n\r\n    it(\"If melee attack, add str mod to attack roll\", async () => {\r\n      const actor = (await createMockActor(\"character\")) as OseActor;\r\n      await actor.update({ system: { scores: { str: { value: 18 } } } });\r\n      expect(game.messages?.size).equal(0);\r\n      const rolldata = await actor.rollAttack(\r\n        { roll: {} },\r\n        { type: \"melee\", skipDialog: true }\r\n      );\r\n      expect(rolldata.formula).equal(\"1d20 + 3 + 0\");\r\n      await waitForInput();\r\n      expect(game.messages?.size).equal(1);\r\n      await actor.delete();\r\n    });\r\n\r\n    // @todo: How to verify if possible to miss, thus obfuscating dmg roll?\r\n    it(\"If melee attack, add str mod to damage roll\", async () => {});\r\n\r\n    it(\"If item provided with a bonus, it is added as bonus to attack roll\", async () => {\r\n      const actor = (await createMockActor(\"character\")) as OseActor;\r\n      const item = await createWorldTestItem(\"weapon\");\r\n      await item?.update({ system: { bonus: 18 } });\r\n      expect(game.messages?.size).equal(0);\r\n      const rolldata = await actor.rollAttack(\r\n        { roll: {}, item },\r\n        { skipDialog: true }\r\n      );\r\n      expect(rolldata.formula).equal(\"1d20 + 18\");\r\n      await waitForInput();\r\n      expect(game.messages?.size).equal(1);\r\n      await actor.delete();\r\n    });\r\n  });\r\n\r\n  describe(\"applyDamage(amount, multiplier)\", () => {\r\n    it(\"doesn't remove hp if no variables are given\", async () => {\r\n      const actor = (await createMockActor(\"character\")) as OseActor;\r\n      await actor.update({ system: { hp: { value: 10, max: 10 } } });\r\n      expect(actor.system.hp.value).equal(10);\r\n      await actor.applyDamage();\r\n      expect(actor.system.hp.value).equal(10);\r\n      await actor.delete();\r\n    });\r\n\r\n    it(\"calculates the amount with amount\", async () => {\r\n      const actor = (await createMockActor(\"character\")) as OseActor;\r\n      await actor.update({ system: { hp: { value: 10, max: 10 } } });\r\n      expect(actor.system.hp.value).equal(10);\r\n      await actor.applyDamage(3);\r\n      expect(actor.system.hp.value).equal(7);\r\n      await actor.delete();\r\n    });\r\n\r\n    it(\"calculates the amount with amount and multiplier\", async () => {\r\n      const actor = (await createMockActor(\"character\")) as OseActor;\r\n      await actor.update({ system: { hp: { value: 10, max: 10 } } });\r\n      expect(actor.system.hp.value).equal(10);\r\n      await actor.applyDamage(3, 2);\r\n      expect(actor.system.hp.value).equal(4);\r\n      await actor.delete();\r\n    });\r\n\r\n    it(\"calculates the amount with amount and negative multiplier\", async () => {\r\n      const actor = (await createMockActor(\"character\")) as OseActor;\r\n      await actor.update({ system: { hp: { value: 1, max: 10 } } });\r\n      expect(actor.system.hp.value).equal(1);\r\n      await actor.applyDamage(3, -2);\r\n      expect(actor.system.hp.value).equal(7);\r\n      await actor.delete();\r\n    });\r\n\r\n    it(\"calculates the amount with negative amount\", async () => {\r\n      const actor = (await createMockActor(\"character\")) as OseActor;\r\n      await actor.update({ system: { hp: { value: 1, max: 10 } } });\r\n      expect(actor.system.hp.value).equal(1);\r\n      await actor.applyDamage(-3);\r\n      expect(actor.system.hp.value).equal(4);\r\n      await actor.delete();\r\n    });\r\n\r\n    it(\"doesn't reduce lower than 0 hp with only amount\", async () => {\r\n      const actor = (await createMockActor(\"character\")) as OseActor;\r\n      await actor.update({ system: { hp: { value: 10, max: 10 } } });\r\n      expect(actor.system.hp.value).equal(10);\r\n      await actor.applyDamage(20);\r\n      expect(actor.system.hp.value).equal(0);\r\n      await actor.delete();\r\n    });\r\n\r\n    it(\"doesn't reduce lower than 0 hp with amount and multiplier\", async () => {\r\n      const actor = (await createMockActor(\"character\")) as OseActor;\r\n      await actor.update({ system: { hp: { value: 10, max: 10 } } });\r\n      expect(actor.system.hp.value).equal(10);\r\n      await actor.applyDamage(4, 3);\r\n      expect(actor.system.hp.value).equal(0);\r\n      await actor.delete();\r\n    });\r\n\r\n    it(\"doesn't increase higher than max hp with only amount\", async () => {\r\n      const actor = (await createMockActor(\"character\")) as OseActor;\r\n      await actor.update({ system: { hp: { value: 1, max: 10 } } });\r\n      expect(actor.system.hp.value).equal(1);\r\n      await actor.applyDamage(-20);\r\n      expect(actor.system.hp.value).equal(10);\r\n      await actor.delete();\r\n    });\r\n\r\n    it(\"doesn't increase higher than max hp with amount and multiplier\", async () => {\r\n      const actor = (await createMockActor(\"character\")) as OseActor;\r\n      await actor.update({ system: { hp: { value: 1, max: 10 } } });\r\n      expect(actor.system.hp.value).equal(1);\r\n      await actor.applyDamage(4, -3);\r\n      expect(actor.system.hp.value).equal(10);\r\n      await actor.delete();\r\n    });\r\n  });\r\n};\r\n","/**\r\n * @file Contains tests for Actor Sheet.\r\n */\r\n// eslint-disable-next-line import/no-cycle\r\nimport { QuenchMethods } from \"../../../e2e\";\r\n// eslint-disable-next-line @typescript-eslint/no-unused-vars\r\nimport {\r\n  cleanUpActorsByKey,\r\n  cleanUpMacros,\r\n  closeDialogs,\r\n  closeSheets,\r\n  createActorTestItem,\r\n  createMockActorKey,\r\n  createMockMacro,\r\n  createWorldTestItem,\r\n  delay,\r\n  itemTypes,\r\n  openDialogs,\r\n  openWindows,\r\n  trashChat,\r\n  waitForInput,\r\n} from \"../../../e2e/testUtils\";\r\nimport OseItem from \"../../item/entity\";\r\nimport OseActorSheet from \"../actor-sheet\";\r\nimport OseActor from \"../entity\";\r\n\r\nexport const key = \"ose.actor.sheet\";\r\nexport const options = {\r\n  displayName: \"OSE: Actor: Sheet\",\r\n  preSelected: true,\r\n};\r\n\r\n/* --------------------------------------------- */\r\n/* Types for storing data between tests          */\r\n/* --------------------------------------------- */\r\ntype DragNDropItem = {\r\n  item: OseItem | undefined;\r\n  itemElement: Element | null;\r\n};\r\n\r\ntype DragNDropItems = {\r\n  source: DragNDropItem;\r\n  target: DragNDropItem;\r\n};\r\n\r\ntype DragNDropDocuments = {\r\n  actor: StoredDocument<Actor> | undefined;\r\n  compendium: CompendiumCollection<any> | undefined;\r\n};\r\n\r\n/* --------------------------------------------- */\r\n/* Helper Functions                              */\r\n/* --------------------------------------------- */\r\nconst getActor = async () => game.actors?.getName(`Test Actor ${key}`);\r\n\r\nexport default ({\r\n  describe,\r\n  it,\r\n  expect,\r\n  after,\r\n  afterEach,\r\n  before\r\n}: QuenchMethods) => {\r\n  // Saving settings being modified by tests\r\n  const originalCtrlSetting = game.settings.get(\r\n    game.system.id,\r\n    \"invertedCtrlBehavior\"\r\n  );\r\n\r\n  after(async () => {\r\n    await cleanUpActorsByKey(key);\r\n    await closeSheets();\r\n    game.settings.set(\r\n      game.system.id,\r\n      \"invertedCtrlBehavior\",\r\n      originalCtrlSetting\r\n    );\r\n  });\r\n\r\n  describe(\"getData()\", () => {\r\n    it(\"returns the expected data\", async () => {\r\n      const actor = (await createMockActorKey(\r\n        \"character\",\r\n        {},\r\n        key\r\n      )) as OseActor;\r\n      const sheet = new OseActorSheet(actor);\r\n      const data = sheet.getData();\r\n\r\n      expect(data.owner).equal(actor?.isOwner);\r\n      expect(data.editable).equal(actor?.sheet?.isEditable);\r\n      expect(Object.keys(data.config)).contain(\"ascendingAC\");\r\n      expect(Object.keys(data.config)).contain(\"initiative\");\r\n      expect(Object.keys(data.config)).contain(\"encumbrance\");\r\n      expect(data.isNew).equal(actor?.isNew());\r\n    });\r\n  });\r\n\r\n  // @todo: Refactor to entity and just use event parsing in sheet\r\n  describe(\"_getItemFromActor(event)\", () => {\r\n    itemTypes.forEach((itemType) => {\r\n      it(`Can get an ${itemType.capitalize()} item`, async () => {\r\n        // Create item\r\n        const actor = await createMockActorKey(\"character\", {}, key);\r\n        await actor?.update({ system: { spells: { enabled: true } } });\r\n        actor?.sheet?.render(true);\r\n        await delay(200);\r\n\r\n        const item = await createActorTestItem(actor, itemType);\r\n        await waitForInput();\r\n\r\n        expect(actor?.items.size).equal(1);\r\n        const mockedItem = item?.pop();\r\n        expect(actor?.items.contents.find((o) => o.id === mockedItem?.id)).not\r\n          .undefined;\r\n\r\n        // Select tab to look inside\r\n        let tab = \"\";\r\n        switch (itemType) {\r\n          // eslint-disable-next-line switch-case/no-case-curly\r\n          case \"spell\": {\r\n            tab = \".tab[data-tab=spells]\";\r\n            break;\r\n          }\r\n\r\n          // eslint-disable-next-line switch-case/no-case-curly\r\n          case \"ability\": {\r\n            tab = \".tab[data-tab=abilities]\";\r\n            break;\r\n          }\r\n\r\n          // eslint-disable-next-line switch-case/no-case-curly\r\n          default: {\r\n            tab = \".tab[data-tab=inventory]\";\r\n          }\r\n        }\r\n\r\n        // Setup what to click\r\n        const clickElement = document.querySelector(`${tab} .item-name`);\r\n        const descriptionStyle =\r\n          clickElement?.parentElement?.nextElementSibling?.style;\r\n        expect(descriptionStyle.display).equal(\"\");\r\n\r\n        // Mock event\r\n        $(`${tab} .item-name`).trigger(\"click\");\r\n        await delay(200);\r\n\r\n        // Verify method\r\n        expect(descriptionStyle.display).equal(\"block\");\r\n\r\n        // Cleanup\r\n        await actor?.delete();\r\n      });\r\n\r\n      after(async () => {\r\n        await cleanUpActorsByKey(key);\r\n        await closeSheets();\r\n      });\r\n    });\r\n  });\r\n\r\n  // @todo: Introduce Extended from dnd5e/PF2e\r\n  describe(\"_toggleItemCategory(event)\", () => {\r\n    // eslint-disable-next-line unicorn/consistent-function-scoping\r\n    const clickCategory = async () => {\r\n      $(\".tab[data-tab=inventory] .item-category-title\").trigger(\"click\");\r\n      await delay(220);\r\n    };\r\n\r\n    before(async () => {\r\n      const actor = (await createMockActorKey(\r\n        \"character\",\r\n        {},\r\n        key\r\n      )) as OseActor;\r\n      await actor.update({ system: { spells: { enabled: true } } });\r\n      actor?.sheet?.render(true);\r\n      await delay(220);\r\n    });\r\n\r\n    it(\"clicking the category name hides the item cateogry\", async () => {\r\n      const sheets = openWindows(\"sheet\");\r\n      expect(sheets.length).equal(1);\r\n      const categoryElement = document.querySelector(\r\n        \".tab[data-tab=inventory] .item-list\"\r\n      );\r\n      expect(categoryElement?.style.display).equal(\"\");\r\n      await clickCategory();\r\n      expect(categoryElement?.style.display).equal(\"none\");\r\n    });\r\n\r\n    it(\"clicking the category name again shows the item cateogry\", async () => {\r\n      const sheets = openWindows(\"sheet\");\r\n      expect(sheets.length).equal(1);\r\n      const categoryElement = document.querySelector(\r\n        \".tab[data-tab=inventory] .item-list\"\r\n      );\r\n      expect(categoryElement?.style.display).equal(\"none\");\r\n      await clickCategory();\r\n      expect(categoryElement?.style.display).equal(\"\");\r\n    });\r\n\r\n    after(async () => {\r\n      await cleanUpActorsByKey(key);\r\n      await closeSheets();\r\n    });\r\n  });\r\n\r\n  describe(\"_toggleContainedItems(event)\", () => {\r\n    // eslint-disable-next-line unicorn/consistent-function-scoping\r\n    const clickContainerCaret = async () => {\r\n      $(\".tab[data-tab=inventory] .container .category-caret\").trigger(\"click\");\r\n      await delay(220);\r\n    };\r\n\r\n    before(async () => {\r\n      const actor = await createMockActorKey(\"character\", {}, key);\r\n      await createActorTestItem(actor, \"container\");\r\n      await createActorTestItem(actor, \"weapon\");\r\n      const weapon = actor?.items.getName(\"New Actor Test Weapon\");\r\n      const container = actor?.items.getName(\"New Actor Test Container\");\r\n      // eslint-disable-next-line no-underscore-dangle\r\n      await weapon?.update({ system: { containerId: container?.id } });\r\n      actor?.sheet?.render(true);\r\n    });\r\n\r\n    it(\"clicking container caret will hide the content\", async () => {\r\n      const sheets = openWindows(\"sheet\");\r\n      expect(sheets.length).equal(1);\r\n\r\n      const actor = await getActor();\r\n      expect(actor?.items.size).equal(2);\r\n\r\n      const container = actor?.items?.getName(\"New Actor Test Container\");\r\n      expect(\r\n        actor?.items.getName(\"New Actor Test Weapon\")?.system.containerId\r\n      ).equal(container?.id);\r\n      const containerElement = document.querySelector(\r\n        \".tab[data-tab=inventory] .container .contained-items\"\r\n      );\r\n      expect(containerElement?.style.display).equal(\"\");\r\n\r\n      await clickContainerCaret();\r\n      expect(containerElement?.style.display).equal(\"none\");\r\n    });\r\n\r\n    it(\"clicking container caret again will show the content\", async () => {\r\n      const sheets = openWindows(\"sheet\");\r\n      expect(sheets.length).equal(1);\r\n\r\n      const actor = await getActor();\r\n      expect(actor?.items.size).equal(2);\r\n\r\n      const container = actor?.items?.getName(\"New Actor Test Container\");\r\n      expect(\r\n        actor?.items.getName(\"New Actor Test Weapon\")?.system.containerId\r\n      ).equal(container?.id);\r\n      const containerElement = document.querySelector(\r\n        \".tab[data-tab=inventory] .container .contained-items\"\r\n      );\r\n\r\n      expect(containerElement?.style.display).equal(\"none\");\r\n      await clickContainerCaret();\r\n      expect(containerElement?.style.display).equal(\"\");\r\n    });\r\n\r\n    after(async () => {\r\n      await cleanUpActorsByKey(key);\r\n      await closeSheets();\r\n    });\r\n  });\r\n\r\n  describe(\"_toggleItemSummary(event)\", () => {\r\n    // eslint-disable-next-line unicorn/consistent-function-scoping\r\n    const clickItemSummary = async (tab: string) => {\r\n      $(`${tab} .item-name`).trigger(\"click\");\r\n      await delay(220);\r\n    };\r\n\r\n    before(async () => {\r\n      const actor = await createMockActorKey(\"character\", {}, key);\r\n      await actor?.update({ system: { spells: { enabled: true } } });\r\n      actor?.sheet?.render(true);\r\n      await delay(220);\r\n    });\r\n\r\n    itemTypes.forEach(async (itemType) => {\r\n      let tab = \"\";\r\n      switch (itemType) {\r\n        // eslint-disable-next-line switch-case/no-case-curly\r\n        case \"spell\": {\r\n          tab = \".tab[data-tab=spells]\";\r\n          break;\r\n        }\r\n\r\n        // eslint-disable-next-line switch-case/no-case-curly\r\n        case \"ability\": {\r\n          tab = \".tab[data-tab=abilities]\";\r\n          break;\r\n        }\r\n\r\n        // eslint-disable-next-line switch-case/no-case-curly\r\n        default: {\r\n          tab = \".tab[data-tab=inventory]\";\r\n        }\r\n      }\r\n\r\n      describe(`for type ${itemType}`, () => {\r\n        before(async () => {\r\n          const actor = await getActor();\r\n          await createActorTestItem(actor, itemType);\r\n        });\r\n\r\n        it(\"clicking item name will show the content\", async () => {\r\n          const sheets = openWindows(\"sheet\");\r\n          expect(sheets.length).equal(1);\r\n\r\n          const actor = await getActor();\r\n          expect(actor?.items.size).equal(1);\r\n\r\n          const summaryElement = document.querySelector(`${tab} .item-summary`);\r\n          expect(summaryElement?.style.display).equal(\"\");\r\n\r\n          await clickItemSummary(tab);\r\n          expect(summaryElement?.style.display).equal(\"block\");\r\n        });\r\n        it(\"clicking item name again will hide the content\", async () => {\r\n          const sheets = openWindows(\"sheet\");\r\n          expect(sheets.length).equal(1);\r\n\r\n          const actor = await getActor();\r\n          expect(actor?.items.size).equal(1);\r\n\r\n          const summaryElement = document.querySelector(`${tab} .item-summary`);\r\n          expect(summaryElement?.style.display).equal(\"block\");\r\n          await clickItemSummary(tab);\r\n          expect(summaryElement?.style.display).equal(\"\");\r\n        });\r\n        it(\"item containing description still shows the summary\", async () => {\r\n          // @todo: This fails, as updated item re-renders the sheet,\r\n          //        and it collapses the summary\r\n          const actor = await getActor();\r\n          const item = actor?.items.getName(\r\n            `New Actor Test ${itemType.capitalize()}`\r\n          );\r\n\r\n          await clickItemSummary(tab);\r\n          await item?.update({ system: { description: \"hello world\" } });\r\n          await waitForInput();\r\n          expect(item?.system.description).equal(\"hello world\");\r\n\r\n          const summaryElement = document.querySelector(`${tab} .item-summary`);\r\n          expect(summaryElement?.innerHTML.indexOf(\"hello world\") >= 0).is.true;\r\n\r\n          await item?.update({ system: { description: \"\" } });\r\n        });\r\n        it(\"item containing macro reference still shows the summary, Issue #353\", async () => {\r\n          const macro = await createMockMacro();\r\n          const macroReference = `<p>@UUID[${macro?.uuid}]{Mock Macro}</p>`;\r\n\r\n          const actor = await getActor();\r\n          const item = actor?.items.getName(\r\n            `New Actor Test ${itemType.capitalize()}`\r\n          );\r\n          await item?.update({ system: { description: macroReference } });\r\n          await waitForInput();\r\n\r\n          const summaryElement = document.querySelector(`${tab} .item-summary`);\r\n          expect(summaryElement?.innerHTML).equal(\"\");\r\n          expect(summaryElement?.innerHTML.indexOf(macroReference) >= 0).true;\r\n          await macro?.delete();\r\n          await item?.update({ system: { description: \"\" } });\r\n        });\r\n\r\n        after(async () => {\r\n          const actor = await getActor();\r\n          actor?.items.forEach(async (i) => {\r\n            await i.delete();\r\n          });\r\n          await cleanUpMacros();\r\n        });\r\n      });\r\n    });\r\n\r\n    after(async () => {\r\n      await cleanUpActorsByKey(key);\r\n      await closeSheets();\r\n    });\r\n  });\r\n\r\n  // @todo: Refactor to entity and just use event parsing in sheet\r\n  describe(\"_displayItemInChat(event)\", () => {\r\n    const clickItemShow = async (tab: string) => {\r\n      $(`${tab} .item-show`).trigger(\"click\");\r\n      await delay(220);\r\n    };\r\n\r\n    before(async () => {\r\n      const actor = await createMockActorKey(\"character\", {}, key);\r\n      await actor?.update({ system: { spells: { enabled: true } } });\r\n      actor?.sheet?.render(true);\r\n      await delay(220);\r\n    });\r\n\r\n    itemTypes.forEach((itemType) => {\r\n      let tab = \"\";\r\n      switch (itemType) {\r\n        // eslint-disable-next-line switch-case/no-case-curly\r\n        case \"spell\": {\r\n          tab = \".tab[data-tab=spells]\";\r\n          break;\r\n        }\r\n\r\n        // eslint-disable-next-line switch-case/no-case-curly\r\n        case \"ability\": {\r\n          tab = \".tab[data-tab=abilities]\";\r\n          break;\r\n        }\r\n\r\n        // eslint-disable-next-line switch-case/no-case-curly\r\n        default: {\r\n          tab = \".tab[data-tab=inventory]\";\r\n        }\r\n      }\r\n\r\n      it(`can show ${itemType}`, async () => {\r\n        await trashChat();\r\n        const actor = await getActor();\r\n        await createActorTestItem(actor, itemType);\r\n        await waitForInput();\r\n        await clickItemShow(tab);\r\n        await waitForInput();\r\n        expect(game.messages?.size).equal(1);\r\n        expect(game.messages?.contents[0]?.content).contain(\r\n          `New Actor Test ${itemType.capitalize()}`\r\n        );\r\n        actor?.items.forEach((i) => i.delete());\r\n      });\r\n\r\n      after(async () => {\r\n        await cleanUpActorsByKey(key);\r\n      });\r\n    });\r\n  });\r\n\r\n  // @todo: Refactor to entity and just use event parsing in sheet\r\n  describe(\"_removeItemFromActor(item)\", () => {\r\n    before(async () => {\r\n      const actor = await createMockActorKey(\"character\", {}, key);\r\n      await actor?.update({ system: { spells: { enabled: true } } });\r\n      actor?.sheet?.render(true);\r\n    });\r\n\r\n    itemTypes.forEach((itemType) => {\r\n      describe(`${itemType} item`, () => {\r\n        it(\"can remove item outside container\", async () => {\r\n          const actor = (await getActor()) as OseActor;\r\n          expect(actor?.items.size).equal(0);\r\n\r\n          await createActorTestItem(actor, itemType);\r\n          await waitForInput();\r\n          const item = actor?.items.getName(\r\n            `New Actor Test ${itemType.capitalize()}`\r\n          );\r\n          expect(actor?.items.size).equal(1);\r\n\r\n          // eslint-disable-next-line no-underscore-dangle\r\n          await actor?.sheet?._removeItemFromActor(item);\r\n          await waitForInput();\r\n          expect(actor?.items.size).equal(0);\r\n        });\r\n\r\n        if (\r\n          itemType !== \"container\" &&\r\n          itemType !== \"spell\" &&\r\n          itemType !== \"ability\"\r\n        ) {\r\n          it(\"can remove item inside container\", async () => {\r\n            const actor = await getActor();\r\n            expect(actor?.items.size).equal(0);\r\n\r\n            await createActorTestItem(actor, \"container\");\r\n            await createActorTestItem(actor, itemType);\r\n            await waitForInput();\r\n            expect(actor?.items.size).equal(2);\r\n\r\n            const item = actor?.items.getName(\r\n              `New Actor Test ${itemType.capitalize()}`\r\n            );\r\n            const container = actor?.items.getName(`New Actor Test Container`);\r\n            expect(item).not.undefined;\r\n            expect(container).not.undefined;\r\n\r\n            // eslint-disable-next-line no-underscore-dangle\r\n            await actor?.sheet?._onContainerItemAdd(item, container);\r\n            await waitForInput();\r\n\r\n            // eslint-disable-next-line no-underscore-dangle\r\n            await actor?.sheet?._removeItemFromActor(item);\r\n            await waitForInput();\r\n            expect(actor?.items.size).equal(1);\r\n            expect(container?.system.itemIds.length).equal(0);\r\n\r\n            // eslint-disable-next-line no-underscore-dangle\r\n            await actor?.sheet?._removeItemFromActor(container);\r\n            await waitForInput();\r\n            expect(actor?.items.size).equal(0);\r\n          });\r\n          it(\"removing container with item inside deletes just container\", async () => {\r\n            const actor = await getActor();\r\n            expect(actor?.items.size).equal(0);\r\n\r\n            await createActorTestItem(actor, \"container\");\r\n            await createActorTestItem(actor, itemType);\r\n            await waitForInput();\r\n            expect(actor?.items.size).equal(2);\r\n\r\n            const item = actor?.items.getName(\r\n              `New Actor Test ${itemType.capitalize()}`\r\n            );\r\n            const container = actor?.items.getName(`New Actor Test Container`);\r\n            expect(item).not.undefined;\r\n            expect(container).not.undefined;\r\n            expect(actor?.items.size).equal(2);\r\n\r\n            // eslint-disable-next-line no-underscore-dangle\r\n            await actor?.sheet?._removeItemFromActor(container);\r\n            await waitForInput();\r\n            expect(actor?.items.size).equal(1);\r\n            // eslint-disable-next-line no-underscore-dangle\r\n            await actor?.sheet?._removeItemFromActor(item);\r\n            await waitForInput();\r\n            expect(actor?.items.size).equal(0);\r\n          });\r\n        }\r\n      });\r\n\r\n      after(async () => {\r\n        await cleanUpActorsByKey(key);\r\n      });\r\n    });\r\n  });\r\n  // @todo: Refactor to entity and just use event parsing in sheet\r\n  describe(\"_useConsumable(event, decrement)\", () => {\r\n    const clickConsumableEmpty = async () =>\r\n      $(`.tab[data-tab=inventory] .empty-mark`).trigger(\"click\");\r\n\r\n    const clickConsumableFull = async () =>\r\n      $(`.tab[data-tab=inventory] .full-mark`).trigger(\"click\");\r\n\r\n    before(async () => {\r\n      const actor = await createMockActorKey(\"character\", {}, key);\r\n      await createActorTestItem(actor, \"item\");\r\n      await waitForInput();\r\n\r\n      const item = actor?.items.contents[0];\r\n      item?.update({ system: { quantity: { max: 6, value: 3 } } });\r\n      await waitForInput();\r\n\r\n      actor?.sheet?.render(true);\r\n      await delay(220);\r\n    });\r\n\r\n    // full = true, empty = false\r\n    it(\"can decrease value\", async () => {\r\n      const actor = await getActor();\r\n      const item = actor?.items.contents[0];\r\n      expect(item?.system.quantity.value).equal(3);\r\n      await clickConsumableFull();\r\n      await waitForInput();\r\n      expect(item?.system.quantity.value).equal(2);\r\n    });\r\n    it(\"can increase value\", async () => {\r\n      const actor = await getActor();\r\n      const item = actor?.items.contents[0];\r\n      expect(item?.system.quantity.value).equal(2);\r\n      await clickConsumableEmpty();\r\n      await waitForInput();\r\n      expect(item?.system.quantity.value).equal(3);\r\n    });\r\n\r\n    after(async () => {\r\n      await cleanUpActorsByKey(key);\r\n    });\r\n  });\r\n\r\n  describe(\"_onSpellChange(event)\", () => {\r\n    before(async () => {\r\n      const actor = await createMockActorKey(\"character\", {}, key);\r\n      await actor?.update({ system: { spells: { enabled: true } } });\r\n      await createActorTestItem(actor, \"spell\");\r\n      await waitForInput();\r\n      actor?.sheet?.render(true);\r\n    });\r\n\r\n    // @todo: How to properly mock updating a field here?\r\n    it(\"changing the input for cast changes spell cast data\", async () => {\r\n      $(\"input[data-field=cast]\").val(3);\r\n      await waitForInput();\r\n\r\n      const actor = await getActor();\r\n      const item = actor?.items.contents[0];\r\n      expect(item?.system.cast).equal(3);\r\n    });\r\n\r\n    // @todo: How to properly mock updating a field here?\r\n    it(\"changing the input for memorize changes spell memorize data\", async () => {\r\n      $(\"input[data-field=cast]\").val(3);\r\n      await waitForInput();\r\n\r\n      const actor = await getActor();\r\n      const item = actor?.items.contents[0];\r\n      expect(item?.system.memorized).equal(3);\r\n    });\r\n\r\n    after(async () => {\r\n      await cleanUpActorsByKey(key);\r\n    });\r\n  });\r\n\r\n  // @todo: Refactor to entity and just use event parsing in sheet\r\n  describe(\"_resetSpells(event)\", () => {\r\n    before(async () => {\r\n      const actor = await createMockActorKey(\"character\", {}, key);\r\n      await actor?.update({ system: { spells: { enabled: true } } });\r\n      await createActorTestItem(actor, \"spell\");\r\n      await waitForInput();\r\n      actor?.items.contents[0].update({ system: { cast: 1, memorized: 3 } });\r\n      actor?.sheet?.render(true);\r\n    });\r\n\r\n    it(\"resetting spells resets the cast field to maximum\", async () => {\r\n      const actor = await getActor();\r\n\r\n      $(\"a[data-action=reset-spells]\").trigger(\"click\");\r\n      await waitForInput();\r\n\r\n      expect(actor?.items.contents[0].system.cast).equal(\r\n        actor?.items.contents[0].system.memorized\r\n      );\r\n    });\r\n\r\n    after(async () => {\r\n      await cleanUpActorsByKey(key);\r\n    });\r\n  });\r\n\r\n  // @todo: Refactor to entity and just use event parsing in sheet\r\n  // @todo: Localization when checking content of chat cards.\r\n  describe(\"_rollAbility(event) \", () => {\r\n    // eslint-disable-next-line unicorn/consistent-function-scoping\r\n    const mockClickItem = async (tab: string) => {\r\n      $(`.tab[data-tab=${tab}] .item-image`).trigger(\"click\");\r\n      await delay(220);\r\n    };\r\n\r\n    before(async () => {\r\n      game.settings.set(game.system.id, \"invertedCtrlBehavior\", true);\r\n      await trashChat();\r\n    });\r\n\r\n    afterEach(async () => {\r\n      await cleanUpActorsByKey(key);\r\n      await trashChat();\r\n    });\r\n\r\n    it(\"rolling weapon on monster updates the counter value\", async () => {\r\n      // Sanity checks\r\n      expect(game.messages?.size).equal(0);\r\n\r\n      // Setup\r\n      const actor = await createMockActorKey(\"monster\", {}, key);\r\n      await createActorTestItem(actor, \"weapon\");\r\n      await waitForInput();\r\n      await actor?.items.contents[0].update({\r\n        system: { counter: { value: 3, max: 3 } },\r\n      });\r\n      expect(actor?.items.size).equal(1);\r\n      actor?.sheet?.render(true);\r\n      await waitForInput();\r\n      await mockClickItem(\"attributes\");\r\n\r\n      // Verification\r\n      expect(game.messages?.size).equal(1);\r\n      expect(game.messages?.contents[0].content).contain(\r\n        \"<h2>Attacks with New Actor Test Weapon</h2>\"\r\n      );\r\n      expect(actor?.items.contents[0].system.counter.value).equal(2);\r\n    });\r\n\r\n    it(\"rolling weapon on character rolls weapon\", async () => {\r\n      // Sanity checks\r\n      expect(game.messages?.size).equal(0);\r\n\r\n      // Setup\r\n      const actor = await createMockActorKey(\"character\", {}, key);\r\n      await createActorTestItem(actor, \"weapon\");\r\n      await waitForInput();\r\n      expect(actor?.items.size).equal(1);\r\n      actor?.sheet?.render(true);\r\n      await waitForInput();\r\n      await mockClickItem(\"inventory\");\r\n\r\n      // Verification\r\n      // @todo: i18n\r\n      expect(game.messages?.size).equal(1);\r\n      expect(game.messages?.contents[0].content).contain(\r\n        \"<h2>Attacks with New Actor Test Weapon</h2>\"\r\n      );\r\n    });\r\n\r\n    it(\"rolling spell rolls and spends the spell\", async () => {\r\n      // Sanity checks\r\n      expect(game.messages?.size).equal(0);\r\n\r\n      // Setup\r\n      const actor = await createMockActorKey(\"character\", {}, key);\r\n      await actor?.update({ system: { spells: { enabled: true } } });\r\n      await createActorTestItem(actor, \"spell\");\r\n      await waitForInput();\r\n      expect(actor?.items.size).equal(1);\r\n      actor?.sheet?.render(true);\r\n      await waitForInput();\r\n      await mockClickItem(\"spells\");\r\n\r\n      // Verification\r\n      expect(game.messages?.size).equal(1);\r\n      expect(game.messages?.contents[0].content).contain(\r\n        \"<h2>New Actor Test Spell</h2>\"\r\n      );\r\n    });\r\n\r\n    it(\"rolling anything else rolls the formula\", async () => {\r\n      // Sanity checks\r\n      expect(game.messages?.size).equal(0);\r\n\r\n      // Setup\r\n      const actor = await createMockActorKey(\"character\", {}, key);\r\n      await actor?.update({ system: { spells: { enabled: true } } });\r\n      await createActorTestItem(actor, \"ability\");\r\n      await waitForInput();\r\n      expect(actor?.items.size).equal(1);\r\n      await actor?.items.contents[0].update({ system: { roll: \"1d6\" } });\r\n      await waitForInput();\r\n      expect(actor?.items.contents[0].system.roll).equal(\"1d6\");\r\n      actor?.sheet?.render(true);\r\n      await waitForInput();\r\n      await mockClickItem(\"abilities\");\r\n\r\n      // Verification\r\n      expect(game.messages?.size).equal(1);\r\n      expect(game.messages?.contents[0].content).contain(\r\n        \"<h2>New Actor Test Ability roll</h2>\"\r\n      );\r\n    });\r\n\r\n    it(\"rolling anything else, without a formula, does nothing\", async () => {\r\n      // Sanity checks\r\n      expect(game.messages?.size).equal(0);\r\n\r\n      // Setup\r\n      const actor = await createMockActorKey(\"character\", {}, key);\r\n      await actor?.update({ system: { spells: { enabled: true } } });\r\n      await createActorTestItem(actor, \"spell\");\r\n      await waitForInput();\r\n      expect(actor?.items.size).equal(1);\r\n      actor?.sheet?.render(true);\r\n      await waitForInput();\r\n      await mockClickItem(\"inventory\");\r\n\r\n      // Verification\r\n      expect(game.messages?.size).equal(0);\r\n    });\r\n\r\n    after(async () => {\r\n      await cleanUpActorsByKey(key);\r\n      await trashChat();\r\n    });\r\n  });\r\n\r\n  // @todo: Refactor to entity and just use event parsing in sheet\r\n  describe(\"_rollSave(event)\", () => {\r\n    const saves = [\"death\", \"wand\", \"paralysis\", \"breath\", \"spell\"];\r\n\r\n    const clickSave = async (save: string) => {\r\n      $(`li[data-save=${save}] a`).trigger(\"click\");\r\n      await delay(220);\r\n    };\r\n\r\n    describe(`character can roll`, () => {\r\n      before(async () => {\r\n        const actor = await createMockActorKey(\"character\", {}, key);\r\n        await actor?.sheet?.render(true);\r\n        game.settings.set(game.system.id, \"invertedCtrlBehavior\", true);\r\n        await trashChat();\r\n        await delay(200);\r\n      });\r\n\r\n      saves.forEach((save) => {\r\n        it(`${save} save`, async () => {\r\n          await trashChat();\r\n          await delay(200);\r\n          expect(game.messages?.size).equal(0);\r\n          await clickSave(save);\r\n          expect(game.messages?.size).equal(1);\r\n          expect(game.messages?.contents[0].content).contain(\r\n            game.i18n.format(\"OSE.roll.save\", {\r\n              save: game.i18n.localize(`OSE.saves.${save}.long`),\r\n            })\r\n          );\r\n        });\r\n      });\r\n\r\n      after(async () => {\r\n        await cleanUpActorsByKey(key);\r\n        await trashChat();\r\n        await delay(200);\r\n      });\r\n    });\r\n\r\n    describe(`monster can roll`, () => {\r\n      before(async () => {\r\n        const actor = await createMockActorKey(\"monster\", {}, key);\r\n        await actor?.sheet?.render(true);\r\n      });\r\n\r\n      saves.forEach((save) => {\r\n        it(`${save} save`, async () => {\r\n          await trashChat();\r\n          await delay(200);\r\n          expect(game.messages?.size).equal(0);\r\n          await clickSave(save);\r\n          expect(game.messages?.size).equal(1);\r\n          expect(game.messages?.contents[0].content).contain(\r\n            game.i18n.format(\"OSE.roll.save\", {\r\n              save: game.i18n.localize(`OSE.saves.${save}.long`),\r\n            })\r\n          );\r\n        });\r\n      });\r\n\r\n      after(async () => {\r\n        await cleanUpActorsByKey(key);\r\n        await trashChat();\r\n        await delay(200);\r\n      });\r\n    });\r\n  });\r\n\r\n  // @todo: Refactor to entity and just use event parsing in sheet\r\n  describe(\"_rollAttack(event)\", () => {\r\n    const attackTypeClasses = [\"melee\", \"missile\"];\r\n    const clickAttack = async (attack: string) => {\r\n      $(`li[data-attack=${attack}] a`).trigger(\"click\");\r\n      await delay(200);\r\n    };\r\n\r\n    before(async () => {\r\n      game.settings.set(game.system.id, \"invertedCtrlBehavior\", true);\r\n      const actor = await createMockActorKey(\"character\", {}, key);\r\n      actor?.sheet?.render(true);\r\n      await trashChat();\r\n    });\r\n\r\n    attackTypeClasses.forEach((attackClass) => {\r\n      it(`can attack with ${attackClass}`, async () => {\r\n        const actor = await getActor();\r\n        expect(game.messages?.size).equal(0);\r\n        await clickAttack(attackClass);\r\n        expect(game.messages?.size).equal(1);\r\n        expect(game.messages?.contents[0].content).contain(\r\n          game.i18n.format(\"OSE.roll.attacks\", { name: actor?.name })\r\n        );\r\n        await trashChat();\r\n      });\r\n    });\r\n\r\n    after(async () => {\r\n      await cleanUpActorsByKey(key);\r\n    });\r\n  });\r\n\r\n  /* --------------------------------------------- */\r\n  /* Check Test Helper functions                   */\r\n  /* --------------------------------------------- */\r\n  const dragNDropSanityChecks = (\r\n    documents: DragNDropDocuments,\r\n    items: DragNDropItems\r\n  ) => {\r\n    // Check Actor constructed properly\r\n    expect(documents.actor).not.undefined;\r\n    expect(documents.actor?.documentName).equal(\"Actor\");\r\n\r\n    // Check that the target constructed properly\r\n    expect(items.target.item).not.undefined;\r\n    expect(items.target.item?.documentName).equal(\"Item\");\r\n    expect(items.target.item?.name).equal(\"TargetContainer\");\r\n  };\r\n\r\n  const dragNDropCasePreflightCheck = (\r\n    sourceItemName: string,\r\n    items: DragNDropItems\r\n  ) => {\r\n    expect(items.source.item).not.undefined;\r\n    expect(items.source.item?.documentName).equal(\"Item\");\r\n    expect(items.source.item?.name).equal(sourceItemName);\r\n\r\n    // Check source and target data\r\n    expect(items.source.item?.system.containerId).equal(\"\");\r\n    expect(items.target.item?.system.itemIds.length).equal(0);\r\n  };\r\n\r\n  const dragNDropCasePostflightCheck = (\r\n    documents: DragNDropDocuments,\r\n    items: DragNDropItems\r\n  ) => {\r\n    // Check item data\r\n    expect(items.target.item?.system.itemIds.length).equal(1);\r\n    expect(items.target.item?.system.itemIds).contain(items.source.item?.id);\r\n    expect(items.source.item?.system.containerId).equal(items.target.item?.id);\r\n\r\n    // Check getters\r\n    const getter =\r\n      items.source.item?.type === \"armor\"\r\n        ? items.source.item?.type\r\n        : `${items.source.item?.type}s`;\r\n    const amount = getter === \"containers\" ? 1 : 0;\r\n    expect(documents.actor?.system[getter].length).equal(amount);\r\n  };\r\n\r\n  // @todo: Refactor to entity and just use event parsing in sheet\r\n  describe(\"_onContainerItemAdd(item, target)\", () => {\r\n    /* --------------------------------------------- */\r\n    /* Loop over item types                          */\r\n    /* --------------------------------------------- */\r\n    itemTypes.forEach((itemType) => {\r\n      // Skip items that can't be put in a container\r\n      if (itemType === \"spell\") return;\r\n      if (itemType === \"ability\") return;\r\n\r\n      const documents: DragNDropDocuments = {} as DragNDropDocuments;\r\n      const items: DragNDropItems = {\r\n        source: {} as DragNDropItem,\r\n        target: {} as DragNDropItem,\r\n      } as DragNDropItems;\r\n\r\n      before(async () => {\r\n        documents.actor = await createMockActorKey(\"character\", {}, key);\r\n\r\n        // Create target container\r\n        [items.target.item] = await createActorTestItem(\r\n          documents.actor,\r\n          \"container\",\r\n          \"TargetContainer\"\r\n        );\r\n      });\r\n\r\n      it(`add ${itemType} to container`, async () => {\r\n        dragNDropSanityChecks(documents, items);\r\n\r\n        // Create source item\r\n        [items.source.item] = await createActorTestItem(\r\n          documents.actor,\r\n          itemType\r\n        );\r\n\r\n        // Perform pre-flight checks\r\n        const sourceItemName = `New Actor Test ${itemType.capitalize()}`;\r\n        dragNDropCasePreflightCheck(sourceItemName, items);\r\n\r\n        // Perform operation\r\n        // eslint-disable-next-line no-underscore-dangle\r\n        await documents.actor?.sheet?._onContainerItemAdd(\r\n          items.source.item,\r\n          items.target.item\r\n        );\r\n\r\n        // Perform post-flight checks\r\n        dragNDropCasePostflightCheck(documents, items);\r\n      });\r\n\r\n      after(async () => {\r\n        await cleanUpActorsByKey(key);\r\n      });\r\n    });\r\n  });\r\n\r\n  // @todo: Refactor to entity and just use event parsing in sheet\r\n  describe(\"_onContainerItemRemove(item, container)\", () => {\r\n    /* --------------------------------------------- */\r\n    /* Loop over item types                          */\r\n    /* --------------------------------------------- */\r\n    itemTypes.forEach((itemType) => {\r\n      // Skip items that can't be put in a container\r\n      if (itemType === \"spell\") return;\r\n      if (itemType === \"ability\") return;\r\n\r\n      const documents: DragNDropDocuments = {} as DragNDropDocuments;\r\n      const items: DragNDropItems = {\r\n        source: {} as DragNDropItem,\r\n        target: {} as DragNDropItem,\r\n      } as DragNDropItems;\r\n\r\n      before(async () => {\r\n        documents.actor = await createMockActorKey(\"character\", {}, key);\r\n\r\n        // Create target container\r\n        [items.target.item] = await createActorTestItem(\r\n          documents.actor,\r\n          \"container\",\r\n          \"TargetContainer\"\r\n        );\r\n\r\n        // Create source item\r\n        [items.source.item] = await createActorTestItem(\r\n          documents.actor,\r\n          itemType\r\n        );\r\n\r\n        // Perform operation\r\n        // eslint-disable-next-line no-underscore-dangle\r\n        await documents.actor?.sheet?._onContainerItemAdd(\r\n          items.source.item,\r\n          items.target.item\r\n        );\r\n      });\r\n\r\n      it(`remove ${itemType} from container`, async () => {\r\n        // Perform pre-flight checks\r\n        dragNDropCasePostflightCheck(documents, items);\r\n\r\n        // Perform operation\r\n        // eslint-disable-next-line no-underscore-dangle\r\n        await documents.actor?.sheet?._onContainerItemRemove(\r\n          items.source.item,\r\n          items.target.item\r\n        );\r\n\r\n        // Perform pre-flight checks\r\n        const sourceItemName = `New Actor Test ${itemType.capitalize()}`;\r\n        dragNDropCasePreflightCheck(sourceItemName, items);\r\n      });\r\n\r\n      after(async () => {\r\n        await cleanUpActorsByKey(key);\r\n      });\r\n    });\r\n  });\r\n\r\n  // @todo: Refactor to entity and just use event parsing in sheet\r\n  describe(\"_onDropItemCreate(droppedItem, targetContainer)\", () => {\r\n    /* --------------------------------------------- */\r\n    /* Loop over item types                          */\r\n    /* --------------------------------------------- */\r\n    itemTypes.forEach((itemType) => {\r\n      // Skip items that can't be put in a container\r\n      if (itemType === \"spell\") return;\r\n      if (itemType === \"ability\") return;\r\n\r\n      const documents: DragNDropDocuments = {} as DragNDropDocuments;\r\n      const items: DragNDropItems = {\r\n        source: {} as DragNDropItem,\r\n        target: {} as DragNDropItem,\r\n      } as DragNDropItems;\r\n\r\n      before(async () => {\r\n        documents.actor = await createMockActorKey(\"character\", {}, key);\r\n      });\r\n\r\n      it(`add non-actor ${itemType} to sheet`, async () => {\r\n        // Create item in sidebar\r\n        items.source.item = (await createWorldTestItem(itemType)) as OseItem;\r\n        const sourceItemName = items.source.item.name || \"test\";\r\n\r\n        // eslint-disable-next-line no-underscore-dangle\r\n        await documents.actor?.sheet?._onDropItemCreate([items.source.item]);\r\n\r\n        // Store new item as it recreates in the character sheet\r\n        items.source.item = documents.actor?.items.getName(\r\n          sourceItemName\r\n        ) as OseItem;\r\n\r\n        expect(items.source.item).not.undefined;\r\n      });\r\n\r\n      after(async () => {\r\n        await cleanUpActorsByKey(key);\r\n      });\r\n    });\r\n  });\r\n\r\n  describe(\"_chooseItemType(choices)\", () => {\r\n    const defaultChoices = [\"weapon\", \"armor\", \"shield\", \"gear\"];\r\n\r\n    it(\"can create standard dialog\", async () => {\r\n      const actor = await createMockActorKey(\"monster\", {}, key);\r\n      // eslint-disable-next-line no-underscore-dangle\r\n      actor?.sheet?._chooseItemType();\r\n      await waitForInput();\r\n\r\n      const dialogs = openDialogs();\r\n      expect(dialogs.length).equal(1);\r\n\r\n      defaultChoices.forEach((choice) => {\r\n        expect(dialogs[0].data.content).contain(`<option value=\"${choice}\"`);\r\n      });\r\n      await dialogs[0].close();\r\n    });\r\n\r\n    it(\"can create custom dialog\", async () => {\r\n      const customChoices = [\"test\", \"test2\", \"test3\"];\r\n      const actor = (await createMockActorKey(\"monster\", {}, key)) as OseActor;\r\n      // eslint-disable-next-line no-underscore-dangle\r\n      actor?.sheet?._chooseItemType(customChoices);\r\n      await waitForInput();\r\n\r\n      const dialogs = openDialogs();\r\n      expect(dialogs.length).equal(1);\r\n\r\n      customChoices.forEach((choice) => {\r\n        expect(dialogs[0].data.content).contain(`<option value=\"${choice}\"`);\r\n      });\r\n      await dialogs[0].close();\r\n    });\r\n\r\n    afterEach(async () => {\r\n      await closeDialogs();\r\n      await cleanUpActorsByKey(key);\r\n    });\r\n  });\r\n\r\n  // @todo: Refactor to entity and just use event parsing in sheet\r\n  describe(\"_createItem(event)\", () => {\r\n    itemTypes.forEach((itemType) => {\r\n      it(`can create ${itemType}`, async () => {\r\n        const actor = await createMockActorKey(\"character\", {}, key);\r\n        await actor?.update({ system: { spells: { enabled: true } } });\r\n        await actor?.sheet?.render(true);\r\n        await delay(200);\r\n        expect(actor?.items.size).equal(0);\r\n\r\n        $(`.sheet .item-create[data-type=\"${itemType}\"]`).trigger(\"click\");\r\n        await waitForInput();\r\n\r\n        expect(actor?.items.size).equal(1);\r\n      });\r\n    });\r\n\r\n    afterEach(async () => {\r\n      await cleanUpActorsByKey(key);\r\n    });\r\n  });\r\n\r\n  // @todo: Refactor to entity and just use event parsing in sheet\r\n  describe(\"_updateItemQuantity(event)\", () => {\r\n    const updateQuantity = (element: HTMLInputElement, modifier: number) => {\r\n      element.value = String(parseInt(element.value, 10) + modifier);\r\n      const event = new InputEvent(\"change\");\r\n      element.dispatchEvent(event);\r\n    };\r\n\r\n    it(\"can add to the quantity\", async () => {\r\n      const actor = await createMockActorKey(\"character\", {}, key);\r\n      actor?.sheet?.render(true);\r\n      const [item] = (await createActorTestItem(\r\n        actor,\r\n        \"item\"\r\n      )) as unknown as OseItem;\r\n      item.update({ system: { quantity: { value: 2, max: 4 } } });\r\n      await waitForInput();\r\n\r\n      const quantityElement = document.querySelector(\r\n        `.sheet .item[data-item-id=\"${item.id}\"] input[data-field=\"value\"]`\r\n      ) as HTMLInputElement;\r\n\r\n      expect(item.system.quantity.value).equal(2);\r\n      updateQuantity(quantityElement, 1);\r\n      await waitForInput();\r\n      expect(item.system.quantity.value).equal(3);\r\n    });\r\n\r\n    it(\"can subtract from the quantity\", async () => {\r\n      const actor = await createMockActorKey(\"character\", {}, key);\r\n      actor?.sheet?.render(true);\r\n      const [item] = (await createActorTestItem(\r\n        actor,\r\n        \"item\"\r\n      )) as unknown as OseItem;\r\n      item.update({ system: { quantity: { value: 2, max: 4 } } });\r\n      await waitForInput();\r\n\r\n      const quantityElement = document.querySelector(\r\n        `.sheet .item[data-item-id=\"${item.id}\"] input[data-field=\"value\"]`\r\n      ) as HTMLInputElement;\r\n\r\n      expect(item.system.quantity.value).equal(2);\r\n      updateQuantity(quantityElement, -1);\r\n      await waitForInput();\r\n      expect(item.system.quantity.value).equal(1);\r\n    });\r\n\r\n    afterEach(async () => {\r\n      await cleanUpActorsByKey(key);\r\n    });\r\n  });\r\n\r\n  // @todo: How to test?\r\n  describe(\"_renderInner(...args)\", () => {});\r\n  // @todo: How to test?\r\n  describe(\"_onResize(event)\", () => {});\r\n\r\n  // @todo: Dose this work now?\r\n  describe(\"_onConfigureActor(event)\", () => {\r\n    [\"character\", \"monster\"].forEach((actorType) => {\r\n      it(`Entity Tweaks renders for ${actorType}`, async () => {\r\n        const actor = await createMockActorKey(\"character\", {}, key);\r\n        await actor?.sheet?.render(true);\r\n        await delay(300);\r\n\r\n        $(`.configure-actor`).trigger(\"click\");\r\n        await delay(300);\r\n\r\n        const windows = openWindows(\"sheet-tweaks\");\r\n        expect(windows.length).equal(1);\r\n        windows[0].close();\r\n      });\r\n    });\r\n\r\n    afterEach(async () => {\r\n      await cleanUpActorsByKey(key);\r\n    });\r\n  });\r\n\r\n  // @todo: How to test?\r\n  describe(\"_getHeaderButtons()\", () => {});\r\n};\r\n","/**\r\n * @file Contains tests for dragging and dropping items to and from Actor Sheet.\r\n */\r\n// eslint-disable-next-line prettier/prettier\r\nimport { QuenchMethods } from \"../../../../e2e\";\r\nimport {\r\n  cleanUpActorsByKey,\r\n  cleanUpWorldItems,\r\n  createActorTestItem,\r\n  createMockActorKey,\r\n  createWorldTestItem,\r\n  itemTypes,\r\n  waitForInput, // eslint-disable-next-line prettier/prettier\r\n} from \"../../../../e2e/testUtils\";\r\nimport OseItem from \"../../../item/entity\";\r\nimport OseActor from \"../../entity\";\r\n\r\nexport const key = \"ose.actor.sheet.e2e.dragndrop\";\r\nexport const options = {\r\n  displayName: \"OSE: Actor: Sheet E2E Drag'n'Drop\",\r\n  preSelected: true,\r\n};\r\n\r\n/* --------------------------------------------- */\r\n/* Types for storing data between tests          */\r\n/* --------------------------------------------- */\r\ntype DragNDropItem = {\r\n  item: OseItem | undefined;\r\n  itemElement: Element | null;\r\n};\r\n\r\ntype DragNDropItems = {\r\n  source: DragNDropItem;\r\n  target: DragNDropItem;\r\n};\r\n\r\ntype DragNDropDocuments = {\r\n  actor: StoredDocument<Actor> | undefined;\r\n  compendium: CompendiumCollection<any> | undefined;\r\n};\r\n\r\n/* --------------------------------------------- */\r\n/* DOM Manipulation Helper functions             */\r\n/* --------------------------------------------- */\r\nconst executeDrag = (sourceElement: Element | null) => {\r\n  const mockDragStartEvent = new DragEvent(\"dragstart\", {\r\n    dataTransfer: new DataTransfer(),\r\n    bubbles: true,\r\n    cancelable: true,\r\n  });\r\n  sourceElement?.dispatchEvent(mockDragStartEvent);\r\n  return mockDragStartEvent;\r\n};\r\n\r\nconst executeDragNDrop = async (items: DragNDropItems) => {\r\n  const mockDragStartEvent = new DragEvent(\"dragstart\", {\r\n    dataTransfer: new DataTransfer(),\r\n    bubbles: true,\r\n    cancelable: true,\r\n  });\r\n  items.source.itemElement?.dispatchEvent(mockDragStartEvent);\r\n\r\n  const mockDropEvent = new DragEvent(\"drop\", {\r\n    dataTransfer: mockDragStartEvent.dataTransfer,\r\n    bubbles: true,\r\n    cancelable: true,\r\n  });\r\n  items.target.itemElement?.dispatchEvent(mockDropEvent);\r\n};\r\n\r\nexport default ({\r\n  describe,\r\n  it,\r\n  expect,\r\n  after,\r\n  afterEach,\r\n  beforeEach,\r\n}: QuenchMethods) => {\r\n  describe(\"_onDragStart(event)\", () => {\r\n    it(\"populates dataTransfer correctly\", async () => {\r\n      const actor = (await createMockActorKey(\r\n        \"character\",\r\n        {},\r\n        key\r\n      )) as OseActor;\r\n      expect(actor).not.undefined;\r\n\r\n      await actor.sheet?.render(true);\r\n\r\n      const [item] = await createActorTestItem(actor, \"weapon\");\r\n      expect(item).not.undefined;\r\n      await waitForInput();\r\n\r\n      const itemElement = document.querySelector(\r\n        `.sheet .inventory li.item[data-item-id=\"${item?.id}\"]`\r\n      );\r\n      expect(itemElement).not.null;\r\n\r\n      const event = executeDrag(itemElement);\r\n      const parsedData = TextEditor.getDragEventData(event);\r\n      expect(Object.keys(parsedData)).contain(\"item\");\r\n    });\r\n\r\n    after(async () => {\r\n      await cleanUpActorsByKey(key);\r\n    });\r\n  });\r\n\r\n  // This is tested in the combined _onDragStart & _onDrop test\r\n  describe(\"_onDropItem(event, data)\", () => {});\r\n\r\n  describe(\"_onDragStart(event, data) & _onDrop(event, data) - Containers\", () => {\r\n    // @todo: Move out to outer scope for re-use, potentially testUtils.\r\n    /* --------------------------------------------- */\r\n    /* Mock Helper functions                         */\r\n    /* --------------------------------------------- */\r\n    const createMockCompendium = async (\r\n      type: CompendiumCollection.Metadata[\"type\"]\r\n      // eslint-disable-next-line unicorn/consistent-function-scoping\r\n    ) =>\r\n      // eslint-disable-next-line no-undef\r\n      CompendiumCollection.createCompendium({\r\n        label: \"Test Compendium\",\r\n        name: \"testcompendium\",\r\n        type,\r\n        path: \"\",\r\n        private: false,\r\n        package: \"world\",\r\n      });\r\n\r\n    // eslint-disable-next-line unicorn/consistent-function-scoping\r\n    const cleanUpCompendium = async () =>\r\n      game.packs.get(\"world.testcompendium\")?.deleteCompendium();\r\n\r\n    /* --------------------------------------------- */\r\n    /* Check Test Helper functions                   */\r\n    /* --------------------------------------------- */\r\n    const dragNDropSanityChecks = (\r\n      documents: DragNDropDocuments,\r\n      items: DragNDropItems\r\n    ) => {\r\n      // Check Actor constructed properly\r\n      expect(documents.actor).not.undefined;\r\n      expect(documents.actor?.documentName).equal(\"Actor\");\r\n\r\n      // Check Compendium constructed properly\r\n      expect(documents.compendium).not.undefined;\r\n      expect(documents.compendium?.documentName).equal(\"Item\");\r\n\r\n      // Check that the target constructed properly\r\n      expect(items.target.item).not.undefined;\r\n      expect(items.target.item?.documentName).equal(\"Item\");\r\n      expect(items.target.item?.name).equal(\"TargetContainer\");\r\n\r\n      // Check the target DOM is stored correctly\r\n      expect(items.target.itemElement).not.null;\r\n      expect(items.target.itemElement?.constructor.name).equal(\"HTMLLIElement\");\r\n    };\r\n\r\n    const dragNDropCasePreflightCheck = (\r\n      sourceItemName: string,\r\n      items: DragNDropItems\r\n    ) => {\r\n      expect(items.source.item).not.undefined;\r\n      expect(items.source.item?.documentName).equal(\"Item\");\r\n      expect(items.source.item?.name).equal(sourceItemName);\r\n\r\n      expect(items.source.itemElement).not.null;\r\n      expect(items.source.itemElement?.constructor.name).equal(\"HTMLLIElement\");\r\n\r\n      // Check source and target data\r\n      expect(items.source.item?.system.containerId).equal(\"\");\r\n      expect(items.target.item?.system.itemIds.length).equal(0);\r\n    };\r\n\r\n    const dragNDropCasePostflightCheck = (\r\n      documents: DragNDropDocuments,\r\n      items: DragNDropItems\r\n    ) => {\r\n      // Check item data\r\n      expect(items.target.item?.system.itemIds.length).equal(1);\r\n      expect(items.target.item?.system.itemIds).contain(items.source.item?.id);\r\n      expect(items.source.item?.system.containerId).equal(\r\n        items.target.item?.id\r\n      );\r\n\r\n      // Check getters\r\n      const getter =\r\n        items.source.item?.type === \"armor\"\r\n          ? items.source.item?.type\r\n          : `${items.source.item?.type}s`;\r\n      const amount = getter === \"containers\" ? 1 : 0;\r\n      expect(documents.actor?.system[getter].length).equal(amount);\r\n    };\r\n\r\n    /* --------------------------------------------- */\r\n    /* Specific cases                                */\r\n    /* --------------------------------------------- */\r\n    // Issue#357\r\n    it(\"Issue#357 Dragging container onto itself should retain container in inventory\", async () => {\r\n      const items: DragNDropItems = {\r\n        source: {} as DragNDropItem,\r\n        target: {} as DragNDropItem,\r\n      } as DragNDropItems;\r\n\r\n      // Setup actor & items\r\n      const actor = await createMockActorKey(\"character\", {}, key);\r\n      [items.target.item] = await createActorTestItem(\r\n        actor,\r\n        \"container\",\r\n        \"TargetContainer\"\r\n      );\r\n      [items.source.item] = await createActorTestItem(actor, \"weapon\");\r\n\r\n      // Render UI elements\r\n      actor?.sheet?.render(true);\r\n      await waitForInput();\r\n\r\n      // Set the DOM elements\r\n      items.source.itemElement = document.querySelector(\r\n        `.sheet .inventory li.item[data-item-id=\"${items.source?.item?.id}\"]`\r\n      );\r\n      items.target.itemElement = document.querySelector(\r\n        `.sheet .inventory li.item[data-item-id=\"${items.target?.item?.id}\"]`\r\n      );\r\n\r\n      // Execute drag'n'drop of stored item\r\n      dragNDropCasePreflightCheck(\"New Actor Test Weapon\", items);\r\n      await executeDragNDrop(items);\r\n      await waitForInput();\r\n\r\n      // Check items\r\n      expect(items.target.item?.system.itemIds.length).equal(1);\r\n      expect(items.target.item?.system.itemIds).contain(items.source.item?.id);\r\n      expect(items.source.item?.system.containerId).equal(\r\n        items.target.item?.id\r\n      );\r\n\r\n      // Re-form the source item to use the target container\r\n      items.source.itemElement = items.target.itemElement;\r\n      items.source.item = items.target.item;\r\n\r\n      // Execute drag'n'drop again\r\n      await executeDragNDrop(items);\r\n      await waitForInput();\r\n\r\n      // Verify that the target container is still present\r\n      const finalElement = document.querySelector(\r\n        `.sheet .inventory li.item[data-item-id=\"${items.target?.item?.id}\"]`\r\n      );\r\n      expect(finalElement).not.null;\r\n    });\r\n\r\n    /* --------------------------------------------- */\r\n    /* Loop over item types                          */\r\n    /* --------------------------------------------- */\r\n    itemTypes.forEach((itemType) => {\r\n      // Skip items that can't be put in a container\r\n      if (itemType === \"spell\") return;\r\n      if (itemType === \"ability\") return;\r\n\r\n      // Initiate storage of actor, items, and DOM elements\r\n      const documents: DragNDropDocuments = {} as DragNDropDocuments;\r\n      const items: DragNDropItems = {\r\n        source: {} as DragNDropItem,\r\n        target: {} as DragNDropItem,\r\n      } as DragNDropItems;\r\n\r\n      describe(`manipulating ${itemType} item type`, () => {\r\n        beforeEach(async () => {\r\n          // Set up actor & compendium\r\n          documents.actor = await createMockActorKey(\"character\", {}, key);\r\n          documents.compendium = await createMockCompendium(\"Item\");\r\n\r\n          // Create target container\r\n          [items.target.item] = await createActorTestItem(\r\n            documents.actor,\r\n            \"container\",\r\n            \"TargetContainer\"\r\n          );\r\n\r\n          // Render UI elements\r\n          documents.actor?.sheet?.render(true);\r\n          documents.compendium?.render(true);\r\n          await waitForInput();\r\n\r\n          // Record Target DOM\r\n          items.target.itemElement = document.querySelector(\r\n            `.sheet .inventory li.item[data-item-id=\"${items.target.item?.id}\"]`\r\n          );\r\n        });\r\n\r\n        it(`drag ${itemType} from actor sheet into a container in a character sheet`, async () => {\r\n          dragNDropSanityChecks(documents, items);\r\n\r\n          // Create item in actor sheet\r\n          [items.source.item] = await createActorTestItem(\r\n            documents.actor,\r\n            itemType\r\n          );\r\n\r\n          // Wait for UI to keep up\r\n          await waitForInput();\r\n\r\n          // Create DOM element\r\n          items.source.itemElement = document.querySelector(\r\n            `.sheet .inventory li.item[data-item-id=\"${items.source.item?.id}\"]`\r\n          );\r\n\r\n          // Perform pre-flight checks\r\n          const sourceItemName = `New Actor Test ${itemType.capitalize()}`;\r\n          dragNDropCasePreflightCheck(sourceItemName, items);\r\n\r\n          // Drag N Drop\r\n          await executeDragNDrop(items);\r\n          await waitForInput();\r\n\r\n          // Perform post-flight checks\r\n          dragNDropCasePostflightCheck(documents, items);\r\n        });\r\n\r\n        it(`drag ${itemType} from item sidebar into a container in a character sheet`, async () => {\r\n          dragNDropSanityChecks(documents, items);\r\n\r\n          // Create item in sidebar\r\n          items.source.item = (await createWorldTestItem(itemType)) as OseItem;\r\n\r\n          // Wait for UI to keep up\r\n          await waitForInput();\r\n\r\n          // Create DOM element\r\n          items.source.itemElement = document.querySelector(\r\n            `.sidebar-tab[data-tab=\"items\"] li.item[data-document-id=\"${items.source.item?.id}\"]`\r\n          );\r\n\r\n          // Perform pre-flight checks\r\n          const sourceItemName = `New World Test ${itemType.capitalize()}`;\r\n          dragNDropCasePreflightCheck(sourceItemName, items);\r\n\r\n          // Drag N Drop\r\n          await executeDragNDrop(items);\r\n          await waitForInput();\r\n\r\n          // Store new item as it recreates in the character sheet\r\n          items.source.item = documents.actor?.items.getName(\r\n            items.source.item?.name\r\n          ) as OseItem;\r\n\r\n          // Perform post-flight checks\r\n          dragNDropCasePostflightCheck(documents, items);\r\n        });\r\n\r\n        it(`drag ${itemType} from compendium into a container in a character sheet`, async () => {\r\n          dragNDropSanityChecks(documents, items);\r\n\r\n          // Create item in compendium\r\n          const worldItem = (await createWorldTestItem(itemType)) as OseItem;\r\n          items.source.item = await documents.compendium?.importDocument(\r\n            worldItem\r\n          );\r\n\r\n          // Wait for UI to keep up\r\n          await waitForInput();\r\n\r\n          // Create DOM element\r\n          items.source.itemElement = document.querySelector(\r\n            `.compendium li.item[data-document-id=\"${items.source.item?.id}\"]`\r\n          );\r\n\r\n          // Perform pre-flight checks\r\n          const sourceItemName = `New World Test ${itemType.capitalize()}`;\r\n          dragNDropCasePreflightCheck(sourceItemName, items);\r\n\r\n          // Drag N Drop\r\n          await executeDragNDrop(items);\r\n          await waitForInput();\r\n\r\n          // Store new item as it recreates in the character sheet\r\n          items.source.item = documents.actor?.items.getName(\r\n            items.source.item?.name\r\n          ) as OseItem;\r\n\r\n          // Perform post-flight checks\r\n          dragNDropCasePostflightCheck(documents, items);\r\n        });\r\n\r\n        afterEach(async () => {\r\n          await cleanUpActorsByKey(key);\r\n          await cleanUpCompendium();\r\n          await cleanUpWorldItems();\r\n        });\r\n      });\r\n    });\r\n  });\r\n};\r\n","/**\r\n * @file Contains tests for Character Sheet.\r\n */\r\n// eslint-disable-next-line import/no-cycle\r\nimport { QuenchMethods } from \"../../../e2e\";\r\nimport {\r\n  cleanUpActorsByKey,\r\n  closeDialogs,\r\n  closeSheets,\r\n  createMockActorKey,\r\n  delay,\r\n  openDialogs,\r\n  openWindows,\r\n  trashChat,\r\n  waitForInput,\r\n} from \"../../../e2e/testUtils\";\r\nimport OseActorSheetCharacter from \"../character-sheet\";\r\n\r\nexport const key = \"ose.actor.sheet.character\";\r\nexport const options = { displayName: \"OSE: Actor: Sheet: Character\" };\r\n\r\nexport default ({ describe, it, expect, after, afterEach }: QuenchMethods) => {\r\n  after(async () => {\r\n    await cleanUpActorsByKey(key);\r\n    await closeSheets();\r\n  });\r\n\r\n  describe(\"defaultOptions()\", () => {\r\n    it(\"Has correctly set defaultOptions\", async () => {\r\n      const actor = await createMockActorKey(\"character\", {}, key);\r\n      const sheet = actor?.sheet as unknown as OseActorSheetCharacter;\r\n\r\n      expect(sheet.options.classes).contain(\"ose\");\r\n      expect(sheet.options.classes).contain(\"sheet\");\r\n      expect(sheet.options.classes).contain(\"actor\");\r\n      expect(sheet.options.classes).contain(\"character\");\r\n\r\n      expect(sheet.options.template).contain(\r\n        \"/templates/actors/character-sheet.html\"\r\n      );\r\n      expect(sheet.options.width).equal(450);\r\n      expect(sheet.options.height).equal(530);\r\n      expect(sheet.options.resizable).is.true;\r\n\r\n      expect(sheet.options.tabs.length).equal(1);\r\n      expect(Object.keys(sheet.options.tabs[0])).contain(\"navSelector\");\r\n      expect(sheet.options.tabs[0].navSelector).equal(\".sheet-tabs\");\r\n      expect(Object.keys(sheet.options.tabs[0])).contain(\"contentSelector\");\r\n      expect(sheet.options.tabs[0].contentSelector).equal(\".sheet-body\");\r\n      expect(Object.keys(sheet.options.tabs[0])).contain(\"initial\");\r\n      expect(sheet.options.tabs[0].initial).equal(\"attributes\");\r\n\r\n      expect(sheet.options.scrollY.length).equal(1);\r\n      expect(sheet.options.scrollY[0]).equal(\".inventory\");\r\n    });\r\n\r\n    after(async () => {\r\n      await cleanUpActorsByKey(key);\r\n    });\r\n  });\r\n\r\n  // @todo: Do we need separate test sfor this, or is getData() enough?\r\n  describe(\"_prepareItems(data)\", () => {});\r\n\r\n  // @todo: this is not tested separately as a dialog, should we test it more?\r\n  describe(\"generateScores()\", () => {\r\n    const scores = {\r\n      str: 0,\r\n      int: 0,\r\n      dex: 0,\r\n      wis: 0,\r\n      con: 0,\r\n      cha: 0,\r\n    };\r\n\r\n    it(\"renders the character creator\", async () => {\r\n      const actor = await createMockActorKey(\"character\", {}, key);\r\n      const sheet = actor?.sheet as unknown as OseActorSheetCharacter;\r\n\r\n      sheet.generateScores();\r\n      await waitForInput();\r\n\r\n      const windows = openWindows(\"creator\");\r\n      expect(windows.length).equal(1);\r\n    });\r\n\r\n    it(\"clicking on the dices generates scores\", async () => {\r\n      const actor = await createMockActorKey(\"character\", {}, key);\r\n      const sheet = actor?.sheet as unknown as OseActorSheetCharacter;\r\n\r\n      sheet.generateScores();\r\n      await delay(400);\r\n\r\n      const windows = openWindows(\"creator\");\r\n      expect(windows.length).equal(1);\r\n\r\n      Object.keys(scores).forEach(async (score) => {\r\n        $(`.creator div[data-score=\"${score}\"] a.score-roll`).trigger(\"click\");\r\n        await waitForInput();\r\n\r\n        const scoreValue = document.querySelector(\r\n          `.creator div[data-score=\"${score}\"] input.score-value`\r\n        );\r\n        const { value } = scoreValue;\r\n        expect(parseInt(value, 10) > 0).equal(true);\r\n      });\r\n    });\r\n\r\n    // @todo: this needs fixing\r\n    it(\"saving scores records data to actor\", async () => {\r\n      const actor = await createMockActorKey(\"character\", {}, key);\r\n      const sheet = actor?.sheet as unknown as OseActorSheetCharacter;\r\n\r\n      sheet.generateScores();\r\n      await delay(400);\r\n\r\n      const windows = openWindows(\"creator\");\r\n      expect(windows.length).equal(1);\r\n\r\n      Object.keys(scores).forEach(async (score) => {\r\n        $(`.creator div[data-score=\"${score}\"] a.score-roll`).trigger(\"click\");\r\n        await waitForInput();\r\n\r\n        const scoreValue = document.querySelector(\r\n          `.creator div[data-score=\"${score}\"] input.score-value`\r\n        );\r\n        const { value } = scoreValue;\r\n        expect(parseInt(value, 10) > 0).equal(true);\r\n        scores[score] = parseInt(value, 10);\r\n      });\r\n\r\n      $(`.creator footer button`).trigger(\"submit\");\r\n      await waitForInput();\r\n\r\n      expect(actor?.system.scores.str.value).equal(scores.str);\r\n      expect(actor?.system.scores.dex.value).equal(scores.dex);\r\n      expect(actor?.system.scores.wis.value).equal(scores.wis);\r\n      expect(actor?.system.scores.int.value).equal(scores.int);\r\n      expect(actor?.system.scores.con.value).equal(scores.con);\r\n      expect(actor?.system.scores.cha.value).equal(scores.cha);\r\n    });\r\n\r\n    // @todo: Auto-roll testing\r\n    // @todo: Gold rolling testing\r\n\r\n    afterEach(async () => {\r\n      await trashChat();\r\n      await cleanUpActorsByKey(key);\r\n      const windows = openWindows(\"creator\");\r\n      windows.forEach((w) => w.close());\r\n      await delay(300);\r\n    });\r\n  });\r\n\r\n  describe(\"getData()\", () => {\r\n    it(\"returns the expected data\", async () => {\r\n      const actor = await createMockActorKey(\"character\", {}, key);\r\n      const data = await actor?.sheet?.getData();\r\n\r\n      expect(Object.keys(data)).contain(\"enrichedBiography\");\r\n      expect(Object.keys(data)).contain(\"enrichedNotes\");\r\n\r\n      // _prepareItems tests\r\n      expect(Object.keys(data)).contain(\"owned\");\r\n      expect(Object.keys(data?.owned)).contain(\"weapons\");\r\n      expect(Object.keys(data?.owned)).contain(\"items\");\r\n      expect(Object.keys(data?.owned)).contain(\"containers\");\r\n      expect(Object.keys(data?.owned)).contain(\"armors\");\r\n      expect(Object.keys(data?.owned)).contain(\"treasures\");\r\n      expect(Object.keys(data)).contain(\"containers\");\r\n      expect(Object.keys(data)).contain(\"abilities\");\r\n      expect(Object.keys(data)).contain(\"spells\");\r\n      expect(Object.keys(data)).contain(\"slots\");\r\n      expect(Object.keys(data)).contain(\"system\");\r\n      expect(Object.keys(data?.system)).contain(\"usesAscendingAC\");\r\n      expect(Object.keys(data?.system)).contain(\"meleeMod\");\r\n      expect(Object.keys(data?.system)).contain(\"rangedMod\");\r\n      expect(Object.keys(data?.system)).contain(\"init\");\r\n    });\r\n\r\n    after(async () => {\r\n      await cleanUpActorsByKey(key);\r\n    });\r\n  });\r\n\r\n  describe(\"_chooseLang()\", () => {\r\n    it(\"renders a dialog\", async () => {\r\n      const actor = await createMockActorKey(\"character\", {}, key);\r\n      // eslint-disable-next-line no-underscore-dangle\r\n      actor?.sheet?._chooseLang();\r\n      await waitForInput();\r\n\r\n      const dialogs = openDialogs();\r\n      expect(dialogs.length).equal(1);\r\n      dialogs[0].close();\r\n    });\r\n\r\n    after(async () => {\r\n      await cleanUpActorsByKey(key);\r\n      await closeDialogs();\r\n      await delay(300);\r\n    });\r\n  });\r\n\r\n  describe(\"_pushLang(table)\", () => {\r\n    const table = \"languages\";\r\n\r\n    it(\"renders a dialog\", async () => {\r\n      const actor = await createMockActorKey(\"character\", {}, key);\r\n      // eslint-disable-next-line no-underscore-dangle\r\n      actor?.sheet?._pushLang(table);\r\n      await waitForInput();\r\n\r\n      const dialogs = openDialogs();\r\n      expect(dialogs.length).equal(1);\r\n      dialogs[0].close();\r\n    });\r\n\r\n    it(\"adds language on OK\", async () => {\r\n      const actor = await createMockActorKey(\"character\", {}, key);\r\n      // eslint-disable-next-line no-underscore-dangle\r\n      actor?.sheet?._pushLang(table);\r\n      await delay(220);\r\n\r\n      $(`button.ok`).trigger(\"click\");\r\n      await delay(500);\r\n\r\n      const dialogs = openDialogs();\r\n      expect(dialogs.length).equal(0);\r\n\r\n      expect(actor?.system.languages.value.length).equal(1);\r\n      expect(actor?.system.languages.value[0]).equal(\"Common\");\r\n    });\r\n\r\n    after(async () => {\r\n      await cleanUpActorsByKey(key);\r\n      await closeDialogs();\r\n    });\r\n  });\r\n\r\n  describe(\"_popLang(table, lang)\", () => {\r\n    const table = \"languages\";\r\n\r\n    it(\"can remove added language\", async () => {\r\n      const actor = await createMockActorKey(\"character\", {}, key);\r\n      await actor?.update({ \"system.languages.value\": [\"Common\"] });\r\n      await waitForInput();\r\n\r\n      expect(actor?.system.languages.value.length).equal(1);\r\n      expect(actor?.system.languages.value[0]).equal(\"Common\");\r\n\r\n      // eslint-disable-next-line no-underscore-dangle\r\n      actor?.sheet?._popLang(table, \"Common\");\r\n      await waitForInput();\r\n\r\n      expect(actor?.system.languages.value.length).equal(0);\r\n    });\r\n\r\n    after(async () => {\r\n      await cleanUpActorsByKey(key);\r\n    });\r\n  });\r\n\r\n  describe(\"_onShowModifiers(event)\", () => {\r\n    it(\"renders a dialog\", async () => {\r\n      const actor = await createMockActorKey(\"character\", {}, key);\r\n      await actor?.update({\r\n        system: {\r\n          scores: {\r\n            str: { value: 10 },\r\n            dex: { value: 10 },\r\n            int: { value: 10 },\r\n            con: { value: 10 },\r\n            wis: { value: 10 },\r\n            cha: { value: 10 },\r\n          },\r\n        },\r\n      });\r\n      actor?.sheet?.render(true);\r\n      await waitForInput();\r\n\r\n      $(`.sheet .profile a[data-action=modifiers]`).trigger(\"click\");\r\n      await delay(200);\r\n\r\n      const dialogs = openDialogs();\r\n      expect(dialogs.length).equal(1);\r\n    });\r\n\r\n    after(async () => {\r\n      await cleanUpActorsByKey(key);\r\n      await closeDialogs();\r\n      await delay(400);\r\n    });\r\n  });\r\n\r\n  describe(\"_onShowGpCost(event, preparedData)\", () => {\r\n    it(\"renders a dialog\", async () => {\r\n      const actor = await createMockActorKey(\"character\", {}, key);\r\n      await actor?.update({\r\n        system: {\r\n          scores: {\r\n            str: { value: 10 },\r\n            dex: { value: 10 },\r\n            int: { value: 10 },\r\n            con: { value: 10 },\r\n            wis: { value: 10 },\r\n            cha: { value: 10 },\r\n          },\r\n        },\r\n      });\r\n      actor?.sheet?.render(true);\r\n      await waitForInput();\r\n\r\n      $(`.sheet .profile a[data-action=gp-cost]`).trigger(\"click\");\r\n      await delay(200);\r\n\r\n      const dialogs = openDialogs();\r\n      expect(dialogs.length).equal(1);\r\n    });\r\n\r\n    after(async () => {\r\n      await cleanUpActorsByKey(key);\r\n      await closeDialogs();\r\n      await delay(400);\r\n    });\r\n  });\r\n\r\n  // @todo: This seems unfinished\r\n  describe(\"_onShowItemTooltip(event)\", () => {});\r\n};\r\n","/**\r\n * @file Contains tests for Monster Sheet.\r\n */\r\n// eslint-disable-next-line import/no-cycle\r\nimport { QuenchMethods } from \"../../../e2e\";\r\nimport {\r\n  cleanUpActorsByKey,\r\n  closeDialogs,\r\n  closeSheets,\r\n  createActorTestItem,\r\n  createMockActorKey,\r\n  delay,\r\n  getMockActorKey,\r\n  openDialogs,\r\n  waitForInput,\r\n} from \"../../../e2e/testUtils\";\r\nimport OseActorSheetMonster from \"../monster-sheet\";\r\n\r\nexport const key = \"ose.actor.sheet.monster\";\r\nexport const options = { displayName: \"OSE: Actor: Sheet: Monster\" };\r\n\r\nexport default ({ describe, it, expect, after, before }: QuenchMethods) => {\r\n  const orginalCtrlSetting = game.settings.get(\r\n    game.system.id,\r\n    \"invertedCtrlBehavior\"\r\n  );\r\n\r\n  after(async () => {\r\n    await game.settings.set(\r\n      game.system.id,\r\n      \"invertedCtrlBehavior\",\r\n      orginalCtrlSetting\r\n    );\r\n    await cleanUpActorsByKey(key);\r\n    await closeSheets();\r\n  });\r\n\r\n  describe(\"defaultOptions()\", () => {\r\n    it(\"Has correctly set defaultOptions\", async () => {\r\n      const actor = await createMockActorKey(\"monster\", {}, key);\r\n      const sheet = actor?.sheet as unknown as OseActorSheetMonster;\r\n\r\n      expect(sheet.options.classes).contain(\"ose\");\r\n      expect(sheet.options.classes).contain(\"sheet\");\r\n      expect(sheet.options.classes).contain(\"actor\");\r\n      expect(sheet.options.classes).contain(\"monster\");\r\n\r\n      expect(sheet.options.template).contain(\r\n        \"/templates/actors/monster-sheet.html\"\r\n      );\r\n      expect(sheet.options.width).equal(450);\r\n      expect(sheet.options.height).equal(560);\r\n      expect(sheet.options.resizable).is.true;\r\n\r\n      expect(sheet.options.tabs.length).equal(1);\r\n      expect(Object.keys(sheet.options.tabs[0])).contain(\"navSelector\");\r\n      expect(sheet.options.tabs[0].navSelector).equal(\".tabs\");\r\n      expect(Object.keys(sheet.options.tabs[0])).contain(\"contentSelector\");\r\n      expect(sheet.options.tabs[0].contentSelector).equal(\".sheet-body\");\r\n      expect(Object.keys(sheet.options.tabs[0])).contain(\"initial\");\r\n      expect(sheet.options.tabs[0].initial).equal(\"attributes\");\r\n    });\r\n\r\n    after(async () => {\r\n      await cleanUpActorsByKey(key);\r\n    });\r\n  });\r\n\r\n  // @todo: Do we need separate tests for this, or is getData() enough?\r\n  describe(\"_prepareItems(data)\", () => {});\r\n\r\n  describe(\"getData()\", () => {\r\n    it(\"returns the expected data\", async () => {\r\n      const actor = await createMockActorKey(\"monster\", {}, key);\r\n      const data = await actor?.sheet?.getData();\r\n\r\n      // _prepareItems tests\r\n      expect(Object.keys(data)).contain(\"owned\");\r\n      expect(Object.keys(data?.owned)).contain(\"weapons\");\r\n      expect(Object.keys(data?.owned)).contain(\"items\");\r\n      expect(Object.keys(data?.owned)).contain(\"containers\");\r\n      expect(Object.keys(data?.owned)).contain(\"armors\");\r\n      expect(Object.keys(data?.owned)).contain(\"treasures\");\r\n      expect(Object.keys(data)).contain(\"attackPatterns\");\r\n      expect(Object.keys(data)).contain(\"spells\");\r\n      expect(Object.keys(data)).contain(\"isNew\");\r\n\r\n      expect(data?.config.morale).equal(\r\n        game.settings.get(game.system.id, \"morale\")\r\n      );\r\n      expect(Object.keys(data)).contain(\"system\");\r\n      expect(Object.keys(data?.system)).contain(\"details\");\r\n      expect(Object.keys(data?.system.details)).contain(\"treasure\");\r\n      expect(Object.keys(data?.system.details.treasure)).contain(\"link\");\r\n    });\r\n\r\n    after(async () => {\r\n      await cleanUpActorsByKey(key);\r\n    });\r\n  });\r\n\r\n  describe(\"generateSave()\", () => {\r\n    it(\"renders a dialog\", async () => {\r\n      const actor = await createMockActorKey(\"monster\", {}, key);\r\n      actor?.sheet?.generateSave();\r\n      await waitForInput();\r\n\r\n      const dialogs = openDialogs();\r\n      expect(dialogs.length).equal(1);\r\n      dialogs[0].close();\r\n    });\r\n\r\n    after(async () => {\r\n      await cleanUpActorsByKey(key);\r\n      await closeDialogs();\r\n      await delay(300);\r\n    });\r\n  });\r\n\r\n  describe(\"_onDrop(event)\", () => {\r\n    const createMockRollTable = async () =>\r\n      RollTable.create({ name: \"Test RollTable\" });\r\n\r\n    after(async () => {\r\n      await cleanUpActorsByKey(key);\r\n      game.tables\r\n        ?.filter((rt) => rt.name === \"Test RollTable\")\r\n        .forEach((rt) => rt.delete());\r\n    });\r\n\r\n    it(\"Can drag testing RollTable to Monster\", async () => {\r\n      const actor = await createMockActorKey(\"monster\", {}, key);\r\n      const rollTable = await createMockRollTable();\r\n      actor?.sheet?.render(true);\r\n      await delay(300);\r\n\r\n      // Setup DOM elements\r\n      const dragElement = document.querySelector(\r\n        `.tab li[data-document-id=${rollTable?.id}]`\r\n      );\r\n      const dropElement = document.querySelector(`.monster .window-content`);\r\n\r\n      // Check DOM elements\r\n      expect(dragElement).not.null;\r\n      expect(dropElement).not.null;\r\n\r\n      // Perform Drag\r\n      const mockDragStartEvent = new DragEvent(\"dragstart\", {\r\n        dataTransfer: new DataTransfer(),\r\n        bubbles: true,\r\n        cancelable: true,\r\n      });\r\n      dragElement?.dispatchEvent(mockDragStartEvent);\r\n\r\n      // Drop it\r\n      // eslint-disable-next-line no-underscore-dangle\r\n      actor?.sheet?._onDrop(mockDragStartEvent);\r\n      await waitForInput();\r\n\r\n      // Verify\r\n      expect(actor?.system.details.treasure.table).equal(\r\n        `@UUID[RollTable.${rollTable?.id}]`\r\n      );\r\n    });\r\n  });\r\n\r\n  describe(\"_resetAttacks(event)\", () => {\r\n    it(\"resets the counter to max\", async () => {\r\n      const actor = await createMockActorKey(\"monster\", {}, key);\r\n      actor?.sheet?.render(true);\r\n      const [item] = await createActorTestItem(actor, \"weapon\");\r\n      item.update({\r\n        system: {\r\n          counter: {\r\n            max: 4,\r\n            value: 1,\r\n          },\r\n        },\r\n      });\r\n      await delay(400);\r\n\r\n      expect(item.system.counter.value).equal(1);\r\n\r\n      // Click on reset\r\n      $(`.item-reset`).trigger(\"click\");\r\n      await waitForInput();\r\n\r\n      expect(item.system.counter.value).equal(4);\r\n    });\r\n\r\n    after(async () => {\r\n      await cleanUpActorsByKey(key);\r\n    });\r\n  });\r\n\r\n  describe(\"_updateAttackCounter(event)\", () => {\r\n    before(() => {\r\n      game.settings.set(game.system.id, \"invertedCtrlBehavior\", true);\r\n    });\r\n\r\n    it(\"updates counter when rolling\", async () => {\r\n      const actor = await createMockActorKey(\"monster\", {}, key);\r\n      actor?.sheet?.render(true);\r\n      const [item] = await createActorTestItem(actor, \"weapon\");\r\n      item.update({\r\n        system: {\r\n          counter: {\r\n            max: 4,\r\n            value: 4,\r\n          },\r\n        },\r\n      });\r\n      await delay(400);\r\n\r\n      expect(item.system.counter.value).equal(4);\r\n\r\n      // Click on reset\r\n      $(`.tab .item[data-item-id=\"${item.id}\"] .item-image`).trigger(\"click\");\r\n      await waitForInput();\r\n\r\n      expect(item.system.counter.value).equal(3);\r\n    });\r\n\r\n    after(async () => {\r\n      await cleanUpActorsByKey(key);\r\n    });\r\n  });\r\n\r\n  describe(\"_cycleAttackPatterns(event)\", () => {\r\n    const colors = Object.keys(CONFIG.OSE.colors);\r\n    colors.push(\"transparent\");\r\n\r\n    before(async () => {\r\n      const actor = await createMockActorKey(\"monster\", {}, key);\r\n      actor?.sheet?.render(true);\r\n      await createActorTestItem(actor, \"weapon\");\r\n      await delay(300);\r\n    });\r\n\r\n    describe(\"properly cycles between colors\", () => {\r\n      colors.forEach((color) => {\r\n        it(`works for color ${color}`, async () => {\r\n          const actor = await getMockActorKey(key);\r\n          const item = actor?.items.contents[0];\r\n          const currentPattern = item?.system.pattern;\r\n\r\n          expect(currentPattern).not.undefined;\r\n          const patternIndex = colors.indexOf(currentPattern);\r\n          const nextIndex =\r\n            patternIndex + 1 === colors.length ? 0 : patternIndex + 1;\r\n\r\n          // Click the thing\r\n          $(`.item-pattern`).trigger(\"click\");\r\n          await delay(200);\r\n\r\n          // Verify\r\n          expect(item?.system.pattern).equal(colors[nextIndex]);\r\n        });\r\n      });\r\n    });\r\n\r\n    after(async () => {\r\n      await cleanUpActorsByKey(key);\r\n    });\r\n  });\r\n};\r\n","/**\r\n * @file Contains tests for Character Modifiers sheet.\r\n */\r\n// eslint-disable-next-line prettier/prettier, import/no-cycle\r\nimport { QuenchMethods } from \"../../../e2e\";\r\nimport {\r\n  cleanUpActorsByKey,\r\n  createMockActorKey,\r\n  openWindows,\r\n  waitForInput,\r\n} from \"../../../e2e/testUtils\";\r\nimport OseCharacterModifiers from \"../character-modifiers\";\r\n\r\nexport const key = \"ose.actor.sheet.character.dialog.modifiers\";\r\nexport const options = {\r\n  displayName: \"OSE: Actor: Dialog Sheet: Character Modifiers\",\r\n};\r\n\r\nconst createMockActor = async (type: string, data: object = {}) =>\r\n  createMockActorKey(type, data, key);\r\n\r\nexport default ({ describe, it, expect, assert, after }: QuenchMethods) => {\r\n  describe(\"defaultOptions()\", () => {\r\n    it(\"Has correctly set defaultOptions\", () => {\r\n      const sheet = new OseCharacterModifiers();\r\n      expect(sheet.options.id).equal(\"sheet-modifiers\");\r\n      expect(sheet.options.classes).contain(\"ose\");\r\n      expect(sheet.options.classes).contain(\"dialog\");\r\n      expect(sheet.options.classes).contain(\"modifiers\");\r\n      expect(sheet.options.template).contain(\r\n        \"/templates/actors/dialogs/modifiers-dialog.html\"\r\n      );\r\n      expect(sheet.options.width).equal(240);\r\n    });\r\n  });\r\n\r\n  describe(\"title()\", () => {\r\n    it(\"Creates string in dialog window title\", async () => {\r\n      const actor = await createMockActor(\"character\");\r\n      const sheet = new OseCharacterModifiers(actor);\r\n      sheet.render(true);\r\n      await waitForInput();\r\n      const dialogTitle = document.querySelector(\r\n        \"div.modifiers .window-title\"\r\n      )?.innerHTML;\r\n      expect(typeof dialogTitle).equal(\"string\");\r\n      const dialogs = openWindows(\"modifiers\");\r\n      expect(dialogs.length).equal(1);\r\n      await dialogs[0].close();\r\n      expect(openWindows(\"modifiers\").length).equal(0);\r\n    });\r\n  });\r\n\r\n  describe(\"getData()\", () => {\r\n    it(\"Returns proper data\", async () => {\r\n      const actor = await createMockActor(\"character\");\r\n      const sheet = new OseCharacterModifiers(actor);\r\n      const data = sheet.getData();\r\n      const keys = Object.keys(data);\r\n      assert(keys.length > 0);\r\n      expect(keys).contain(\"user\");\r\n    });\r\n  });\r\n\r\n  after(async () => {\r\n    await cleanUpActorsByKey(key);\r\n  });\r\n};\r\n","/**\r\n * @file Contains tests for Entity Tweaks sheet.\r\n */\r\n// eslint-disable-next-line prettier/prettier, import/no-cycle\r\nimport { QuenchMethods } from \"../../../e2e\";\r\nimport {\r\n  cleanUpActorsByKey,\r\n  createMockActorKey,\r\n  openWindows,\r\n  waitForInput,\r\n} from \"../../../e2e/testUtils\";\r\nimport OseEntityTweaks from \"../entity-tweaks\";\r\n\r\nexport const key = \"ose.actor.sheet.dialog.entity-tweaks\";\r\nexport const options = {\r\n  displayName: \"OSE: Actor: Dialog Sheet: Entity Tweaks\",\r\n};\r\n\r\nconst createMockActor = async (type: string, data: object = {}) =>\r\n  createMockActorKey(type, data, key);\r\n\r\nexport default ({ describe, it, expect, assert, after }: QuenchMethods) => {\r\n  describe(\"defaultOptions()\", () => {\r\n    it(\"Has correctly set defaultOptions\", () => {\r\n      const entityTweaks = new OseEntityTweaks();\r\n      expect(entityTweaks.options.id).equal(\"sheet-tweaks\");\r\n      expect(entityTweaks.options.classes).contain(\"sheet-tweaks\");\r\n      expect(entityTweaks.options.template).contain(\r\n        \"/templates/actors/dialogs/tweaks-dialog.html\"\r\n      );\r\n      expect(entityTweaks.options.width).equal(380);\r\n    });\r\n  });\r\n\r\n  describe(\"title()\", () => {\r\n    it(\"Creates string in dialog window title\", async () => {\r\n      const actor = await createMockActor(\"character\");\r\n      const entityTweaks = new OseEntityTweaks(actor);\r\n      entityTweaks.render(true);\r\n      await waitForInput();\r\n      const dialogTitle = document.querySelector(\r\n        \"div.sheet-tweaks .window-title\"\r\n      )?.innerHTML;\r\n      expect(typeof dialogTitle).equal(\"string\");\r\n      const dialogs = openWindows(\"sheet-tweaks\");\r\n      expect(dialogs.length).equal(1);\r\n      await dialogs[0].close();\r\n      expect(openWindows(\"sheet-tweaks\").length).equal(0);\r\n    });\r\n  });\r\n\r\n  describe(\"getData()\", () => {\r\n    it(\"Returns proper data\", async () => {\r\n      const actor = await createMockActor(\"character\");\r\n      const entityTweaks = new OseEntityTweaks(actor);\r\n      const data = entityTweaks.getData();\r\n      const keys = Object.keys(data);\r\n      assert(keys.length >= 2);\r\n      expect(keys).contain(\"config\");\r\n      expect(keys).contain(\"user\");\r\n      assert(data.isCharacter);\r\n    });\r\n  });\r\n\r\n  // @todo: Test with Cypress or mock event\r\n  describe(\"_updateObject(event, formData)\", () => {});\r\n\r\n  after(async () => {\r\n    await cleanUpActorsByKey(key);\r\n  });\r\n};\r\n","/**\r\n * @file Contains tests for Ability Data Model.\r\n */\r\n// eslint-disable-next-line prettier/prettier, import/no-cycle\r\nimport { QuenchMethods } from \"../../../e2e\";\r\nimport OseDataModelAbility from \"../data-model-ability\";\r\n\r\nexport const key = \"ose.item.datamodel.ability\";\r\nexport const options = { displayName: \"OSE: Item: Data Model: Ability\" };\r\n\r\nexport default ({ describe, it, expect }: QuenchMethods) => {\r\n  describe(\"manualTags\", () => {\r\n    const ability = new OseDataModelAbility();\r\n    it(\"By default return empty array\", () => {\r\n      expect(ability.manualTags.length).equal(0);\r\n    });\r\n\r\n    it(\"Can write tags to tags field\", () => {\r\n      ability.tags = [{ title: \"title\", value: \"value\" }];\r\n      expect(ability.tags.length).equal(1);\r\n      expect(Object.keys(ability.tags[0]).length).equal(2);\r\n      expect(ability.tags[0].title).equal(\"title\");\r\n      expect(ability.tags[0].value).equal(\"value\");\r\n      expect(ability.tags[0].label).is.undefined;\r\n    });\r\n\r\n    it(\"Can retrieve tags\", () => {\r\n      expect(ability.manualTags.length).equal(1);\r\n      expect(ability.manualTags[0].title).equal(\"title\");\r\n      expect(ability.manualTags[0].value).equal(\"value\");\r\n      expect(ability.tags[0].label).is.undefined;\r\n    });\r\n  });\r\n\r\n  describe(\"autoTags\", () => {\r\n    const ability = new OseDataModelAbility();\r\n    it(\"By default return auto-tags\", () => {\r\n      expect(ability.autoTags.length).equal(1);\r\n      expect(Object.keys(ability.autoTags[0]).length).equal(1);\r\n    });\r\n\r\n    it(\"By default return empty label\", () => {\r\n      expect(ability.autoTags[0].label).equal(\"\");\r\n    });\r\n\r\n    it(\"By default return tshirt icon\", () => {\r\n      expect(ability.autoTags[0].icon).is.undefined;\r\n    });\r\n\r\n    it(\"Requirements create autoTags\", () => {\r\n      ability.requirements = \"magic-user,slow\";\r\n      expect(ability.autoTags.length).equal(2);\r\n      expect(Object.keys(ability.autoTags[0]).length).equal(1);\r\n      expect(ability.autoTags[0].label).equal(\"magic-user\");\r\n      expect(Object.keys(ability.autoTags[1]).length).equal(1);\r\n      expect(ability.autoTags[1].label).equal(\"slow\");\r\n    });\r\n\r\n    it(\"Save create autoTags\", () => {\r\n      ability.save = \"death\";\r\n      expect(ability.autoTags.length).equal(3);\r\n      expect(Object.keys(ability.autoTags[2]).length).equal(2);\r\n      expect(ability.autoTags[2].label).equal(\r\n        game.i18n.localize(\"OSE.saves.death.long\")\r\n      );\r\n      expect(ability.autoTags[2].icon).equal(\"fa-skull\");\r\n    });\r\n\r\n    it(\"Roll create autoTags\", () => {\r\n      ability.roll = \"1d20+1\";\r\n      expect(ability.autoTags.length).equal(4);\r\n      expect(Object.keys(ability.autoTags[3]).length).equal(2);\r\n      expect(ability.autoTags[2].label).equal(\r\n        `${game.i18n.localize(\"OSE.items.Roll\")} 1d20+1 undefinednull`\r\n      );\r\n    });\r\n  });\r\n};\r\n","/**\r\n * @file Contains tests for Armor Item Data Model.\r\n */\r\n// eslint-disable-next-line prettier/prettier, import/no-cycle\r\nimport { QuenchMethods } from \"../../../e2e\";\r\nimport OseDataModelArmor from \"../data-model-armor\";\r\n\r\nexport const key = \"ose.item.datamodel.armor\";\r\nexport const options = { displayName: \"OSE: Item: Data Model: Armor\" };\r\n\r\nexport default ({ describe, it, expect }: QuenchMethods) => {\r\n  describe(\"ArmorTypes\", () => {\r\n    const dataTypes = OseDataModelArmor.ArmorTypes;\r\n\r\n    it(\"Has 4 armor types\", () => {\r\n      expect(Object.keys(dataTypes).length).equal(4);\r\n    });\r\n    it(\"Has unarmored\", () => {\r\n      expect(dataTypes.unarmored).equal(\"OSE.armor.unarmored\");\r\n    });\r\n    it(\"Has light\", () => {\r\n      expect(dataTypes.light).equal(\"OSE.armor.light\");\r\n    });\r\n    it(\"Has heavy\", () => {\r\n      expect(dataTypes.heavy).equal(\"OSE.armor.heavy\");\r\n    });\r\n    it(\"Has shield\", () => {\r\n      expect(dataTypes.shield).equal(\"OSE.armor.shield\");\r\n    });\r\n  });\r\n\r\n  describe(\"manualTags\", () => {\r\n    const item = new OseDataModelArmor();\r\n\r\n    it(\"By default return empty array\", () => {\r\n      expect(item.manualTags.length).equal(0);\r\n    });\r\n\r\n    it(\"Can write tags to tags field\", () => {\r\n      item.tags = [{ title: \"title\", value: \"value\" }];\r\n      expect(item.tags.length).equal(1);\r\n      expect(Object.keys(item.tags[0]).length).equal(2);\r\n      expect(item.tags[0].title).equal(\"title\");\r\n      expect(item.tags[0].value).equal(\"value\");\r\n      expect(item.tags[0].label).is.undefined;\r\n    });\r\n\r\n    it(\"Can retrieve tags\", () => {\r\n      expect(item.manualTags.length).equal(1);\r\n      expect(Object.keys(item.tags[0]).length).equal(2);\r\n      expect(item.manualTags[0].title).equal(\"title\");\r\n      expect(item.manualTags[0].value).equal(\"value\");\r\n      expect(item.manualTags[0].label).equal(\"value\");\r\n    });\r\n  });\r\n\r\n  describe(\"autoTags\", () => {\r\n    const item = new OseDataModelArmor();\r\n\r\n    it(\"By default return auto-tags\", () => {\r\n      expect(item.autoTags.length).equal(1);\r\n      expect(Object.keys(item.autoTags[0]).length).equal(2);\r\n    });\r\n    it(\"By default return light armor\", () => {\r\n      expect(item.autoTags[0].label).equal(\"OSE.armor.light\");\r\n    });\r\n    it(\"By default return tshirt icon\", () => {\r\n      expect(item.autoTags[0].icon).equal(\"fa-tshirt\");\r\n    });\r\n  });\r\n};\r\n","/**\r\n * @file Contains tests for Container Item Data Model.\r\n */\r\n// eslint-disable-next-line prettier/prettier, import/no-cycle\r\nimport { QuenchMethods } from \"../../../e2e\";\r\nimport OseDataModelContainer from \"../data-model-container\";\r\n\r\nexport const key = \"ose.item.datamodel.container\";\r\nexport const options = { displayName: \"OSE: Item: Data Model: Container\" };\r\n\r\nexport default ({ describe, it, expect }: QuenchMethods) => {\r\n  describe(\"contents()\", () => {\r\n    it(\"Returns null if itemIds is empty Array\", () => {\r\n      const container = new OseDataModelContainer();\r\n      expect(container.contents).is.null;\r\n    });\r\n  });\r\n\r\n  describe(\"totalWeight()\", () => {\r\n    it(\"Returns 0 with no items\", () => {\r\n      const container = new OseDataModelContainer();\r\n      expect(container.totalWeight).equal(0);\r\n    });\r\n  });\r\n\r\n  describe(\"manualTags()\", () => {\r\n    const container = new OseDataModelContainer();\r\n    it(\"By default return empty array\", () => {\r\n      expect(container.manualTags.length).equal(0);\r\n    });\r\n\r\n    it(\"Can write tags to tags field\", () => {\r\n      container.tags = [{ value: \"value\", title: \"title\" }];\r\n      expect(container.tags.length).equal(1);\r\n      expect(Object.keys(container.tags[0]).length).equal(2);\r\n      expect(container.tags[0].title).equal(\"title\");\r\n      expect(container.tags[0].value).equal(\"value\");\r\n      expect(container.tags[0].label).is.undefined;\r\n    });\r\n\r\n    it(\"Can retrieve tags\", () => {\r\n      expect(container.manualTags.length).equal(1);\r\n      expect(container.manualTags[0].title).equal(\"title\");\r\n      expect(container.manualTags[0].value).equal(\"value\");\r\n      expect(container.tags[0].label).is.undefined;\r\n    });\r\n  });\r\n\r\n  describe(\"autoTags()\", () => {\r\n    const container = new OseDataModelContainer();\r\n    it(\"By default return no auto-tags\", () => {\r\n      expect(container.autoTags.length).equal(0);\r\n    });\r\n\r\n    it(\"Can create autoTags\", () => {\r\n      container.tags = [{ value: CONFIG.OSE.tags.blunt }];\r\n      expect(container.tags.length).equal(1);\r\n      expect(container.autoTags[0].label).equal(CONFIG.OSE.tags.blunt);\r\n      expect(container.autoTags[0].icon).equal(\"fa-hammer-crash\");\r\n      expect(container.autoTags[0].image).equal(\r\n        `${CONFIG.OSE.assetsPath}/blunt.png`\r\n      );\r\n    });\r\n  });\r\n};\r\n","/**\r\n * @file Contains tests for Misc Item Data Model.\r\n */\r\n// eslint-disable-next-line prettier/prettier, import/no-cycle\r\nimport { QuenchMethods } from \"../../../e2e\";\r\nimport OseDataModelItem from \"../data-model-item\";\r\n\r\nexport const key = \"ose.item.datamodel.misc\";\r\nexport const options = { displayName: \"OSE: Item: Data Model: Misc\" };\r\n\r\nexport default ({ describe, it, expect }: QuenchMethods) => {\r\n  describe(\"manualTags()\", () => {\r\n    const miscItem = new OseDataModelItem();\r\n    it(\"By default return empty array\", () => {\r\n      expect(miscItem.manualTags.length).equal(0);\r\n    });\r\n\r\n    it(\"Can write tags to tags field\", () => {\r\n      miscItem.tags = [{ title: \"title\", value: \"value\" }];\r\n      expect(miscItem.tags.length).equal(1);\r\n      expect(Object.keys(miscItem.tags[0]).length).equal(2);\r\n      expect(miscItem.tags[0].title).equal(\"title\");\r\n      expect(miscItem.tags[0].value).equal(\"value\");\r\n      expect(miscItem.tags[0].label).is.undefined;\r\n    });\r\n\r\n    it(\"Can retrieve tags\", () => {\r\n      expect(miscItem.manualTags.length).equal(1);\r\n      expect(miscItem.manualTags[0].title).equal(\"title\");\r\n      expect(miscItem.manualTags[0].value).equal(\"value\");\r\n      expect(miscItem.tags[0].label).is.undefined;\r\n    });\r\n  });\r\n\r\n  describe(\"autoTags()\", () => {\r\n    const miscItem = new OseDataModelItem();\r\n    it(\"By default return no auto-tags\", () => {\r\n      expect(miscItem.autoTags.length).equal(0);\r\n    });\r\n\r\n    it(\"Can create autoTags\", () => {\r\n      miscItem.tags = [{ value: CONFIG.OSE.tags.blunt }];\r\n      expect(miscItem.tags.length).equal(1);\r\n      expect(miscItem.autoTags[0].label).equal(CONFIG.OSE.tags.blunt);\r\n      expect(miscItem.autoTags[0].icon).equal(\"fa-hammer-crash\");\r\n      expect(miscItem.autoTags[0].image).equal(\r\n        `${CONFIG.OSE.assetsPath}/blunt.png`\r\n      );\r\n    });\r\n  });\r\n};\r\n","/**\r\n * @file Contains tests for Spell Item Data Model.\r\n */\r\n// eslint-disable-next-line prettier/prettier, import/no-cycle\r\nimport { QuenchMethods } from \"../../../e2e\";\r\nimport OseDataModelSpell from \"../data-model-spell\";\r\n\r\nexport const key = \"ose.item.datamodel.spell\";\r\nexport const options = { displayName: \"OSE: Item: Data Model: Spell\" };\r\n\r\nexport default ({ describe, it, expect }: QuenchMethods) => {\r\n  describe(\"manualTags()\", () => {\r\n    const spell = new OseDataModelSpell();\r\n    it(\"By default return empty array\", () => {\r\n      expect(spell.manualTags.length).equal(0);\r\n    });\r\n\r\n    it(\"Can write tags to tags field\", () => {\r\n      spell.tags = [{ title: \"title\", value: \"value\" }];\r\n      expect(spell.tags.length).equal(1);\r\n      expect(Object.keys(spell.tags[0]).length).equal(2);\r\n      expect(spell.tags[0].title).equal(\"title\");\r\n      expect(spell.tags[0].value).equal(\"value\");\r\n      expect(spell.tags[0].label).is.undefined;\r\n    });\r\n\r\n    it(\"Can retrieve tags\", () => {\r\n      expect(spell.manualTags.length).equal(1);\r\n      expect(spell.manualTags[0].title).equal(\"title\");\r\n      expect(spell.manualTags[0].value).equal(\"value\");\r\n      expect(spell.tags[0].label).is.undefined;\r\n    });\r\n  });\r\n\r\n  describe(\"autoTags()\", () => {\r\n    const spell = new OseDataModelSpell();\r\n    it(\"By default return 3 auto-tags\", () => {\r\n      expect(spell.autoTags.length).equal(3);\r\n      spell.autoTags.forEach((t) => {\r\n        expect(t).not.null;\r\n        expect(t?.label).equal(\"\");\r\n      });\r\n    });\r\n\r\n    it(\"Save create autoTags\", () => {\r\n      spell.save = \"death\";\r\n      expect(spell.autoTags.length).equal(4);\r\n      expect(Object.keys(spell.autoTags[3]).length).equal(2);\r\n      expect(spell.autoTags[3].label).equal(\r\n        game.i18n.localize(\"OSE.saves.death.long\")\r\n      );\r\n      expect(spell.autoTags[3].icon).equal(\"fa-skull\");\r\n    });\r\n\r\n    it(\"Roll create autoTags\", () => {\r\n      spell.roll = \"1d20+1\";\r\n      expect(spell.autoTags.length).equal(5);\r\n      expect(Object.keys(spell.autoTags[3]).length).equal(1);\r\n      expect(spell.autoTags[3].label).equal(\r\n        `${game.i18n.localize(\"OSE.items.Roll\")} 1d20+1`\r\n      );\r\n    });\r\n  });\r\n};\r\n","/**\r\n * @file Contains tests for Weapon Item Data Model.\r\n */\r\n// eslint-disable-next-line prettier/prettier, import/no-cycle\r\nimport { QuenchMethods } from \"../../../e2e\";\r\nimport OseDataModelWeapon from \"../data-model-weapon\";\r\n\r\nexport const key = \"ose.item.datamodel.weapon\";\r\nexport const options = { displayName: \"OSE: Item: Data Model: Weapon\" };\r\n\r\nexport default ({ describe, it, expect }: QuenchMethods) => {\r\n  describe(\"manualTags()\", () => {\r\n    const item = new OseDataModelWeapon();\r\n    it(\"By default return empty array\", () => {\r\n      expect(item.manualTags.length).equal(0);\r\n    });\r\n\r\n    it(\"Can write tags to tags field\", () => {\r\n      item.tags = [{ title: \"title\", value: \"value\" }];\r\n      expect(item.tags.length).equal(1);\r\n      expect(Object.keys(item.tags[0]).length).equal(2);\r\n      expect(item.tags[0].title).equal(\"title\");\r\n      expect(item.tags[0].value).equal(\"value\");\r\n      expect(item.tags[0].label).is.undefined;\r\n    });\r\n\r\n    it(\"Can retrieve tags\", () => {\r\n      expect(item.manualTags.length).equal(1);\r\n      expect(Object.keys(item.tags[0]).length).equal(2);\r\n      expect(item.manualTags[0].title).equal(\"title\");\r\n      expect(item.manualTags[0].value).equal(\"value\");\r\n      expect(item.manualTags[0].label).is.undefined;\r\n    });\r\n  });\r\n  describe(\"qualities()\", () => {\r\n    it(\"By default returns an empty array\", () => {\r\n      const item = new OseDataModelWeapon();\r\n      expect(item.qualities.length).equal(0);\r\n    });\r\n\r\n    it(\"Given a manual tag, it returns an array containing said tag\", () => {\r\n      const item = new OseDataModelWeapon();\r\n      item.tags = [{ value: \"slow\", label: \"slow\" }];\r\n      expect(item.qualities.length).equal(1);\r\n      expect(Object.keys(item.qualities[0]).length).equal(2);\r\n      expect(item.qualities[0].label).equal(item.manualTags[0].label);\r\n      expect(item.qualities[0].value).equal(item.manualTags[0].value);\r\n    });\r\n\r\n    it(\"Given a autoTag, it returns an array containing said autoTag\", () => {\r\n      const item = new OseDataModelWeapon();\r\n      item.slow = true;\r\n      expect(item.qualities.length).equal(1);\r\n      expect(Object.keys(item.qualities[0]).length).equal(4);\r\n      expect(item.qualities[0].label).equal(\"Slow\");\r\n      expect(item.qualities[0].title).equal(\"Slow\");\r\n      expect(item.qualities[0].icon).equal(\"fa-weight-hanging\");\r\n      expect(item.qualities[0].image).contain(\"assets/slow.png\");\r\n    });\r\n  });\r\n\r\n  describe(\"autotags()\", () => {\r\n    it(\"Returns an flattened array with damage and autotags\", () => {\r\n      const item = new OseDataModelWeapon();\r\n      expect(item.autoTags.length).equal(1);\r\n      expect(Object.keys(item.autoTags[0]).length).equal(2);\r\n      expect(item.autoTags[0].icon).equal(\"fa-tint\");\r\n      expect(item.autoTags[0].label).equal(\"\");\r\n    });\r\n\r\n    it(\"Damage is present in flattened array\", () => {\r\n      const item = new OseDataModelWeapon();\r\n      item.damage = \"1d13\";\r\n      expect(item.autoTags.length).equal(1);\r\n      expect(Object.keys(item.autoTags[0]).length).equal(2);\r\n      expect(item.autoTags[0].icon).equal(\"fa-tint\");\r\n      expect(item.autoTags[0].label).equal(\"1d13\");\r\n    });\r\n\r\n    it(\"A melee tag is returned as expected\", () => {\r\n      const item = new OseDataModelWeapon();\r\n      item.melee = true;\r\n      expect(item.autoTags.length).equal(2);\r\n      expect(Object.keys(item.autoTags[0]).length).equal(2);\r\n      expect(item.autoTags[0].icon).equal(\"fa-tint\");\r\n      expect(item.autoTags[0].label).equal(\"\");\r\n      expect(Object.keys(item.autoTags[1]).length).equal(3);\r\n      expect(item.autoTags[1].label).equal(\"Melee\");\r\n      expect(item.autoTags[1].icon).equal(\"fa-sword\");\r\n      expect(item.autoTags[1].image).contain(\"assets/melee.png\");\r\n    });\r\n\r\n    it(\"A missile tag is returned as expected\", () => {\r\n      const item = new OseDataModelWeapon();\r\n      item.missile = true;\r\n      expect(item.autoTags.length).equal(3);\r\n      expect(Object.keys(item.autoTags[0]).length).equal(2);\r\n      expect(item.autoTags[0].icon).equal(\"fa-tint\");\r\n      expect(item.autoTags[0].label).equal(\"\");\r\n      expect(Object.keys(item.autoTags[1]).length).equal(3);\r\n      expect(item.autoTags[1].label).equal(\"Missile\");\r\n      expect(item.autoTags[1].icon).equal(\"fa-bow-arrow\");\r\n      expect(item.autoTags[1].image).contain(\"assets/missile.png\");\r\n      expect(Object.keys(item.autoTags[2]).length).equal(2);\r\n      expect(item.autoTags[2].label).equal(\"0/0/0\");\r\n      expect(item.autoTags[2].icon).equal(\"fa-bullseye\");\r\n    });\r\n\r\n    it(\"A missile tag with ranges is returned as expected\", () => {\r\n      const item = new OseDataModelWeapon();\r\n      item.missile = true;\r\n      item.range.short = 30;\r\n      item.range.medium = 60;\r\n      item.range.long = 90;\r\n      expect(item.autoTags.length).equal(3);\r\n      expect(Object.keys(item.autoTags[0]).length).equal(2);\r\n      expect(item.autoTags[0].icon).equal(\"fa-tint\");\r\n      expect(item.autoTags[0].label).equal(\"\");\r\n      expect(Object.keys(item.autoTags[1]).length).equal(3);\r\n      expect(item.autoTags[1].label).equal(\"Missile\");\r\n      expect(item.autoTags[1].icon).equal(\"fa-bow-arrow\");\r\n      expect(item.autoTags[1].image).contain(\"assets/missile.png\");\r\n      expect(Object.keys(item.autoTags[2]).length).equal(2);\r\n      expect(item.autoTags[2].label).equal(\"30/60/90\");\r\n      expect(item.autoTags[2].icon).equal(\"fa-bullseye\");\r\n    });\r\n\r\n    it(\"A slow tag is returned as expected\", () => {\r\n      const item = new OseDataModelWeapon();\r\n      item.slow = true;\r\n      expect(item.autoTags.length).equal(2);\r\n      expect(Object.keys(item.autoTags[0]).length).equal(2);\r\n      expect(item.autoTags[0].icon).equal(\"fa-tint\");\r\n      expect(item.autoTags[0].label).equal(\"\");\r\n      expect(Object.keys(item.autoTags[1]).length).equal(3);\r\n      expect(item.autoTags[1].label).equal(\"Slow\");\r\n      expect(item.autoTags[1].icon).equal(\"fa-weight-hanging\");\r\n      expect(item.autoTags[1].image).contain(\"assets/slow.png\");\r\n    });\r\n\r\n    it(\"A save tag is returned as expected\", () => {\r\n      const item = new OseDataModelWeapon();\r\n      item.save = \"death\";\r\n      expect(item.autoTags.length).equal(2);\r\n      expect(Object.keys(item.autoTags[0]).length).equal(2);\r\n      expect(item.autoTags[0].icon).equal(\"fa-tint\");\r\n      expect(item.autoTags[0].label).equal(\"\");\r\n      expect(Object.keys(item.autoTags[1]).length).equal(2);\r\n      expect(item.autoTags[1].label).equal(\r\n        game.i18n.localize(\"OSE.saves.death.long\")\r\n      );\r\n      expect(item.autoTags[1].icon).equal(\"fa-skull\");\r\n    });\r\n  });\r\n};\r\n","/**\r\n * @file Contains tests for Item Data Model.\r\n */\r\n// eslint-disable-next-line prettier/prettier, import/no-cycle\r\nimport { QuenchMethods } from \"../../../e2e\";\r\nimport {\r\n  cleanUpWorldItems,\r\n  closeDialogs,\r\n  createActorTestItem,\r\n  createMockActorKey,\r\n  createWorldTestItem,\r\n  openDialogs,\r\n  trashChat,\r\n  waitForInput,\r\n} from \"../../../e2e/testUtils\";\r\nimport OseItem from \"../entity\";\r\n\r\nexport const key = \"ose.item.entity\";\r\nexport const options = { displayName: \"OSE: Item: Entity\" };\r\n\r\nconst createMockActor = async (data: object = {}) =>\r\n  createMockActorKey(\"character\", data, key);\r\n\r\nexport default ({\r\n  describe,\r\n  it,\r\n  expect,\r\n  after,\r\n  beforeEach,\r\n  assert,\r\n}: QuenchMethods) => {\r\n  const itemTypes = new Set([\r\n    \"spell\",\r\n    \"ability\",\r\n    \"armor\",\r\n    \"weapon\",\r\n    \"item\",\r\n    \"container\",\r\n  ]);\r\n\r\n  const { defaultIcons } = OseItem;\r\n\r\n  after(async () => {\r\n    cleanUpWorldItems();\r\n  });\r\n\r\n  describe(\"defaultIcons()\", () => {\r\n    it(\"There are 6 default icons\", () =>\r\n      expect(Object.keys(defaultIcons).length).equal(6));\r\n\r\n    itemTypes.forEach((type: string) => {\r\n      it(`Has ${type} icon`, () => expect(defaultIcons[type]).is.not.undefined);\r\n    });\r\n\r\n    it(\"Asking for other items return null\", () =>\r\n      expect(defaultIcons.non_existing).is.undefined);\r\n  });\r\n\r\n  describe(\"create()\", () => {\r\n    const testItemCreate = async (type: string) => {\r\n      const item = await createWorldTestItem(type);\r\n      expect(item).is.not.undefined;\r\n      expect(item?.img).equals(defaultIcons[type]);\r\n      const itemName = item?.name;\r\n      await item?.delete();\r\n      expect(game.items?.find((o) => o.name === itemName)).is.undefined;\r\n    };\r\n\r\n    it(\"Can create weapon OseItem\", async () => {\r\n      await testItemCreate(\"weapon\");\r\n    });\r\n    it(\"Can create armor OseItem\", async () => {\r\n      await testItemCreate(\"armor\");\r\n    });\r\n    it(\"Can create item OseItem\", async () => {\r\n      await testItemCreate(\"item\");\r\n    });\r\n    it(\"Can create spell OseItem\", async () => {\r\n      await testItemCreate(\"spell\");\r\n    });\r\n    it(\"Can create ability OseItem\", async () => {\r\n      await testItemCreate(\"ability\");\r\n    });\r\n    it(\"Can create container OseItem\", async () => {\r\n      await testItemCreate(\"container\");\r\n    });\r\n\r\n    // Requires chai-as-promised\r\n    /*\r\n    it('Can\\'t create without name', async () => {\r\n      await expect(OseItem.create({type: 'container'})).to.be.rejectedWith(\r\n        Error, \r\n        \"[OseItem.name] may not be a blank string\")\r\n    })\r\n    it('Can\\'t create without type', async () => {\r\n      await expect(OseItem.create({name: 'Test Item'})).to.be.rejectedWith(\r\n        Error, \r\n        \"[OseItem.type] may not be a blank string\")\r\n    })\r\n    it('Can\\'t create without acceptable type', async () => {\r\n      await expect(OseItem.create({name: 'Test Item', type: 'TEST'})).to.be.rejectedWith(\r\n        Error, \r\n        \"[OseItem.type] TEST is not a valid choice\")\r\n    }) \r\n    */\r\n  });\r\n\r\n  // @todo: How to test?\r\n  describe(\"prepareData()\", () => {});\r\n\r\n  describe(\"prepareDerivedData()\", () => {\r\n    it(\"has the expected fields\", async () => {\r\n      const item = (await createWorldTestItem(type)) as OseItem;\r\n      expect(item?.system.enrichedDescription).not.undefined;\r\n      await item?.delete();\r\n    });\r\n  });\r\n\r\n  // @todo: How to mock html?\r\n  describe(\"chatListeners(html)\", () => {\r\n    it(\"Correctly binds _onChatCardAction to element\", () => {});\r\n    it(\"Correctly binds _onChatCardToggleContent to element\", () => {});\r\n  });\r\n\r\n  /// @todo: How to test?\r\n  describe(\"getChatData(htmlOptions)\", () => {\r\n    it(\"Weapon with tags correctly stored in item.system.properties\", () => {});\r\n    it(\"Spell stores class, level, range, and duration in item.system.properties\", () => {});\r\n    it('Equipped item stores \"Equipped\" in item.system.properties', () => {});\r\n    it(\"Properly returns itemData\", () => {});\r\n  });\r\n\r\n  describe(\"rollWeapon(options)\", () => {\r\n    it(\"Actor with melee & missile weapon renders dialog\", async () => {\r\n      const actor: OseActor = await createMockActor();\r\n      await createActorTestItem(actor, \"weapon\");\r\n      const weapon: OseItem = actor?.items.contents[0];\r\n      await weapon?.update({ system: { melee: true, missile: true } });\r\n      const result = weapon.rollWeapon();\r\n      await waitForInput();\r\n      await actor.delete();\r\n      expect(openDialogs().length).equal(1);\r\n      assert(result);\r\n      await closeDialogs();\r\n      await waitForInput();\r\n      await waitForInput();\r\n      await waitForInput();\r\n      expect(openDialogs().length).equal(0);\r\n    });\r\n\r\n    it(\"Actor with weapon with \", async () => {\r\n      const actor: OseActor = await createMockActor();\r\n      await createActorTestItem(actor, \"weapon\");\r\n      const weapon: OseItem = actor?.items.contents[0];\r\n      await weapon?.update({ system: { missile: true, melee: false } });\r\n      const result = weapon.rollWeapon();\r\n      await actor.delete();\r\n      assert(result);\r\n    });\r\n  });\r\n\r\n  describe(\"rollFormula(options)\", () => {\r\n    it(\"Missing item.system.roll throws error\", async () => {\r\n      const item: OseItem = await createWorldTestItem(\"item\");\r\n      try {\r\n        await item.rollFormula();\r\n      } catch (error: any) {\r\n        expect(error.name).equal(\"Error\");\r\n      }\r\n    });\r\n    it(\"Casting a spell trigger a dialog\", async () => {\r\n      const item: OseItem = await createWorldTestItem(\"spell\");\r\n      await item.update({ system: { roll: \"1d20+12\" } });\r\n      await item.rollFormula();\r\n      await waitForInput();\r\n      await waitForInput();\r\n      await waitForInput();\r\n      expect(openDialogs().length).equal(1);\r\n      await closeDialogs();\r\n      await trashChat();\r\n    });\r\n    it(\"A OseDice.Roll is returned from method\", async () => {\r\n      const item: OseItem = await createWorldTestItem(\"spell\");\r\n      await item.update({ system: { roll: \"1d20+12\" } });\r\n      const result: any = await item.rollFormula();\r\n      assert(result instanceof Roll);\r\n    });\r\n  });\r\n\r\n  describe(\"spendSpell()\", () => {\r\n    it(\"Calling using non-spell item throws an error\", async () => {\r\n      const item: OseItem = await createWorldTestItem(\"weapon\");\r\n      try {\r\n        await item.spendSpell();\r\n      } catch (error: unknown) {\r\n        expect(error.name).equal(\"Error\");\r\n      }\r\n    });\r\n    it(\"Calling function reduces item.system.cast by one\", async () => {\r\n      const item: OseItem = await createWorldTestItem(\"spell\");\r\n      const initialSlots: Number = 3;\r\n      await item.update({ system: { cast: initialSlots } });\r\n      await item.spendSpell();\r\n      expect(item?.system?.cast).equal(initialSlots - 1);\r\n    });\r\n  });\r\n\r\n  describe(\"_getRollTag(data)\", () => {\r\n    it(\"Data provided without a roll key returns void\", async () => {\r\n      const item: OseItem = await createWorldTestItem(\"weapon\");\r\n      // eslint-disable-next-line no-underscore-dangle\r\n      const tag = item._getRollTag({});\r\n      expect(tag).to.be.undefined;\r\n    });\r\n    it(\"Returns ab object with value containing roll-info\", async () => {\r\n      const item: OseItem = await createWorldTestItem(\"weapon\");\r\n      // eslint-disable-next-line no-underscore-dangle\r\n      const tag = item._getRollTag({ roll: \"1d12+4\" });\r\n      expect(tag).not.to.be.undefined;\r\n      expect(tag?.label).equal(\"Roll 1d12+4\");\r\n    });\r\n  });\r\n\r\n  describe(\"_getSaveTag(data)\", () => {\r\n    it(\"Data provided without a save key returns void\", async () => {\r\n      const item: OseItem = await createWorldTestItem(\"weapon\");\r\n      // eslint-disable-next-line no-underscore-dangle\r\n      const tag = item._getSaveTag({});\r\n      expect(tag).to.be.undefined;\r\n    });\r\n    it(\"Returns an object with two keys; label and icon\", async () => {\r\n      const item: OseItem = await createWorldTestItem(\"weapon\");\r\n      // eslint-disable-next-line no-underscore-dangle\r\n      const tag = item._getSaveTag({ save: \"death\" });\r\n      expect(tag).not.to.be.undefined;\r\n      expect(tag?.label).equal(\"Death Poison\");\r\n      expect(tag?.icon).equal(\"fa-skull\");\r\n    });\r\n  });\r\n\r\n  describe(\"pushManualTag(values)\", () => {\r\n    const testPushManualTag = async (\r\n      item: OseItem,\r\n      tag: string,\r\n      itemTagData: { label: string; title: string; value: string }\r\n      // eslint-disable-next-line unicorn/consistent-function-scoping\r\n    ) => {\r\n      expect(item?.system?.tags.length).equal(0);\r\n      await item?.pushManualTag([tag]);\r\n      expect(item?.system?.tags.length).equal(1);\r\n      const itemTag = item?.system?.tags?.pop();\r\n      expect(itemTag.label).equal(itemTagData.label);\r\n      expect(itemTag.title).equal(itemTagData.title);\r\n      expect(itemTag.value).equal(itemTagData.value);\r\n    };\r\n\r\n    // eslint-disable-next-line unicorn/consistent-function-scoping\r\n    const pushManualTag = async (item: OseItem, tag: string) => {\r\n      expect(item?.system?.tags.length).equal(0);\r\n      await item?.pushManualTag([tag]);\r\n    };\r\n\r\n    const testSystemBooleans = (\r\n      item: OseItem,\r\n      flags: { melee: boolean; slow: boolean; missile: boolean }\r\n    ) => {\r\n      expect(item.system.melee).equal(flags.melee);\r\n      expect(item.system.slow).equal(flags.slow);\r\n      expect(item.system.missile).equal(flags.missile);\r\n    };\r\n\r\n    it(\"Provided value without () adds value to all keys\", async () => {\r\n      const item: OseItem = await createWorldTestItem(\"weapon\");\r\n      await testPushManualTag(item, \"test\", {\r\n        label: \"test\",\r\n        title: \"test\",\r\n        value: \"test\",\r\n      });\r\n      item.delete();\r\n    });\r\n    it(\"Provided values have tags within () added to array as title\", async () => {\r\n      const item: OseItem = await createWorldTestItem(\"weapon\");\r\n      await testPushManualTag(item, \"test (test2)\", {\r\n        label: \"test\",\r\n        title: \"test2\",\r\n        value: \"test\",\r\n      });\r\n      item.delete();\r\n    });\r\n\r\n    // Default\r\n    it(\"Weapons are automatically melee\", async () => {\r\n      const item: OseItem = await createWorldTestItem(\"weapon\");\r\n      testSystemBooleans(item, { melee: true, slow: false, missile: false });\r\n      await item?.delete();\r\n    });\r\n\r\n    // Boolean tags\r\n    const booleanTags = new Set([\r\n      CONFIG.OSE.tags.melee,\r\n      CONFIG.OSE.tags.slow,\r\n      CONFIG.OSE.tags.missile,\r\n    ]);\r\n\r\n    booleanTags.forEach((t) => {\r\n      it(`\"${t}\" tag activates the boolean but not a tag`, async () => {\r\n        const item: OseItem = await createWorldTestItem(\"weapon\");\r\n        await pushManualTag(item, t);\r\n        testSystemBooleans(item, {\r\n          melee: true,\r\n          slow: t === CONFIG.OSE.tags.slow,\r\n          missile: t === CONFIG.OSE.tags.missile,\r\n        });\r\n        item.delete();\r\n      });\r\n      it(`\"Test (${t})\" tags activates the boolean and adds a tag`, async () => {\r\n        const item: OseItem = await createWorldTestItem(\"weapon\");\r\n        await testPushManualTag(item, `Test (${t})`, {\r\n          label: \"Test\",\r\n          title: t,\r\n          value: \"Test\",\r\n        });\r\n        testSystemBooleans(item, {\r\n          melee: true,\r\n          slow: t === CONFIG.OSE.tags.slow,\r\n          missile: t === CONFIG.OSE.tags.missile,\r\n        });\r\n        item.delete();\r\n      });\r\n    });\r\n  });\r\n\r\n  describe(\"popManualTag(value)\", () => {\r\n    it(\"Item without system.tags return undefined\", async () => {\r\n      const item: OseItem = await createWorldTestItem(\"weapon\");\r\n      expect(item.system.tags.length).equal(0);\r\n      const poppedTag = await item.popManualTag(\"test\");\r\n      expect(poppedTag).equal(undefined);\r\n    });\r\n    it(\"Tags matching input value are removed from item.system.tags\", async () => {\r\n      const item: OseItem = await createWorldTestItem(\"weapon\");\r\n      expect(item.system.tags.length).equal(0);\r\n\r\n      await item.pushManualTag([\"test\", \"test2\"]);\r\n      expect(item.system.tags.length).equal(2);\r\n\r\n      await item.popManualTag(\"test\");\r\n      expect(item.system.tags.length).equal(1);\r\n      expect(item.system.tags.pop().title).equal(\"test2\");\r\n    });\r\n  });\r\n\r\n  describe(\"getAutoTagList()\", () => {\r\n    it(\"Container does nothing\", async () => {\r\n      const item: OseItem = await createWorldTestItem(\"container\");\r\n      const tagList = item.getAutoTagList();\r\n      expect(tagList.length).equal(0);\r\n      item.delete();\r\n    });\r\n    it(\"Item does nothing\", async () => {\r\n      const item: OseItem = await createWorldTestItem(\"item\");\r\n      const tagList = item.getAutoTagList();\r\n      expect(tagList.length).equal(0);\r\n      item.delete();\r\n    });\r\n    it(\"Weapon has damage label applied\", async () => {\r\n      const item: OseItem = await createWorldTestItem(\"weapon\");\r\n      const tagList = item.getAutoTagList();\r\n      expect(tagList.length).equal(1);\r\n      expect(tagList[0].icon).equal(\"fa-tint\");\r\n      expect(tagList[0].label).equal(\"1d6\");\r\n      item.delete();\r\n    });\r\n    it(\"Missile weapon has ranges applied\", async () => {\r\n      const item: OseItem = await createWorldTestItem(\"weapon\");\r\n      await item.pushManualTag([CONFIG.OSE.tags.missile]);\r\n      assert(item.system.missile);\r\n      const tagList = item.getAutoTagList();\r\n      expect(tagList.length).equal(2);\r\n      expect(tagList[0].icon).equal(\"fa-tint\");\r\n      expect(tagList[0].label).equal(\"1d6\");\r\n      expect(tagList[1].icon).equal(\"fa-bullseye\");\r\n      expect(tagList[1].label).equal(\"0/0/0\");\r\n      item.delete();\r\n    });\r\n    it(\"Manual weapon tags are applied\", async () => {\r\n      const item: OseItem = await createWorldTestItem(\"weapon\");\r\n      await item.pushManualTag([\"Test\"]);\r\n      const tagList = item.getAutoTagList();\r\n      expect(tagList.length).equal(2);\r\n      expect(tagList[0].icon).equal(\"fa-tint\");\r\n      expect(tagList[0].label).equal(\"1d6\");\r\n      expect(tagList[1].label).equal(\"Test\");\r\n      item.delete();\r\n    });\r\n    it(\"Default Armor has armor type applied\", async () => {\r\n      const item: OseItem = await createWorldTestItem(\"armor\");\r\n      const tagList = item.getAutoTagList();\r\n      expect(tagList.length).equal(1);\r\n      expect(tagList[0].icon).equal(\"fa-tshirt\");\r\n      expect(tagList[0].label).equal(\"Light\");\r\n      item.delete();\r\n    });\r\n    it(\"Heavy Armor has armor type applied\", async () => {\r\n      const item: OseItem = await createWorldTestItem(\"armor\");\r\n      await item.update({ system: { type: \"heavy\" } });\r\n      const tagList = item.getAutoTagList();\r\n      expect(tagList.length).equal(1);\r\n      expect(tagList[0].icon).equal(\"fa-tshirt\");\r\n      expect(tagList[0].label).equal(\"Heavy\");\r\n      item.delete();\r\n    });\r\n    it(\"Spells have class, range, and duration applied\", async () => {\r\n      const item: OseItem = await createWorldTestItem(\"spell\");\r\n      const tagList = item.getAutoTagList();\r\n      expect(tagList.length).equal(3);\r\n      expect(tagList[0].label).equal(\"Magic-User\");\r\n      expect(tagList[1].label).equal(\"\");\r\n      expect(tagList[2].label).equal(\"\");\r\n      item.delete();\r\n    });\r\n    it(\"Abilities have requirements applied\", async () => {\r\n      const item: OseItem = await createWorldTestItem(\"ability\");\r\n      await item.update({ system: { requirements: \"alice,bob\" } });\r\n      const tagList = item.getAutoTagList();\r\n      expect(tagList.length).equal(2);\r\n      expect(tagList[0].label).equal(\"alice\");\r\n      expect(tagList[1].label).equal(\"bob\");\r\n      item.delete();\r\n    });\r\n    it(\"If rollTag exists, it is applied\", async () => {\r\n      const item: OseItem = await createWorldTestItem(\"spell\");\r\n      await item.update({ system: { roll: \"1d20+12\" } });\r\n      const tagList = item.getAutoTagList();\r\n      expect(tagList.length).equal(4);\r\n      expect(tagList[3].label).equal(\"Roll 1d20+12\");\r\n      item.delete();\r\n    });\r\n    it(\"If saveTag exists, it is applied\", async () => {\r\n      const item: OseItem = await createWorldTestItem(\"spell\");\r\n      await item.update({ system: { save: \"death\" } });\r\n      const tagList = item.getAutoTagList();\r\n      expect(tagList.length).equal(4);\r\n      expect(tagList[3].label).equal(\"Death Poison\");\r\n      expect(tagList[3].icon).equal(\"fa-skull\");\r\n      item.delete();\r\n    });\r\n  });\r\n\r\n  // @todo How to test?\r\n  describe(\"roll(options)\", () => {\r\n    it(\"Item of weapon type activates rollWeapon\", async () => {});\r\n    it(\"Item of spell type activates spendSpell\", () => {});\r\n    it(\"Item of ability type activates rollFormula if it has associated item.system.roll\", () => {});\r\n    it(\"Item of ability type shows chat card if no item.system.roll associated\", () => {});\r\n    it(\"Item of item type shows chat card\", () => {});\r\n    it(\"Item of armor type shows chat card\", () => {});\r\n  });\r\n\r\n  describe(\"show()\", () => {\r\n    beforeEach(async () => {\r\n      await trashChat();\r\n    });\r\n\r\n    after(async () => {\r\n      game.items\r\n        ?.filter((o) => o?.name?.indexOf(\"Test Weapon Item \") >= 0 || false)\r\n        .forEach(async (i) => i.delete());\r\n      await trashChat();\r\n    });\r\n\r\n    // eslint-disable-next-line unicorn/consistent-function-scoping\r\n    const rollMessageTest = async (rollMode: string) => {\r\n      assert(\r\n        [\"publicroll\", \"gmroll\", \"blindroll\", \"selfroll\"].includes(rollMode)\r\n      );\r\n      expect(game.messages?.size).equal(0);\r\n      game.settings.set(\"core\", \"rollMode\", rollMode);\r\n      expect(game.settings.get(\"core\", \"rollMode\")).equal(rollMode);\r\n      const item: OseItem = await createWorldTestItem(\"weapon\");\r\n      await item?.show();\r\n      expect(game.messages?.size).equal(1);\r\n      const chatMessage = game.messages?.contents.pop();\r\n      expect(chatMessage?.blind).equal(rollMode === \"blindroll\");\r\n      expect(chatMessage?.type).equal(0);\r\n      if (rollMode === \"publicroll\") {\r\n        expect(chatMessage?.whisper?.length).equal(0);\r\n      } else {\r\n        chatMessage?.whisper?.forEach((o: string) => {\r\n          // eslint-disable-next-line no-underscore-dangle\r\n          assert(game.users?.find((u: User) => u._id === o)?.isGM);\r\n        });\r\n      }\r\n      await item?.delete();\r\n    };\r\n\r\n    it(\"Private GM Roll whispers chat message to GM\", async () => {\r\n      await rollMessageTest(\"gmroll\");\r\n    });\r\n\r\n    it(\"Blindroll whispers chat message to GM and is blind\", async () => {\r\n      await rollMessageTest(\"blindroll\");\r\n    });\r\n\r\n    it(\"Selfroll whispers chat message to user\", async () => {\r\n      await rollMessageTest(\"selfroll\");\r\n    });\r\n    it(\"Public messages is not a whisper and is not blind\", async () => {\r\n      await rollMessageTest(\"publicroll\");\r\n    });\r\n  });\r\n\r\n  // @todo: How to test? Mock Event?\r\n  describe(\"_onChatCardToggleContent(event)\", () => {});\r\n  describe(\"_onChatCardAction(event)\", () => {});\r\n\r\n  // @todo: How to mock?\r\n  describe(\"_getChatCardActor(card)\", () => {\r\n    it(\"Returns actor if tokenId is properly set\", () => {});\r\n    it(\"Returns actor if actorId is properly set\", () => {});\r\n    it(\"Returns null if neither tokenId nor actorId is properly set\", () => {});\r\n  });\r\n\r\n  // @todo: How to mock?\r\n  describe(\"_getChatCardTargets(card)\", () => {});\r\n};\r\n","/**\r\n * @file Contains tests for Ability Data Model.\r\n */\r\n// eslint-disable-next-line prettier/prettier, import/no-cycle\r\nimport { QuenchMethods } from \"../../../e2e\";\r\nimport { cleanUpWorldItems, createWorldTestItem } from \"../../../e2e/testUtils\";\r\n\r\nexport const key = \"ose.item.sheet\";\r\nexport const options = { displayName: \"OSE: Item: Sheet\" };\r\n\r\nexport default ({ describe, it, expect, after, assert }: QuenchMethods) => {\r\n  after(() => {\r\n    cleanUpWorldItems();\r\n  });\r\n\r\n  describe(\"defaultOptions() \", () => {\r\n    it(\"Has correctly set defaultOptions\", async () => {\r\n      const item = await createWorldTestItem(\"item\");\r\n      const sheet = item?.sheet;\r\n      expect(sheet).is.not.undefined;\r\n      expect(sheet?.options.classes.length).equal(3);\r\n      expect(sheet?.options.classes).contain(\"ose\");\r\n      expect(sheet?.options.classes).contain(\"sheet\");\r\n      expect(sheet?.options.classes).contain(\"item\");\r\n      expect(sheet?.options.width).equal(520);\r\n      expect(sheet?.options.height).equal(390);\r\n      assert(!sheet?.options.resizable);\r\n      expect(sheet?.options.tabs.length).equal(1);\r\n      expect(Object.keys(sheet?.options.tabs[0]).length).equal(4);\r\n      expect(Object.keys(sheet?.options.tabs[0])).contain(\"callback\");\r\n      expect(typeof sheet?.options.tabs[0].callback).equal(\"function\");\r\n      expect(sheet?.options.tabs[0].callback.name).contain(\"_onChangeTab\");\r\n      expect(Object.keys(sheet?.options.tabs[0])).contain(\"navSelector\");\r\n      expect(sheet?.options.tabs[0].navSelector).equal(\".tabs\");\r\n      expect(Object.keys(sheet?.options.tabs[0])).contain(\"contentSelector\");\r\n      expect(sheet?.options.tabs[0].contentSelector).equal(\".sheet-body\");\r\n      expect(Object.keys(sheet?.options.tabs[0])).contain(\"initial\");\r\n      expect(sheet?.options.tabs[0].initial).equal(\"description\");\r\n    });\r\n  });\r\n\r\n  describe(\"template()\", () => {\r\n    it(\"Returns html path\", async () => {\r\n      const item = await createWorldTestItem(\"item\");\r\n      const sheet = item?.sheet;\r\n      expect(sheet).is.not.undefined;\r\n      expect(sheet?.template).contain(\"templates/items\");\r\n      expect(sheet?.template).contain(\"-sheet.html\");\r\n    });\r\n  });\r\n\r\n  describe(\"getData()\", () => {\r\n    it(\"Returns data\", async () => {\r\n      const item = await createWorldTestItem(\"item\");\r\n      const sheet = item?.sheet;\r\n      expect(sheet).is.not.undefined;\r\n      const data = await sheet?.getData();\r\n      expect(Object.keys(data)).contain(\"_id\");\r\n      expect(Object.keys(data)).contain(\"editable\");\r\n      expect(Object.keys(data)).contain(\"config\");\r\n      expect(Object.keys(data)).contain(\"enriched\");\r\n    });\r\n  });\r\n};\r\n","/**\r\n * @file Contains tests for Party Entity.\r\n */\r\n// eslint-disable-next-line prettier/prettier, import/no-cycle\r\nimport { QuenchMethods } from \"../../../e2e\";\r\nimport { cleanUpActorsByKey, createMockActorKey } from \"../../../e2e/testUtils\";\r\nimport OseParty from \"../party\";\r\nimport OsePartySheet from \"../party-sheet\";\r\n\r\nexport const key = \"ose.party.entity\";\r\nexport const options = { displayName: \"OSE: Party: Entity\" };\r\n\r\nconst createMockActor = async (type: string, data: object = {}) =>\r\n  createMockActorKey(type, data, key);\r\n\r\nexport default ({ describe, it, expect, assert, after }: QuenchMethods) => {\r\n  describe(\"currentParty()\", () => {\r\n    it(\"Returns all characters in a party\", async () => {\r\n      const actor = await createMockActor(\"character\");\r\n      const partySheet = new OsePartySheet();\r\n      // eslint-disable-next-line no-underscore-dangle\r\n      const promisedAnswer = await partySheet._addActorToParty(actor);\r\n      expect(promisedAnswer).is.undefined;\r\n      assert(actor?.getFlag(game.system.id, \"party\"));\r\n\r\n      const party = OseParty;\r\n      const actorsInParty = game.actors?.filter(\r\n        (o) => o.flags[game.system.id]?.party\r\n      );\r\n      expect(party.currentParty.length).equal(actorsInParty?.length);\r\n      await actor?.delete();\r\n    });\r\n  });\r\n\r\n  after(async () => {\r\n    await cleanUpActorsByKey(key);\r\n  });\r\n};\r\n","/**\r\n * @file Contains tests for Party Sheet.\r\n */\r\n// eslint-disable-next-line prettier/prettier, import/no-cycle\r\nimport { QuenchMethods } from \"../../../e2e\";\r\nimport {\r\n  cleanUpActorsByKey,\r\n  createMockActorKey,\r\n  openWindows,\r\n  waitForInput,\r\n} from \"../../../e2e/testUtils\";\r\nimport OsePartySheet from \"../party-sheet\";\r\n\r\nexport const key = \"ose.party.sheet\";\r\nexport const options = { displayName: \"OSE: Party: Sheet\" };\r\n\r\nconst createMockActor = async (type: string, data: object = {}) =>\r\n  createMockActorKey(type, data, key);\r\n\r\nexport default ({ describe, it, expect, assert, after }: QuenchMethods) => {\r\n  describe(\"defaultOptions()\", () => {\r\n    it(\"Has correctly set defaultOptions\", () => {\r\n      const partySheet = new OsePartySheet();\r\n      expect(partySheet.options.classes).contain(\"ose\");\r\n      expect(partySheet.options.classes).contain(\"dialog\");\r\n      expect(partySheet.options.classes).contain(\"party-sheet\");\r\n      expect(partySheet.options.template).contain(\r\n        \"/templates/apps/party-sheet.html\"\r\n      );\r\n      expect(partySheet.options.width).equal(280);\r\n      expect(partySheet.options.height).equal(400);\r\n      assert(partySheet.options.resizable);\r\n      expect(partySheet.options.dragDrop[0].dragSelector).equal(\r\n        \".actor-list .actor\"\r\n      );\r\n      expect(partySheet.options.dragDrop[0].dropSelector).equal(\r\n        \".party-members\"\r\n      );\r\n      assert(!partySheet.options.closeOnSubmit);\r\n    });\r\n  });\r\n\r\n  // @todo: How to test?\r\n  describe(\"init()\", () => {});\r\n\r\n  describe(\"showPartySheet(options = {})\", () => {\r\n    it(\"Can render party sheet\", async () => {\r\n      OsePartySheet.showPartySheet();\r\n      await waitForInput();\r\n      const dialogs = openWindows(\"party-sheet\");\r\n      expect(dialogs.length).equal(1);\r\n      expect(dialogs[0].options.classes).contain(\"party-sheet\");\r\n      await dialogs[0].close();\r\n      expect(openWindows(\"party-sheet\").length).equal(0);\r\n    });\r\n  });\r\n\r\n  describe(\"partySheet()\", () => {\r\n    it(\"Returns a partysheet\", () => {\r\n      const { partySheet } = OsePartySheet;\r\n      expect(partySheet).is.not.undefined;\r\n      expect(partySheet?.options.classes).contain(\"party-sheet\");\r\n    });\r\n  });\r\n\r\n  describe(\"title()\", () => {\r\n    it(\"Creates string in dialog window title\", async () => {\r\n      OsePartySheet.showPartySheet();\r\n      await waitForInput();\r\n      const dialogTitle = document.querySelector(\r\n        \"div.party-sheet .window-title\"\r\n      )?.innerHTML;\r\n      expect(typeof dialogTitle).equal(\"string\");\r\n      const dialogs = openWindows(\"party-sheet\");\r\n      expect(dialogs.length).equal(1);\r\n      await dialogs[0].close();\r\n      expect(openWindows(\"party-sheet\").length).equal(0);\r\n    });\r\n  });\r\n\r\n  describe(\"getData()\", () => {\r\n    it(\"Returns proper data\", () => {\r\n      const sheet = new OsePartySheet();\r\n      const data = sheet.getData();\r\n      const keys = Object.keys(data);\r\n      expect(keys.length).equal(4);\r\n      expect(keys).contain(\"partyActors\");\r\n      expect(keys).contain(\"config\");\r\n      expect(keys).contain(\"user\");\r\n      expect(keys).contain(\"settings\");\r\n    });\r\n  });\r\n\r\n  describe(\"_addActorToParty(actor)\", () => {\r\n    it(\"Monster returns undefined\", async () => {\r\n      const actor = await createMockActor(\"monster\");\r\n      const partySheet = new OsePartySheet();\r\n      // eslint-disable-next-line no-underscore-dangle\r\n      const promisedAnswer = await partySheet._addActorToParty(actor);\r\n      expect(promisedAnswer).is.undefined;\r\n      await actor.delete();\r\n    });\r\n\r\n    it(\"Adding a character updates the actor\", async () => {\r\n      const actor = await createMockActor(\"character\");\r\n      const partySheet = new OsePartySheet();\r\n      // eslint-disable-next-line no-underscore-dangle\r\n      const promisedAnswer = await partySheet._addActorToParty(actor);\r\n      expect(promisedAnswer).is.undefined;\r\n      assert(actor?.getFlag(game.system.id, \"party\"));\r\n      await actor.delete();\r\n    });\r\n  });\r\n\r\n  describe(\"_removeActorFromParty(actor)\", async () => {\r\n    it(\"Removing a character updates the actor flags\", async () => {\r\n      const actor = await createMockActor(\"character\");\r\n      const partySheet = new OsePartySheet();\r\n      // eslint-disable-next-line no-underscore-dangle\r\n      const promisedAddAnswer = await partySheet._addActorToParty(actor);\r\n      expect(promisedAddAnswer).is.undefined;\r\n      assert(actor?.getFlag(game.system.id, \"party\"));\r\n      // eslint-disable-next-line no-underscore-dangle\r\n      const promisedRemoveAnswer = await partySheet._removeActorFromParty(actor);\r\n      expect(promisedRemoveAnswer).is.undefined;\r\n      assert(!actor?.getFlag(game.system.id, \"party\"));\r\n      await actor.delete();\r\n    });\r\n  });\r\n\r\n  // @todo: Test with Cypress or mock event\r\n  describe(\"_onDrop(event)\", () => {});\r\n\r\n  describe(\"_onDropActor(event, data)\", () => {\r\n    const event = \"\";\r\n    it(\"Dropping a non-actor type returns nothing\", async () => {\r\n      const partySheet = new OsePartySheet();\r\n      // eslint-disable-next-line no-underscore-dangle\r\n      const resolvedResponse = await partySheet._onDropActor(event, {\r\n        type: \"not-actor\",\r\n      });\r\n      expect(resolvedResponse).is.undefined;\r\n    });\r\n\r\n    it(\"Dropping an actor type updates the actor\", async () => {\r\n      const actor = await createMockActor(\"character\");\r\n      const data = {\r\n        type: actor?.documentName,\r\n        uuid: actor?.uuid,\r\n      };\r\n      const partySheet = new OsePartySheet();\r\n      // eslint-disable-next-line no-underscore-dangle\r\n      const promisedAnswer = await partySheet._onDropActor(event, data);\r\n      await waitForInput();\r\n      expect(promisedAnswer).is.undefined;\r\n      assert(actor?.getFlag(game.system.id, \"party\"));\r\n      await actor?.delete();\r\n    });\r\n  });\r\n\r\n  describe(\"_recursiveAddFolder(folder)\", () => {\r\n    it(\"Folder of actors add actors to party\", async () => {\r\n      const partySheet = new OsePartySheet();\r\n      const folder = await Folder.create({\r\n        name: `Test Folder ${key}`,\r\n        type: \"Actor\",\r\n      });\r\n      const actor = await createMockActor(\"character\");\r\n      // eslint-disable-next-line no-underscore-dangle\r\n      await actor?.update({ folder: folder?._id });\r\n      expect(actor?.folder).equal(folder);\r\n      // eslint-disable-next-line no-underscore-dangle\r\n      partySheet._recursiveAddFolder(folder);\r\n      await waitForInput();\r\n      assert(actor?.getFlag(game.system.id, \"party\"));\r\n      await actor?.delete();\r\n      await folder?.delete();\r\n    });\r\n\r\n    it(\"Folder with sub-folders of actors add actors to party\", async () => {\r\n      const partySheet = new OsePartySheet();\r\n      const folder = await Folder.create({\r\n        name: `Test Folder ${key}`,\r\n        type: \"Actor\",\r\n      });\r\n      const subFolder = await Folder.create({\r\n        name: `Test Folder ${key} subfolder`,\r\n        type: \"Actor\",\r\n        folder: folder._id,\r\n      });\r\n      const actor = await createMockActor(\"character\");\r\n      // eslint-disable-next-line no-underscore-dangle\r\n      await actor?.update({ folder: subFolder?._id });\r\n      expect(actor?.folder).equal(subFolder);\r\n      // eslint-disable-next-line no-underscore-dangle\r\n      partySheet._recursiveAddFolder(folder);\r\n      await waitForInput();\r\n      assert(actor?.getFlag(game.system.id, \"party\"));\r\n      await actor?.delete();\r\n    });\r\n  });\r\n\r\n  describe(\"_onDropFolder(event, data)\", () => {\r\n    it(\"Dropping with documentName that is not Actor returns undefined\", async () => {\r\n      const mockData = {\r\n        documentName: \"Not-Actor\",\r\n      };\r\n      const partySheet = new OsePartySheet();\r\n      const response = await partySheet._onDropFolder(\"\", mockData);\r\n      expect(response).is.undefined;\r\n    });\r\n\r\n    it(\"Dropping a folder with an actor in it adds it to the party\", async () => {\r\n      const partySheet = new OsePartySheet();\r\n      const folder = await Folder.create({\r\n        name: `Test Folder ${key}`,\r\n        type: \"Actor\",\r\n      });\r\n      const actor = await createMockActor(\"character\");\r\n      // eslint-disable-next-line no-underscore-dangle\r\n      await actor?.update({ folder: folder?._id });\r\n      expect(actor?.folder).equal(folder);\r\n      // eslint-disable-next-line no-underscore-dangle\r\n      await partySheet._onDropFolder(\"\", folder);\r\n      await waitForInput();\r\n      assert(actor?.getFlag(game.system.id, \"party\"));\r\n      await actor?.delete();\r\n      await folder?.delete();\r\n    });\r\n  });\r\n\r\n  // @todo: Test with Cypress or Mock event\r\n  describe(\"_onDragStart(event)\", () => {});\r\n\r\n  // Tested in OsePartyXP\r\n  describe(\"_dealXP(event)\", () => {});\r\n\r\n  after(async () => {\r\n    cleanUpActorsByKey(key);\r\n    game.folders?.contents\r\n      ?.filter((a) => a.name?.includes(`Test Folder ${key}`))\r\n      ?.forEach((a) => a.delete());\r\n  });\r\n};\r\n","/**\r\n * @file Contains tests for Party XP Sheet.\r\n */\r\n// eslint-disable-next-line prettier/prettier, import/no-cycle\r\nimport { QuenchMethods } from \"../../../e2e\";\r\nimport { openWindows, waitForInput } from \"../../../e2e/testUtils\";\r\nimport OsePartyXP from \"../party-xp\";\r\n\r\nexport const key = \"ose.party-xp.sheet\";\r\nexport const options = { displayName: \"OSE: Party XP: Sheet\" };\r\n\r\nexport default ({ describe, it, expect, assert }: QuenchMethods) => {\r\n  describe(\"defaultOptions()\", () => {\r\n    it(\"Has correctly set defaultOptions\", () => {\r\n      const partyXP = new OsePartyXP();\r\n      expect(partyXP.options.classes).contain(\"ose\");\r\n      expect(partyXP.options.classes).contain(\"dialog\");\r\n      expect(partyXP.options.classes).contain(\"party-xp\");\r\n      expect(partyXP.options.template).contain(\"/templates/apps/party-xp.html\");\r\n      expect(partyXP.options.width).equal(300);\r\n      expect(partyXP.options.height).equal(\"auto\");\r\n      assert(!partyXP.options.resizable);\r\n      assert(partyXP.options.closeOnSubmit);\r\n    });\r\n  });\r\n\r\n  describe(\"title()\", () => {\r\n    it(\"Creates string in dialog window title\", async () => {\r\n      const partyXP = new OsePartyXP();\r\n      partyXP.render(true);\r\n      await waitForInput();\r\n      const dialogTitle = document.querySelector(\r\n        \"div.party-xp .window-title\"\r\n      )?.innerHTML;\r\n      expect(typeof dialogTitle).equal(\"string\");\r\n      const dialogs = openWindows(\"party-xp\");\r\n      expect(dialogs.length).equal(1);\r\n      await dialogs[0].close();\r\n      expect(openWindows(\"party-xp\").length).equal(0);\r\n    });\r\n  });\r\n\r\n  describe(\"getData()\", () => {\r\n    it(\"Returns proper data\", () => {\r\n      const sheet = new OsePartyXP();\r\n      const data = sheet.getData();\r\n      const keys = Object.keys(data);\r\n      expect(keys.length).equal(5);\r\n      expect(keys).contain(\"actors\");\r\n      expect(keys).contain(\"data\");\r\n      expect(keys).contain(\"config\");\r\n      expect(keys).contain(\"user\");\r\n      expect(keys).contain(\"settings\");\r\n    });\r\n  });\r\n\r\n  // @todo: Test with Cypress or similar, or mock event (see actor-sheet-e2e)\r\n  describe(\"_onDrop(event)\", () => {});\r\n  describe(\"_updateObject(event)\", () => {});\r\n  describe(\"_calculateShare()\", () => {});\r\n  describe(\"_dealXP(event)\", () => {});\r\n};\r\n","/**\r\n * @file Contains tests for behaviour helpers\r\n */\r\n// eslint-disable-next-line prettier/prettier, import/no-cycle\r\nimport { QuenchMethods } from \"../../e2e\";\r\nimport skipRollDialogCheck from \"../helpers-behaviour\";\r\n\r\nexport const key = \"ose.helpers.behaviour\";\r\nexport const options = {\r\n  displayName: \"OSE: Helpers: Behaviour\",\r\n};\r\n\r\nexport default ({ describe, it, before, after, assert }: QuenchMethods) => {\r\n  describe(\"skipRollDialogCheck(event)\", () => {\r\n    const originalSetting = game.settings.get(\r\n      game.system.id,\r\n      \"invertedCtrlBehavior\"\r\n    );\r\n\r\n    describe(\"invertedCtrlBehavior is set to false\", () => {\r\n      before(async () => {\r\n        await game.settings.set(game.system.id, \"invertedCtrlBehavior\", false);\r\n      });\r\n\r\n      it(\"Setting is false\", async () => {\r\n        const setting = await game.settings.get(\r\n          game.system.id,\r\n          \"invertedCtrlBehavior\"\r\n        );\r\n        assert(!setting);\r\n      });\r\n\r\n      it(\"Not holding ctrl should not skip dialog\", () => {\r\n        const event = new KeyboardEvent(\"keydown\", { ctrlKey: false });\r\n        assert(!skipRollDialogCheck(event));\r\n      });\r\n\r\n      it(\"Not holding meta should not skip dialog\", () => {\r\n        const event = new KeyboardEvent(\"keydown\", { metaKey: false });\r\n        assert(!skipRollDialogCheck(event));\r\n      });\r\n\r\n      it(\"Holding ctrl should not skip dialog\", () => {\r\n        const event = new KeyboardEvent(\"keydown\", { ctrlKey: true });\r\n        assert(skipRollDialogCheck(event));\r\n      });\r\n\r\n      it(\"Holding meta should not skip dialog\", () => {\r\n        const event = new KeyboardEvent(\"keydown\", { metaKey: true });\r\n        assert(skipRollDialogCheck(event));\r\n      });\r\n    });\r\n\r\n    describe(\"invertedCtrlBehavior is set to true\", () => {\r\n      before(async () => {\r\n        await game.settings.set(game.system.id, \"invertedCtrlBehavior\", true);\r\n      });\r\n\r\n      it(\"Setting is false\", async () => {\r\n        const setting = await game.settings.get(\r\n          game.system.id,\r\n          \"invertedCtrlBehavior\"\r\n        );\r\n        assert(setting);\r\n      });\r\n\r\n      it(\"Not holding ctrl should skip dialog\", () => {\r\n        const event = new KeyboardEvent(\"keydown\", { ctrlKey: false });\r\n        assert(skipRollDialogCheck(event));\r\n      });\r\n\r\n      it(\"Not holding meta should skip dialog\", () => {\r\n        const event = new KeyboardEvent(\"keydown\", { ctrlKey: false });\r\n        assert(skipRollDialogCheck(event));\r\n      });\r\n\r\n      it(\"Holding ctrl should not skip dialog\", () => {\r\n        const event = new KeyboardEvent(\"keydown\", { ctrlKey: true });\r\n        assert(!skipRollDialogCheck(event));\r\n      });\r\n\r\n      it(\"Holding meta should not skip dialog\", () => {\r\n        const event = new KeyboardEvent(\"keydown\", { metaKey: true });\r\n        assert(!skipRollDialogCheck(event));\r\n      });\r\n    });\r\n\r\n    after(async () => {\r\n      await game.settings.set(\r\n        game.system.id,\r\n        \"invertedCtrlBehavior\",\r\n        originalSetting\r\n      );\r\n    });\r\n  });\r\n};\r\n","/**\r\n * @file Contains tests for chat helpers\r\n */\r\n// eslint-disable-next-line prettier/prettier, import/no-cycle\r\nimport { QuenchMethods } from \"../../e2e\";\r\nimport {\r\n  addChatMessageButtons,\r\n  addChatMessageContextOptions,\r\n  functionsForTesting,\r\n} from \"../helpers-chat\";\r\n\r\nconst { applyChatCardDamage } = functionsForTesting;\r\n\r\nexport const key = \"ose.helpers.chat\";\r\nexport const options = {\r\n  displayName: \"OSE: Helpers: Chat\",\r\n};\r\n\r\nexport default ({ describe, it, before, after, expect }: QuenchMethods) => {\r\n  // @todo: How do we test these properly?\r\n  describe(\"applyChatCardDamage(roll, multiplier)\", () => {});\r\n  describe(\"addChatMessageContextOptions(_, options)\", () => {});\r\n  describe(\"addChatMessageButtons(msg. html)\", () => {});\r\n};\r\n","/**\r\n * @file Contains tests for dice helpers\r\n */\r\n// eslint-disable-next-line prettier/prettier, import/no-cycle\r\nimport { QuenchMethods } from \"../../e2e\";\r\nimport { closeDialogs, trashChat, waitForInput } from \"../../e2e/testUtils\";\r\nimport OseDice from \"../helpers-dice\";\r\n\r\nexport const key = \"ose.helpers.dice\";\r\nexport const options = {\r\n  displayName: \"OSE: Helpers: Dice\",\r\n};\r\n\r\nconst createMockRoll = (\r\n  target: number,\r\n  resultArray: Array<number | string> = [target]\r\n) => {\r\n  const results: Array<object> = [];\r\n  resultArray.forEach((r: number | string) => {\r\n    results.push({ result: r });\r\n  });\r\n  return {\r\n    terms: [{ results }],\r\n    total: target,\r\n  };\r\n};\r\n\r\nexport default ({\r\n  describe,\r\n  it,\r\n  after,\r\n  afterEach,\r\n  before,\r\n  expect,\r\n}: QuenchMethods) => {\r\n  const acSetting = game.settings.get(game.system.id, \"ascendingAC\");\r\n\r\n  before(async () => {\r\n    await ui.notifications?.close();\r\n  });\r\n\r\n  after(async () => {\r\n    game.settings.set(game.system.id, \"ascendingAC\", acSetting);\r\n    await ui.notifications?.render(true);\r\n  });\r\n\r\n  describe(\"sendRoll(parts, data, title, flavor, speaker, form, chatMessage)\", () => {\r\n    before(async () => {\r\n      await trashChat();\r\n    });\r\n\r\n    it(\"Can roll with single part\", async () => {\r\n      const dice = await OseDice.sendRoll({\r\n        parts: [\"1d10\"],\r\n        data: { roll: { blindroll: false } },\r\n      });\r\n      await waitForInput();\r\n      await waitForInput();\r\n      const chatCard = document.querySelector(\r\n        \".chat-message .dice-formula\"\r\n      )?.innerHTML;\r\n      expect(Object.keys(dice)).contain(\"_evaluated\");\r\n      expect(dice._evaluated).equal(true);\r\n      expect(Object.keys(dice)).contain(\"_formula\");\r\n      expect(dice._formula).equal(\"1d10\");\r\n      expect(chatCard).equal(\"1d10\");\r\n    });\r\n\r\n    it(\"Can roll with multiple parts\", async () => {\r\n      const dice = await OseDice.sendRoll({\r\n        parts: [\"1d10\", \"1d20\"],\r\n        data: { roll: { blindroll: false } },\r\n      });\r\n      await waitForInput();\r\n      await waitForInput();\r\n      const chatCard = document.querySelector(\r\n        \".chat-message .dice-formula\"\r\n      )?.innerHTML;\r\n      expect(Object.keys(dice)).contain(\"_evaluated\");\r\n      expect(dice._evaluated).equal(true);\r\n      expect(Object.keys(dice)).contain(\"_formula\");\r\n      expect(dice._formula).equal(\"1d10 + 1d20\");\r\n      expect(chatCard).equal(\"1d10 + 1d20\");\r\n    });\r\n\r\n    afterEach(async () => {\r\n      await trashChat();\r\n    });\r\n  });\r\n\r\n  describe(\"digestResult(data, roll)\", () => {\r\n    // eslint-disable-next-line unicorn/consistent-function-scoping\r\n    const createMockData = (\r\n      type: string,\r\n      target: number,\r\n      thac0: number = 0\r\n    ) => ({\r\n      roll: { type, target, thac0 },\r\n    });\r\n    describe(\"result type\", () => {\r\n      const data = createMockData(\"result\", 10);\r\n      it(\"Successful roll hitting target\", () => {\r\n        const roll = createMockRoll(10);\r\n        expect(OseDice.digestResult(data, roll).isSuccess).equal(true);\r\n        expect(OseDice.digestResult(data, roll).isFailure).equal(false);\r\n      });\r\n\r\n      it(\"Unsuccessful roll under\", () => {\r\n        const roll = createMockRoll(9);\r\n        expect(OseDice.digestResult(data, roll).isSuccess).equal(false);\r\n        expect(OseDice.digestResult(data, roll).isFailure).equal(true);\r\n      });\r\n\r\n      it(\"Unsuccessful roll over\", () => {\r\n        const roll = createMockRoll(11);\r\n        expect(OseDice.digestResult(data, roll).isSuccess).equal(false);\r\n        expect(OseDice.digestResult(data, roll).isFailure).equal(true);\r\n      });\r\n    });\r\n\r\n    describe(\"above type\", () => {\r\n      const data = createMockData(\"above\", 10);\r\n      it(\"Successful roll hitting target\", () => {\r\n        const roll = createMockRoll(10);\r\n        expect(OseDice.digestResult(data, roll).isSuccess).equal(true);\r\n        expect(OseDice.digestResult(data, roll).isFailure).equal(false);\r\n      });\r\n\r\n      it(\"Unsuccessful roll under\", () => {\r\n        const roll = createMockRoll(9);\r\n        expect(OseDice.digestResult(data, roll).isSuccess).equal(false);\r\n        expect(OseDice.digestResult(data, roll).isFailure).equal(true);\r\n      });\r\n\r\n      it(\"Successful roll over\", () => {\r\n        const roll = createMockRoll(11);\r\n        expect(OseDice.digestResult(data, roll).isSuccess).equal(true);\r\n        expect(OseDice.digestResult(data, roll).isFailure).equal(false);\r\n      });\r\n    });\r\n\r\n    describe(\"below type\", () => {\r\n      const data = createMockData(\"below\", 10);\r\n      it(\"Successful roll hitting target\", () => {\r\n        const roll = createMockRoll(10);\r\n        expect(OseDice.digestResult(data, roll).isSuccess).equal(true);\r\n        expect(OseDice.digestResult(data, roll).isFailure).equal(false);\r\n      });\r\n\r\n      it(\"Successful roll under\", () => {\r\n        const roll = createMockRoll(9);\r\n        expect(OseDice.digestResult(data, roll).isSuccess).equal(true);\r\n        expect(OseDice.digestResult(data, roll).isFailure).equal(false);\r\n      });\r\n\r\n      it(\"Unsuccessful roll over\", () => {\r\n        const roll = createMockRoll(11);\r\n        expect(OseDice.digestResult(data, roll).isSuccess).equal(false);\r\n        expect(OseDice.digestResult(data, roll).isFailure).equal(true);\r\n      });\r\n    });\r\n\r\n    describe(\"check type\", () => {\r\n      const data = createMockData(\"check\", 10);\r\n      it(\"Successful roll on a nat 1\", () => {\r\n        const roll = createMockRoll(1);\r\n        expect(OseDice.digestResult(data, roll).isSuccess).equal(true);\r\n        expect(OseDice.digestResult(data, roll).isFailure).equal(false);\r\n      });\r\n\r\n      it(\"Unsuccessful roll on a nat 20\", () => {\r\n        const dataNat20 = createMockData(\"check\", 20);\r\n        const roll = createMockRoll(20);\r\n        expect(OseDice.digestResult(dataNat20, roll).isSuccess).equal(false);\r\n        expect(OseDice.digestResult(dataNat20, roll).isFailure).equal(true);\r\n      });\r\n\r\n      it(\"Successful roll hitting target\", () => {\r\n        const roll = createMockRoll(10);\r\n        expect(OseDice.digestResult(data, roll).isSuccess).equal(true);\r\n        expect(OseDice.digestResult(data, roll).isFailure).equal(false);\r\n      });\r\n\r\n      it(\"Successful roll under\", () => {\r\n        const roll = createMockRoll(9);\r\n        expect(OseDice.digestResult(data, roll).isSuccess).equal(true);\r\n        expect(OseDice.digestResult(data, roll).isFailure).equal(false);\r\n      });\r\n\r\n      it(\"Unsuccessful roll over\", () => {\r\n        const roll = createMockRoll(11);\r\n        expect(OseDice.digestResult(data, roll).isSuccess).equal(false);\r\n        expect(OseDice.digestResult(data, roll).isFailure).equal(true);\r\n      });\r\n    });\r\n\r\n    describe(\"table type\", () => {\r\n      const data = {\r\n        roll: {\r\n          type: \"table\",\r\n          target: 10,\r\n          table: {\r\n            9: \"Success\",\r\n            10: \"Failure\",\r\n          },\r\n        },\r\n      };\r\n\r\n      it(\"Successful roll hitting target\", () => {\r\n        const roll = createMockRoll(9);\r\n        expect(OseDice.digestResult(data, roll).isSuccess).equal(false);\r\n        expect(OseDice.digestResult(data, roll).isSuccess).equal(false);\r\n        expect(OseDice.digestResult(data, roll).details).equal(\"Success\");\r\n      });\r\n\r\n      it(\"Successful roll under\", () => {\r\n        const roll = createMockRoll(10);\r\n        expect(OseDice.digestResult(data, roll).isSuccess).equal(false);\r\n        expect(OseDice.digestResult(data, roll).isSuccess).equal(false);\r\n        expect(OseDice.digestResult(data, roll).details).equal(\"Failure\");\r\n      });\r\n    });\r\n\r\n    describe(\"unknown type\", () => {\r\n      const data = createMockData(\"unknown\", 10);\r\n      it(\"Returns default result\", () => {\r\n        const roll = createMockRoll(4);\r\n        expect(OseDice.digestResult(data, roll).isSuccess).equal(false);\r\n        expect(OseDice.digestResult(data, roll).isSuccess).equal(false);\r\n        expect(OseDice.digestResult(data, roll).target).equal(10);\r\n        expect(OseDice.digestResult(data, roll).total).equal(4);\r\n      });\r\n    });\r\n  });\r\n\r\n  describe(\"attackIsSuccess(roll, target, bonus)\", () => {\r\n    describe(\"Ascending AC\", () => {\r\n      before(async () => {\r\n        await game.settings.set(game.system.id, \"ascendingAC\", true);\r\n      });\r\n\r\n      it(\"Natural 1 always fails\", () => {\r\n        const rollTargetOne = createMockRoll(1, [1]);\r\n        expect(OseDice.attackIsSuccess(rollTargetOne, 100, 0)).equal(false);\r\n        const rollTargetTwenty = createMockRoll(20, [1]);\r\n        expect(OseDice.attackIsSuccess(rollTargetTwenty, 100, 0)).equal(false);\r\n      });\r\n\r\n      it(\"Natural 20 always succeeds\", () => {\r\n        const rollTargetOne = createMockRoll(1, [20]);\r\n        expect(OseDice.attackIsSuccess(rollTargetOne, 0, 100)).equal(true);\r\n        const rollTargetTwenty = createMockRoll(20, [20]);\r\n        expect(OseDice.attackIsSuccess(rollTargetTwenty, 0, 100)).equal(true);\r\n      });\r\n\r\n      it(\"Roll + bonus equal target is successful\", () => {\r\n        const roll = createMockRoll(10);\r\n        const target = 20;\r\n        const bonus = 10;\r\n        expect(OseDice.attackIsSuccess(roll, target, bonus)).equal(true);\r\n      });\r\n\r\n      it(\"Roll + bonus above target is successful\", () => {\r\n        const roll = createMockRoll(10);\r\n        const target = 19;\r\n        const bonus = 10;\r\n        expect(OseDice.attackIsSuccess(roll, target, bonus)).equal(true);\r\n      });\r\n\r\n      it(\"Roll + bnous under target is unsuccessful\", () => {\r\n        const roll = createMockRoll(10);\r\n        const target = 21;\r\n        const bonus = 10;\r\n        expect(OseDice.attackIsSuccess(roll, target, bonus)).equal(false);\r\n      });\r\n    });\r\n\r\n    describe(\"Descending AC\", () => {\r\n      before(async () => {\r\n        await game.settings.set(game.system.id, \"ascendingAC\", false);\r\n      });\r\n\r\n      it(\"Natural 1 always fails\", () => {\r\n        const rollTargetOne = createMockRoll(1, [1]);\r\n        expect(OseDice.attackIsSuccess(rollTargetOne, 100, 0)).equal(false);\r\n        const rollTargetTwenty = createMockRoll(20, [1]);\r\n        expect(OseDice.attackIsSuccess(rollTargetTwenty, 100, 0)).equal(false);\r\n      });\r\n\r\n      it(\"Natural 20 always succeeds\", () => {\r\n        const rollTargetOne = createMockRoll(1, [20]);\r\n        expect(OseDice.attackIsSuccess(rollTargetOne, 0, 100)).equal(true);\r\n        const rollTargetTwenty = createMockRoll(20, [20]);\r\n        expect(OseDice.attackIsSuccess(rollTargetTwenty, 0, 100)).equal(true);\r\n      });\r\n\r\n      it(\"Roll + ac equal thac0 is successful\", () => {\r\n        const roll = createMockRoll(10);\r\n        const thac0 = 20;\r\n        const ac = 10;\r\n        expect(OseDice.attackIsSuccess(roll, thac0, ac)).equal(true);\r\n      });\r\n\r\n      it(\"Roll + ac above thac0 is successful\", () => {\r\n        const roll = createMockRoll(10);\r\n        const thac0 = 19;\r\n        const ac = 10;\r\n        expect(OseDice.attackIsSuccess(roll, thac0, ac)).equal(true);\r\n      });\r\n\r\n      it(\"Roll + ac under thac0 is unsuccessful\", () => {\r\n        const roll = createMockRoll(10);\r\n        const thac0 = 21;\r\n        const ac = 10;\r\n        expect(OseDice.attackIsSuccess(roll, thac0, ac)).equal(false);\r\n      });\r\n    });\r\n  });\r\n\r\n  describe(\"digestAttackResult(data, roll)\", () => {\r\n    const data = {\r\n      roll: {\r\n        thac0: 15,\r\n        target: {\r\n          actor: {\r\n            system: {\r\n              ac: { value: 0 },\r\n              aac: { value: 9 },\r\n            },\r\n          },\r\n        },\r\n      },\r\n    };\r\n\r\n    describe(\"Ascending AC\", () => {\r\n      before(async () => {\r\n        await game.settings.set(game.system.id, \"ascendingAC\", true);\r\n      });\r\n\r\n      it(\"Natural 1 terms is unsuccessful\", async () => {\r\n        expect(game.settings.get(game.system.id, \"ascendingAC\")).equal(true);\r\n        const rollTargetOne = createMockRoll(1, [1]);\r\n        expect(OseDice.digestAttackResult(data, rollTargetOne).isSuccess).equal(\r\n          false\r\n        );\r\n        expect(OseDice.digestAttackResult(data, rollTargetOne).isFailure).equal(\r\n          true\r\n        );\r\n        const rollTargetTwenty = createMockRoll(20, [1]);\r\n        expect(\r\n          OseDice.digestAttackResult(data, rollTargetTwenty).isSuccess\r\n        ).equal(false);\r\n        expect(\r\n          OseDice.digestAttackResult(data, rollTargetTwenty).isFailure\r\n        ).equal(true);\r\n      });\r\n\r\n      it(\"Attack rolls with a modified result of 1 are allowed to succeeed if hits target AC. Issue#340\", () => {\r\n        const attackBonus = -1;\r\n        const targetData = {\r\n          roll: {\r\n            thac0: 19,\r\n            target: {\r\n              actor: {\r\n                system: {\r\n                  ac: { value: 0 },\r\n                  aac: { value: 1 },\r\n                },\r\n              },\r\n            },\r\n          },\r\n        };\r\n\r\n        const roll = createMockRoll(1, [2, attackBonus]);\r\n        expect(OseDice.digestAttackResult(targetData, roll).isSuccess).equal(\r\n          true\r\n        );\r\n        expect(OseDice.digestAttackResult(targetData, roll).isFailure).equal(\r\n          false\r\n        );\r\n      });\r\n\r\n      it(\"Lower than target AC is unsuccessful\", () => {\r\n        const attackBonus = 19 - data.roll.thac0;\r\n        const roll = createMockRoll(\r\n          data.roll.target.actor.system.aac.value - attackBonus - 1\r\n        );\r\n        expect(OseDice.digestAttackResult(data, roll).isSuccess).equal(false);\r\n        expect(OseDice.digestAttackResult(data, roll).isFailure).equal(true);\r\n      });\r\n\r\n      it(\"Equal than target AC is successful\", () => {\r\n        const attackBonus = 19 - data.roll.thac0;\r\n        const roll = createMockRoll(\r\n          data.roll.target.actor.system.aac.value - attackBonus\r\n        );\r\n        expect(OseDice.digestAttackResult(data, roll).isSuccess).equal(true);\r\n        expect(OseDice.digestAttackResult(data, roll).isFailure).equal(false);\r\n      });\r\n\r\n      it(\"Higher than target AC is successful\", () => {\r\n        const attackBonus = 19 - data.roll.thac0;\r\n        const roll = createMockRoll(\r\n          data.roll.target.actor.system.aac.value - attackBonus + 1\r\n        );\r\n        expect(OseDice.digestAttackResult(data, roll).isSuccess).equal(true);\r\n        expect(OseDice.digestAttackResult(data, roll).isFailure).equal(false);\r\n      });\r\n\r\n      it(\"Attack rolls with a modified result of 20 are allowed to fail if doesn't hit target AC. Issue#340\", () => {\r\n        const attackBonus = 1;\r\n        const targetData = {\r\n          roll: {\r\n            thac0: 19,\r\n            target: {\r\n              actor: {\r\n                system: {\r\n                  ac: { value: 0 },\r\n                  aac: { value: 21 },\r\n                },\r\n              },\r\n            },\r\n          },\r\n        };\r\n\r\n        const roll = createMockRoll(20, [19, attackBonus]);\r\n        expect(OseDice.digestAttackResult(targetData, roll).isSuccess).equal(\r\n          false\r\n        );\r\n        expect(OseDice.digestAttackResult(targetData, roll).isFailure).equal(\r\n          true\r\n        );\r\n      });\r\n\r\n      it(\"Natural 20 is successful\", () => {\r\n        const rollTargetOne = createMockRoll(1, [20]);\r\n        expect(OseDice.digestAttackResult(data, rollTargetOne).isSuccess).equal(\r\n          true\r\n        );\r\n        expect(OseDice.digestAttackResult(data, rollTargetOne).isFailure).equal(\r\n          false\r\n        );\r\n        const rollTargetTwenty = createMockRoll(20, [20]);\r\n        expect(\r\n          OseDice.digestAttackResult(data, rollTargetTwenty).isSuccess\r\n        ).equal(true);\r\n        expect(\r\n          OseDice.digestAttackResult(data, rollTargetTwenty).isFailure\r\n        ).equal(false);\r\n      });\r\n    });\r\n\r\n    describe(\"Descending AC, ac=0\", () => {\r\n      before(async () => {\r\n        await game.settings.set(game.system.id, \"ascendingAC\", false);\r\n      });\r\n\r\n      it(\"Natural 1 terms is unsuccessful\", async () => {\r\n        expect(game.settings.get(game.system.id, \"ascendingAC\")).equal(false);\r\n        const rollTargetOne = createMockRoll(1, [1]);\r\n        expect(OseDice.digestAttackResult(data, rollTargetOne).isSuccess).equal(\r\n          false\r\n        );\r\n        expect(OseDice.digestAttackResult(data, rollTargetOne).isFailure).equal(\r\n          true\r\n        );\r\n        const rollTargetTwenty = createMockRoll(20, [1]);\r\n        expect(\r\n          OseDice.digestAttackResult(data, rollTargetTwenty).isSuccess\r\n        ).equal(false);\r\n        expect(\r\n          OseDice.digestAttackResult(data, rollTargetTwenty).isFailure\r\n        ).equal(true);\r\n      });\r\n\r\n      it(\"Lower than thac0 is unsuccessful\", () => {\r\n        const roll = createMockRoll(data.roll.thac0 - 1);\r\n        expect(OseDice.digestAttackResult(data, roll).isSuccess).equal(false);\r\n        expect(OseDice.digestAttackResult(data, roll).isFailure).equal(true);\r\n      });\r\n\r\n      it(\"Equal to thac0 is successful\", () => {\r\n        const roll = createMockRoll(data.roll.thac0);\r\n        expect(OseDice.digestAttackResult(data, roll).isSuccess).equal(true);\r\n        expect(OseDice.digestAttackResult(data, roll).isFailure).equal(false);\r\n      });\r\n\r\n      it(\"Higher than thac0 is successful\", () => {\r\n        const roll = createMockRoll(data.roll.thac0 + 1);\r\n        expect(OseDice.digestAttackResult(data, roll).isSuccess).equal(true);\r\n        expect(OseDice.digestAttackResult(data, roll).isFailure).equal(false);\r\n      });\r\n\r\n      it(\"Natural 20 is successful\", () => {\r\n        const rollTargetOne = createMockRoll(1, [20]);\r\n        expect(OseDice.digestAttackResult(data, rollTargetOne).isSuccess).equal(\r\n          true\r\n        );\r\n        expect(OseDice.digestAttackResult(data, rollTargetOne).isFailure).equal(\r\n          false\r\n        );\r\n        const rollTargetTwenty = createMockRoll(20, [20]);\r\n        expect(\r\n          OseDice.digestAttackResult(data, rollTargetTwenty).isSuccess\r\n        ).equal(true);\r\n        expect(\r\n          OseDice.digestAttackResult(data, rollTargetTwenty).isFailure\r\n        ).equal(false);\r\n      });\r\n    });\r\n  });\r\n\r\n  describe(\"sendAttackRoll(parts, data, flags, title, flavor, speaker, form)\", () => {\r\n    // eslint-disable-next-line unicorn/consistent-function-scoping\r\n    const createMockAttackData = () => ({\r\n      parts: [\"1d20\", \"0\", \"0\", \"0\"],\r\n      data: {\r\n        roll: {\r\n          type: \"melee\",\r\n          dmg: [\"1d6\"],\r\n          thac0: 15,\r\n          target: {\r\n            actor: { system: { ac: { value: 0 }, aac: { value: 9 } } },\r\n          },\r\n        },\r\n      },\r\n    });\r\n\r\n    before(async () => {\r\n      await trashChat();\r\n      await game.settings.set(game.system.id, \"ascendingAC\", true);\r\n    });\r\n\r\n    it(\"Missing dmg roll shows notification\", async () => {\r\n      ui.notifications?.close();\r\n      const rollData = createMockAttackData();\r\n      rollData.data.roll.dmg = [];\r\n      await OseDice.sendAttackRoll(rollData);\r\n      await waitForInput();\r\n      const notification = ui.notifications?.queue.pop();\r\n      expect(ui.notifications?.queue.length).equal(0);\r\n      expect(notification?.message).equal(\r\n        \"Attack has no damage dice terms; be sure to set the attack's damage\"\r\n      );\r\n    });\r\n\r\n    it(\"Can roll with single part and single dmg die\", async () => {\r\n      const rollData = createMockAttackData();\r\n      await OseDice.sendAttackRoll(rollData);\r\n      await waitForInput();\r\n      await waitForInput();\r\n      await waitForInput();\r\n      await waitForInput();\r\n      const attackDiceResult =\r\n        document.querySelector(\".dice-formula\")?.innerHTML;\r\n      expect(attackDiceResult).equal(\"1d20 + 0 + 0 + 0\");\r\n      const damageDiceResult = document.querySelector(\r\n        \".damage-roll .dice-formula\"\r\n      )?.innerHTML;\r\n      expect(damageDiceResult).equal(\"1d6\");\r\n    });\r\n    afterEach(async () => {\r\n      await trashChat();\r\n    });\r\n  });\r\n\r\n  describe(\"RollSave(parts, data, skipDialog, speaker, flavor, title, chatMessage)\", () => {\r\n    describe(\"Skipping dialog\", () => {\r\n      const skipDialog = true;\r\n      it(\"produces a roll chat message\", async () => {\r\n        await OseDice.RollSave({\r\n          parts: [\"1d10\"],\r\n          skipDialog,\r\n          data: { roll: { blindroll: false } },\r\n        });\r\n        await waitForInput();\r\n        expect(game.messages.size).equal(1);\r\n        expect(document.querySelector(\".roll-result\")).not.undefined;\r\n      });\r\n    });\r\n\r\n    describe(\"Not skipping dialog\", () => {\r\n      it(\"produces a dialog\", async () => {\r\n        OseDice.RollSave({\r\n          parts: [\"1d10\"],\r\n          data: { roll: { blindroll: false } },\r\n        });\r\n        await waitForInput();\r\n        const dialog = document.querySelector(\".dialog\");\r\n        expect(dialog?.querySelector(\".ok\")).not.null;\r\n        expect(dialog?.querySelector(\".magic\")).not.null;\r\n        expect(dialog?.querySelector(\".cancel\")).not.null;\r\n        await closeDialogs();\r\n      });\r\n    });\r\n\r\n    afterEach(async () => {\r\n      await trashChat();\r\n      await closeDialogs();\r\n    });\r\n  });\r\n\r\n  describe(\"Roll(parts, data, skipDialog, speaker, flavor, title, chatMessage, flags)\", () => {\r\n    describe(\"Skipping dialog\", () => {\r\n      const skipDialog = true;\r\n      it(\"produces a roll chat message\", async () => {\r\n        await OseDice.Roll({\r\n          parts: [\"1d10\"],\r\n          skipDialog,\r\n          data: { roll: { blindroll: false } },\r\n        });\r\n        await waitForInput();\r\n        expect(game.messages.size).equal(1);\r\n        expect(document.querySelector(\".roll-result\")).not.undefined;\r\n      });\r\n    });\r\n\r\n    describe(\"Not skipping dialog\", () => {\r\n      it(\"produces a dialog\", async () => {\r\n        OseDice.Roll({\r\n          parts: [\"1d10\"],\r\n          data: { roll: { blindroll: false } },\r\n        });\r\n        await waitForInput();\r\n        const dialog = document.querySelector(\".dialog\");\r\n        expect(dialog?.querySelector(\".ok\")).not.null;\r\n        expect(dialog?.querySelector(\".magic\")).is.null;\r\n        expect(dialog?.querySelector(\".cancel\")).not.null;\r\n        await closeDialogs();\r\n      });\r\n    });\r\n\r\n    afterEach(async () => {\r\n      await trashChat();\r\n      await closeDialogs();\r\n      await waitForInput();\r\n    });\r\n  });\r\n};\r\n","/**\r\n * @file Contains tests for handlebars helpers\r\n */\r\n// eslint-disable-next-line prettier/prettier, import/no-cycle\r\nimport { QuenchMethods } from \"../../e2e\";\r\n\r\nexport const key = \"ose.helpers.handlebars\";\r\nexport const options = {\r\n  displayName: \"OSE: Helpers: Handlebars\",\r\n};\r\n\r\nexport default ({ describe, it, expect }: QuenchMethods) => {\r\n  describe(\"registerHelpers()\", () => {\r\n    describe(\"eq helper\", () => {\r\n      const helper = \"eq\";\r\n      it(\"is registered\", () => {\r\n        expect(Object.keys(Handlebars.helpers)).contain(helper);\r\n      });\r\n\r\n      it(\"is functional\", () => {\r\n        expect(Handlebars.helpers.eq(1, 1)).equal(true);\r\n        expect(Handlebars.helpers.eq(\"test\", \"test\")).equal(true);\r\n        expect(Handlebars.helpers.eq(1, 2)).equal(false);\r\n        expect(Handlebars.helpers.eq(\"test\", 1)).equal(false);\r\n        expect(Handlebars.helpers.eq([], [])).equal(false);\r\n      });\r\n    });\r\n\r\n    describe(\"mod helper\", () => {\r\n      const helper = \"mod\";\r\n      it(\"is registered\", () => {\r\n        expect(Object.keys(Handlebars.helpers)).contain(helper);\r\n      });\r\n\r\n      it(\"is functional\", () => {\r\n        expect(Handlebars.helpers.mod(0)).equal(\"0\");\r\n        expect(Handlebars.helpers.mod(1)).equal(\"+1\");\r\n        expect(Handlebars.helpers.mod(-1)).equal(\"-1\");\r\n        expect(Handlebars.helpers.mod(\"1\")).equal(\"+1\");\r\n        expect(Handlebars.helpers.mod(\"-1\")).equal(\"-1\");\r\n        expect(Handlebars.helpers.mod(\"a\")).equal(\"0\");\r\n      });\r\n    });\r\n\r\n    describe(\"add helper\", () => {\r\n      const helper = \"add\";\r\n      it(\"is registered\", () => {\r\n        expect(Object.keys(Handlebars.helpers)).contain(helper);\r\n      });\r\n\r\n      it(\"is functional\", () => {\r\n        expect(Handlebars.helpers.add(1, 2)).equal(3);\r\n        expect(Handlebars.helpers.add(1, -2)).equal(-1);\r\n        expect(Handlebars.helpers.add(\"1\", \"3\")).equal(4);\r\n        expect(Handlebars.helpers.add(\"1\", \"-3\")).equal(-2);\r\n      });\r\n    });\r\n\r\n    describe(\"subtract helper\", () => {\r\n      const helper = \"subtract\";\r\n      it(\"is registered\", () => {\r\n        expect(Object.keys(Handlebars.helpers)).contain(helper);\r\n      });\r\n\r\n      it(\"is functional\", () => {\r\n        expect(Handlebars.helpers.subtract(1, 2)).equal(-1);\r\n        expect(Handlebars.helpers.subtract(1, -2)).equal(3);\r\n        expect(Handlebars.helpers.subtract(\"1\", \"3\")).equal(-2);\r\n        expect(Handlebars.helpers.subtract(\"1\", \"-3\")).equal(4);\r\n      });\r\n    });\r\n\r\n    describe(\"divide helper\", () => {\r\n      const helper = \"divide\";\r\n      it(\"is registered\", () => {\r\n        expect(Object.keys(Handlebars.helpers)).contain(helper);\r\n      });\r\n\r\n      it(\"is functional\", () => {\r\n        expect(Handlebars.helpers.divide(1, 2)).equal(0);\r\n        expect(Handlebars.helpers.divide(1, -2)).equal(-1);\r\n        expect(Handlebars.helpers.divide(10, 3)).equal(3);\r\n        expect(Handlebars.helpers.divide(\"10\", \"3\")).equal(3);\r\n        expect(Handlebars.helpers.divide(\"10\", \"-3\")).equal(-4);\r\n      });\r\n    });\r\n\r\n    describe(\"mult helper\", () => {\r\n      const helper = \"mult\";\r\n      it(\"is registered\", () => {\r\n        expect(Object.keys(Handlebars.helpers)).contain(helper);\r\n      });\r\n\r\n      it(\"is functional\", () => {\r\n        expect(Handlebars.helpers.mult(1, 2)).equal(2);\r\n        expect(Handlebars.helpers.mult(1, -2)).equal(-2);\r\n        expect(Handlebars.helpers.mult(10, 3)).equal(30);\r\n        expect(Handlebars.helpers.mult(\"10\", \"3\")).equal(30);\r\n        expect(Handlebars.helpers.mult(\"10\", \"-3\")).equal(-30);\r\n        expect(Handlebars.helpers.mult(0.1, 2)).equal(0.2);\r\n        expect(Handlebars.helpers.mult(0.01, 1)).equal(0.01);\r\n        expect(Handlebars.helpers.mult(0.001, 1)).equal(0);\r\n      });\r\n    });\r\n\r\n    describe(\"roundWeight helper\", () => {\r\n      const helper = \"roundWeight\";\r\n      it(\"is registered\", () => {\r\n        expect(Object.keys(Handlebars.helpers)).contain(helper);\r\n      });\r\n\r\n      it(\"is functional\", () => {\r\n        expect(Handlebars.helpers.roundWeight(10.1)).equal(0);\r\n        expect(Handlebars.helpers.roundWeight(100.1)).equal(0.1);\r\n        expect(Handlebars.helpers.roundWeight(1000.1)).equal(1);\r\n      });\r\n    });\r\n\r\n    describe(\"getTagIcon helper\", () => {\r\n      const helper = \"getTagIcon\";\r\n      it(\"is registered\", () => {\r\n        expect(Object.keys(Handlebars.helpers)).contain(helper);\r\n      });\r\n\r\n      describe(\"is functional\", () => {\r\n        const tags = Object.keys(CONFIG.OSE.tags);\r\n        tags.forEach((tag) => {\r\n          it(`for ${tag} tag`, async () => {\r\n            expect(Handlebars.helpers.getTagIcon(CONFIG.OSE.tags[tag])).equal(\r\n              CONFIG.OSE.tag_images[tag]\r\n            );\r\n          });\r\n        });\r\n      });\r\n    });\r\n\r\n    describe(\"counter helper\", () => {\r\n      const helper = \"counter\";\r\n      it(\"is registered\", () => {\r\n        expect(Object.keys(Handlebars.helpers)).contain(helper);\r\n      });\r\n\r\n      it(\"is functional\", () => {\r\n        expect(Handlebars.helpers.counter(true, 12, 10)).equal(100);\r\n        expect(Handlebars.helpers.counter(true, -10, 10)).equal(0);\r\n        expect(Handlebars.helpers.counter(true, 3, 10)).equal(30);\r\n        expect(Handlebars.helpers.counter(true, 33, 100)).equal(33);\r\n        expect(Handlebars.helpers.counter(true, 100, 400)).equal(25);\r\n        expect(Handlebars.helpers.counter(false, 12, 10)).equal(0);\r\n        expect(Handlebars.helpers.counter(false, -10, 10)).equal(100);\r\n        expect(Handlebars.helpers.counter(false, 3, 10)).equal(70);\r\n        expect(Handlebars.helpers.counter(false, 33, 100)).equal(67);\r\n        expect(Handlebars.helpers.counter(false, 100, 400)).equal(75);\r\n      });\r\n    });\r\n\r\n    describe(\"times helper\", () => {\r\n      const helper = \"times\";\r\n      it(\"is registered\", () => {\r\n        expect(Object.keys(Handlebars.helpers)).contain(helper);\r\n      });\r\n\r\n      it(\"is functional\", () => {\r\n        const block = {\r\n          fn: (i) => i,\r\n        };\r\n        expect(Handlebars.helpers.times(2, block)).equal(\"01\");\r\n        expect(Handlebars.helpers.times(5, block)).equal(\"01234\");\r\n      });\r\n    });\r\n\r\n    describe(\"path helper\", () => {\r\n      const helper = \"path\";\r\n      it(\"is registered\", () => {\r\n        expect(Object.keys(Handlebars.helpers)).contain(helper);\r\n      });\r\n\r\n      it(\"is functional\", () => {\r\n        expect(Handlebars.helpers.path(\"/test\")).equal(\r\n          `${CONFIG.OSE.systemPath()}/test`\r\n        );\r\n      });\r\n    });\r\n\r\n    describe(\"asset helper\", () => {\r\n      const helper = \"asset\";\r\n      it(\"is registered\", () => {\r\n        expect(Object.keys(Handlebars.helpers)).contain(helper);\r\n      });\r\n\r\n      it(\"is functional\", () => {\r\n        expect(Handlebars.helpers.asset(\"/test\")).equal(\r\n          `${CONFIG.OSE.assetsPath}/test`\r\n        );\r\n      });\r\n    });\r\n  });\r\n};\r\n","/**\r\n * @file Contains tests for Quench for testing macros\r\n */\r\n// eslint-disable-next-line import/no-cycle\r\nimport { QuenchMethods } from \"../../e2e\";\r\nimport {\r\n  cleanUpActorsByKey,\r\n  cleanUpMacros,\r\n  cleanUpScenes,\r\n  cleanUpWorldItems,\r\n  closeDialogs,\r\n  createActorTestItem,\r\n  createMockActorKey,\r\n  createMockMacro,\r\n  createMockScene,\r\n  createWorldTestItem,\r\n  openDialogs,\r\n  waitForInput,\r\n} from \"../../e2e/testUtils\";\r\nimport { createOseMacro, rollItemMacro } from \"../helpers-macros\";\r\n\r\nexport const key = \"ose.helpers.macro\";\r\nexport const options = { displayName: \"OSE: Helpers: Macro\" };\r\n\r\n/* MOCKING HELPERS */\r\nconst createMockActor = async (type: string, data: object = {}) =>\r\n  createMockActorKey(type, data, key);\r\n\r\n/* CLEAN UP HELPERS */\r\nconst cleanUpActors = () => cleanUpActorsByKey(key);\r\n\r\nexport default ({\r\n  describe,\r\n  it,\r\n  expect,\r\n  before,\r\n  after,\r\n  afterEach,\r\n}: QuenchMethods) => {\r\n  before(async () => {\r\n    game?.scenes?.active?.update({ active: false });\r\n    await ui.notifications?.close();\r\n  });\r\n\r\n  afterEach(async () => {\r\n    cleanUpMacros();\r\n    cleanUpActors();\r\n    cleanUpWorldItems();\r\n    cleanUpScenes();\r\n  });\r\n\r\n  after(async () => {\r\n    closeDialogs();\r\n    cleanUpMacros();\r\n    cleanUpActors();\r\n    cleanUpWorldItems();\r\n    cleanUpScenes();\r\n    await ui.notifications?.render(true);\r\n  });\r\n\r\n  describe(\"createOseMacro(data, slot)\", () => {\r\n    it(\"Can create macro\", async () => {\r\n      const macro = await createMockMacro();\r\n      expect(game.macros?.contents.find((m) => m.uuid === macro?.uuid)).not\r\n        .undefined;\r\n    });\r\n\r\n    it(\"Can drag Macro to hotbar\", async () => {\r\n      const macro = await createMockMacro();\r\n      const data = { type: \"Macro\", uuid: macro?.uuid };\r\n      const macroSlot = 9;\r\n\r\n      await createOseMacro(data, macroSlot);\r\n      const hotbar = game.user?.getHotbarMacros(1);\r\n\r\n      expect(hotbar[macroSlot - 1].macro).equal(macro);\r\n    });\r\n\r\n    it(\"Dragging Actor to hotbar send notification\", async () => {\r\n      const actor = await createMockActor(\"character\");\r\n      const data = { type: actor?.type, uuid: actor?.uuid };\r\n      const macroSlot = 9;\r\n      expect(ui.notifications?.queue.length).equal(0);\r\n      await createOseMacro(data, macroSlot);\r\n      expect(ui.notifications?.queue.length).equal(1);\r\n      expect(ui.notifications?.queue.pop()?.message).equal(\r\n        game.i18n.localize(\"OSE.warn.macrosNotAnItem\")\r\n      );\r\n      expect(ui.notifications?.queue.length).equal(0);\r\n      await actor?.delete();\r\n    });\r\n\r\n    it(\"Dragging World Item to hotbar send notification\", async () => {\r\n      const actor = await createMockActor(\"character\");\r\n      const worldItem = await createWorldTestItem(\"weapon\");\r\n      const data = { type: \"Item\", uuid: worldItem?.uuid };\r\n      const macroSlot = 9;\r\n      expect(ui.notifications?.queue.length).equal(0);\r\n      await createOseMacro(data, macroSlot);\r\n      expect(ui.notifications?.queue.length).equal(1);\r\n      expect(ui.notifications?.queue.pop()?.message).equal(\r\n        game.i18n.localize(\"OSE.warn.macrosOnlyForOwnedItems\")\r\n      );\r\n      expect(ui.notifications?.queue.length).equal(0);\r\n      await actor?.delete();\r\n      await worldItem?.delete();\r\n    });\r\n\r\n    describe(\"Dragging all item types creates macros\", () => {\r\n      const itemTypes = new Set([\r\n        \"spell\",\r\n        \"ability\",\r\n        \"armor\",\r\n        \"weapon\",\r\n        \"item\",\r\n        \"container\",\r\n      ]);\r\n      itemTypes.forEach((type) => {\r\n        it(`Dragging Actor ${type.capitalize()} to hotbar craetes macro`, async () => {\r\n          const actor = await createMockActor(\"character\");\r\n          await createActorTestItem(actor, type);\r\n          const item = actor?.items.contents[0];\r\n          const data = {\r\n            type: \"Item\",\r\n            uuid: item?.uuid,\r\n            item: {\r\n              name: item?.name,\r\n              img: \"\",\r\n            },\r\n          };\r\n          const macroSlot = 9;\r\n\r\n          await createOseMacro(data, macroSlot);\r\n          const macro = game.user?.getHotbarMacros()[macroSlot - 1];\r\n          expect(macro?.macro?.command).equal(\r\n            `game.ose.rollItemMacro(\"New Actor Test ${type.capitalize()}\");`\r\n          );\r\n          await actor?.delete();\r\n        });\r\n      });\r\n    });\r\n  });\r\n\r\n  describe(\"rollItemMacro(itemName)\", () => {\r\n    it(\"No scene creates warning\", async () => {\r\n      const type = \"weapon\";\r\n      const actor = await createMockActor(\"character\");\r\n      await createActorTestItem(actor, type);\r\n      await game.user?.update({ character: actor?.id });\r\n      expect(ChatMessage.getSpeaker().scene).is.null;\r\n      expect(ChatMessage.getSpeaker().actor).is.not.null;\r\n      expect(ui.notifications?.queue.length).equal(0);\r\n      await rollItemMacro(`New Actor Test ${type.capitalize()}`);\r\n      expect(ui.notifications?.queue.length).equal(1);\r\n      expect(ui.notifications?.queue.pop()?.message).equal(\r\n        game.i18n.localize(\"OSE.warn.macrosNoTokenOwnedInScene\")\r\n      );\r\n      expect(ui.notifications?.queue.length).equal(0);\r\n      await actor?.delete();\r\n    });\r\n\r\n    it(\"No assigned actor creates warning\", async () => {\r\n      const type = \"weapon\";\r\n      const actor = await createMockActor(\"character\");\r\n      const scene = await createMockScene();\r\n      expect(scene?.tokenVision).equal(true);\r\n      await createActorTestItem(actor, type);\r\n      await game.user?.update({ character: null });\r\n      expect(ChatMessage.getSpeaker().scene).is.not.null;\r\n      expect(ChatMessage.getSpeaker().actor).is.null;\r\n      expect(ui.notifications?.queue.length).equal(0);\r\n      await rollItemMacro(`New Actor Test ${type.capitalize()}`);\r\n      expect(ui.notifications?.queue.length).equal(1);\r\n      expect(ui.notifications?.queue.pop()?.message).equal(\r\n        game.i18n.localize(\"OSE.warn.macrosNoTokenOwnedInScene\")\r\n      );\r\n      expect(ui.notifications?.queue.length).equal(0);\r\n      await actor?.delete();\r\n      await scene?.delete();\r\n    });\r\n\r\n    it(\"Scene & assigned actor creates roll\", async () => {\r\n      const type = \"weapon\";\r\n      const actor = await createMockActor(\"character\");\r\n      const scene = await createMockScene();\r\n      expect(scene?.tokenVision).equal(true);\r\n      await createActorTestItem(actor, type);\r\n      await game.user?.update({ character: actor?.id });\r\n      expect(ChatMessage.getSpeaker().scene).is.not.null;\r\n      expect(ChatMessage.getSpeaker().actor).is.not.null;\r\n      await rollItemMacro(`New Actor Test ${type.capitalize()}`);\r\n      await waitForInput();\r\n      expect(openDialogs().length).equal(1);\r\n      await closeDialogs();\r\n      await actor?.delete();\r\n      await scene?.delete();\r\n    });\r\n\r\n    it(\"Duplicate item creates warning but also craetes rolls\", async () => {\r\n      const type = \"weapon\";\r\n      const actor = await createMockActor(\"character\");\r\n      const scene = await createMockScene();\r\n      expect(scene?.tokenVision).equal(true);\r\n      await createActorTestItem(actor, type);\r\n      await createActorTestItem(actor, type);\r\n      await game.user?.update({ character: actor?.id });\r\n      expect(ui.notifications?.queue.length).equal(0);\r\n      await rollItemMacro(`New Actor Test ${type.capitalize()}`);\r\n      await waitForInput();\r\n      expect(ui.notifications?.queue.length).equal(1);\r\n      expect(ui.notifications?.queue.pop()?.message).equal(\r\n        game.i18n.format(\"OSE.warn.moreThanOneItemWithName\", {\r\n          actorName: actor?.name,\r\n          itemName: `New Actor Test ${type.capitalize()}`,\r\n        })\r\n      );\r\n      expect(ui.notifications?.queue.length).equal(0);\r\n      await waitForInput();\r\n      expect(openDialogs().length).equal(1);\r\n      await closeDialogs();\r\n      await actor?.delete();\r\n      await scene?.delete();\r\n    });\r\n\r\n    it(\"Missing item creates warning\", async () => {\r\n      const type = \"weapon\";\r\n      const actor = await createMockActor(\"character\");\r\n      const scene = await createMockScene();\r\n      expect(scene?.tokenVision).equal(true);\r\n      await createActorTestItem(actor, type);\r\n      await game.user?.update({ character: actor?.id });\r\n      await actor?.items\r\n        .getName(`New Actor Test ${type.capitalize()}`)\r\n        ?.delete();\r\n      expect(ui.notifications?.queue.length).equal(0);\r\n      await rollItemMacro(`New Actor Test ${type.capitalize()}`);\r\n      await waitForInput();\r\n      expect(ui.notifications?.queue.length).equal(1);\r\n      const error = ui.notifications?.queue.pop();\r\n      expect(ui.notifications?.queue.length).equal(0);\r\n      expect(error?.type).equal(\"error\");\r\n      expect(error?.message).equal(\r\n        game.i18n.format(\"OSE.error.noItemWithName\", {\r\n          actorName: actor?.name,\r\n          itemName: `New Actor Test ${type.capitalize()}`,\r\n        })\r\n      );\r\n      await actor?.delete();\r\n      await scene?.delete();\r\n    });\r\n  });\r\n};\r\n","/**\r\n * @file Contains tests for party helpers\r\n */\r\n// eslint-disable-next-line prettier/prettier, import/no-cycle\r\nimport { QuenchMethods } from \"../../e2e\";\r\nimport {\r\n  cleanUpActorsByKey,\r\n  closeDialogs,\r\n  createMockActorKey,\r\n  openDialogs,\r\n  waitForInput,\r\n} from \"../../e2e/testUtils\";\r\nimport { update } from \"../helpers-party\";\r\nimport OsePartySheet from \"../party/party-sheet\";\r\n\r\nexport const key = \"ose.helpers.party\";\r\nexport const options = {\r\n  displayName: \"OSE: Helpers: Party\",\r\n};\r\n\r\n/* MOCKING HELPERS */\r\nconst createMockActor = async (type: string, data: object = {}) =>\r\n  createMockActorKey(type, data, key);\r\n\r\n/* CLEAN UP HELPERS */\r\nconst cleanUpActors = () => cleanUpActorsByKey(key);\r\n\r\nexport default ({ describe, it, expect, after }: QuenchMethods) => {\r\n  after(() => {\r\n    cleanUpActors();\r\n  });\r\n\r\n  // @todo: How to test?\r\n  describe(\"addControl(object, html)\", () => {});\r\n\r\n  describe(\"update(actor)\", () => {\r\n    it(\"Doesn't render a partysheet when not in party\", async () => {\r\n      const actor = await createMockActor(\"character\");\r\n      update(actor);\r\n      expect(openDialogs().length).equal(0);\r\n      await actor?.delete();\r\n    });\r\n\r\n    it(\"Opens a partysheet when in party\", async () => {\r\n      const actor = await createMockActor(\"character\");\r\n      actor?.setFlag(game.system.id, \"party\", true);\r\n      update(actor);\r\n      await waitForInput();\r\n      await OsePartySheet?.partySheet?.render(true);\r\n      await waitForInput();\r\n      const partyMember = document\r\n        .querySelector(\".party-members .actor\")\r\n        ?.getAttribute(\"data-actor-id\");\r\n      expect(partyMember).equal(actor?.id);\r\n      expect(openDialogs().length).equal(1);\r\n      await closeDialogs();\r\n      actor?.delete();\r\n      expect(openDialogs().length).equal(1);\r\n    });\r\n  });\r\n};\r\n","/**\r\n * @file Contains tests for treasure helpers\r\n */\r\n// eslint-disable-next-line prettier/prettier, import/no-cycle\r\nimport { QuenchMethods } from \"../../e2e\";\r\nimport { trashChat, waitForInput } from \"../../e2e/testUtils\";\r\nimport { functionsForTesting } from \"../helpers-treasure\";\r\n\r\nconst { drawTreasure, rollTreasure } = functionsForTesting;\r\n\r\nexport const key = \"ose.helpers.treasure\";\r\nexport const options = {\r\n  displayName: \"OSE: Helpers: Treasure\",\r\n};\r\n\r\nconst createMockTable = async () =>\r\n  RollTable.create({\r\n    name: `Mock Table ${key}`,\r\n  });\r\n\r\nconst createMockTreasureTable = async () => {\r\n  const table: RollTable = (await createMockTable()) as RollTable;\r\n  await table.update({ name: `Mock Treasure Table ${key}` });\r\n  await table.setFlag(game.system.id, \"treasure\", true);\r\n  return table;\r\n};\r\n\r\nconst cleanUpTables = async () => {\r\n  const tables = game.tables?.filter(\r\n    (t) =>\r\n      t.name === `Mock Table ${key}` || t.name === `Mock Treasure Table ${key}`\r\n  );\r\n  tables?.forEach((t) => t.delete());\r\n};\r\n\r\nexport default ({ describe, it, expect, after }: QuenchMethods) => {\r\n  // @todo: how to test?\r\n  describe(\"augmentTable(table, html)\", () => {});\r\n\r\n  describe(\"drawTreasure(table, data)\", () => {\r\n    it(\"Can create table\", async () => {\r\n      const table = await createMockTreasureTable();\r\n      await table.createEmbeddedDocuments(\"TableResult\", [\r\n        {\r\n          text: \"50% Chance\",\r\n          range: [1, 1],\r\n          weight: 50,\r\n        },\r\n      ]);\r\n      expect(table.results.size).equal(1);\r\n      await table.delete();\r\n    });\r\n\r\n    it(\"Draws successfully from a treasure table\", async () => {\r\n      const table = await createMockTreasureTable();\r\n      await table.createEmbeddedDocuments(\"TableResult\", [\r\n        {\r\n          text: \"100% Chance\",\r\n          range: [1, 1],\r\n          weight: 100,\r\n        },\r\n      ]);\r\n      const data = await drawTreasure(table, {});\r\n      await waitForInput();\r\n      expect(data.treasure).is.not.undefined;\r\n      const resultKey = Object.keys(data.treasure)[0];\r\n      expect(data.treasure[resultKey].text).equal(\"100% Chance\");\r\n    });\r\n\r\n    // @todo: volatile, may still draw due to 1% minimum, how to fix?\r\n    /* it(\"Draws unsuccessfully from a treasure table\", async () => {\r\n      const table = await createMockTreasureTable();\r\n      await table.createEmbeddedDocuments(\"TableResult\", [\r\n        {\r\n          text: \"1% Chance\",\r\n          range: [1, 1],\r\n          weight: 1,\r\n        },\r\n      ]);\r\n      const data = await drawTreasure(table, {});\r\n      expect(Object.keys(data.treasure).length).equal(0);\r\n    }); */\r\n\r\n    it(\"Just draws from a non-treasure table\", async () => {\r\n      const table = await createMockTable();\r\n      table?.update({ formula: \"1d100\" });\r\n      await table?.createEmbeddedDocuments(\"TableResult\", [\r\n        {\r\n          text: \"100% Chance\",\r\n          range: [1, 100],\r\n        },\r\n      ]);\r\n      const data = await drawTreasure(table, {});\r\n      await waitForInput();\r\n      expect(data.treasure).is.not.undefined;\r\n      const resultKey = Object.keys(data.treasure)[0];\r\n      expect(data.treasure[resultKey].text).equal(\"100% Chance\");\r\n    });\r\n  });\r\n\r\n  describe(\"rollTreasure(table, options)\", () => {\r\n    it(\"Rolling on treasure table produces a chat message\", async () => {\r\n      trashChat();\r\n      const table = await createMockTreasureTable();\r\n      await table.createEmbeddedDocuments(\"TableResult\", [\r\n        {\r\n          text: \"100% Chance\",\r\n          range: [1, 1],\r\n          weight: 100,\r\n        },\r\n      ]);\r\n      await rollTreasure(table);\r\n      await waitForInput();\r\n      expect(game.messages?.size).equal(1);\r\n      expect(game.messages?.contents[0].content).contains(\"100% Chance\");\r\n    });\r\n  });\r\n\r\n  after(() => {\r\n    cleanUpTables();\r\n    trashChat();\r\n  });\r\n};\r\n","/* eslint-disable import/no-cycle */\r\n/* eslint-disable simple-import-sort/imports */\r\n/**\r\n * @file Orchestration for our Quench tests\r\n */\r\n// ACTOR TESTING IMPORTS\r\nimport actorDataModelCharacterTests, {\r\n  key as actorDataModelCharacterKey,\r\n  options as actorDataModelCharacterOptions,\r\n} from \"../module/actor/__tests__/data-model-character.test\";\r\nimport actorDataModelCharacterACTests, {\r\n  key as actorDataModelCharacterACKey,\r\n  options as actorDataModelCharacterACOptions,\r\n} from \"../module/actor/data-model-classes/__tests__/data-model-character-ac.test\";\r\nimport actorDataModelCharacterEncumbranceTests, {\r\n  key as actorDataModelCharacterEncumbranceKey,\r\n  options as actorDataModelCharacterEncumbranceOptions,\r\n} from \"../module/actor/data-model-classes/__tests__/data-model-character-encumbrance.test\";\r\nimport actorDataModelCharacterMoveTests, {\r\n  key as actorDataModelCharacterMoveKey,\r\n  options as actorDataModelCharacterMoveOptions,\r\n} from \"../module/actor/data-model-classes/__tests__/data-model-character-move.test\";\r\nimport actorDataModelCharacterScoresTests, {\r\n  key as actorDataModelCharacterScoresKey,\r\n  options as actorDataModelCharacterScoresOptions,\r\n} from \"../module/actor/data-model-classes/__tests__/data-model-character-scores.test\";\r\nimport actorDataModelCharacterSpellsTests, {\r\n  key as actorDataModelCharacterSpellsKey,\r\n  options as actorDataModelCharacterSpellsOptions,\r\n} from \"../module/actor/data-model-classes/__tests__/data-model-character-spells.test\";\r\nimport actorDataModelMonsterTests, {\r\n  key as actorDataModelMonsterKey,\r\n  options as actorDataModelMonsterOptions,\r\n} from \"../module/actor/__tests__/data-model-monster.test\";\r\nimport actorEntityTests, {\r\n  key as actorEntityKey,\r\n  options as actorEntityOptions,\r\n} from \"../module/actor/__tests__/entity-actor.test\";\r\nimport actorSheetTests, {\r\n  key as actorSheetKey,\r\n  options as actorSheetOptions,\r\n} from \"../module/actor/__tests__/sheet-actor.test\";\r\nimport actorSheetDragNDropTests, {\r\n  key as actorSheetDragNDropKey,\r\n  options as actorSheetDragNDropOptions,\r\n} from \"../module/actor/__tests__/sheet-actor/sheet-actor-e2e-dragndrop.test\";\r\nimport actorSheetCharacterTests, {\r\n  key as actorSheetCharacterKey,\r\n  options as actorSheetCharacterOptions,\r\n} from \"../module/actor/__tests__/sheet-character.test\";\r\nimport actorSheetMonsterTests, {\r\n  key as actorSheetMonsterKey,\r\n  options as actorSheetMonsterOptions,\r\n} from \"../module/actor/__tests__/sheet-monster.test\";\r\n\r\n// DIALOG TESTING IMPORTS\r\nimport actorSheetCharacterDialogModifiersTest, {\r\n  key as actorSheetCharacterDialogModifiersKey,\r\n  options as actorSheetCharacterDialogModifiersOptions,\r\n} from \"../module/dialog/__tests__/sheet-character-modifiers.test\";\r\nimport actorSheetDialogEntityTweaksTests, {\r\n  key as actorSheetDialogEntityTweaksKey,\r\n  options as actorSheetDialogEntityTweaksOptions,\r\n} from \"../module/dialog/__tests__/sheet-entity-tweaks.test\";\r\n\r\n// ITEM TESTING IMPORTS\r\nimport itemDataModelAbilityTests, {\r\n  key as itemDataModelAbilityKey,\r\n  options as itemDataModelAbilityOptions,\r\n} from \"../module/item/__tests__/data-model-item-ability.test\";\r\nimport itemDataModelArmorTests, {\r\n  key as itemDataModelArmorKey,\r\n  options as itemDataModelArmorOptions,\r\n} from \"../module/item/__tests__/data-model-item-armor.test\";\r\nimport itemDataModelContainerTests, {\r\n  key as itemDataModelContainerKey,\r\n  options as itemDataModelContainerOptions,\r\n} from \"../module/item/__tests__/data-model-item-container.test\";\r\nimport itemDataModelMiscTests, {\r\n  key as itemDataModelMiscKey,\r\n  options as itemDataModelMiscOptions,\r\n} from \"../module/item/__tests__/data-model-item-misc.test\";\r\nimport itemDataModelSpellTests, {\r\n  key as itemDataModelSpellKey,\r\n  options as itemDataModelSpellOptions,\r\n} from \"../module/item/__tests__/data-model-item-spell.test\";\r\nimport itemDataModelWeaponTests, {\r\n  key as itemDataModelWeaponKey,\r\n  options as itemDataModelWeaponOptions,\r\n} from \"../module/item/__tests__/data-model-item-weapon.test\";\r\nimport itemEntityTests, {\r\n  key as itemEntityKey,\r\n  options as itemEntityOptions,\r\n} from \"../module/item/__tests__/entity-item.test\";\r\nimport itemSheetTests, {\r\n  key as itemSheetKey,\r\n  options as itemSheetOptions,\r\n} from \"../module/item/__tests__/sheet-item.test\";\r\n\r\n// PARTY TESTING IMPORTS\r\nimport partyEntityTests, {\r\n  key as partyEntityKey,\r\n  options as partyEntityOptions,\r\n} from \"../module/party/__tests__/entity-party.test\";\r\nimport partySheetTests, {\r\n  key as partySheetKey,\r\n  options as partySheetOptions,\r\n} from \"../module/party/__tests__/sheet-party.test\";\r\nimport partyXpSheetTests, {\r\n  key as partyXpSheetKey,\r\n  options as partyXpSheetOptions,\r\n} from \"../module/party/__tests__/sheet-party-xp.test\";\r\n\r\n// HELPER TESTING IMPORTS\r\nimport helpersBehaviourTests, {\r\n  key as helpersBehaviourKey,\r\n  options as helpersBehaviourOptions,\r\n} from \"../module/__tests__/helpers-behaviour.test\";\r\nimport helpersChatTests, {\r\n  key as helpersChatKey,\r\n  options as helpersChatOptions,\r\n} from \"../module/__tests__/helpers-chat.test\";\r\nimport helpersDiceTests, {\r\n  key as helpersDiceKey,\r\n  options as helpersDiceOptions,\r\n} from \"../module/__tests__/helpers-dice.test\";\r\nimport helpersHandlebarsTests, {\r\n  key as helpersHandlebarsKey,\r\n  options as helpersHandlebarsOptions,\r\n} from \"../module/__tests__/helpers-handlebars.test\";\r\nimport helpersMacrosTests, {\r\n  key as helpersMacrosKey,\r\n  options as helpersMacrosOptions,\r\n} from \"../module/__tests__/helpers-macros.test\";\r\nimport helpersPartyTests, {\r\n  key as helpersPartyKey,\r\n  options as helpersPartyOptions,\r\n} from \"../module/__tests__/helpers-party.test\";\r\nimport helpersTreasureTests, {\r\n  key as helpersTreasureKey,\r\n  options as helpersTreasureOptions,\r\n} from \"../module/__tests__/helpers-treasure.test\";\r\n\r\nexport type QuenchMethods = {\r\n  [s: string]: any;\r\n};\r\n\r\ntype Quench = {\r\n  registerBatch: (key: string, tests: Function, options: any) => void;\r\n};\r\n\r\nHooks.on(\"quenchReady\", async (quench: Quench) => {\r\n  /* ------------------------------------------- */\r\n  /* ACTOR TESTING                               */\r\n  /* ------------------------------------------- */\r\n  quench.registerBatch(\r\n    actorDataModelCharacterKey,\r\n    actorDataModelCharacterTests,\r\n    actorDataModelCharacterOptions\r\n  );\r\n  quench.registerBatch(\r\n    actorDataModelCharacterACKey,\r\n    actorDataModelCharacterACTests,\r\n    actorDataModelCharacterACOptions\r\n  );\r\n  quench.registerBatch(\r\n    actorDataModelCharacterEncumbranceKey,\r\n    actorDataModelCharacterEncumbranceTests,\r\n    actorDataModelCharacterEncumbranceOptions\r\n  );\r\n  quench.registerBatch(\r\n    actorDataModelCharacterMoveKey,\r\n    actorDataModelCharacterMoveTests,\r\n    actorDataModelCharacterMoveOptions\r\n  );\r\n  quench.registerBatch(\r\n    actorDataModelCharacterScoresKey,\r\n    actorDataModelCharacterScoresTests,\r\n    actorDataModelCharacterScoresOptions\r\n  );\r\n  quench.registerBatch(\r\n    actorDataModelCharacterSpellsKey,\r\n    actorDataModelCharacterSpellsTests,\r\n    actorDataModelCharacterSpellsOptions\r\n  );\r\n  quench.registerBatch(\r\n    actorDataModelMonsterKey,\r\n    actorDataModelMonsterTests,\r\n    actorDataModelMonsterOptions\r\n  );\r\n\r\n  quench.registerBatch(actorEntityKey, actorEntityTests, actorEntityOptions);\r\n\r\n  quench.registerBatch(actorSheetKey, actorSheetTests, actorSheetOptions);\r\n  quench.registerBatch(\r\n    actorSheetDragNDropKey,\r\n    actorSheetDragNDropTests,\r\n    actorSheetDragNDropOptions\r\n  );\r\n  quench.registerBatch(\r\n    actorSheetCharacterKey,\r\n    actorSheetCharacterTests,\r\n    actorSheetCharacterOptions\r\n  );\r\n  quench.registerBatch(\r\n    actorSheetMonsterKey,\r\n    actorSheetMonsterTests,\r\n    actorSheetMonsterOptions\r\n  );\r\n\r\n  /* ------------------------------------------- */\r\n  /* DIALOG TESTING                              */\r\n  /* ------------------------------------------- */\r\n\r\n  quench.registerBatch(\r\n    actorSheetCharacterDialogModifiersKey,\r\n    actorSheetCharacterDialogModifiersTest,\r\n    actorSheetCharacterDialogModifiersOptions\r\n  );\r\n  quench.registerBatch(\r\n    actorSheetDialogEntityTweaksKey,\r\n    actorSheetDialogEntityTweaksTests,\r\n    actorSheetDialogEntityTweaksOptions\r\n  );\r\n\r\n  /* ------------------------------------------- */\r\n  /* ITEM TESTING                                */\r\n  /* ------------------------------------------- */\r\n\r\n  quench.registerBatch(\r\n    itemDataModelAbilityKey,\r\n    itemDataModelAbilityTests,\r\n    itemDataModelAbilityOptions\r\n  );\r\n  quench.registerBatch(\r\n    itemDataModelArmorKey,\r\n    itemDataModelArmorTests,\r\n    itemDataModelArmorOptions\r\n  );\r\n  quench.registerBatch(\r\n    itemDataModelContainerKey,\r\n    itemDataModelContainerTests,\r\n    itemDataModelContainerOptions\r\n  );\r\n  quench.registerBatch(\r\n    itemDataModelMiscKey,\r\n    itemDataModelMiscTests,\r\n    itemDataModelMiscOptions\r\n  );\r\n  quench.registerBatch(\r\n    itemDataModelSpellKey,\r\n    itemDataModelSpellTests,\r\n    itemDataModelSpellOptions\r\n  );\r\n  quench.registerBatch(\r\n    itemDataModelWeaponKey,\r\n    itemDataModelWeaponTests,\r\n    itemDataModelWeaponOptions\r\n  );\r\n\r\n  quench.registerBatch(itemEntityKey, itemEntityTests, itemEntityOptions);\r\n\r\n  quench.registerBatch(itemSheetKey, itemSheetTests, itemSheetOptions);\r\n\r\n  /* ------------------------------------------- */\r\n  /* PARTY TESTING                         */\r\n  /* ------------------------------------------- */\r\n\r\n  quench.registerBatch(partyEntityKey, partyEntityTests, partyEntityOptions);\r\n  quench.registerBatch(partySheetKey, partySheetTests, partySheetOptions);\r\n  quench.registerBatch(partyXpSheetKey, partyXpSheetTests, partyXpSheetOptions);\r\n\r\n  /* ------------------------------------------- */\r\n  /* HELPER TESTING                               */\r\n  /* ------------------------------------------- */\r\n\r\n  quench.registerBatch(\r\n    helpersBehaviourKey,\r\n    helpersBehaviourTests,\r\n    helpersBehaviourOptions\r\n  );\r\n  quench.registerBatch(helpersChatKey, helpersChatTests, helpersChatOptions);\r\n  quench.registerBatch(helpersDiceKey, helpersDiceTests, helpersDiceOptions);\r\n  quench.registerBatch(\r\n    helpersHandlebarsKey,\r\n    helpersHandlebarsTests,\r\n    helpersHandlebarsOptions\r\n  );\r\n  quench.registerBatch(\r\n    helpersMacrosKey,\r\n    helpersMacrosTests,\r\n    helpersMacrosOptions\r\n  );\r\n  quench.registerBatch(helpersPartyKey, helpersPartyTests, helpersPartyOptions);\r\n  quench.registerBatch(\r\n    helpersTreasureKey,\r\n    helpersTreasureTests,\r\n    helpersTreasureOptions\r\n  );\r\n});","/**\r\n * @file The entry point for the OSE system\r\n *       We should handle most of our setup here.\r\n */\r\nimport OseActorSheetCharacter from \"./module/actor/character-sheet\";\r\nimport OseDataModelCharacter from \"./module/actor/data-model-character\";\r\nimport OseDataModelMonster from \"./module/actor/data-model-monster\";\r\nimport OseActor from \"./module/actor/entity\";\r\nimport OseActorSheetMonster from \"./module/actor/monster-sheet\";\r\n\r\nimport OseDataModelAbility from \"./module/item/data-model-ability\";\r\nimport OseDataModelArmor from \"./module/item/data-model-armor\";\r\nimport OseDataModelContainer from \"./module/item/data-model-container\";\r\nimport OseDataModelItem from \"./module/item/data-model-item\";\r\nimport OseDataModelSpell from \"./module/item/data-model-spell\";\r\nimport OseDataModelWeapon from \"./module/item/data-model-weapon\";\r\nimport OseItem from \"./module/item/entity\";\r\nimport OseItemSheet from \"./module/item/item-sheet\";\r\n\r\nimport * as chat from \"./module/helpers-chat\";\r\nimport OseCombat from \"./module/combat\";\r\nimport OSE from \"./module/config\";\r\nimport registerFVTTModuleAPIs from \"./module/fvttModuleAPIs\";\r\nimport handlebarsHelpers from \"./module/helpers-handlebars\";\r\nimport * as macros from \"./module/helpers-macros\";\r\nimport * as party from \"./module/helpers-party\";\r\nimport OsePartySheet from \"./module/party/party-sheet\";\r\nimport templates from \"./module/preloadTemplates\";\r\nimport * as renderList from \"./module/renderList\";\r\nimport registerSettings from \"./module/settings\";\r\nimport * as treasure from \"./module/helpers-treasure\";\r\n\r\nimport \"./e2e\";\r\n\r\n/* -------------------------------------------- */\r\n/*  Foundry VTT Initialization                  */\r\n/* -------------------------------------------- */\r\n\r\nHooks.once(\"init\", async () => {\r\n  /**\r\n   * Set an initiative formula for the system\r\n   *\r\n   * @type {string}\r\n   */\r\n  CONFIG.Combat.initiative = {\r\n    formula: \"1d6 + @init\",\r\n    decimals: 2,\r\n  };\r\n\r\n  CONFIG.OSE = OSE;\r\n\r\n  game.ose = {\r\n    rollItemMacro: macros.rollItemMacro,\r\n    rollTableMacro: macros.rollTableMacro,\r\n    oseCombat: OseCombat,\r\n  };\r\n\r\n  // Init Party Sheet handler\r\n  OsePartySheet.init();\r\n\r\n  // Custom Handlebars helpers\r\n  handlebarsHelpers();\r\n\r\n  // Give modules a chance to add encumbrance schemes\r\n  // They can do so by adding their encumbrance schemes\r\n  // to CONFIG.OSE.encumbranceOptions\r\n  Hooks.call(\"ose-setup-encumbrance\");\r\n\r\n  // Register custom system settings\r\n  registerSettings();\r\n\r\n  // Register APIs of Foundry VTT Modules we explicitly support that provide custom hooks\r\n  registerFVTTModuleAPIs();\r\n\r\n  CONFIG.Actor.documentClass = OseActor;\r\n  CONFIG.Item.documentClass = OseItem;\r\n\r\n  CONFIG.Actor.systemDataModels = {\r\n    character: OseDataModelCharacter,\r\n    monster: OseDataModelMonster,\r\n  };\r\n  CONFIG.Item.systemDataModels = {\r\n    weapon: OseDataModelWeapon,\r\n    armor: OseDataModelArmor,\r\n    item: OseDataModelItem,\r\n    spell: OseDataModelSpell,\r\n    ability: OseDataModelAbility,\r\n    container: OseDataModelContainer,\r\n  };\r\n\r\n  // Register sheet application classes\r\n  Actors.unregisterSheet(\"core\", ActorSheet);\r\n  Actors.registerSheet(game.system.id, OseActorSheetCharacter, {\r\n    types: [\"character\"],\r\n    makeDefault: true,\r\n    label: \"OSE.SheetClassCharacter\",\r\n  });\r\n  Actors.registerSheet(game.system.id, OseActorSheetMonster, {\r\n    types: [\"monster\"],\r\n    makeDefault: true,\r\n    label: \"OSE.SheetClassMonster\",\r\n  });\r\n\r\n  Items.unregisterSheet(\"core\", ItemSheet);\r\n  Items.registerSheet(game.system.id, OseItemSheet, {\r\n    makeDefault: true,\r\n    label: \"OSE.SheetClassItem\",\r\n  });\r\n\r\n  await templates();\r\n});\r\n\r\n/**\r\n * This function runs after game data has been requested and loaded from the servers, so entities exist\r\n */\r\nHooks.once(\"setup\", () => {\r\n  // Localize CONFIG objects once up-front\r\n  [\"saves_short\", \"saves_long\", \"scores\", \"armor\", \"colors\", \"tags\"].forEach(\r\n    (o) => {\r\n      CONFIG.OSE[o] = Object.entries(CONFIG.OSE[o]).reduce((obj, e) => {\r\n        const localized = { ...obj };\r\n        localized[e[0]] = game.i18n.localize(e[1]);\r\n        return localized;\r\n      }, {});\r\n    }\r\n  );\r\n\r\n  // Custom languages\r\n  const languages = game.settings.get(game.system.id, \"languages\");\r\n  if (languages !== \"\") {\r\n    const langArray = languages.split(\",\").map((s) => s.trim());\r\n    CONFIG.OSE.languages = langArray;\r\n  }\r\n});\r\n\r\nHooks.once(\"ready\", async () => {\r\n  Hooks.on(\"hotbarDrop\", (bar, data, slot) => {\r\n    macros.createOseMacro(data, slot);\r\n    // Returning false to stop the rest of hotbarDrop handling.\r\n    return false;\r\n  });\r\n});\r\n\r\n// License info\r\nHooks.on(\"renderSidebarTab\", async (object, html) => {\r\n  if (object instanceof ActorDirectory) {\r\n    party.addControl(object, html);\r\n  }\r\n  if (object instanceof Settings) {\r\n    const gamesystem = html.find(\"#game-details\");\r\n    // SRD Link\r\n    const ose = gamesystem.find(\"h4\").last();\r\n    ose.append(\r\n      ` <sub><a href=\"https://oldschoolessentials.necroticgnome.com/srd/index.php\">SRD<a></sub>`\r\n    );\r\n\r\n    // License text\r\n    const template = `${OSE.systemPath()}/templates/chat/license.html`;\r\n    const rendered = await renderTemplate(template);\r\n    gamesystem.find(\".system\").append(rendered);\r\n\r\n    // User guide\r\n    const docs = html.find(\"button[data-action='docs']\");\r\n    const styling =\r\n      \"border:none;margin-right:2px;vertical-align:middle;margin-bottom:5px\";\r\n    $(\r\n      `<button type=\"button\" data-action=\"userguide\"><img src='${OSE.assetsPath}/dragon.png' width='16' height='16' style='${styling}'/>Old School Guide</button>`\r\n    ).insertAfter(docs);\r\n    html.find('button[data-action=\"userguide\"]').click(() => {\r\n      new FrameViewer(\"https://ose.vtt.red/\", {\r\n        resizable: true,\r\n      }).render(true);\r\n    });\r\n  }\r\n});\r\n\r\nHooks.on(\"preCreateCombatant\", (combat, data, options, id) => {\r\n  const init = game.settings.get(game.system.id, \"initiative\");\r\n  if (init === \"group\") {\r\n    OseCombat.addCombatant(combat, data, options, id);\r\n  }\r\n});\r\n\r\nHooks.on(\"updateCombatant\", OseCombat.debounce(OseCombat.updateCombatant), 100);\r\nHooks.on(\"renderCombatTracker\", OseCombat.debounce(OseCombat.format, 100));\r\nHooks.on(\"preUpdateCombat\", OseCombat.preUpdateCombat);\r\nHooks.on(\r\n  \"getCombatTrackerEntryContext\",\r\n  OseCombat.debounce(OseCombat.addContextEntry, 100)\r\n);\r\n\r\nHooks.on(\"renderChatLog\", (app, html) => OseItem.chatListeners(html));\r\nHooks.on(\"getChatLogEntryContext\", chat.addChatMessageContextOptions);\r\nHooks.on(\"renderChatMessage\", chat.addChatMessageButtons);\r\nHooks.on(\"renderRollTableConfig\", treasure.augmentTable);\r\nHooks.on(\"updateActor\", party.update);\r\n\r\nHooks.on(\"renderCompendium\", renderList.RenderCompendium);\r\nHooks.on(\"renderSidebarDirectory\", renderList.RenderDirectory);\r\n\r\nHooks.on(\"OSE.Party.showSheet\", OsePartySheet.showPartySheet);\r\n","/**\r\n * @file A place to store Handlebars helpers for our templates\r\n */\r\nimport OSE, { InventoryItemTag } from \"./config\";\r\n\r\nconst registerHelpers = async () => {\r\n  // Handlebars template helpers\r\n  Handlebars.registerHelper(\"eq\", (a, b) => a === b);\r\n\r\n  Handlebars.registerHelper(\"mod\", (val) => {\r\n    if (val > 0) {\r\n      return `+${val}`;\r\n    }\r\n    if (val < 0) {\r\n      return `${val}`;\r\n    }\r\n    return \"0\";\r\n  });\r\n\r\n  Handlebars.registerHelper(\r\n    \"add\",\r\n    (lh, rh) => parseInt(lh, 10) + parseInt(rh, 10)\r\n  );\r\n\r\n  Handlebars.registerHelper(\r\n    \"subtract\",\r\n    (lh, rh) => parseInt(lh, 10) - parseInt(rh, 10)\r\n  );\r\n\r\n  Handlebars.registerHelper(\"divide\", (lh, rh) =>\r\n    Math.floor(parseFloat(lh) / parseFloat(rh))\r\n  );\r\n\r\n  Handlebars.registerHelper(\r\n    \"mult\",\r\n    (lh, rh) => Math.round(100 * parseFloat(lh) * parseFloat(rh)) / 100\r\n  );\r\n\r\n  Handlebars.registerHelper(\r\n    \"roundWeight\",\r\n    (weight) => Math.round(parseFloat(weight) / 100) / 10\r\n  );\r\n\r\n  Handlebars.registerHelper(\"getTagIcon\", (tagValue: string) => {\r\n    const tagKey = (Object.keys(CONFIG.OSE.tags) as InventoryItemTag[])\r\n      // find key for the tag display name who's name matches the provided tag text.\r\n      .find((findTagName) => CONFIG.OSE.tags[findTagName] === tagValue);\r\n    // if that tag key is found, return the image for the tag key\r\n    return tagKey ? CONFIG.OSE.tag_images[tagKey] : null;\r\n  });\r\n\r\n  Handlebars.registerHelper(\"counter\", (status, value, max) =>\r\n    status\r\n      ? Math.clamped((100 * value) / max, 0, 100)\r\n      : Math.clamped(100 - (100 * value) / max, 0, 100)\r\n  );\r\n\r\n  Handlebars.registerHelper(\"times\", (n, block) => {\r\n    let accum = \"\";\r\n    // eslint-disable-next-line no-plusplus\r\n    for (let i = 0; i < n; ++i) accum += block.fn(i);\r\n    return accum;\r\n  });\r\n\r\n  Handlebars.registerHelper(\r\n    \"path\",\r\n    (relativePath) => `${OSE.systemPath()}${relativePath}`\r\n  );\r\n\r\n  Handlebars.registerHelper(\r\n    \"asset\",\r\n    (relativePath) => `${OSE.assetsPath}${relativePath}`\r\n  );\r\n\r\n  Handlebars.registerHelper(\"ceil\", (val) => Math.ceil(val));\r\n};\r\n\r\nexport default registerHelpers;\r\n","/**\r\n * @file Wire up system settings.\r\n */\r\n\r\nimport { ApplyDamageOption } from \"./config\";\r\nimport { EncumbranceOption } from \"./config\";\r\n\r\n/**\r\n * Perform setting registration.\r\n */\r\nconst registerSettings = () => {\r\n  game.settings.register(game.system.id, \"initiative\", {\r\n    name: game.i18n.localize(\"OSE.Setting.Initiative\"),\r\n    hint: game.i18n.localize(\"OSE.Setting.InitiativeHint\"),\r\n    default: \"group\",\r\n    scope: \"world\",\r\n    type: String,\r\n    config: true,\r\n    choices: {\r\n      individual: \"OSE.Setting.InitiativeIndividual\",\r\n      group: \"OSE.Setting.InitiativeGroup\",\r\n    },\r\n  });\r\n\r\n  game.settings.register(game.system.id, \"rerollInitiative\", {\r\n    name: game.i18n.localize(\"OSE.Setting.RerollInitiative\"),\r\n    hint: game.i18n.localize(\"OSE.Setting.RerollInitiativeHint\"),\r\n    default: \"reset\",\r\n    scope: \"world\",\r\n    type: String,\r\n    config: true,\r\n    choices: {\r\n      keep: \"OSE.Setting.InitiativeKeep\",\r\n      reset: \"OSE.Setting.InitiativeReset\",\r\n      reroll: \"OSE.Setting.InitiativeReroll\",\r\n    },\r\n  });\r\n\r\n  game.settings.register(game.system.id, \"ascendingAC\", {\r\n    name: game.i18n.localize(\"OSE.Setting.AscendingAC\"),\r\n    hint: game.i18n.localize(\"OSE.Setting.AscendingACHint\"),\r\n    default: false,\r\n    scope: \"world\",\r\n    type: Boolean,\r\n    config: true,\r\n  });\r\n\r\n  game.settings.register(game.system.id, \"morale\", {\r\n    name: game.i18n.localize(\"OSE.Setting.Morale\"),\r\n    hint: game.i18n.localize(\"OSE.Setting.MoraleHint\"),\r\n    default: false,\r\n    scope: \"world\",\r\n    type: Boolean,\r\n    config: true,\r\n  });\r\n\r\n  game.settings.register(game.system.id, \"encumbranceOption\", {\r\n    name: game.i18n.localize(\"OSE.Setting.Encumbrance\"),\r\n    hint: game.i18n.localize(\"OSE.Setting.EncumbranceHint\"),\r\n    default: \"detailed\",\r\n    scope: \"world\",\r\n    type: String,\r\n    config: true,\r\n    choices: Object.values(CONFIG.OSE.encumbranceOptions)\r\n    .reduce((obj, enc) => {\r\n      return {...obj, [enc.type]: enc.localizedLabel}\r\n    }, {}) as SettingConfig<EncumbranceOption>[\"choices\"],\r\n  });\r\n\r\n  game.settings.register(game.system.id, \"significantTreasure\", {\r\n    name: game.i18n.localize(\"OSE.Setting.SignificantTreasure\"),\r\n    hint: game.i18n.localize(\"OSE.Setting.SignificantTreasureHint\"),\r\n    default: 800,\r\n    scope: \"world\",\r\n    type: Number,\r\n    config: true,\r\n  });\r\n\r\n  game.settings.register(game.system.id, \"languages\", {\r\n    name: game.i18n.localize(\"OSE.Setting.Languages\"),\r\n    hint: game.i18n.localize(\"OSE.Setting.LanguagesHint\"),\r\n    default: \"\",\r\n    scope: \"world\",\r\n    type: String,\r\n    config: true,\r\n  });\r\n  game.settings.register(game.system.id, \"applyDamageOption\", {\r\n    name: game.i18n.localize(\"OSE.Setting.applyDamageOption\"),\r\n    hint: game.i18n.localize(\"OSE.Setting.applyDamageOptionHint\"),\r\n    default: \"selected\",\r\n    scope: \"world\",\r\n    type: String,\r\n    config: true,\r\n    choices:  {\r\n      selected : game.i18n.localize(\"OSE.Setting.damageSelected\"),\r\n      targeted : game.i18n.localize(\"OSE.Setting.damageTarget\"),\r\n      originalTarget : game.i18n.localize(\"OSE.Setting.damageOriginalTarget\"),\r\n    },\r\n  });\r\n  game.settings.register(game.system.id, \"invertedCtrlBehavior\", {\r\n    name: game.i18n.localize(\"OSE.Setting.InvertedCtrlBehavior\"),\r\n    hint: game.i18n.localize(\"OSE.Setting.InvertedCtrlBehaviorHint\"),\r\n    default: false,\r\n    scope: \"world\",\r\n    type: Boolean,\r\n    config: true,\r\n  });\r\n};\r\n\r\ndeclare global {\r\n  namespace ClientSettings {\r\n    // Include OSE settings in addition to foundry default settings\r\n    interface Values {\r\n      \"ose.initiative\": \"individual\" | \"group\";\r\n      \"ose.rerollInitiative\": \"keep\" | \"reset\" | \"reroll\";\r\n      \"ose.ascendingAC\": boolean;\r\n      \"ose.morale\": boolean;\r\n      \"ose.encumbranceOption\": EncumbranceOption;\r\n      \"ose.significantTreasure\": number;\r\n      \"ose.languages\": string;\r\n      \"ose.applyDamageOption\": ApplyDamageOption;\r\n    }\r\n  }\r\n}\r\n\r\nexport default registerSettings;\r\n","/**\r\n * @file Register APIs that help the system more gracefully integrate with other modules\r\n */\r\n\r\nconst registerFVTTModuleAPIs = () => {\r\n  // see docs for more info https://github.com/fantasycalendar/FoundryVTT-ItemPiles/blob/master/docs/api.md\r\n  Hooks.once(\"item-piles-ready\", async () => {\r\n\r\n    game.itempiles.API.addSystemIntegration({\r\n\r\n      \"VERSION\": \"1.0.1\",\r\n\r\n      // The actor class type is the type of actor that will be used for the default item pile actor that is created on first item drop.\r\n      \"ACTOR_CLASS_TYPE\": \"character\",\r\n\r\n      // The item quantity attribute is the path to the attribute on items that denote how many of that item that exists\r\n      \"ITEM_QUANTITY_ATTRIBUTE\": \"system.quantity.value\",\r\n\r\n      // The item price attribute is the path to the attribute on each item that determine how much it costs\r\n      \"ITEM_PRICE_ATTRIBUTE\": \"system.cost\",\r\n\r\n      // Item types and the filters actively remove items from the item pile inventory UI that users cannot loot, such as spells, feats, and classes\r\n      \"ITEM_FILTERS\": [\r\n        {\r\n          \"path\": \"type\",\r\n          \"filters\": \"spell,ability\"\r\n        }\r\n      ],\r\n\r\n      \"UNSTACKABLE_ITEM_TYPES\": [\"weapon\", \"armor\", \"container\"],\r\n\r\n      // Item similarities determines how item piles detect similarities and differences in the system\r\n      \"ITEM_SIMILARITIES\": [\"name\", \"type\", \"system.treasure\"],\r\n\r\n      // Currencies in item piles is a versatile system that can accept actor attributes (a number field on the actor's sheet) or items (actual items in their inventory)\r\n      // In the case of attributes, the path is relative to the \"actor.system\"\r\n      // In the case of items, it is recommended you export the item with `.toObject()` and strip out any module data\r\n      \"CURRENCIES\": [\r\n        {\r\n          type: \"item\",\r\n          name: \"OSE.items.gp.long\",\r\n          img: \"systems/ose/assets/gold.png\",\r\n          abbreviation: \"{#}GP\",\r\n          data: {\r\n            item: {\r\n              \"name\": \"Gold Coins\",\r\n              \"type\": \"item\",\r\n              \"img\": \"systems/ose/assets/gold.png\",\r\n              \"system\": {\r\n                \"quantity\": { \"value\": 1, \"max\": null },\r\n                \"weight\": 0.1,\r\n                \"cost\": 1,\r\n                \"treasure\": true,\r\n              }\r\n            }\r\n          },\r\n          primary: true,\r\n          exchangeRate: 1\r\n        }\r\n      ]\r\n    });\r\n  });\r\n};\r\n\r\nexport default registerFVTTModuleAPIs;\r\n","/**\r\n * @file A file that manages preloading our system templates\r\n */\r\nimport OSE from \"./config\";\r\n\r\nconst preloadHandlebarsTemplates = async () => {\r\n  const templatePaths = [\r\n    // Character Sheets\r\n    `${OSE.systemPath()}/templates/actors/character-sheet.html`,\r\n    `${OSE.systemPath()}/templates/actors/monster-sheet.html`,\r\n    // Character Sheets Partials\r\n    `${OSE.systemPath()}/templates/actors/partials/character-header.html`,\r\n    `${OSE.systemPath()}/templates/actors/partials/character-attributes-tab.html`,\r\n    `${OSE.systemPath()}/templates/actors/partials/character-abilities-tab.html`,\r\n    `${OSE.systemPath()}/templates/actors/partials/character-spells-tab.html`,\r\n    `${OSE.systemPath()}/templates/actors/partials/character-inventory-tab.html`,\r\n    `${OSE.systemPath()}/templates/actors/partials/actor-item-summary.html`,\r\n    `${OSE.systemPath()}/templates/actors/partials/character-notes-tab.html`,\r\n    `${OSE.systemPath()}/templates/actors/partials/monster-header.html`,\r\n    `${OSE.systemPath()}/templates/actors/partials/monster-attributes-tab.html`,\r\n    // Item Display\r\n    `${OSE.systemPath()}/templates/actors/partials/item-auto-tags-partial.html`,\r\n    // Party Sheet\r\n    `${OSE.systemPath()}/templates/apps/party-sheet.html`,\r\n    // `${OSE.systemPath()}/templates/apps/party-xp.html`,\r\n  ];\r\n  return loadTemplates(templatePaths);\r\n};\r\n\r\nexport default preloadHandlebarsTemplates;\r\n","/**\r\n * @file Functions that alter the way that sidebar and compendium lists render\r\n */\r\nimport OSE from \"./config\";\r\n\r\nexport const RenderCompendium = async (object, html, d) => {\r\n  if (object.metadata.type !== \"Item\") {\r\n    return;\r\n  }\r\n\r\n  const render = html[0].querySelectorAll(\".item\");\r\n  const docs = await d.collection.getDocuments();\r\n\r\n  render.forEach(async (item, i) => {\r\n    const id = render[i].dataset.documentId;\r\n\r\n    const element = docs.find((doc) => doc.id === id);\r\n    const tagTemplate = $.parseHTML(\r\n      await renderTemplate(\r\n        `${OSE.systemPath()}/templates/actors/partials/item-auto-tags-partial.html`,\r\n        { tags: element.system.autoTags }\r\n      )\r\n    );\r\n\r\n    $(item).append(tagTemplate);\r\n  });\r\n};\r\n\r\nexport const RenderDirectory = async (object, html) => {\r\n  if (object.id !== \"items\") {\r\n    return;\r\n  }\r\n\r\n  const render = html[0].querySelectorAll(\".item\");\r\n  const content = object.documents;\r\n\r\n  render.forEach(async (item) => {\r\n    const foundryDocument = content.find(\r\n      (e) => e.id === item.dataset.documentId\r\n    );\r\n\r\n    const tagTemplate = $.parseHTML(\r\n      await renderTemplate(\r\n        `${OSE.systemPath()}/templates/actors/partials/item-auto-tags-partial.html`,\r\n        { tags: foundryDocument.system.autoTags || [] }\r\n      )\r\n    );\r\n    $(item).append(tagTemplate);\r\n  });\r\n};\r\n"],"names":["__awaiter","thisArg","_arguments","P","generator","Promise","resolve","reject","fulfilled","value","step","next","e","rejected","result","done","then","apply","__classPrivateFieldGet","receiver","state","kind","f","TypeError","has","call","get","__classPrivateFieldSet","set","OseDataModelCharacterEncumbrance","constructor","variant","max","baseEncumbranceCap","items","_OseDataModelCharacterEncumbrance_encumbranceVariant","this","_OseDataModelCharacterEncumbrance_max","_OseDataModelCharacterEncumbrance_weight","enabled","pct","Math","clamped","encumbered","steps","atThirdBreakpoint","encumbranceSteps","half","_OseDataModelCharacterEncumbrance_instances","_OseDataModelCharacterEncumbrance_delta_get","atSecondBreakpoint","threeEighths","atFirstBreakpoint","quarter","Object","defineProperty","OseDataModelCharacterEncumbranceBasic","options","super","type","_OseDataModelCharacterEncumbranceBasic_weight","_OseDataModelCharacterEncumbranceBasic_treasureEncumbrance","_OseDataModelCharacterEncumbranceBasic_heaviestArmor","significantTreasure","reduce","acc","system","treasure","quantity","weight","heaviest","armorType","equipped","armorWeight","unarmored","light","heavy","overTreasureThreshold","overSignificantTreasureThreshold","isHeavy","isLightWithTreasure","OseDataModelCharacterEncumbranceComplete","_OseDataModelCharacterEncumbranceComplete_weight","includes","values","OseDataModelCharacterEncumbranceDetailed","_OseDataModelCharacterEncumbranceDetailed_weight","_OseDataModelCharacterEncumbranceDetailed_hasAdventuringGear","some","i","gearWeight","OseDataModelCharacterEncumbranceDisabled","OseDataModelCharacterEncumbranceItemBased","_OseDataModelCharacterEncumbranceItemBased_equippedMax","_OseDataModelCharacterEncumbranceItemBased_packedMax","_OseDataModelCharacterEncumbranceItemBased_max","_OseDataModelCharacterEncumbranceItemBased_atFiveEighths","_OseDataModelCharacterEncumbranceItemBased_atThreeQuarters","_OseDataModelCharacterEncumbranceItemBased_atSevenEights","_OseDataModelCharacterEncumbranceItemBased_atOneThird","_OseDataModelCharacterEncumbranceItemBased_atFiveNinths","_OseDataModelCharacterEncumbranceItemBased_atSevenNinths","_OseDataModelCharacterEncumbranceItemBased_weight","_OseDataModelCharacterEncumbranceItemBased_equippedWeight","_OseDataModelCharacterEncumbranceItemBased_packedWeight","ceil","itemslots","usingEquippedEncumbrance","packedEncumbranceSteps","fiveEighths","threeQuarters","sevenEighths","equippedEncumbranceSteps","oneThird","fiveNinths","sevenNinths","equippedValues","packedValues","equippedIndex","findIndex","packedIndex","OSE","systemPath","systemRoot","game","id","assetsPath","encumbrance","settings","encumbranceOptions","disabled","basic","detailed","complete","itembased","scores","str","int","dex","wis","con","cha","scores_short","exploration_skills","ld","od","sd","fs","exploration_skills_short","roll_type","above","below","saves_short","death","wand","paralysis","breath","spell","saves_long","armor","shield","apply_damage_options","selected","targeted","originalTarget","colors","green","red","yellow","purple","blue","orange","white","languages","tags","melee","missile","slow","twohanded","blunt","brace","splash","reload","charge","auto_tags","label","CONFIG","image","icon","tag_images","monster_saves","d","w","p","b","s","monster_thac0","OseDice","async","parts","data","title","flavor","speaker","form","chatMessage","template","chatData","user","templateData","config","bonus","push","roll","Roll","join","evaluate","rollMode","blindroll","isGM","whisper","ChatMessage","getWhisperRecipients","_id","blind","digestResult","render","r","rollOSE","renderTemplate","content","dice3d","showForRoll","displayed","create","sound","sounds","dice","isSuccess","isFailure","target","total","die","terms","results","table","output","details","attackIsSuccess","thac0","ac","digestAttackResult","targetActorData","actor","targetAc","targetAac","aac","victim","attackBonus","i18n","format","flags","dmg","filter","v","length","ui","notifications","error","dmgRoll","dr","rollDamage","skipDialog","rolled","dialogData","formula","rollModes","Dice","rollData","sendRoll","buttons","ok","localize","callback","html","querySelector","magic","cancel","Dialog","default","close","sendAttackRoll","OseCharacterCreator","FormApplication","defaultOptions","classes","width","submitOnClose","object","name","getData","foundry","utils","deepClone","counters","gold","stats","sum","avg","std","doStats","ev","list","$","currentTarget","closest","n","mean","parseFloat","sqrt","map","x","siblings","find","text","round","removeAttr","rollScore","score","rollParts","skipMessage","event","getSpeaker","count","activateListeners","click","el","parentElement","dataset","val","trigger","change","char","submit","updateData","preventClose","preventRender","extendedData","_onSubmit","itemData","img","cost","createEmbeddedDocuments","formData","preventDefault","update","sheet","OseCharacterGpCost","preparedData","position","totalCost","getTotalCost","inventory","gp","item","newGP","updateEmbeddedDocuments","physical","Set","forEach","OseCharacterModifiers","skipRollDialogCheck","ctrlKey","metaKey","OseEntityTweaks","isCharacter","ascendingAC","_render","OseActorSheet","ActorSheet","owner","isOwner","editable","isEditable","initiative","isNew","activateEditor","initialContent","_getItemFromActor","li","itemId","_toggleItemCategory","css","removeClass","addClass","slideDown","slideUp","_toggleContainedItems","targetItems","_toggleItemSummary","itemSummary","style","display","show","deleteEmbeddedDocuments","containerId","newItemIds","itemIds","o","_useConsumable","decrement","field","parseInt","each","_","memorized","counter","rollWeapon","spendSpell","rollFormula","actorObject","element","save","rollSave","attack","targetAttack","_onSortItem","source","dropTarget","targetId","Error","targetData","_onDragStart","dragData","itemIdsArray","classList","contains","toDragData","actorId","sceneId","isToken","canvas","scene","tokenId","token","pack","effectId","effect","effects","dataTransfer","setData","JSON","stringify","key","folder","fromUuid","uuid","itemArray","contents","getSubfolders","subfolder","_onDropItemCreate","targetItem","targetIsContainer","Item","implementation","fromDropData","toObject","exists","isContainer","_onContainerItemRemove","_onContainerItemAdd","container","newList","itemObj","alreadyExistsInActor","parent","latestItem","newItem","pop","droppedItem","targetContainer","Array","isArray","containedItems","parse","containedItem","choices","types","dlg","_createItem","header","lvl","createItem","capitalize","split","_chooseItemType","dialogInput","args","_renderInner","resizable","heightDelta","height","baseSize","_onResize","editor","editorSize","_onConfigureActor","top","left","_getHeaderButtons","canConfigure","class","onclick","concat","_rollSave","_rollAttack","rollHitDice","_rollAbility","stopPropagation","_displayItemInChat","_removeItemFromActor","confirm","yes","defaultYes","select","_updateItemQuantity","bind","_onSpellChange","_resetSpells","OseActorSheetCharacter","mergeObject","tabs","navSelector","contentSelector","initial","scrollY","_prepareItems","owned","armors","weapons","treasures","containers","carriedTreasure","abilities","spells","spellList","slots","spellSlots","usesAscendingAC","meleeMod","rangedMod","init","sort","a","generateScores","enrichedBiography","TextEditor","enrichHTML","biography","enrichedNotes","notes","choice","_pushLang","_chooseLang","newData","_popLang","lang","_onShowModifiers","document","append","stat","rollCheck","rollLoyalty","expl","exploration","rollExploration","_onShowGpCost","array","parents","OseDataModelCharacterAC","isAscending","dexDefMod","mod","_OseDataModelCharacterAC_armor","_OseDataModelCharacterAC_dexMod","_OseDataModelCharacterAC_mod","_OseDataModelCharacterAC_acProp","_OseDataModelCharacterAC_isAscending","propAscending","propDescending","base","baseAscending","baseDescending","naked","_OseDataModelCharacterAC_instances","_OseDataModelCharacterAC_getShieldBonus","_OseDataModelCharacterAC_armored_get","_change","_a","OseDataModelCharacterMove","shouldCalculateMovement","baseMoveRate","_OseDataModelCharacterMove_moveBase","_OseDataModelCharacterMove_autocalculate","_OseDataModelCharacterMove_encumbranceVariant","_OseDataModelCharacterMove_overEncumbranceLimit","_OseDataModelCharacterMove_atFirstBreakpoint","_OseDataModelCharacterMove_atSecondBreakpoint","_OseDataModelCharacterMove_atThirdBreakpoint","_OseDataModelCharacterMove_instances","_OseDataModelCharacterMove_derivedSpeed","encounter","overland","OseDataModelCharacterScores","_OseDataModelCharacterScores_str","_OseDataModelCharacterScores_int","_OseDataModelCharacterScores_wis","_OseDataModelCharacterScores_dex","_OseDataModelCharacterScores_con","_OseDataModelCharacterScores_cha","static","undefined","_OseDataModelCharacterScores_instances","_OseDataModelCharacterScores_strMod_get","atk","strAtkMod","strDmgMod","_OseDataModelCharacterScores_strOpenDoorsMod_get","valueFromTable","strengthAttackMods","strengthDamageMods","_OseDataModelCharacterScores_intMod_get","literacy","_OseDataModelCharacterScores_intLiteracyMod_get","spoken","_OseDataModelCharacterScores_intSpokenLanguagesMod_get","_OseDataModelCharacterScores_wisMod_get","_OseDataModelCharacterScores_dexMod_get","_OseDataModelCharacterScores_dexAtkMod_get","def","_OseDataModelCharacterScores_dexDefMod_get","_OseDataModelCharacterScores_dexInitMod_get","_OseDataModelCharacterScores_conMod_get","_OseDataModelCharacterScores_chaMod_get","loyalty","_OseDataModelCharacterScores_chaLoyaltyMod_get","retain","_OseDataModelCharacterScores_chaRetainMod_get","npc","_OseDataModelCharacterScores_chaReactionMod_get","standardAttributeMods","openDoorMods","literacyMods","spokenMods","dexAttackMods","dexDefenseMods","cappedAttributeMods","OseDataModelCharacterSpells","maxSlots","t","prototype","hasOwnProperty","indexOf","getOwnPropertySymbols","propertyIsEnumerable","__rest","_OseDataModelCharacterSpells_slots","_OseDataModelCharacterSpells_spellList","_OseDataModelCharacterSpells_enabled","usedSlots","_b","_OseDataModelCharacterSpells_instances","_OseDataModelCharacterSpells_reducedUsedSlots","keys","idx","_OseDataModelCharacterSpells_usedAndMaxSlots","othersAtLvl","assign","localeCompare","reducedSpells","WeakMap","WeakSet","cast","Number","isNaN","usedAtLvl","lv","used","getItemsOfActorOfType","filterType","filterFn","OseDataModelCharacter","abstract","DataModel","prepareDerivedData","movement","movementAuto","StringField","NumberField","BooleanField","ObjectField","SchemaField","fields","hp","hd","integer","saves","ft","positive","retainer","wage","ascendingAcMod","bba","isSlow","every","OseDataModelMonster","prev","curr","attackPatterns","pattern","updated","OseItem","defaultIcons","ability","weapon","context","tag","prepareData","enrichedDescription","description","on","_onChatCardAction","_onChatCardToggleContent","htmlOptions","itemType","props","range","duration","properties","isNPC","_source","rollType","autoTags","rollTarget","_getRollTag","_getSaveTag","getAutoTagList","tagList","damage","short","medium","long","requirements","req","rollTag","saveTag","pushManualTag","regExp","matches","exec","slice","index","trim","popManualTag","getChatData","labels","isHealing","hasDamage","isSpell","hasSave","CONST","CHAT_MESSAGE_TYPES","OTHER","alias","button","card","messageId","message","messages","action","isTargetted","isAuthor","_getChatCardActor","actorName","targets","_getChatCardTargets","tokenKey","scenes","tokenData","getEmbeddedDocument","Token","actors","character","controlled","tokens","arr","removeFalsyElements","OseActor","Actor","version","startsWith","prototypeToken","texture","acValue","aacValue","bbaValue","thac0Value","embeddedName","getExperience","actorData","modified","floor","xp","generateSave","tmp","k","actorType","RollSave","fastForward","rollMorale","morale","rollReaction","attribute","level","rollAppearing","check","appearing","attData","dmgParts","size","rollAttack","ignoreBonusDamage","attackMods","strDmgMods","defaultMods","ose","amount","multiplier","OseActorSheetMonster","monsterData","link","isNewerVersion","_onDrop","tableDatum","packs","all","_cycleAttackPatterns","currentColor","contextmenu","_resetAttacks","_updateAttackCounter","rollHP","OseTags","rollTagFormula","formulaData","rollTagTarget","OseDataModelAbility","ArrayField","manualTags","OseDataModelArmor","ArmorTypes","min","tagNames","flat","OseDataModelContainer","totalWeight","OseDataModelItem","cumulativeWeight","cumulativeCost","cumulativeItemslots","OseDataModelSpell","OseDataModelWeapon","missileTag","meleeTag","slowTag","qualities","OseItemSheet","ItemSheet","enriched","keypress","which","applyChatCardDamage","last","dmgTgt","victimId","_c","applyDamageToTarget","nameOrId","applyDamage","canApply","canApplyDamage","applyDamageOption","_d","configName","configValue","OseCombat","STATUS_SLOW","STATUS_DIZZY","debounce","wait","timeoutId","window","clearTimeout","setTimeout","combat","combatants","groups","cbt","group","getFlag","present","toMessage","setupTurns","reroll","resetAll","updates","rolls","c","cf","_getInitiativeFormula","getInitiativeRoll","pool","PoolTerm","fromRolls","combinedRoll","fromTerms","evalRoll","rollArr","msgContent","entries","combats","viewed","skipDefeated","isDefeated","tData","turn","span","innerHTML","ct","controls","cmbtant","combatantId","moveInCombat","preparingSpell","moveActive","eq","after","spellActive","announceListener","remove","trash","insertBefore","color","prepend","addListeners","updateCombatant","combatant","groupInit","cmbtGroup","isActive","setFlag","rollInitiative","addCombatant","disposition","updateSource","activateCombatant","turns","addContextEntry","unshift","diff","resetInitiative","individualInitiative","drawTreasure","chance","percent","getChatText","TABLE_RESULT_TYPES","DOCUMENT","collection","embeddedTable","tables","resultId","rollTreasure","add","functionsForTesting","createOseMacro","slot","assignHotbarMacro","command","macro","Macro","warn","macros","m","ownership","userId","rollItemMacro","itemName","rollTableMacro","tableUuId","draw","displayChat","OseParty","currentParty","act","party","OsePartyXP","closeOnSubmit","_updateObject","_dealXP","_calculateShare","totalXP","baseXpShare","xpShare","share","row","qRow","Party","partySheet","OsePartySheet","dragDrop","dragSelector","dropSelector","focus","ascending","partyActors","_onDropActor","_onDropFolder","droppedActor","_addActorToParty","_recursiveAddFolder","children","documentName","getActor","_removeActorFromParty","delay","ms","trashChat","documentClass","deleteDocuments","deleteAll","waitForInput","openWindows","className","windows","openDialogs","closeDialogs","closeSheets","createMockActorKey","createWorldTestItem","createActorTestItem","createMockMacro","randomID","createMockScene","Scene","tokenVision","getMockActorKey","getName","cleanUpMacros","mockMacros","delete","cleanUpActorsByKey","cleanUpWorldItems","_e","cleanUpScenes","_f","itemTypes","displayName","createMockActor","actorDataModelCharacterTests","describe","it","expect","before","dataModel","ascendingACSetting","initiativeSetting","not","atHalfEncumbered","atQuarterEncumbered","atEighthEncumbered","spellLevels","contain","subFields","subField","subSubField","equal","testActor","to","be","true","false","is","getter","actorDataModelCharacterACTests","itemsArmor","itemsShield","itemsBoth","negativeDexMod","negativeArbitraryMod","armorAC","toPct","createMockItem","itemOptions","actorDataModelCharacterEncumbranceTests","enc","EncumbranceDisabled","EncumbranceBasic","expectedSteps","have","members","EncumbranceDetailed","EncumbranceComplete","console","info","EncumbranceItemBased","actorDataModelCharacterMoveTests","move","expectedBase","expectedEncounter","expectedOverland","actorDataModelCharacterScoresTests","scoreSpread","from","_el","scoreKeys","fromTable","tableKey","numberToScores","number","fromEntries","scoreKey","buildTestCases","scoresToUse","scoresObj","buildTestCasesWithModifiers","added","spreadToModTests","createMockSpell","spellOptions","spellsPerLevel","actorDataModelCharacterSpellsTests","levels","lvCount","createMockSpellList","spellData","actorDataModelMonsterTests","afterEach","transparent","preSelected","actorEntityTests","assert","actorItem","low","high","wands","savesData","thac0Data","thac0PlusData","conScoreSpread","conBonusSpread","hdSpread","levelSpread","conMod","expectedTerms","modSign","modUnsigned","expression","operator","toString","_g","_h","_j","_k","_l","_m","_o","_p","activate","getTokenDocument","placeables","setTarget","releaseOthers","groupSelection","null","_q","_r","_s","_t","_u","_v","_w","_x","rolldata","actorSheetTests","originalCtrlSetting","mockedItem","tab","clickElement","descriptionStyle","nextElementSibling","clickCategory","sheets","categoryElement","clickContainerCaret","containerElement","clickItemSummary","summaryElement","macroReference","clickItemShow","mockClickItem","clickSave","attackClass","dragNDropCasePreflightCheck","sourceItemName","dragNDropCasePostflightCheck","documents","dragNDropSanityChecks","defaultChoices","dialogs","customChoices","updateQuantity","modifier","String","InputEvent","dispatchEvent","quantityElement","executeDragNDrop","mockDragStartEvent","DragEvent","DataTransfer","bubbles","cancelable","itemElement","mockDropEvent","actorSheetDragNDropTests","beforeEach","sourceElement","executeDrag","parsedData","getDragEventData","compendium","finalElement","CompendiumCollection","createCompendium","path","private","package","createMockCompendium","worldItem","importDocument","deleteCompendium","actorSheetCharacterTests","scoreValue","actorSheetMonsterTests","orginalCtrlSetting","rt","rollTable","RollTable","dragElement","dropElement","currentPattern","patternIndex","nextIndex","actorSheetCharacterDialogModifiersTest","dialogTitle","actorSheetDialogEntityTweaksTests","entityTweaks","itemDataModelAbilityTests","itemDataModelArmorTests","dataTypes","itemDataModelContainerTests","itemDataModelMiscTests","miscItem","itemDataModelSpellTests","itemDataModelWeaponTests","itemEntityTests","non_existing","testItemCreate","equals","initialSlots","testPushManualTag","itemTagData","itemTag","testSystemBooleans","poppedTag","rollMessageTest","users","u","itemSheetTests","partyEntityTests","promisedAnswer","actorsInParty","partySheetTests","showPartySheet","promisedAddAnswer","promisedRemoveAnswer","resolvedResponse","Folder","subFolder","response","folders","partyXpSheetTests","partyXP","helpersBehaviourTests","originalSetting","setting","KeyboardEvent","helpersChatTests","createMockRoll","resultArray","helpersDiceTests","acSetting","chatCard","_evaluated","_formula","createMockData","dataNat20","rollTargetOne","rollTargetTwenty","notification","queue","attackDiceResult","damageDiceResult","dialog","helpersHandlebarsTests","Handlebars","helpers","subtract","divide","mult","roundWeight","getTagIcon","block","fn","times","asset","cleanUpActors","helpersMacrosTests","active","hotbar","getHotbarMacros","macroSlot","_y","_z","_0","helpersPartyTests","partyMember","getAttribute","createMockTable","createMockTreasureTable","helpersTreasureTests","resultKey","Hooks","quench","registerBatch","actorDataModelCharacterKey","actorDataModelCharacterOptions","actorDataModelCharacterACOptions","actorDataModelCharacterEncumbranceOptions","actorDataModelCharacterMoveOptions","actorDataModelCharacterScoresOptions","actorDataModelCharacterSpellsOptions","actorDataModelMonsterKey","actorDataModelMonsterOptions","actorEntityKey","actorEntityOptions","actorSheetKey","actorSheetOptions","actorSheetDragNDropKey","actorSheetDragNDropOptions","actorSheetCharacterKey","actorSheetCharacterOptions","actorSheetMonsterKey","actorSheetMonsterOptions","actorSheetCharacterDialogModifiersKey","actorSheetCharacterDialogModifiersOptions","actorSheetDialogEntityTweaksKey","actorSheetDialogEntityTweaksOptions","itemDataModelAbilityOptions","itemDataModelArmorOptions","itemDataModelContainerOptions","itemDataModelMiscOptions","itemDataModelSpellOptions","itemDataModelWeaponOptions","itemEntityOptions","itemSheetOptions","partyEntityKey","partyEntityOptions","partySheetKey","partySheetOptions","partyXpSheetOptions","helpersBehaviourOptions","helpersChatOptions","helpersDiceOptions","helpersHandlebarsOptions","helpersMacrosKey","helpersMacrosOptions","helpersPartyKey","helpersPartyOptions","helpersTreasureKey","helpersTreasureOptions","once","Combat","decimals","macros.rollItemMacro","macros.rollTableMacro","oseCombat","registerHelper","lh","rh","tagValue","tagKey","findTagName","status","accum","relativePath","register","hint","scope","individual","keep","reset","Boolean","obj","localizedLabel","itempiles","API","addSystemIntegration","VERSION","ACTOR_CLASS_TYPE","ITEM_QUANTITY_ATTRIBUTE","ITEM_PRICE_ATTRIBUTE","ITEM_FILTERS","filters","UNSTACKABLE_ITEM_TYPES","ITEM_SIMILARITIES","CURRENCIES","abbreviation","primary","exchangeRate","systemDataModels","monster","Actors","unregisterSheet","registerSheet","makeDefault","Items","templatePaths","loadTemplates","localized","langArray","bar","macros.createOseMacro","ActorDirectory","control","replaceWith","party.addControl","Settings","gamesystem","rendered","docs","styling","insertAfter","FrameViewer","preUpdateCombat","app","chatListeners","condition","msg","blindable","isTreasureTable","treasureTableToggle","toggleClass","isTreasure","hide","attr","party.update","metadata","querySelectorAll","getDocuments","documentId","doc","tagTemplate","parseHTML","foundryDocument"],"mappings":"AAqEO,SAASA,EAAUC,EAASC,EAAYC,EAAGC,GAE9C,OAAO,IAAKD,IAAMA,EAAIE,WAAU,SAAUC,EAASC,GAC/C,SAASC,EAAUC,GAAS,IAAMC,EAAKN,EAAUO,KAAKF,IAAW,MAAOG,GAAKL,EAAOK,GAAO,CAC3F,SAASC,EAASJ,GAAS,IAAMC,EAAKN,EAAiB,MAAEK,IAAW,MAAOG,GAAKL,EAAOK,GAAO,CAC9F,SAASF,EAAKI,GAJlB,IAAeL,EAIaK,EAAOC,KAAOT,EAAQQ,EAAOL,QAJ1CA,EAIyDK,EAAOL,MAJhDA,aAAiBN,EAAIM,EAAQ,IAAIN,GAAE,SAAUG,GAAWA,EAAQG,EAAO,KAIhBO,KAAKR,EAAWK,EAAY,CAC9GH,GAAMN,EAAYA,EAAUa,MAAMhB,EAASC,GAAc,KAAKS,OACtE,GACA,CA0JO,SAASO,EAAuBC,EAAUC,EAAOC,EAAMC,GAC1D,GAAa,MAATD,IAAiBC,EAAG,MAAM,IAAIC,UAAU,iDAC5C,GAAqB,mBAAVH,EAAuBD,IAAaC,IAAUE,GAAKF,EAAMI,IAAIL,GAAW,MAAM,IAAII,UAAU,4EACvG,MAAgB,MAATF,EAAeC,EAAa,MAATD,EAAeC,EAAEG,KAAKN,GAAYG,EAAIA,EAAEb,MAAQW,EAAMM,IAAIP,EACxF,CAEO,SAASQ,EAAuBR,EAAUC,EAAOX,EAAOY,EAAMC,GACjE,GAAa,MAATD,EAAc,MAAM,IAAIE,UAAU,kCACtC,GAAa,MAATF,IAAiBC,EAAG,MAAM,IAAIC,UAAU,iDAC5C,GAAqB,mBAAVH,EAAuBD,IAAaC,IAAUE,GAAKF,EAAMI,IAAIL,GAAW,MAAM,IAAII,UAAU,2EACvG,MAAiB,MAATF,EAAeC,EAAEG,KAAKN,EAAUV,GAASa,EAAIA,EAAEb,MAAQA,EAAQW,EAAMQ,IAAIT,EAAUV,GAASA,CACxG,mDC/Nc,MAAOoB,EAwBnBC,YACEC,EAAU,WACVC,EAAMH,EAAiCI,mBACvCC,EAAQ,gBAhBVC,EAAoBP,IAAAQ,UAAA,GAEpBC,EAAKT,IAAAQ,UAAA,GAELE,EAAAV,IAAAQ,KAAU,GAcRT,EAAAS,KAAID,EAAuBJ,EAAO,KAClCJ,EAAAS,KAAIC,EAAQL,EAAG,IAChB,CAEGD,cACF,OAAOb,EAAAkB,KAAID,EAAA,IACZ,CAEGI,cACF,MAAoC,aAA7BrB,EAAAkB,KAAwBD,EAAA,IAChC,CAEGK,UACF,OAAOC,KAAKC,QAAS,IAAMN,KAAK3B,MAAS2B,KAAKJ,IAAK,EAAG,IACvD,CAEGW,iBACF,OAAOP,KAAK3B,MAAQ2B,KAAKJ,GAC1B,CAGGY,YACF,MAAO,EACR,CAEGnC,YACF,OAAOS,EAAAkB,KAAIE,EAAA,IACZ,CAEGN,UACF,OAAOd,EAAAkB,KAAIC,EAAA,IACZ,CAEGL,QAAIvB,GACNkB,EAAAS,KAAIC,EAAQ5B,EAAK,IAClB,CAMGoC,wBACF,OACET,KAAK3B,MACL2B,KAAKJ,KACFH,EAAiCiB,iBAAiBC,KAAO,MACzD7B,EAAAkB,KAAIY,EAAA,IAAAC,IAAW,EAErB,CAEGC,yBACF,OACEd,KAAK3B,MACL2B,KAAKJ,KACFH,EAAiCiB,iBAAiBK,aAAe,MACjEjC,EAAAkB,KAAIY,EAAA,IAAAC,IAAW,EAErB,CAEGG,wBACF,OACEhB,KAAK3B,MACL2B,KAAKJ,KACFH,EAAiCiB,iBAAiBO,QAAU,MAC5DnC,EAAAkB,KAAIY,EAAA,IAAAC,IAAW,EAErB,uEA5BC,OAAOb,KAAKJ,IAAMH,EAAiCI,kBACrD,EAjEOqB,OAAAC,eAAA1B,EAAA,qBAAA,iDAAqB,OAErByB,OAAAC,eAAA1B,EAAA,mBAAA,2CAAmBpB,MAAA,CACxB4C,QAAS,GACTF,aAAc,KACdJ,KAAM,MCNW,MAAAS,UACX3B,EAsCRC,YACEE,EAAMH,EAAiCI,mBACvCC,EAAgB,GAChBuB,EAAmB,IAEnBC,MAAMF,EAAsCG,KAAM3B,GAXpD4B,EAAQhC,IAAAQ,UAAA,GAERyB,EAAqBjC,IAAAQ,UAAA,GAErB0B,EAAelC,IAAAQ,UAAA,GAQbT,EAAAS,QACEqB,aAAO,EAAPA,EAASM,sBACTP,EAAsCO,oBAAmB,KAE3DpC,EAAAS,OAAeF,EAAM8B,QACnB,CAACC,GAAeN,OAAMO,QAAUC,WAAUC,WAAUC,aACzC,SAATV,GAAoBQ,EAAiBF,EAAMG,EAAS3D,MAAQ4D,EAA7BJ,GACjC,GACD,KAEDtC,EAAAS,OAAsBF,EAAM8B,QAC1B,CAACM,GAAYX,OAAMO,QAAUP,KAAMY,EAAWC,eAC/B,UAATb,GAAqBa,EAET,UAAdD,GACAD,IACEd,EAAsCiB,YAAYC,UAE7ClB,EAAsCiB,YAAYE,MACzC,UAAdJ,EACKf,EAAsCiB,YAAYG,MACpDN,EATmCA,GAW5Cd,EAAsCiB,YAAYC,eAErD,CAEG9B,YACF,MAAO,CAAE,IAAM1B,EAAAkB,KAAyByB,EAAA,KAAIzB,KAAKJ,IAClD,CAEG6C,4BACF,OAAOzC,KAAK3B,OAASS,EAAAkB,WACtB,CAEG3B,YACF,OAAOS,EAAAkB,KAAIwB,EAAA,IACZ,CAEGkB,uCACF,OAAO1C,KAAK3B,OAASS,EAAAkB,WACtB,CAEGS,wBACF,OACE3B,EAAAkB,KAAmB0B,EAAA,OACjBN,EAAsCiB,YAAYG,OACpDxC,KAAK3B,OAASS,EAAAkB,KAAIyB,EAAA,IAErB,CAEGX,yBACF,MAAM6B,EACJ7D,EAAAkB,KAAmB0B,EAAA,OACnBN,EAAsCiB,YAAYG,MAC9CI,EACJ9D,EAAAkB,KAAmB0B,EAAA,OACjBN,EAAsCiB,YAAYE,OACpDvC,KAAK3B,OAASS,EAAAkB,YAChB,OAAO2C,GAAWC,CACnB,CAEG5B,wBACF,OACElC,EAAAkB,KAAmB0B,EAAA,OACjBN,EAAsCiB,YAAYE,OACpDvC,KAAK0C,gCAER,4CA7GMxB,OAAAC,eAAAC,EAAA,yBAAA,iDAAyB,KAEzBF,OAAAC,eAAAC,EAAA,uBAAA,iDAAuB,KAKvBF,OAAAC,eAAAC,EAAA,OAAA,iDAAO,UAKPF,OAAAC,eAAAC,EAAA,iBAAA,iDAAiB,iCAKjBF,OAAAC,eAAAC,EAAA,sBAAA,iDAAsB,MAMtBF,OAAAC,eAAAC,EAAA,cAAA,2CAAc/C,MAAA,CACnBiE,UAAW,EACXC,MAAO,EACPC,MAAO,KCtCU,MAAAK,UACXpD,EAmBRC,YACEE,EAAMH,EAAiCI,mBACvCC,EAAgB,IAEhBwB,MAAMuB,EAAyCtB,KAAM3B,GANvDkD,EAAQtD,IAAAQ,UAAA,GAONT,EAAAS,OAAeF,EAAM8B,QACnB,CAACC,GAAON,OAAMO,QAAUE,WAAUC,aACnB,SAATV,EAAwBM,EAAMG,EAAS3D,MAAQ4D,EAC/C,CAAC,SAAU,QAAS,aAAac,SAASxB,GACrCM,EAAMI,EACRJ,GAET,GACD,IACF,CAGGrB,YACF,OAAOU,OAAO8B,OAAOvD,EAAiCiB,iBACvD,CAEGrC,YACF,OAAOS,EAAAkB,KAAI8C,EAAA,IACZ,gBAvCM5B,OAAAC,eAAA0B,EAAA,yBAAA,iDAAyB,KAEzB3B,OAAAC,eAAA0B,EAAA,uBAAA,iDAAuB,KAKvB3B,OAAAC,eAAA0B,EAAA,OAAA,iDAAO,aAKP3B,OAAAC,eAAA0B,EAAA,iBAAA,iDAAiB,oCChBL,MAAAI,UACXxD,EA0BRC,YACEE,EAAMH,EAAiCI,mBACvCC,EAAgB,IAEhBwB,MAAM2B,EAAyC1B,KAAM3B,GARvDsD,EAAA1D,IAAAQ,KAAU,GAEVmD,EAAoB3D,IAAAQ,UAAA,GAOlBT,EAAAS,KAA2BmD,EAAArD,EAAMsD,MAC9BC,GAAuB,SAAXA,EAAE9B,OAAoB8B,EAAEvB,OAAOC,WAC7C,KACDxC,EAAAS,OACEF,EAAM8B,QACJ,CAACC,GAAON,OAAMO,QAAUC,WAAUC,WAAUC,cAC1C,GAAa,UAATV,GAA6B,YAATA,EAAoB,OAAOM,EAEnD,IAAIxD,EAAQwD,EAKZ,MAHa,SAATN,GAAmBQ,IAAU1D,GAAS2D,EAAS3D,MAAQ4D,GACvD,CAAC,SAAU,QAAS,aAAac,SAASxB,KAAOlD,GAAS4D,GAEvD5D,CAAK,GAEd,IAEDS,EAAAkB,KAAwBmD,EAAA,KACrBF,EAAyCK,WACzC,GAAE,IACT,CAGG9C,YACF,OAAOU,OAAO8B,OAAOvD,EAAiCiB,iBACvD,CAEGrC,YACF,OAAOS,EAAAkB,KAAIkD,EAAA,IACZ,8BAzDMhC,OAAAC,eAAA8B,EAAA,yBAAA,iDAAyB,KAEzB/B,OAAAC,eAAA8B,EAAA,uBAAA,iDAAuB,KAKvB/B,OAAAC,eAAA8B,EAAA,OAAA,iDAAO,aAKP/B,OAAAC,eAAA8B,EAAA,iBAAA,iDAAiB,oCAKjB/B,OAAAC,eAAA8B,EAAA,aAAA,iDAAa,KCpBD,MAAAM,UACX9D,EAiBRC,cACE4B,MAAMiC,EAAyChC,KAChD,CAGGlD,YACF,OAAO,CACR,EArBM6C,OAAAC,eAAAoC,EAAA,yBAAA,iDAAyB,KAEzBrC,OAAAC,eAAAoC,EAAA,uBAAA,iDAAuB,KAKvBrC,OAAAC,eAAAoC,EAAA,OAAA,iDAAO,aAKPrC,OAAAC,eAAAoC,EAAA,iBAAA,iDAAiB,oCCjBL,MAAAC,UACX/D,EAiDRC,YAAYE,EAAM,GAAIE,EAAgB,IACpCwB,MAAMkC,EAA0CjC,KAAM3B,GAnCxD6D,EAAajE,IAAAQ,UAAA,GAEb0D,EAAWlE,IAAAQ,UAAA,GAEX2D,EAAKnE,IAAAQ,UAAA,GAEL4D,EAAepE,IAAAQ,UAAA,GACf6D,EAAiBrE,IAAAQ,UAAA,GACjB8D,EAAetE,IAAAQ,UAAA,GAEf+D,EAAYvE,IAAAQ,UAAA,GACZgE,EAAcxE,IAAAQ,UAAA,GACdiE,EAAezE,IAAAQ,UAAA,GAgBfkE,EAAQ1E,IAAAQ,UAAA,GAERmE,EAAgB3E,IAAAQ,UAAA,GAEhBoE,EAAc5E,IAAAQ,UAAA,GAKZT,EAAAS,KAAI0D,EAAc,GAAE,KACpBnE,EAAAS,KAAIyD,EAAgB,EAAC,KACrBlE,EAAAS,KAAqBoE,EAAA/D,KAAKgE,KACxBvE,EAAM8B,QACJ,CAACC,GAAON,OAAMO,QAAUE,WAAUsC,YAAWlC,eAC9B,SAATb,GAAoBa,EAEpB,CAAC,SAAU,QAAS,aAAaW,SAASxB,KAAUa,EAC/CP,EAAMyC,EACRzC,EAHEA,EAAMG,EAAS3D,MAAQiG,GAKlC,SAGJ/E,EAAAS,KAAuBmE,EAAA9D,KAAKgE,KAC1BvE,EAAM8B,QACJ,CAACC,GAAON,OAAMO,QAAUE,WAAUsC,YAAWlC,eAC9B,SAATb,GAAmBa,EACdP,EAAMG,EAAS3D,MAAQiG,EAC5B,CAAC,SAAU,QAAS,aAAavB,SAASxB,IAASa,EAC9CP,EAAMyC,EACRzC,GAET,SAGJtC,EAAAS,KAAIkE,EAAWlE,KAAKuE,yBAChBzF,EAAAkB,KAAoBmE,EAAA,KACpBrF,EAAAkB,KAAIoE,EAAA,UAER7E,EAAAS,KAAI2D,EAAQ3D,KAAKuE,yBACbzF,EAAAkB,KAAiByD,EAAA,KACjB3E,EAAAkB,KAAI0D,EAAA,UAERnE,EAAAS,OAAsBlB,EAAAkB,YAAelB,EAAAkB,KAAS2D,EAAA,MAAIH,EAA0CgB,uBAAuBC,YAAc,UACjIlF,EAAAS,OAAwBlB,EAAAkB,YAAelB,EAAAkB,KAAS2D,EAAA,MAAIH,EAA0CgB,uBAAuBE,cAAgB,UACrInF,EAAAS,OAAsBlB,EAAAkB,YAAelB,EAAAkB,KAAS2D,EAAA,MAAIH,EAA0CgB,uBAAuBG,aAAe,UAElIpF,EAAAS,OAAmBlB,EAAAkB,YAAelB,EAAAkB,KAAS2D,EAAA,MAAIH,EAA0CoB,yBAAyBC,SAAW,UAC7HtF,EAAAS,OAAqBlB,EAAAkB,YAAelB,EAAAkB,KAAS2D,EAAA,MAAIH,EAA0CoB,yBAAyBE,WAAa,UACjIvF,EAAAS,OAAsBlB,EAAAkB,YAAelB,EAAAkB,KAAS2D,EAAA,MAAIH,EAA0CoB,yBAAyBG,YAAc,SAEpI,CAGGvE,YACF,OAAOR,KAAKuE,yBACRrD,OAAO8B,OACLQ,EAA0CoB,0BAE5C1D,OAAO8B,OACLQ,EAA0CgB,uBAEjD,CAEGD,+BACF,MAAMS,EAAiB9D,OAAO8B,OAC5BQ,EAA0CoB,0BAEtCK,EAAe/D,OAAO8B,OAC1BQ,EAA0CgB,wBAE5C,IAAIU,EAAgBF,EAAeG,WAChC7G,GAASA,EAAQQ,EAAAkB,KAAImE,EAAA,KAAmBrF,EAAAkB,KAAIyD,EAAA,KAAiB,MAEhEyB,GAAmC,IAAnBA,EAAuB,EAAIA,EAC3C,IAAIE,EAAcH,EAAaE,WAC5B7G,GAASA,EAAQQ,EAAAkB,KAAIoE,EAAA,KAAiBtF,EAAAkB,KAAI0D,EAAA,KAAe,MAG5D,OADA0B,GAA+B,IAAjBA,EAAqB,EAAIA,KAC7BF,GAAiBE,EAC5B,CAEG/G,YACF,OAAOS,EAAAkB,KAAIkE,EAAA,IACZ,CAEGtE,UACF,OAAOd,EAAAkB,KAAI2D,EAAA,IACZ,CAEG3C,wBACF,OAAOhB,KAAKuE,yBACRzF,EAAAkB,KAAgB+D,EAAA,KAChBjF,EAAAkB,KAAI4D,EAAA,IACT,CAEG9C,yBACF,OAAOd,KAAKuE,yBACRzF,EAAAkB,KAAkBgE,EAAA,KAClBlF,EAAAkB,KAAI6D,EAAA,IACT,CAEGpD,wBACF,OAAOT,KAAKuE,yBACRzF,EAAAkB,KAAmBiE,EAAA,KACnBnF,EAAAkB,KAAI8D,EAAA,IACT,0KAlJM5C,OAAAC,eAAAqC,EAAA,yBAAA,2CAAyBnF,MAAA,CAC9BoG,YAAa,KACbC,cAAe,GACfC,aAAc,QAGTzD,OAAAC,eAAAqC,EAAA,2BAAA,2CAA2BnF,MAAA,CAChCwG,SAAU,MACVC,WAAY,MACZC,YAAa,SAiBR7D,OAAAC,eAAAqC,EAAA,yBAAA,iDAAyB,KAEzBtC,OAAAC,eAAAqC,EAAA,uBAAA,iDAAuB,KAKvBtC,OAAAC,eAAAqC,EAAA,OAAA,iDAAO,cAKPtC,OAAAC,eAAAqC,EAAA,iBAAA,iDAAiB,qCClCnB,MAAM6B,EAAM,CAEjBC,aACE,MAAO,GAAGtF,KAAKuF,iBAChB,EAEGA,iBACF,MAAO,YAAYC,KAAK1D,OAAO2D,IAChC,EAEGC,iBACF,MAAO,GAAG1F,KAAKuF,mBAChB,EACGI,kBACF,MAAMhG,EAAU6F,KAAKI,SAAStG,IAAIkG,KAAK1D,OAAO2D,GAAI,qBAClD,OAAOzF,KAAK6F,mBAAmBlG,IAAYK,KAAK6F,mBAAmBC,QACpE,EACDD,mBAAoB,CAClBE,MAAO3E,EACP4E,SAAU/C,EACVgD,SAAUpD,EACViD,SAAUvC,EACV2C,UAAW1C,GAEb2C,OAAQ,CACNC,IAAK,sBACLC,IAAK,sBACLC,IAAK,sBACLC,IAAK,sBACLC,IAAK,sBACLC,IAAK,uBAEPC,aAAc,CACZN,IAAK,uBACLC,IAAK,uBACLC,IAAK,uBACLC,IAAK,uBACLC,IAAK,uBACLC,IAAK,wBAEPE,mBAAoB,CAClBC,GAAI,0BACJC,GAAI,0BACJC,GAAI,0BACJC,GAAI,2BAENC,yBAA0B,CACxBJ,GAAI,2BACJC,GAAI,2BACJC,GAAI,2BACJC,GAAI,4BAENE,UAAW,CACTvI,OAAQ,IACRwI,MAAO,IACPC,MAAO,KAETC,YAAa,CACXC,MAAO,wBACPC,KAAM,uBACNC,UAAW,4BACXC,OAAQ,yBACRC,MAAO,yBAETC,WAAY,CACVL,MAAO,uBACPC,KAAM,sBACNC,UAAW,2BACXC,OAAQ,wBACRC,MAAO,wBAETE,MAAO,CACLrF,UAAW,sBACXC,MAAO,kBACPC,MAAO,kBACPoF,OAAQ,oBAEVC,qBAAsB,CACpBC,SAAW,WACXC,SAAW,WACXC,eAAiB,kBAEnBC,OAAQ,CACNC,MAAO,mBACPC,IAAK,iBACLC,OAAQ,oBACRC,OAAQ,oBACRC,KAAM,kBACNC,OAAQ,oBACRC,MAAO,oBAETC,UAAW,CACT,SACA,SACA,UACA,UACA,UACA,eACA,SACA,WACA,SACA,WACA,QACA,UACA,SACA,WACA,QACA,YACA,SACA,aACA,SACA,WACA,OACA,SACA,SAEFC,KAAM,CACJC,MAAO,kBACPC,QAAS,oBACTC,KAAM,iBACNC,UAAW,sBACXC,MAAO,kBACPC,MAAO,kBACPC,OAAQ,mBACRC,OAAQ,mBACRC,OAAQ,oBAEVC,UAAW,CACLT,YACF,MAAO,CACLU,MAAOC,OAAOjE,IAAIqD,KAAKC,MACvBY,MAAO,GAAGD,OAAOjE,IAAIK,uBACrB8D,KAAM,WAET,EACGZ,cACF,MAAO,CACLS,MAAOC,OAAOjE,IAAIqD,KAAKE,QACvBW,MAAO,GAAGD,OAAOjE,IAAIK,yBACrB8D,KAAM,eAET,EACGX,WACF,MAAO,CACLQ,MAAOC,OAAOjE,IAAIqD,KAAKG,KACvBU,MAAO,GAAGD,OAAOjE,IAAIK,sBACrB8D,KAAM,oBAET,EACGV,gBACF,MAAO,CACLO,MAAOC,OAAOjE,IAAIqD,KAAKI,UACvBS,MAAO,GAAGD,OAAOjE,IAAIK,2BACrB8D,KAAM,mBAET,EACGT,YACF,MAAO,CACLM,MAAOC,OAAOjE,IAAIqD,KAAKK,MACvBQ,MAAO,GAAGD,OAAOjE,IAAIK,uBACrB8D,KAAM,kBAET,EACGR,YACF,MAAO,CACLK,MAAOC,OAAOjE,IAAIqD,KAAKM,MACvBO,MAAO,GAAGD,OAAOjE,IAAIK,uBACrB8D,KAAM,iBAET,EACGP,aACF,MAAO,CACLI,MAAOC,OAAOjE,IAAIqD,KAAKO,OACvBM,MAAO,GAAGD,OAAOjE,IAAIK,wBACrB8D,KAAM,WAET,EACGN,aACF,MAAO,CACLG,MAAOC,OAAOjE,IAAIqD,KAAKQ,OACvBK,MAAO,GAAGD,OAAOjE,IAAIK,wBACrB8D,KAAM,UAET,EACGL,aACF,MAAO,CACLE,MAAOC,OAAOjE,IAAIqD,KAAKS,OACvBI,MAAO,GAAGD,OAAOjE,IAAIK,wBACrB8D,KAAM,oBAET,GAEHC,WAAY,CACNd,YACF,MAAO,GAAGW,OAAOjE,IAAIK,sBACtB,EACGkD,cACF,MAAO,cACR,EACGC,WACF,MAAO,GAAGS,OAAOjE,IAAIK,qBACtB,EACGoD,gBACF,MAAO,GAAGQ,OAAOjE,IAAIK,0BACtB,EACGqD,YACF,MAAO,GAAGO,OAAOjE,IAAIK,sBACtB,EACGsD,YACF,MAAO,GAAGM,OAAOjE,IAAIK,sBACtB,EACGuD,aACF,MAAO,GAAGK,OAAOjE,IAAIK,uBACtB,EACGwD,aACF,MAAO,GAAGI,OAAOjE,IAAIK,uBACtB,EACGyD,aACF,MAAO,GAAGG,OAAOjE,IAAIK,uBACtB,GAEHgE,cAAe,CACb,EAAG,CACDC,EAAG,GACHC,EAAG,GACHC,EAAG,GACHC,EAAG,GACHC,EAAG,IAEL,EAAG,CACDJ,EAAG,GACHC,EAAG,GACHC,EAAG,GACHC,EAAG,GACHC,EAAG,IAEL,EAAG,CACDJ,EAAG,GACHC,EAAG,GACHC,EAAG,GACHC,EAAG,GACHC,EAAG,IAEL,EAAG,CACDJ,EAAG,EACHC,EAAG,EACHC,EAAG,GACHC,EAAG,GACHC,EAAG,IAEL,GAAI,CACFJ,EAAG,EACHC,EAAG,EACHC,EAAG,EACHC,EAAG,EACHC,EAAG,IAEL,GAAI,CACFJ,EAAG,EACHC,EAAG,EACHC,EAAG,EACHC,EAAG,EACHC,EAAG,GAEL,GAAI,CACFJ,EAAG,EACHC,EAAG,EACHC,EAAG,EACHC,EAAG,EACHC,EAAG,GAEL,GAAI,CACFJ,EAAG,EACHC,EAAG,EACHC,EAAG,EACHC,EAAG,EACHC,EAAG,GAEL,GAAI,CACFJ,EAAG,EACHC,EAAG,EACHC,EAAG,EACHC,EAAG,EACHC,EAAG,IAGPC,cAAe,CACb,EAAG,GACH,EAAG,GACH,EAAG,GACH,EAAG,GACH,EAAG,GACH,EAAG,GACH,EAAG,GACH,EAAG,GACH,EAAG,GACH,GAAI,GACJ,GAAI,GACJ,GAAI,EACJ,GAAI,EACJ,GAAI,EACJ,GAAI,EACJ,GAAI,IC9TFC,EAAU,CACdC,gBAAeC,MACbA,EAAQ,GAAEC,KACVA,EAAO,CAAE,EAAAC,MACTA,EAAQ,KAAIC,OACZA,EAAS,KAAIC,QACbA,EAAU,KAAIC,KACdA,EAAO,KAAIC,YACXA,GAAc,GACZ,IACF,MAAMC,EAAW,GAAGrF,EAAIC,+CAElBqF,EAAW,CACfC,KAAMpF,KAAKoF,KAAKnF,GAChB8E,WAGIM,EAAe,CACnBR,QACAC,SACAF,OACAU,OAAQxB,OAAOjE,KAIJ,OAATmF,GAAiBA,EAAKO,MAAM1M,OAC9B8L,EAAMa,KAAKR,EAAKO,MAAM1M,OAIxB,MAAM4M,EAAO,IAAIC,KAAKf,EAAMgB,KAAK,KAAMf,GAAMgB,SAAS,CAAElB,OAAO,IAG/D,IAAImB,EAAW7F,KAAKI,SAAStG,IAAI,OAAQ,YAkBzC,OAjBA+L,EAAWb,EAAOA,EAAKa,SAAShN,MAAQgN,GAGnCb,GAAQJ,EAAKa,KAAKK,YACrBD,EAAW7F,KAAKoF,KAAKW,KAAO,WAAa,aAGvC,CAAC,SAAU,aAAaxI,SAASsI,KACnCV,EAASa,QAAUC,YAAYC,qBAAqB,OACrC,aAAbL,IAAyBV,EAASa,QAAU,CAAChG,KAAKoF,KAAKe,MAC1C,cAAbN,IACFV,EAASiB,OAAQ,EACjBxB,EAAKa,KAAKK,WAAY,GAGxBT,EAAanM,OAASuL,EAAQ4B,aAAazB,EAAMa,GAE1C,IAAIhN,SAASC,IAClB+M,EAAKa,SAASlN,MAAMmN,IAClBlB,EAAamB,QAAUD,EACvBE,eAAevB,EAAUG,GAAcjM,MAAMsN,IAC3CvB,EAASuB,QAAUA,EAEf1G,KAAK2G,OACP3G,KAAK2G,OACFC,YACCnB,EACAzF,KAAKoF,MACL,EACAD,EAASa,QACTb,EAASiB,OAEVhN,MAAMyN,KACe,IAAhB5B,GAAuBgB,YAAYa,OAAO3B,GAC9CzM,EAAQ+M,EAAK,KAGjBN,EAAS4B,MAAQjD,OAAOkD,OAAOC,MACX,IAAhBhC,GAAuBgB,YAAYa,OAAO3B,GAC9CzM,EAAQ+M,GACT,GACD,GACF,GAEL,EASDY,aAAazB,EAAMa,GAEjB,MAAMvM,EAAS,CACbgO,WAAW,EACXC,WAAW,EACXC,OAAQxC,EAAKa,KAAK2B,OAClBC,MAAO5B,EAAK4B,OAGRC,EAAM7B,EAAK8B,MAAM,GAAGC,QAAQ,GAAGtO,OAErC,OAAQ0L,EAAKa,KAAK1J,MAChB,IAAK,SACC0J,EAAK4B,QAAUnO,EAAOkO,OACxBlO,EAAOgO,WAAY,EAEnBhO,EAAOiO,WAAY,EAGrB,MAGF,IAAK,QAEC1B,EAAK4B,OAASnO,EAAOkO,OACvBlO,EAAOgO,WAAY,EAEnBhO,EAAOiO,WAAY,EAGrB,MAGF,IAAK,QAEC1B,EAAK4B,OAASnO,EAAOkO,OACvBlO,EAAOgO,WAAY,EAEnBhO,EAAOiO,WAAY,EAGrB,MAGF,IAAK,QAES,IAARG,GAAc7B,EAAK4B,OAASnO,EAAOkO,QAAUE,EAAM,GACrDpO,EAAOgO,WAAY,EAEnBhO,EAAOiO,WAAY,EAGrB,MAGF,IAAK,QAAS,CAEZ,MAAMM,MAAEA,GAAU7C,EAAKa,KACvB,IAAIiC,EAAShM,OAAO8B,OAAOiK,GAAO,GAClC,IAAK,IAAI5J,EAAI,EAAGA,GAAK4H,EAAK4B,MAAOxJ,IAC3B4J,EAAM5J,KACR6J,EAASD,EAAM5J,IAGnB3E,EAAOyO,QAAUD,EAEjB,KACD,CAED,QACExO,EAAOgO,WAAY,EACnBhO,EAAOiO,WAAY,EAKvB,OAAOjO,CACR,EAUD0O,gBAAe,CAACnC,EAAMoC,EAAOC,IAEa,IAApCrC,EAAK8B,MAAM,GAAGC,QAAQ,GAAGtO,SAIW,KAApCuM,EAAK8B,MAAM,GAAGC,QAAQ,GAAGtO,QAGtBuM,EAAK4B,MAAQS,GAAMD,GAY5BE,mBAAmBnD,EAAMa,GAEvB,MAAMvM,EAAS,CACbgO,WAAW,EACXC,WAAW,EACXC,OAAQ,GACRC,MAAO5B,EAAK4B,OAEdnO,EAAOkO,OAASxC,EAAKa,KAAKoC,MAC1B,MAAMG,EAAkBpD,EAAKa,KAAK2B,QAAQa,OAAO3L,QAAU,KAErD4L,EAAWtD,EAAKa,KAAK2B,OAASY,EAAgBF,GAAGjP,MAAQ,GACzDsP,EAAYvD,EAAKa,KAAK2B,OAASY,EAAgBI,IAAIvP,OAAS,GAGlE,GAFAK,EAAOmP,OAASzD,EAAKa,KAAK2B,QAAU,KAEhCpH,KAAKI,SAAStG,IAAIkG,KAAK1D,OAAO2D,GAAI,eAAgB,CACpD,MAAMqI,EAAc,GAAK1D,EAAKa,KAAKoC,MAC/BrN,KAAKoN,gBAAgBnC,EAAM0C,EAAWG,IACxCpP,EAAOyO,QAAU3H,KAAKuI,KAAKC,OACzB,sCACA,CACEtP,OAAQuM,EAAK4B,QAGjBnO,EAAOgO,WAAY,IAEnBhO,EAAOyO,QAAU3H,KAAKuI,KAAKC,OACzB,sCACA,CACEjD,MAAOrM,EAAOkO,SAGlBlO,EAAOiO,WAAY,EAE3B,MAAW,GAAI3M,KAAKoN,gBAAgBnC,EAAMvM,EAAOkO,OAAQc,GAAW,CAE9D,MAAMrP,EAAQgC,KAAKC,QAAQ5B,EAAOkO,OAAS3B,EAAK4B,OAAQ,EAAG,GAC3DnO,EAAOyO,QAAU3H,KAAKuI,KAAKC,OAAO,6BAA8B,CAC9DtP,OAAQL,EACR0M,MAAOrM,EAAOkO,SAEhBlO,EAAOgO,WAAY,CACzB,MACMhO,EAAOyO,QAAU3H,KAAKuI,KAAKC,OAAO,6BAA8B,CAC9DjD,MAAOrM,EAAOkO,SAEhBlO,EAAOiO,WAAY,EAErB,OAAOjO,CACR,EAoBDwL,sBAAqBC,MACnBA,EAAQ,GAAEC,KACVA,EAAO,CAAE,EAAA6D,MACTA,EAAQ,CAAE,EAAA5D,MACVA,EAAQ,KAAIC,OACZA,EAAS,KAAIC,QACbA,EAAU,KAAIC,KACdA,EAAO,MACL,IACF,GAAqD,IAAjDJ,EAAKa,KAAKiD,IAAIC,QAAQC,GAAY,KAANA,IAAUC,OAOxC,YAHAC,GAAGC,cAAcC,MACf,uEAIJ,MAAM9D,EAAW,GAAGrF,EAAIC,+CAClBqF,EAAW,CACfC,KAAMpF,KAAKoF,KAAKnF,GAChB8E,UACA0D,SAGIpD,EAAe,CACnBR,QACAC,SACAF,OACAU,OAAQxB,OAAOjE,KAIJ,OAATmF,GAAiBA,EAAKO,MAAM1M,OAAO8L,EAAMa,KAAKR,EAAKO,MAAM1M,OAE7D,MAAM4M,EAAO,IAAIC,KAAKf,EAAMgB,KAAK,KAAMf,GAAMgB,SAAS,CAAElB,OAAO,IACzDuE,EAAU,IAAIvD,KAAKd,EAAKa,KAAKiD,IAAI/C,KAAK,KAAMf,GAAMgB,SAAS,CAC/DlB,OAAO,IAIT,IAAImB,EAAW7F,KAAKI,SAAStG,IAAI,OAAQ,YAkBzC,OAjBA+L,EAAWb,EAAOA,EAAKa,SAAShN,MAAQgN,EAGpCjB,EAAKa,KAAKK,YACZD,EAAW7F,KAAKoF,KAAKW,KAAO,WAAa,aAGvC,CAAC,SAAU,aAAaxI,SAASsI,KACnCV,EAASa,QAAUC,YAAYC,qBAAqB,OACrC,aAAbL,IAAyBV,EAASa,QAAU,CAAChG,KAAKoF,KAAKe,MAC1C,cAAbN,IACFV,EAASiB,OAAQ,EACjBxB,EAAKa,KAAKK,WAAY,GAGxBT,EAAanM,OAASuL,EAAQsD,mBAAmBnD,EAAMa,GAEhD,IAAIhN,SAASC,IAClB+M,EAAKa,SAASlN,MAAMmN,IAClBlB,EAAamB,QAAUD,EACvB0C,EAAQ3C,SAASlN,MAAM8P,IACrB7D,EAAa8D,WAAaD,EAC1BzC,eAAevB,EAAUG,GAAcjM,MAAMsN,IAC3CvB,EAASuB,QAAUA,EAEf1G,KAAK2G,OACP3G,KAAK2G,OACFC,YACCnB,EACAzF,KAAKoF,MACL,EACAD,EAASa,QACTb,EAASiB,OAEVhN,MAAK,KACAiM,EAAanM,OAAOgO,WACtB7B,EAAanM,OAAOwP,IAAMO,EAAQ5B,MAClCrH,KAAK2G,OACFC,YACCqC,EACAjJ,KAAKoF,MACL,EACAD,EAASa,QACTb,EAASiB,OAEVhN,MAAK,KACJ6M,YAAYa,OAAO3B,GACnBzM,EAAQ+M,EAAK,MAGjBQ,YAAYa,OAAO3B,GACnBzM,EAAQ+M,GACT,KAGLN,EAAS4B,MAAQjD,OAAOkD,OAAOC,KAC/BhB,YAAYa,OAAO3B,GACnBzM,EAAQ+M,GACT,GACD,GACF,GACF,GAEL,EAEDf,gBAAeC,MACbA,EAAQ,GAAEC,KACVA,EAAO,CAAE,EAAAwE,WACTA,GAAa,EAAKrE,QAClBA,EAAU,KAAID,OACdA,EAAS,KAAID,MACbA,EAAQ,KAAII,YACZA,GAAc,GACZ,IACF,IAAIoE,GAAS,EACb,MAAMnE,EAAW,GAAGrF,EAAIC,+CAClBwJ,EAAa,CACjBC,QAAS5E,EAAMgB,KAAK,KACpBf,OACAiB,SAAU7F,KAAKI,SAAStG,IAAI,OAAQ,YACpC0P,UAAW1F,OAAO2F,KAAKD,WAGnBE,EAAW,CACf/E,QACAC,OACAC,QACAC,SACAC,UACAE,eAEF,GAAImE,EACF,OAAO3E,EAAQkF,SAASD,GAG1B,MAAME,EAAU,CACdC,GAAI,CACFhG,MAAO7D,KAAKuI,KAAKuB,SAAS,YAC1B9F,KAAM,kCACN+F,SAAWC,IACTX,GAAS,EACTK,EAAS1E,KAAOgF,EAAK,GAAGC,cAAc,QACtCxE,EAAOhB,EAAQkF,SAASD,EAAS,GAGrCQ,MAAO,CACLrG,MAAO7D,KAAKuI,KAAKuB,SAAS,yBAC1B9F,KAAM,+BACN+F,SAAWC,IACTX,GAAS,EACTK,EAAS1E,KAAOgF,EAAK,GAAGC,cAAc,QACtCP,EAAS/E,MAAMa,KAAK,GAAGkE,EAAS9E,KAAKa,KAAKyE,SAC1CR,EAAS7E,OAAS,IAAI7E,KAAKuI,KAAKuB,SAAS,6BACvCJ,EAAS9E,KAAKa,KAAKyE,SAErBzE,EAAOhB,EAAQkF,SAASD,EAAS,GAGrCS,OAAQ,CACNnG,KAAM,+BACNH,MAAO7D,KAAKuI,KAAKuB,SAAS,cAC1BC,SAAWC,IAAD,IAIRA,QAAavD,eAAevB,EAAUoE,GAC5C,IAAI7D,EAGJ,OAAO,IAAIhN,SAASC,IAClB,IAAI0R,OAAO,CACTvF,QACA6B,QAASsD,EACTJ,UACAS,QAAS,KACTC,MAAO,KACL5R,IAAQ2Q,GAAS5D,EAAa,IAE/Ba,QAAO,EAAK,GAElB,EAED5B,YAAWC,MACTA,EAAQ,GAAEC,KACVA,EAAO,CAAE,EAAAwE,WACTA,GAAa,EAAKrE,QAClBA,EAAU,KAAID,OACdA,EAAS,KAAID,MACbA,EAAQ,KAAII,YACZA,GAAc,EAAIwD,MAClBA,EAAQ,CAAE,GACR,IACF,IAAIY,GAAS,EACb,MAAMnE,EAAW,GAAGrF,EAAIC,+CAClBwJ,EAAa,CACjBC,QAAS5E,EAAMgB,KAAK,KACpBf,OACAiB,SAAUjB,EAAKa,KAAKK,UAChB,YACA9F,KAAKI,SAAStG,IAAI,OAAQ,YAC9B0P,UAAW1F,OAAO2F,KAAKD,WAEnBE,EAAW,CACf/E,QACAC,OACAC,QACAC,SACAC,UACAE,cACAwD,SAEF,GAAIW,EACF,MAAO,CAAC,QAAS,UAAW,UAAU7L,SAASqH,EAAKa,KAAK1J,MACrD0I,EAAQ8F,eAAeb,GACvBjF,EAAQkF,SAASD,GAGvB,MAAME,EAAU,CACdC,GAAI,CACFhG,MAAO7D,KAAKuI,KAAKuB,SAAS,YAC1B9F,KAAM,kCACN+F,SAAWC,IACTX,GAAS,EACTK,EAAS1E,KAAOgF,EAAK,GAAGC,cAAc,QACtCxE,EAAO,CAAC,QAAS,UAAW,UAAUlI,SAASqH,EAAKa,KAAK1J,MACrD0I,EAAQ8F,eAAeb,GACvBjF,EAAQkF,SAASD,EAAS,GAGlCS,OAAQ,CACNnG,KAAM,+BACNH,MAAO7D,KAAKuI,KAAKuB,SAAS,cAC1BC,SAAWC,IAAD,IAIRA,QAAavD,eAAevB,EAAUoE,GAC5C,IAAI7D,EAGJ,OAAO,IAAIhN,SAASC,IAClB,IAAI0R,OAAO,CACTvF,QACA6B,QAASsD,EACTJ,UACAS,QAAS,KACTC,MAAO,KACL5R,IAAQ2Q,GAAS5D,EAAa,IAE/Ba,QAAO,EAAK,GAElB,GCpgBY,MAAMkE,UAA4BC,gBACpCC,4BACT,MAAM7O,EAAUC,MAAM4O,eAMtB,OALA7O,EAAQ8O,QAAU,CAAC,MAAO,SAAU,WACpC9O,EAAQoE,GAAK,oBACbpE,EAAQqJ,SAAW,GAAGrF,EAAIC,gEAC1BjE,EAAQ+O,MAAQ,IAChB/O,EAAQgP,eAAgB,EACjBhP,CACR,CASGgJ,YACF,MAAO,GAAGrK,KAAKsQ,OAAOC,SAAS/K,KAAKuI,KAAKuB,SAAS,yBACnD,CASDkB,UACE,MAAMpG,EAAOqG,QAAQC,MAAMC,UAAU3Q,KAAKsQ,QAmB1C,OAlBAlG,EAAKQ,KAAOpF,KAAKoF,KACjBR,EAAKU,OAASxB,OAAOjE,IACrBrF,KAAK4Q,SAAW,CACdxK,IAAK,EACLG,IAAK,EACLD,IAAK,EACLD,IAAK,EACLI,IAAK,EACLD,IAAK,EACLqK,KAAM,GAER7Q,KAAK8Q,MAAQ,CACXC,IAAK,EACLC,IAAK,EACLC,IAAK,GAEPjR,KAAKmG,OAAS,GACdnG,KAAK6Q,KAAO,EACLzG,CACR,CAID8G,QAAQC,GACN,MAAMC,EAAOC,EAAEF,EAAGG,eAAeC,QAAQ,mBACnCpL,EAASjF,OAAO8B,OAAOhD,KAAKmG,QAC5BqL,EAAIrL,EAAOkI,OACX0C,EAAM5K,EAAOvE,QAAO,CAACC,EAAKtD,IAASsD,EAAMtD,EAAKF,OAAO,GACrDoT,EAAOC,WAAWX,GAAOS,EACzBP,EAAM5Q,KAAKsR,KACfxL,EACGyL,KAAKC,IAAOA,EAAExT,MAAQoT,IAAS,IAC/B7P,QAAO,CAACC,EAAKtD,IAASsD,EAAMtD,GAAM,GAAKiT,GAGtCV,EAAQM,EAAKU,SAAS,eAC5BhB,EAAMiB,KAAK,QAAQC,KAAKjB,GACxBD,EAAMiB,KAAK,QAAQC,KAAK3R,KAAK4R,MAAO,GAAKlB,EAAOS,GAAK,IACrDV,EAAMiB,KAAK,QAAQC,KAAK3R,KAAK4R,MAAM,IAAMhB,GAAO,KAE5CO,GAAK,GACPH,EAAEF,EAAGG,eACFC,QAAQ,QACRQ,KAAK,yBACLG,WAAW,YAGhBlS,KAAKsQ,OAAOQ,MAAQ,CAClBC,MACAC,IAAK3Q,KAAK4R,MAAO,GAAKlB,EAAOS,GAAK,GAClCP,IAAK5Q,KAAK4R,MAAM,IAAMhB,GAAO,IAEhC,CAEDkB,UAAUC,EAAO/Q,EAAU,IAEzBrB,KAAK4Q,SAASwB,IAAU,EAExB,MAAM/I,EACM,SAAV+I,EACI,OACA5M,KAAKuI,KAAKuB,SAAS,cAAc8C,UACjCC,EAAY,CAAC,OAInB,OAAIhR,EAAQiR,YACH,IAAIpH,KAAKmH,EAAU,IAAIjH,SAAS,CAAElB,OAAO,IAG3CD,EAAQiB,KAAK,CAClBqH,MAAOlR,EAAQkR,MACfpI,MAAOkI,EACPjI,KAVW,CACXa,KAAM,CAAE,GAUR2D,YAAY,EACZrE,QAASkB,YAAY+G,WAAW,CAAE/E,MAAOzN,OACzCsK,OAAQ9E,KAAKuI,KAAKC,OAAO,2BAA4B,CACnDoE,MAAO/I,EACPoJ,MAAOzS,KAAK4Q,SAASwB,KAEvB/H,MAAO7E,KAAKuI,KAAKC,OAAO,2BAA4B,CAClDoE,MAAO/I,EACPoJ,MAAOzS,KAAK4Q,SAASwB,MAG1B,CAGDM,kBAAkBlD,GAChBlO,MAAMoR,kBAAkBlD,GACxBA,EAAKuC,KAAK,gBAAgBY,OAAOxB,IAC/B,MAAMyB,EAAKzB,EAAGG,cAAcuB,cAAcA,eACpCT,MAAEA,GAAUQ,EAAGE,QACrB9S,KAAKmS,UAAUC,EAAO,CAAEG,MAAOpB,IAAMvS,MAAMmN,IACzC/L,KAAKmG,OAAOiM,GAAS,CAAE/T,MAAO0N,EAAEc,OAChCwE,EAAEuB,GAAIb,KAAK,SAASgB,IAAIhH,EAAEc,OAAOmG,QAAQ,SAAS,GAClD,IAGJxD,EAAKuC,KAAK,eAAeY,OAAOxB,IAC9B,MAAMyB,EAAKzB,EAAGG,cAAcuB,cAAcA,cAAcA,cACxD7S,KAAKmS,UAAU,OAAQ,CAAEI,MAAOpB,IAAMvS,MAAMmN,IAC1C/L,KAAK6Q,KAAO,GAAK9E,EAAEc,MACnBwE,EAAEuB,GAAIb,KAAK,eAAegB,IAAI/S,KAAK6Q,KAAK,GACxC,IAGJrB,EAAKuC,KAAK,qBAAqBkB,QAAQ9B,IACrCnR,KAAKkR,QAAQC,EAAG,IAGlB3B,EAAKuC,KAAK,eAAeY,OAAMzI,MAAOiH,IACpC,MAAML,EAAQ,CAAC,MAAO,MAAO,MAAO,MAAO,MAAO,OAClD,IAAK,MAAMoC,KAAQpC,EAAO,CACxB,MAAM/E,QAAU/L,KAAKmS,UAAUe,EAAM,CAAEX,MAAOpB,EAAImB,aAAa,IAC/DtS,KAAKmG,OAAO+M,GAAQ,CAAE7U,MAAO0N,EAAEc,MAChC,CACD7M,KAAKkR,QAAQC,GACb,MAAMpF,QAAU/L,KAAKmS,UAAU,OAAQ,CAAEI,MAAOpB,EAAImB,aAAa,IACjEtS,KAAK6Q,KAAO,GAAK9E,EAAEc,MACnB7M,KAAKmT,QAAQ,GAEhB,CAGDjJ,gBACEqI,GACAa,WAAEA,EAAa,KAAIC,aAAEA,GAAe,EAAKC,cAAEA,GAAgB,GAAU,CAAE,GAEvE,MAAMC,EAAe,IAAKH,EAAYtR,OAAQ,CAAEqE,OAAQnG,KAAKmG,SAE7D7E,MAAMkS,UAAUjB,EAAO,CACrBa,WAAYG,EACZF,eACAC,kBAIF,MAAM/I,EAAUkB,YAAY+G,WAAW,CAAE/E,MAAOzN,KAAKsQ,OAAO7C,QACtD5C,EAAe,CACnBC,OAAQxB,OAAOjE,IACfc,OAAQnG,KAAKmG,OACbkE,MAAO7E,KAAKuI,KAAKuB,SAAS,wBAC1BwB,MAAO9Q,KAAKsQ,OAAOQ,MACnBD,KAAM7Q,KAAK6Q,MAEP3E,QAAgBD,eACpB,GAAG5G,EAAIC,iDACPuF,SAGIY,YAAYa,OAAO,CACvBJ,UACA3B,YAIF,MAAMkJ,EAAW,CACflD,KAAM/K,KAAKuI,KAAKuB,SAAS,sBACzB/N,KAAM,OACNmS,IAAK,GAAGrO,EAAIK,sBACZ5D,OAAQ,CACNC,UAAU,EACV4R,KAAM,EACN1R,OAAQ,EACRD,SAAU,CACR3D,MAAO2B,KAAK6Q,QAIlB7Q,KAAKsQ,OAAOsD,wBAAwB,OAAQ,CAACH,GAC9C,CAUDvJ,oBAAoBqI,EAAOsB,GACzBtB,EAAMuB,uBAEA9T,KAAKsQ,OAAOyD,OAAOF,GAGzB7T,KAAKsQ,OAAO0D,MAAMlI,QAAO,EAC1B,EC3NY,MAAMmI,UAA2BhE,gBAC9CvQ,YAAY6S,EAAO2B,EAAcC,GAC/B7S,MAAMiR,EAAO4B,GACbnU,KAAKsQ,OAAO4D,aAAeA,CAC5B,CAEUhE,4BACT,MAAM7O,EAAUC,MAAM4O,eAKtB,OAJA7O,EAAQ8O,QAAU,CAAC,MAAO,SAAU,WACpC9O,EAAQoE,GAAK,gBACbpE,EAAQqJ,SAAW,GAAGrF,EAAIC,4DAC1BjE,EAAQ+O,MAAQ,IACT/O,CACR,CAUGgJ,YACF,MAAO,GAAGrK,KAAKsQ,OAAOC,SAAS/K,KAAKuI,KAAKuB,SACvC,4BAEH,CASDpF,gBACE,MAAME,QAAaqG,QAAQC,MAAMC,UAAU3Q,KAAKsQ,OAAO4D,cAIvD,OAHA9J,EAAKgK,gBAAkBpU,MAAKqU,EAAcjK,GAC1CA,EAAKQ,KAAOpF,KAAKoF,KACjB5K,KAAKsU,UAAYtU,KAAKsQ,OAAOxQ,MACtBsK,CACR,CAEDF,YAAY7I,GACV,OAAOC,MAAMwO,MAAMzO,EACpB,CAiBD6I,gBAAgBqI,GAAOc,aAAEA,GAAe,EAAKC,cAAEA,GAAgB,GAAU,IAEvEhS,MAAMkS,UAAUjB,EAAO,CACrBc,eACAC,kBAGF,MAAMc,QAAkBpU,MAAKqU,QAAoBrU,KAAKwQ,WAChD+D,QAAWvU,KAAKsQ,OAAOxQ,MAAMiS,MAAMyC,IACvC,MAAMf,EAAWe,EAAK1S,OACtB,OACG0S,EAAKjE,OAAS/K,KAAKuI,KAAKuB,SAAS,uBAClB,OAAdkF,EAAKjE,OACPkD,EAAS1R,QACT,IAEJ,IAAKwS,EAEH,YADAjG,GAAGC,cAAcC,MAAMhJ,KAAKuI,KAAKuB,SAAS,mBAG5C,MAAMmF,EAAQF,EAAGzS,OAAOE,SAAS3D,MAAQ+V,EACrCK,GAAS,EACXzU,KAAKsQ,OAAOoE,wBAAwB,OAAQ,CAC1C,CAAE/I,IAAK4I,EAAG9O,GAAI,wBAAyBgP,KAGzCnG,GAAGC,cAAcC,MAAMhJ,KAAKuI,KAAKuB,SAAS,yBAE7C,CASDpF,QAAoBqI,EAAOsB,GACzBtB,EAAMuB,iBAEN,MAAMvJ,EAAUkB,YAAY+G,WAAW,CAAE/E,MAAOzN,OAC1C6K,QAAqB7K,KAAKwQ,UAC1BtE,QAAgBD,eACpB,GAAG5G,EAAIC,kDACPuF,GAEFY,YAAYa,OAAO,CACjBJ,UACA3B,kBAGIvK,KAAKsQ,OAAOyD,OAAOF,GAGzB7T,KAAKsQ,OAAO0D,MAAMlI,QAAO,EAC1B,CAGD5B,QAAoBE,GAClB,IAAIyC,EAAQ,EACZ,MAAM8H,EAAW,IAAIC,IAAI,CAAC,OAAQ,YAAa,SAAU,UAQzD,OAPAxK,EAAKtK,MAAM+U,SAASL,IAClB,MAAMf,EAAWe,EAAK1S,OAClB6S,EAASvV,IAAIoV,EAAKjT,QAAUkS,EAAS1R,WACvC8K,GAAS4G,EAASzR,SAASpC,IACvB6T,EAASE,KACTF,EAASE,KAAOF,EAASzR,SAAS3D,MAAK,IAExCwO,CACR,CAKD6F,kBAAkBlD,GAChBlO,MAAMoR,kBAAkBlD,GACxBA,EAAKuC,KAAK,iBAAiBY,OAAM,KAC/B3S,KAAKmT,QAAQ,GAEhB,EC/IY,MAAM2B,UAA8B7E,gBACtCC,4BACT,MAAM7O,EAAUC,MAAM4O,eAKtB,OAJA7O,EAAQ8O,QAAU,CAAC,MAAO,SAAU,aACpC9O,EAAQoE,GAAK,kBACbpE,EAAQqJ,SAAW,GAAGrF,EAAIC,8DAC1BjE,EAAQ+O,MAAQ,IACT/O,CACR,CASGgJ,YACF,MAAO,GAAGrK,KAAKsQ,OAAOC,iBACvB,CASDC,UACE,MAAMpG,EAAOqG,QAAQC,MAAMC,UAAU3Q,KAAKsQ,QAE1C,OADAlG,EAAKQ,KAAOpF,KAAKoF,KACVR,CACR,CAKDsI,kBAAkBlD,GAChBlO,MAAMoR,kBAAkBlD,EACzB,EClCH,MAAMuF,EAAuBxC,GACE/M,KAAKI,SAAStG,IACzCkG,KAAK1D,OAAO2D,GACZ,0BAGI8M,IAAUA,EAAMyC,SAAWzC,EAAM0C,UACnC1C,IAAUA,EAAMyC,SAAWzC,EAAM0C,SCZxB,MAAMC,UAAwBjF,gBAChCC,4BACT,MAAM7O,EAAUC,MAAM4O,eAKtB,OAJA7O,EAAQoE,GAAK,eACbpE,EAAQ8O,QAAU,CAAC,gBACnB9O,EAAQqJ,SAAW,GAAGrF,EAAIC,2DAC1BjE,EAAQ+O,MAAQ,IACT/O,CACR,CAUGgJ,YACF,MAAO,GAAGrK,KAAKsQ,OAAOC,SAAS/K,KAAKuI,KAAKuB,SAAS,sBACnD,CASDkB,UACE,MAAMpG,EAAOqG,QAAQC,MAAMC,UAAU3Q,KAAKsQ,QAS1C,MARkB,cAAdlG,EAAK7I,OACP6I,EAAK+K,aAAc,GAErB/K,EAAKQ,KAAOpF,KAAKoF,KACjBR,EAAKU,OAAS,IACTxB,OAAOjE,IACV+P,YAAa5P,KAAKI,SAAStG,IAAIkG,KAAK1D,OAAO2D,GAAI,gBAE1C2E,CACR,CAKDsI,kBAAkBlD,GAChBlO,MAAMoR,kBAAkBlD,EACzB,CAUDtF,oBAAoBqI,EAAOsB,GACzBtB,EAAMuB,uBAEA9T,KAAKsQ,OAAOyD,OAAOF,SAGnB7T,KAAKsQ,OAAO0D,MAAMqB,SAAQ,EACjC,EC9DY,MAAMC,UAAsBC,WACzC/E,UACE,MAAMpG,EAAOqG,QAAQC,MAAMC,UAAUrP,MAAMkP,UAAUpG,MAYrD,OAXAA,EAAKoL,MAAQxV,KAAKyN,MAAMgI,QACxBrL,EAAKsL,SAAW1V,KAAKyN,MAAMuG,MAAM2B,WAEjCvL,EAAKU,OAAS,IACTxB,OAAOjE,IACV+P,YAAa5P,KAAKI,SAAStG,IAAIkG,KAAK1D,OAAO2D,GAAI,eAC/CmQ,WAAgE,UAApDpQ,KAAKI,SAAStG,IAAIkG,KAAK1D,OAAO2D,GAAI,cAC9CE,YAAaH,KAAKI,SAAStG,IAAIkG,KAAK1D,OAAO2D,GAAI,sBAEjD2E,EAAKyL,MAAQ7V,KAAKyN,MAAMoI,QAEjBzL,CACR,CAED0L,eAAevF,EAAMlP,EAAS0U,GAK5BzU,MAAMwU,eAAevF,EAAMlP,EAAS0U,EACrC,CAIDC,kBAAkBzD,GAChB,MAAM0D,EAAK1D,EAAMjB,cAAcC,QAAQ,eACvC,OAAOvR,KAAKyN,MAAM3N,MAAMR,IAAI2W,EAAGnD,QAAQoD,OACxC,CAIDC,oBAAoB5D,GAClBA,EAAMuB,iBACN,MACMhU,EADiBuR,EAAEkB,EAAMjB,eACF/S,KAAK,cAElC,GAA6B,SAAzBuB,EAAMsW,IAAI,WAAuB,CACnC,MAAMxD,EAAKvB,EAAEkB,EAAMjB,eAAeS,KAAK,uBACvCa,EAAGyD,YAAY,kBACfzD,EAAG0D,SAAS,iBAEZxW,EAAMyW,UAAU,IACtB,KAAW,CACL,MAAM3D,EAAKvB,EAAEkB,EAAMjB,eAAeS,KAAK,sBACvCa,EAAGyD,YAAY,iBACfzD,EAAG0D,SAAS,kBAEZxW,EAAM0W,QAAQ,IACf,CACF,CAEDC,sBAAsBlE,GACpBA,EAAMuB,iBACN,MAAM4C,EAAcrF,EAAEkB,EAAM3F,OAAO2E,QAAQ,eACrCzR,EAAQ4W,EAAY3E,KAAK,8BAE/B,GAA6B,SAAzBjS,EAAMsW,IAAI,WAAuB,CACnC,MAAMxD,EAAK8D,EAAY3E,KAAK,uBAC5Ba,EAAGyD,YAAY,kBACfzD,EAAG0D,SAAS,iBAEZxW,EAAMyW,UAAU,IACtB,KAAW,CACL,MAAM3D,EAAK8D,EAAY3E,KAAK,sBAC5Ba,EAAGyD,YAAY,iBACfzD,EAAG0D,SAAS,kBAEZxW,EAAM0W,QAAQ,IACf,CACF,CAEDG,mBAAmBpE,GACjBA,EAAMuB,iBACN,MAAM8C,EAAcrE,EAAMjB,cACvBC,QAAQ,oBACR9B,cAAc,iBACjBmH,EAAYC,MAAMC,QAAwC,KAA9BF,EAAYC,MAAMC,QAAiB,QAAU,EAC1E,CAED5M,yBAAyBqI,GACvB,MAAM0D,EAAK5E,EAAEkB,EAAMjB,eAAeC,QAAQ,eAC7BvR,KAAKyN,MAAM3N,MAAMR,IAAI2W,EAAG7L,KAAK,WACrC2M,MACN,CAGD7M,2BAA2BsK,GACzB,GAAkB,YAAdA,EAAKjT,MAAoC,UAAdiT,EAAKjT,KAElC,OAAOvB,KAAKyN,MAAMuJ,wBAAwB,OAAQ,CAACxC,EAAK7I,MAE1D,GAAkB,cAAd6I,EAAKjT,MAAoD,KAA5BiT,EAAK1S,OAAOmV,YAAoB,CAC/D,MAAMA,YAAEA,GAAgBzC,EAAK1S,OACvBoV,EAAalX,KAAKyN,MAAM3N,MAC3BR,IAAI2X,GACJnV,OAAOqV,QAAQhJ,QAAQiJ,GAAMA,IAAM5C,EAAK/O,WAErCzF,KAAKyN,MAAMiH,wBAAwB,OAAQ,CAC/C,CAAE/I,IAAKsL,EAAanV,OAAQ,CAAEqV,QAASD,KAE1C,CACD,GAAkB,cAAd1C,EAAKjT,MAAwBiT,EAAK1S,OAAOqV,QAAS,CACpD,MACM/D,EADiBoB,EAAK1S,OAAOqV,QACDvV,QAAO,CAACC,EAAKkR,KAE1C/S,KAAKyN,MAAM3N,MAAMR,IAAIyT,IACtBlR,EAAImJ,KAAK,CAAEW,IAAKoH,EAAK,qBAAsB,KACtClR,IACN,UAEG7B,KAAKyN,MAAMiH,wBAAwB,OAAQtB,EAClD,CAGDpT,KAAKyN,MAAMuJ,wBAAwB,OAAQ,CAACxC,EAAK7I,KAClD,CAMD0L,eAAe9E,EAAO+E,GACpB,MAAM9C,EAAOxU,KAAKgW,kBAAkBzD,GACpC,IAAKiC,EAAM,OAAO,KAClB,IACExS,UAAY3D,MAAO2D,IACjBwS,EAAK1S,OACT0S,EAAKT,OAAO,CACV,wBAAyBuD,IAActV,IAAaA,GAEvD,CAEDkI,qBAAqBqI,GACnBA,EAAMuB,iBACN,MAAMU,EAAOxU,KAAKgW,kBAAkBzD,GACpC,MAAmC,SAA/BA,EAAM3F,OAAOkG,QAAQyE,MAChB/C,EAAKT,OAAO,CAAE,cAAeyD,SAASjF,EAAM3F,OAAOvO,SAEzB,aAA/BkU,EAAM3F,OAAOkG,QAAQyE,MAChB/C,EAAKT,OAAO,CACjB,mBAAoByD,SAASjF,EAAM3F,OAAOvO,cAF9C,CAKD,CAED6L,mBAAmBqI,GACFlB,EAAEkB,EAAMjB,eACpBC,QAAQ,qBACRQ,KAAK,eACD0F,MAAK,CAACC,EAAG9E,KACd,MAAMsD,OAAEA,GAAWtD,EAAGE,QAChB0B,EAAOxU,KAAKyN,MAAM3N,MAAMR,IAAI4W,GAC5BzC,EAAWe,GAAM1S,OACvB0S,EAAKT,OAAO,CACVpI,IAAK6I,EAAK/O,GACV,cAAegO,EAASkE,WACxB,GAEL,CAEDzN,mBAAmBqI,GACjB,MAAMiC,EAAOxU,KAAKgW,kBAAkBzD,GAC9BkB,EAAWe,GAAM1S,OACL,WAAd0S,EAAKjT,MACiB,YAApBvB,KAAKyN,MAAMlM,MACbiT,EAAKT,OAAO,CACV,uBAAwBN,EAASmE,QAAQvZ,MAAQ,IAGrDmW,EAAKqD,WAAW,CAAEjJ,WAAYmG,EAAoBxC,MAC5B,SAAbiC,EAAKjT,KACdiT,EAAKsD,WAAW,CAAElJ,WAAYmG,EAAoBxC,KAElDiC,EAAKuD,YAAY,CAAEnJ,WAAYmG,EAAoBxC,IAEtD,CAEDrI,gBAAgBqI,GACd,MAAMyF,EAAchY,KAAKyN,MACnBwK,EAAU1F,EAAMjB,eAChB4G,KAAEA,GAASD,EAAQpF,cAAcA,cAAcC,QACrDkF,EAAYG,SAASD,EAAM,CAAE3F,SAC9B,CAEDrI,kBAAkBqI,GAChB,MAAMyF,EAAchY,KAAKyN,MACnBwK,EAAU1F,EAAMjB,eAChB8G,OAAEA,GAAWH,EAAQpF,cAAcA,cAAcC,QACvDkF,EAAYK,aAAa,CAAEpN,KAAM,CAAE,GAAImN,EAAQ,CAC7C7W,KAAM6W,EACNxJ,WAAYmG,EAAoBxC,IAEnC,CAED+F,YAAY/F,EAAOkB,GACjB,MAAM8E,EAASvY,KAAKyN,MAAM3N,MAAMR,IAAImU,EAAS9H,KACvCmG,EAAW9R,KAAKyN,MAAM3N,MAAMqO,QAC/B9K,GAAMA,EAAE+G,KAAKuB,MAAQ4M,EAAOnO,KAAKuB,MAE9B6M,EAAajG,EAAM3F,OAAO2E,QAAQ,kBAClCkH,EAAWD,EAAaA,EAAW1F,QAAQoD,OAAS,KACpDtJ,EAASkF,EAASC,MAAMhI,GAAMA,EAAEK,KAAKuB,MAAQ8M,IACnD,IAAK7L,EAAQ,MAAM,IAAI8L,MAAM,sBAAsBnG,EAAM3F,UACzD,MAAM+L,EAAa/L,GAAQ9K,OAIP,cAAjB8K,GAAQrL,MAA+C,cAAvBqL,GAAQxC,MAAM7I,MACpB,KAA3BoX,EAAW1B,aAOsB,KAA/BsB,GAAQzW,OAAOmV,aACjBjX,KAAKyN,MAAMiH,wBAAwB,OAAQ,CACzC,CAAE/I,IAAK4M,EAAO9S,GAAI,qBAAsB,MAI5CnE,MAAMgX,YAAY/F,EAAOkB,IAXvBzT,KAAKyN,MAAMiH,wBAAwB,OAAQ,CACzC,CAAE/I,IAAK4M,EAAO9S,GAAI,qBAAsBmH,EAAOnH,KAWpD,CAEDmT,aAAarG,GACX,MAAM0D,EAAK1D,EAAMjB,cACjB,IAGIuH,EAHAC,EAAe,GACnB,IAAIvG,EAAM3F,OAAOmM,UAAUC,SAAS,gBAApC,CAKA,GAAI/C,EAAGnD,QAAQoD,OAAQ,CACrB,MAAM1B,EAAOxU,KAAKyN,MAAM3N,MAAMR,IAAI2W,EAAGnD,QAAQoD,QAC7C2C,EAAWrE,EAAKyE,aAChBJ,EAASrE,KAAOA,EAChBqE,EAAStX,KAAO,OACE,cAAdiT,EAAKjT,MAAwBiT,EAAK1S,OAAOqV,QAAQ9I,OAAS,IAE5DyK,EAAetE,EAAK1S,OAAOqV,QAE9B,CASD,GANA0B,EAASK,QAAUlZ,KAAKyN,MAAMhI,GAC9BoT,EAASM,QAAUnZ,KAAKyN,MAAM2L,QAAUC,OAAOC,OAAO7T,GAAK,KAC3DoT,EAASU,QAAUvZ,KAAKyN,MAAM2L,QAAUpZ,KAAKyN,MAAM+L,MAAM/T,GAAK,KAC9DoT,EAASY,KAAOzZ,KAAKyN,MAAMgM,KAGvBxD,EAAGnD,QAAQ4G,SAAU,CACvB,MAAMC,EAAS3Z,KAAKyN,MAAMmM,QAAQta,IAAI2W,EAAGnD,QAAQ4G,UACjDb,EAAStX,KAAO,eAChBsX,EAASzO,KAAOuP,EAAOvP,IACxB,CAGDmI,EAAMsH,aAAaC,QACjB,aACAC,KAAKC,UAAUnB,GAAU,CAACoB,EAAK5b,IACjB,YAAR4b,EAGKF,KAAKC,UAAUlB,GAEjBza,IAtCiD,CAyC7D,CAGD6L,oBAAoBqI,EAAOnI,GACzB,MAAM8P,QAAeC,SAAS/P,EAAKgQ,MACnC,IAAKF,GAA0B,SAAhBA,EAAO3Y,KAAiB,OAEvC,IAAI8Y,EAAYH,EAAOI,UAAY,GAOnC,GALAJ,EAAOK,eAAc,GAAM1F,SAAS2F,IAClCH,EAAUrP,QAAQwP,EAAUF,SAAS,IAInCD,EAAUhM,OAAS,GAAKgM,EAAU,IAAID,MAAMrX,SAAS,cAAe,CACtE,MAAMjD,EAAQ,GACdua,EAAUxF,SAAQ3K,MAAOsK,IACvB1U,EAAMkL,WAAWmP,SAAS3F,EAAK4F,MAAM,IAEvCC,EAAYva,CACb,CAEDE,KAAKya,kBAAkBJ,EACxB,CAGDnQ,kBAAkBqI,EAAOnI,GACvB,MAAMqO,EAAWlG,EAAM3F,OAAO2E,QAAQ,UAAUuB,SAASoD,OACnDwE,EAAa1a,KAAKyN,MAAM3N,MAAMR,IAAImZ,GAClCkC,EAAyC,cAArBD,GAAYnZ,KAGhCiT,QAAaoG,KAAKC,eAAeC,aAAa1Q,GAC9CqJ,EAAWe,EAAKuG,WAEhBC,IAAWhb,KAAKyN,MAAM3N,MAAMR,IAAIkV,EAAK/O,IAErCwV,EAAcjb,KAAKyN,MAAM3N,MAAMR,IAAIkV,EAAK1S,OAAOmV,aAGrD,GAAIzC,EAAK/O,KAAOgT,EAEhB,OAAKuC,GAAWL,EAKZM,EAAoBjb,KAAKkb,uBAAuB1G,EAAMyG,GAGtDN,EAA0B3a,KAAKmb,oBAAoB3G,EAAMkG,QAA7D,EANS1a,KAAKya,kBAAkB,CAAChH,GAOlC,CAEDvJ,6BAA6BsK,EAAM4G,GACjC,MAAMC,EAAUD,EAAUtZ,OAAOqV,QAAQhJ,QAAQpE,GAAMA,GAAKyK,EAAK/O,KAC3D6V,EAAUtb,KAAKsQ,OAAOxQ,MAAMR,IAAIkV,EAAK/O,UACrC2V,EAAUrH,OAAO,CAAEjS,OAAQ,CAAEqV,QAASkE,WACtCC,EAAQvH,OAAO,CAAEjS,OAAQ,CAAEmV,YAAa,KAC/C,CAED/M,0BAA0BsK,EAAM5H,GAC9B,MAAM2O,EAAuB3O,EAAO4O,OAAO1b,MAAMiS,MAC9C1O,GAAMA,EAAEoC,KAAO+O,EAAK/O,KAEvB,IAAIgW,EAAajH,EACjB,IAAK+G,EAAsB,CAEzB,MAAMG,QAAgB1b,KAAKya,kBAAkB,CAACjG,EAAKuG,aACnDU,EAAaC,EAAQC,KACtB,CAKD,IAHiC/O,EAAO9K,OAAOqV,QAAQpF,MACpD1O,GAAMA,EAAEoC,KAAOgW,EAAWhW,KAEE,CAC7B,MAAM4V,EAAU,IAAIzO,EAAO9K,OAAOqV,QAASsE,EAAWhW,UAChDmH,EAAOmH,OAAO,CAAEjS,OAAQ,CAAEqV,QAASkE,WACnCI,EAAW1H,OAAO,CAAEjS,OAAQ,CAAEmV,YAAarK,EAAOnH,KACzD,CACF,CAGDyE,wBAAwB0R,EAAaC,GAAkB,GAsBrD,IApByBC,MAAMC,QAAQH,GACnCA,EACA,CAACA,IACY/G,SAASL,IAIxB,GAHIA,EAAK1S,OAAOmV,aAA2C,KAA5BzC,EAAK1S,OAAOmV,cAEzCzC,EAAK1S,OAAOmV,YAAc,IAEZ,cAAdzC,EAAKjT,MAC0B,iBAAxBiT,EAAK1S,OAAOqV,QACnB,CAEA,MAAM6E,EAAiBjC,KAAKkC,MAAMzH,EAAK1S,OAAOqV,SAC9C6E,EAAenH,SAASqH,IAEtBA,EAAcpa,OAAOmV,YAAc,EAAE,IAEvC2E,EAAY5Q,QAAQgR,EACrB,MAEEH,EACH,OAAO7b,KAAKyN,MAAMmG,wBAAwB,OAAQgI,GAGpD,MAAMzE,QAAEA,GAAY0E,EAAgB/Z,OACpCqV,EAAQnM,KAAK4Q,EAAYnW,IACzB,MAAM+O,EAAOxU,KAAKyN,MAAM3N,MAAMR,IAAIsc,EAAY,GAAGnW,UAC3C+O,EAAKT,OAAO,CAAEjS,OAAQ,CAAEmV,YAAa4E,EAAgBpW,YACrDoW,EAAgB9H,OAAO,CAAEjS,OAAQ,CAAEqV,YAC1C,CAIDjN,sBAAsBiS,EAAU,CAAC,SAAU,QAAS,SAAU,SAC5D,MAAMtR,EAAe,CAAEuR,MAAOD,GACxBE,QAAYpQ,eAChB,GAAG5G,EAAIC,kDACPuF,GAGF,OAAO,IAAI5M,SAASC,IAClB,IAAI0R,OAAO,CACTvF,MAAO7E,KAAKuI,KAAKuB,SAAS,yBAC1BpD,QAASmQ,EACTjN,QAAS,CACPC,GAAI,CACFhG,MAAO7D,KAAKuI,KAAKuB,SAAS,UAC1B9F,KAAM,+BACN+F,SAAWC,IACTtR,EAAQ,CACNqD,KAAMiO,EAAKuC,KAAK,uBAAuBgB,MACvCxC,KAAMf,EAAKuC,KAAK,sBAAsBgB,OACtC,GAGNpD,OAAQ,CACNnG,KAAM,+BACNH,MAAO7D,KAAKuI,KAAKuB,SAAS,gBAG9BO,QAAS,OACR/D,QAAO,EAAK,GAElB,CAGDwQ,YAAY/J,GACVA,EAAMuB,iBACN,MAAMyI,EAAShK,EAAMjB,eACfvP,SAAEA,EAAQR,KAAEA,EAAIib,IAAEA,GAAQD,EAAOzJ,QACjC2J,EAAa,CAAClb,EAAMgP,KAAU,CAClCA,KAAMA,GAAQ,OAAOhP,EAAKmb,eAC1Bnb,SAIF,GAAa,WAATA,EAMG,CACL,MAAMkS,EAAWgJ,EAAWlb,GAI5B,OAHIQ,IAAU0R,EAAS3R,OAAS,CAAEC,UAAU,IAE/B,UAATR,IAAkBkS,EAAS3R,OAAS0a,EAAM,CAAEA,OAAQ,CAACA,IAAK,IACvDxc,KAAKyN,MAAMmG,wBAAwB,OAAQ,CAACH,GAAW,CAAA,EAC/D,CAZsB,CACrB,MAAM0I,EAAUI,EAAOzJ,QAAQqJ,QAAQQ,MAAM,KAC7C3c,KAAK4c,gBAAgBT,GAASvd,MAAMie,IAClC,MAAMpJ,EAAWgJ,EAAWI,EAAYtb,KAAMsb,EAAYtM,MAC1DvQ,KAAKyN,MAAMmG,wBAAwB,OAAQ,CAACH,GAAW,CAAA,EAAG,GAElE,CAOG,CAEDvJ,0BAA0BqI,GACxBA,EAAMuB,iBACN,MAAMU,EAAOxU,KAAKgW,kBAAkBzD,GAEpC,MAAmC,UAA/BA,EAAM3F,OAAOkG,QAAQyE,MAChB/C,EAAKT,OAAO,CACjB,wBAAyByD,SAASjF,EAAM3F,OAAOvO,SAGhB,QAA/BkU,EAAM3F,OAAOkG,QAAQyE,MAChB/C,EAAKT,OAAO,CACjB,sBAAuByD,SAASjF,EAAM3F,OAAOvO,cAFjD,CAKD,CAID6L,sBAAsB4S,GACpB,MAAMtN,QAAalO,MAAMyb,gBAAgBD,GACzC9c,KAAKwK,KAAOgF,EAAK,GAGjB,MAAMwN,EAAYxN,EAAKuC,KAAK,cAC5B,GAAyB,IAArBiL,EAAU3O,OAOd,OAJA2O,EAAUvF,MAAK,CAACC,EAAG9E,KACjB,MAAMqK,EAAcjd,KAAKmU,SAAS+I,OAASld,KAAKqB,QAAQ6b,OACxDtK,EAAGiE,MAAMqG,OAAS,GAAGD,EAAczF,SAAS5E,EAAGE,QAAQqK,aAAa,IAE/D3N,CACR,CAGDtF,gBAAgBqI,GAEdjR,MAAM8b,UAAU7K,GAEhB,MAAM/C,EAAO6B,EAAErR,KAAKwK,MACdwS,EAAYxN,EAAKuC,KAAK,cAC5B,GAAyB,IAArBiL,EAAU3O,OACZ,OAGF2O,EAAUvF,MAAK,CAACC,EAAG9E,KACjB,MAAMqK,EAAcjd,KAAKmU,SAAS+I,OAASld,KAAKqB,QAAQ6b,OACxDtK,EAAGiE,MAAMqG,OAAS,GAAGD,EAAczF,SAAS5E,EAAGE,QAAQqK,aAAa,IAGtD3N,EAAKuC,KAAK,WAClB0F,MAAK,CAAChS,EAAI4X,KAChB,MAAMjC,EAAYiC,EAAO9L,QAAQ,qBACjC,GAAI6J,EAAW,CACb,MAAM6B,EAAcjd,KAAKmU,SAAS+I,OAASld,KAAKqB,QAAQ6b,OACxDG,EAAOxG,MAAMqG,OAAS,GACpBD,EAAczF,SAAS4D,EAAUtI,QAAQwK,eAE5C,IAEJ,CAGDC,kBAAkBhL,GAChBA,EAAMuB,iBACN,IAAIoB,EAAgBlV,KAAKyN,MAAO,CAC9B+P,IAAKxd,KAAKmU,SAASqJ,IAAM,GACzBC,KAAMzd,KAAKmU,SAASsJ,MAAQzd,KAAKmU,SAAS/D,MAAQ,KAAO,IACxDtE,QAAO,EACX,CAOD4R,oBACE,IAAItO,EAAU9N,MAAMoc,oBAGpB,MAAMC,EAAenY,KAAKoF,KAAKW,MAAQvL,KAAKyN,MAAMgI,QAWlD,OAVIzV,KAAKqB,QAAQqU,UAAYiI,IAC3BvO,EAAU,CACR,CACE/F,MAAO7D,KAAKuI,KAAKuB,SAAS,qBAC1BsO,MAAO,kBACPpU,KAAM,cACNqU,QAAUtL,GAAUvS,KAAKud,kBAAkBhL,KAE7CuL,OAAO1O,IAEJA,CACR,CAEDsD,kBAAkBlD,GAChBlO,MAAMoR,kBAAkBlD,GAGxBA,EAAKuC,KAAK,mCAAmCY,OAAOJ,IAClDvS,KAAK+d,UAAUxL,EAAM,IAGvB/C,EAAKuC,KAAK,aAAaY,OAAOJ,IAC5BvS,KAAKge,YAAYzL,EAAM,IAGzB/C,EAAKuC,KAAK,6BAA6BY,OAAOJ,IAC5CvS,KAAKyN,MAAMwQ,YAAY,CAAE1L,SAAQ,IAInC/C,EAAKuC,KAAK,8BAA8BY,OAAMzI,MAAOqI,IACnDvS,KAAKke,aAAa3L,EAAM,IAG1B/C,EAAKuC,KAAK,mCAAmCY,OAAOJ,IAClDvS,KAAKmW,oBAAoB5D,EAAM,IAEjC/C,EAAKuC,KAAK,yCAAyCY,OAAOJ,IACxDA,EAAM4L,iBAAiB,IAEzB3O,EAAKuC,KAAK,8BAA8BY,OAAOJ,IAC7CvS,KAAKyW,sBAAsBlE,EAAM,IAGnC/C,EAAKuC,KAAK,cAAcY,OAAOJ,IAC7BvS,KAAK2W,mBAAmBpE,EAAM,IAGhC/C,EAAKuC,KAAK,6BAA6BY,OAAMzI,MAAOqI,IAClDvS,KAAKoe,mBAAmB7L,EAAM,IAI3BvS,KAAKqB,QAAQqU,WAGlBlG,EAAKuC,KAAK,gBAAgBY,OAAOJ,IAE/BvS,KAAKsc,YAAY/J,EAAM,IAGzB/C,EAAKuC,KAAK,cAAcY,OAAOJ,IAChBvS,KAAKgW,kBAAkBzD,GAC/ByB,MAAMlI,QAAO,EAAK,IAGzB0D,EAAKuC,KAAK,gBAAgBY,OAAOJ,IAC/B,MAAMiC,EAAOxU,KAAKgW,kBAAkBzD,GAEpC,GAAmB,cAAfiC,GAAMjT,OAAyBiT,GAAM1S,QAAQqV,SAAS9I,OAAS,EACjE,OAAOrO,KAAKqe,qBAAqB7J,GAEnC5E,OAAO0O,QAAQ,CACbjU,MAAO7E,KAAKuI,KAAKuB,SAAS,8BAC1BpD,QAAS1G,KAAKuI,KAAKuB,SAAS,qCAC5BiP,IAAK,KACHve,KAAKqe,qBAAqB7J,EAAK,EAEjCgK,YAAY,GACZ,IAGJhP,EACGuC,KAAK,mBACLY,OAAOxB,GAAOA,EAAGvE,OAAO6R,WACxBxL,OAAOjT,KAAK0e,oBAAoBC,KAAK3e,OAGxCwP,EAAKuC,KAAK,kCAAkCY,OAAOJ,IACjDvS,KAAKqX,eAAe9E,GAAO,EAAK,IAElC/C,EAAKuC,KAAK,mCAAmCY,OAAOJ,IAClDvS,KAAKqX,eAAe9E,GAAO,EAAM,IAInC/C,EACGuC,KAAK,mBACLY,OAAOJ,GAAUA,EAAM3F,OAAO6R,WAC9BxL,OAAOjT,KAAK4e,eAAeD,KAAK3e,OAEnCwP,EACGuC,KAAK,mDACLY,OAAOJ,IACNvS,KAAK6e,aAAatM,EAAM,IAE7B,ECvnBY,MAAMuM,UAA+BxJ,EAMvCpF,4BACT,OAAOO,QAAQC,MAAMqO,YAAYzd,MAAM4O,eAAgB,CACrDC,QAAS,CAAC,MAAO,QAAS,QAAS,aACnCzF,SAAU,GAAGrF,EAAIC,qDACjB8K,MAAO,IACP8M,OAAQ,IACRF,WAAW,EACXgC,KAAM,CACJ,CACEC,YAAa,cACbC,gBAAiB,cACjBC,QAAS,eAGbC,QAAS,CAAC,eAEb,CAQDC,cAAcjV,GAEZA,EAAKkV,MAAQ,CACXxf,MAAOE,KAAKyN,MAAM3L,OAAOhC,MACzByf,OAAQvf,KAAKyN,MAAM3L,OAAO6F,MAC1B6X,QAASxf,KAAKyN,MAAM3L,OAAO0d,QAC3BC,UAAWzf,KAAKyN,MAAM3L,OAAO2d,UAC7BC,WAAY1f,KAAKyN,MAAM3L,OAAO4d,YAEhCtV,EAAKrI,SAAW/B,KAAKyN,MAAM3L,OAAO6d,gBAClCvV,EAAKsV,WAAa1f,KAAKyN,MAAM3L,OAAO4d,WACpCtV,EAAKwV,UAAY5f,KAAKyN,MAAM3L,OAAO8d,UACnCxV,EAAKyV,OAAS7f,KAAKyN,MAAM3L,OAAO+d,OAAOC,UACvC1V,EAAK2V,MAAQ/f,KAAKyN,MAAM3L,OAAOke,WAI/B5V,EAAKtI,OAAOme,gBAAkBjgB,KAAKyN,MAAM3L,OAAOme,gBAChD7V,EAAKtI,OAAOoe,SAAWlgB,KAAKyN,MAAM3L,OAAOoe,SACzC9V,EAAKtI,OAAOqe,UAAYngB,KAAKyN,MAAM3L,OAAOqe,UAC1C/V,EAAKtI,OAAOse,KAAOpgB,KAAKyN,MAAM3L,OAAOse,KAGrC,IACKlf,OAAO8B,OAAOoH,EAAKkV,UACnBpe,OAAO8B,OAAOoH,GAAMyV,QAAQC,WAAa,CAAA,GAC5C1V,EAAKwV,WACL/K,SAASuC,GAAMA,EAAEiJ,MAAK,CAACC,EAAGxW,KAAOwW,EAAED,MAAQ,IAAMvW,EAAEuW,MAAQ,MAC9D,CAEDE,iBACE,IAAIvQ,EAAoBhQ,KAAKyN,MAAO,CAClC+P,IAAKxd,KAAKmU,SAASqJ,IAAM,GACzBC,KAAMzd,KAAKmU,SAASsJ,MAAQzd,KAAKmU,SAAS/D,MAAQ,KAAO,IACxDtE,QAAO,EACX,CAMD5B,gBACE,MAAME,EAAO9I,MAAMkP,UAYnB,OAVAxQ,KAAKqf,cAAcjV,GAEnBA,EAAKoW,wBAA0BC,WAAWC,WACxC1gB,KAAKsQ,OAAOxO,OAAOqL,QAAQwT,UAC3B,CAAEzW,OAAO,IAEXE,EAAKwW,oBAAsBH,WAAWC,WACpC1gB,KAAKsQ,OAAOxO,OAAOqL,QAAQ0T,MAC3B,CAAE3W,OAAO,IAEJE,CACR,CAEDF,oBACE,MAEMW,EAAe,CAAEsR,QAFP7S,OAAOjE,IAAIoD,WAGrB4T,QAAYpQ,eAChB,GAAG5G,EAAIC,yDACPuF,GAGF,OAAO,IAAI5M,SAASC,IAClB,IAAI0R,OAAO,CACTvF,MAAO,GACP6B,QAASmQ,EACTjN,QAAS,CACPC,GAAI,CACFhG,MAAO7D,KAAKuI,KAAKuB,SAAS,UAC1B9F,KAAM,+BACN+F,SAAWC,IACTtR,EAAQ,CACN4iB,OAAQtR,EAAKuC,KAAK,yBAAyBgB,OAC3C,GAGNpD,OAAQ,CACNnG,KAAM,+BACNH,MAAO7D,KAAKuI,KAAKuB,SAAS,gBAG9BO,QAAS,OACR/D,QAAO,EAAK,GAElB,CAEDiV,UAAU9T,GAER,IAAI8G,EADS/T,KAAKyN,MAAM3L,OACNmL,GAClBjN,KAAKghB,cAAcpiB,MAAMie,IACvB,MAAMtM,EAAOjH,OAAOjE,IAAIoD,UAAUoU,EAAYiE,QAC1C/M,EAAO1V,MACT0V,EAAO1V,MAAM2M,KAAKuF,GAElBwD,EAAS,CAAE1V,MAAO,CAACkS,IAGrB,MAAM0Q,EAAU,CAAA,EAEhB,OADAA,EAAQhU,GAAS8G,EACV/T,KAAKyN,MAAMsG,OAAO,CAAEjS,OAAQmf,GAAU,GAEhD,CAEDC,SAASjU,EAAOkU,GACd,MACMpN,EADO/T,KAAKyN,MAAM3L,OACJmL,GAAO5O,MAAM8P,QAAQyE,GAAOA,GAAMuO,IAChDF,EAAU,CAAA,EAEhB,OADAA,EAAQhU,GAAS,CAAE5O,MAAO0V,GACnB/T,KAAKyN,MAAMsG,OAAO,CAAEjS,OAAQmf,GACpC,CAIDG,iBAAiB7O,GACfA,EAAMuB,iBACN,IAAIgB,EAAsB9U,KAAKyN,MAAO,CACpC+P,IAAKxd,KAAKmU,SAASqJ,IAAM,GACzBC,KAAMzd,KAAKmU,SAASsJ,MAAQzd,KAAKmU,SAAS/D,MAAQ,KAAO,IACxDtE,QAAO,EACX,CAED5B,oBAAoBqI,EAAO2B,GACzB3B,EAAMuB,iBACN,IAAIG,EAAmBjU,KAAKyN,MAAOyG,EAAc,CAC/CsJ,IAAKxd,KAAKmU,SAASqJ,IAAM,GACzBC,KAAMzd,KAAKmU,SAASsJ,MAAQzd,KAAKmU,SAAS/D,MAAQ,KAAO,IACxDtE,QAAO,EACX,CAED5B,yBAAyBqI,GACvB,MACM8J,QAAYpQ,eAChB,GAAG5G,EAAIC,qEAFY,CAAA,GAKrB+b,SAAS5R,cAAc,SAAS6R,OAAOjF,EACxC,CAOD3J,kBAAkBlD,GAChBlO,MAAMoR,kBAAkBlD,GAExBA,EAAKuC,KAAK,oCAAoCY,OAAOxB,IACnD,MAAM6G,EAAchY,KAAKyN,MACnBwK,EAAU9G,EAAGG,eACbc,MAAEA,GAAU6F,EAAQpF,cAAcA,cAAcC,SAChDyO,KAAEA,GAAStJ,EAAQpF,cAAcA,cAAcC,QACjDV,EACF4F,EAAYwJ,UAAUpP,EAAO,CAAEG,MAAOpB,IACpB,OAAToQ,GACTvJ,EAAYyJ,YAAYrP,EAAO,CAAEG,MAAOpB,GACzC,IAGH3B,EAAKuC,KAAK,kCAAkCY,OAAOxB,IACjD,MAAM6G,EAAchY,KAAKyN,MAEnBiU,EADUvQ,EAAGG,cACEuB,cAAcA,cAAcC,QAAQ6O,YACzD3J,EAAY4J,gBAAgBF,EAAM,CAAEnP,MAAOpB,GAAK,IAGlD3B,EAAKuC,KAAK,8BAA8BY,OAAOxB,IAC7CnR,KAAKohB,iBAAiBjQ,EAAG,IAG3B3B,EAAKuC,KAAK,4BAA4BY,OAAOxB,IAC3CnR,KAAK6hB,cAAc1Q,EAAInR,KAAKwQ,UAAU,IAInCxQ,KAAKqB,QAAQqU,WAGlBlG,EAAKuC,KAAK,cAAcY,OAAOxB,IAC7BA,EAAG2C,iBACH,MACM7G,EADSkE,EAAGG,cACGwB,QAAQgP,MAC7B9hB,KAAK+gB,UAAU9T,EAAM,IAGvBuC,EAAKuC,KAAK,aAAaY,OAAOxB,IAC5BA,EAAG2C,iBACH,MACM7G,EADSkE,EAAGG,cACGwB,QAAQgP,MAC7B9hB,KAAKkhB,SAASjU,EAAOoE,EAAEF,EAAGG,eAAeC,QAAQ,SAASnH,KAAK,QAAQ,IAIzEoF,EAAKuC,KAAK,gBAAgBY,OAAMzI,MAAOiH,IACrC,MAAM8E,EAAK5E,EAAEF,EAAGG,eAAeyQ,QAAQ,SACjCvN,EAAOxU,KAAKyN,MAAM3N,MAAMR,IAAI2W,EAAG7L,KAAK,iBACpCoK,EAAKT,OAAO,CAChBjS,OAAQ,CACNM,UAAWoS,EAAK1S,OAAOM,WAEzB,IAGJoN,EAAKuC,KAAK,oCAAoCY,OAAOxB,IACnDnR,KAAKugB,eAAepP,EAAG,IAE1B,iIC5OW,MAAO6Q,GA2BnBtiB,YAAYuiB,GAAc,EAAOta,EAAgB,GAAIua,EAAY,EAAGC,EAAM,eAlB1EC,EAAO5iB,IAAAQ,UAAA,GAEPqiB,EAAQ7iB,IAAAQ,UAAA,GAERsiB,EAAK9iB,IAAAQ,UAAA,GAELuiB,EAAQ/iB,IAAAQ,UAAA,GAERwiB,EAAahjB,IAAAQ,UAAA,GAWXT,EAAAS,KAAIwiB,EAAgBP,EAAW,KAC/B1iB,EAAAS,KAAIoiB,EAAUza,EAAK,KACnBpI,EAAAS,KAAIqiB,EAAWH,EAAS,KACxB3iB,EAAAS,KAAIsiB,EAAQH,EAAG,KACf5iB,EAAAS,KAAIuiB,EAAWzjB,EAAAkB,KAAiBwiB,EAAA,KAC5BR,GAAwBS,cACxBT,GAAwBU,mBAC7B,CAeGC,WACF,OAAO7jB,EAAAkB,KAAiBwiB,EAAA,KACpBR,GAAwBY,cACxBZ,GAAwBa,cAC7B,CAOGC,YACF,OAAOhkB,EAAAkB,KAAiBwiB,EAAA,KACpBxiB,KAAK2iB,KAAO7jB,EAAAkB,KAAYqiB,EAAA,KACxBriB,KAAK2iB,KAAO7jB,EAAAkB,WACjB,CAOG4H,aACF,OAAO9I,EAAAkB,KAAI+iB,EAAA,IAAAC,GAAJ3jB,KAAAW,KACR,CAwBG3B,YACF,MAAMskB,EAAyB,OAAlB7jB,EAAAkB,KAAa+iB,EAAA,IAAAE,GAAYjjB,KAAK8iB,MAAQhkB,EAAAkB,cACnD,OAAOlB,EAAAkB,KAAiBwiB,EAAA,KACpBG,EAAO3iB,KAAK4H,OAAS5H,KAAKmiB,IAC1BQ,EAAO3iB,KAAK4H,OAAS5H,KAAKmiB,GAC/B,CAIG9jB,UAAM6kB,GAAmB,CAOzBf,UACF,OAAOrjB,EAAAkB,KAAIsiB,EAAA,IACZ,CAEGH,QAAIlP,GACN1T,EAAAS,KAAIsiB,EAAQrP,EAAM,IACnB,yGAlFC,eACEkQ,EAAArkB,EAAAkB,KAAWoiB,EAAA,KAACrQ,MAAK,EAAGjQ,QAAUP,WAA4B,WAATA,0BAC7CO,OAAOhD,EAAAkB,aAAc3B,QAAS,CAEtC,EAAC4kB,EAAA,iBAyCC,MAAMtb,EAEL,QAFawb,EAAArkB,EAAAkB,KAAWoiB,EAAA,KAACrQ,MACxB,EAAGjQ,QAAUP,WAA4B,WAATA,WACjC,IAAA4hB,OAAA,EAAAA,EAAErhB,OAAOhD,EAAAkB,KAAYuiB,EAAA,MAAElkB,MAExB,OAAKsJ,GAAmB,IAAVA,EAEP7I,EAAAkB,KAAIwiB,EAAA,KAAgB7a,EAAQ7I,EAAAkB,KAAYqiB,EAAA,KAAG1a,EAAQ7I,EAAAkB,YAFxB,IAGpC,EAzFOkB,OAAAC,eAAA6gB,GAAA,gBAAA,iDAAgB,KAEhB9gB,OAAAC,eAAA6gB,GAAA,iBAAA,iDAAiB,IAEjB9gB,OAAAC,eAAA6gB,GAAA,gBAAA,iDAAgB,QAEhB9gB,OAAAC,eAAA6gB,GAAA,iBAAA,iDAAiB,OCHZ,MAAOoB,GAwBnB1jB,YACEiG,EAAgD,IAAIlG,EACpD4jB,GAA0B,EAC1BV,EAAOS,GAA0BE,0BAxBnCC,EAAU/jB,IAAAQ,UAAA,GAEVwjB,EAAehkB,IAAAQ,UAAA,GAEfyjB,EAAoBjkB,IAAAQ,UAAA,GAEpB0jB,GAAsBlkB,IAAAQ,UAAA,GAEtB2jB,GAAmBnkB,IAAAQ,UAAA,GAEnB4jB,GAAoBpkB,IAAAQ,UAAA,GAEpB6jB,GAAmBrkB,IAAAQ,UAAA,GAejBT,EAAAS,KAAIujB,EAAaZ,EAAI,KACrBpjB,EAAAS,KAAIwjB,EAAkBH,EAAuB,KAC7C9jB,EAAAS,KAA2ByjB,EAAA9d,EAAYhG,aACvCJ,EAAAS,KAA6B0jB,GAAA/d,EAAYpF,gBAGzChB,EAAAS,KAA0B2jB,GAAAhe,EAAY3E,uBACtCzB,EAAAS,KAA2B4jB,GAAAje,EAAY7E,wBACvCvB,EAAAS,KAA0B6jB,GAAAle,EAAYlF,sBACvC,CASGkiB,WAEF,OAAK7jB,EAAAkB,KAAIwjB,EAAA,MAAgD,aAA7B1kB,EAAAkB,KAAwByjB,EAAA,KAG7C3kB,EAAAkB,KAAI8jB,EAAA,IAAAC,IAAJ1kB,KAAAW,MAFElB,EAAAkB,KAAIujB,EAAA,IAGd,CAEGZ,SAAKtkB,GACPkB,EAAAS,KAAIujB,EAAallB,EAAK,IACvB,CAEG2lB,gBACF,OAAOhkB,KAAK2iB,KAAO,CACpB,CAEGsB,eACF,OAAOjkB,KAAK2iB,KAAO,CACpB,oIAxBC,OAAI7jB,EAAAkB,KAA0B0jB,GAAA,KAAS,EACnC5kB,EAAAkB,KAAuB6jB,GAAA,KAA0B,IAAjB/kB,EAAAkB,KAAcujB,EAAA,KAC9CzkB,EAAAkB,KAAwB4jB,GAAA,KAA0B,GAAjB9kB,EAAAkB,KAAcujB,EAAA,KAC5CzkB,EAAAkB,KAAI2jB,GAAA,KAAuC,IAAjB7kB,EAAAkB,KAAcujB,EAAA,KAAUzkB,EAAAkB,WAC3D,EA7COkB,OAAAC,eAAAiiB,GAAA,eAAA,iDAAe,MCcV,MAAOc,GA8JnBxkB,aAAY0G,IAAEA,EAAGC,IAAEA,EAAGE,IAAEA,EAAGD,IAAEA,EAAGE,IAAEA,EAAGC,IAAEA,iBAvBvC0d,GAAsB3kB,IAAAQ,KAAA,CAAE3B,MAAO,EAAG0M,MAAO,IAEzCqZ,GAAsB5kB,IAAAQ,KAAA,CAAE3B,MAAO,EAAG0M,MAAO,IAEzCsZ,GAAsB7kB,IAAAQ,KAAA,CAAE3B,MAAO,EAAG0M,MAAO,IAEzCuZ,GAAsB9kB,IAAAQ,KAAA,CAAE3B,MAAO,EAAG0M,MAAO,IAEzCwZ,GAAsB/kB,IAAAQ,KAAA,CAAE3B,MAAO,EAAG0M,MAAO,IAEzCyZ,GAAsBhlB,IAAAQ,KAAA,CAAE3B,MAAO,EAAG0M,MAAO,IAcvCxL,EAAAS,KAAImkB,GAAQ/d,EAAG,KACf7G,EAAAS,KAAIokB,GAAQ/d,EAAG,KACf9G,EAAAS,KAAIqkB,GAAQ9d,EAAG,KACfhH,EAAAS,KAAIskB,GAAQhe,EAAG,KACf/G,EAAAS,KAAIukB,GAAQ/d,EAAG,KACfjH,EAAAS,KAAIwkB,GAAQ/d,EAAG,IAChB,CAxCDge,sBAAsBxX,EAA+B8F,GACnD,IAAI7F,EACJ,IAAK,IAAI7J,EAAI,EAAGA,GAAK0P,EAAK1P,GAAK,OACZqhB,IAAbzX,EAAM5J,KACR6J,EAASD,EAAM5J,IAGnB,OAAO6J,CACR,CAkCG9G,UACF,MAAO,CACL/H,MAAOS,EAAAkB,KAAImkB,GAAA,KAAM9lB,MACjB0M,MAAOjM,EAAAkB,KAAImkB,GAAA,KAAMpZ,MACjBoX,IAAKrjB,EAAAkB,KAAY2kB,GAAA,IAAAC,IACjBC,IAAK7kB,KAAK8kB,UACV5W,IAAKlO,KAAK+kB,UACVle,GAAI/H,EAAAkB,KAAqB2kB,GAAA,IAAAK,IAE5B,CAEG5e,QAAI6M,GACN1T,EAAAS,uCACKlB,EAAAkB,cACAiT,OAEN,CAUK6R,gBACA,OAAOZ,GAA4Be,eAC/Bf,GAA4BgB,mBAC5BpmB,EAAAkB,KAAImkB,GAAA,KAAM9lB,MAEjB,CAGG0mB,gBACA,OAAOb,GAA4Be,eAC/Bf,GAA4BiB,mBAC5BrmB,EAAAkB,KAAImkB,GAAA,KAAM9lB,MAEjB,CASCgI,UACF,MAAO,CACLhI,MAAOS,EAAAkB,KAAIokB,GAAA,KAAM/lB,MACjB0M,MAAOjM,EAAAkB,KAAIokB,GAAA,KAAMrZ,MACjBoX,IAAKrjB,EAAAkB,KAAY2kB,GAAA,IAAAS,IACjBC,SAAUvmB,EAAAkB,KAAoB2kB,GAAA,IAAAW,IAC9BC,OAAQzmB,EAAAkB,KAA2B2kB,GAAA,IAAAa,IAEtC,CAEGnf,QAAI4M,GACN1T,EAAAS,uCACKlB,EAAAkB,cACAiT,OAEN,CAuBG1M,UACF,MAAO,CACLlI,MAAOS,EAAAkB,KAAIqkB,GAAA,KAAMhmB,MACjB0M,MAAOjM,EAAAkB,KAAIqkB,GAAA,KAAMtZ,MACjBoX,IAAKrjB,EAAAkB,KAAY2kB,GAAA,IAAAc,IAEpB,CAEGlf,QAAI0M,GACN1T,EAAAS,uCACKlB,EAAAkB,cACAiT,OAEN,CASG3M,UACF,MAAO,CACLjI,MAAOS,EAAAkB,KAAIskB,GAAA,KAAMjmB,MACjB0M,MAAOjM,EAAAkB,KAAIskB,GAAA,KAAMvZ,MACjBoX,IAAKrjB,EAAAkB,KAAY2kB,GAAA,IAAAe,IACjBb,IAAI/lB,EAAAkB,KAAe2kB,GAAA,IAAAgB,IACnBC,IAAK9mB,EAAAkB,KAAe2kB,GAAA,IAAAkB,IACpBzF,KAAMthB,EAAAkB,KAAgB2kB,GAAA,IAAAmB,IAEzB,CAEGxf,QAAI2M,GACN1T,EAAAS,uCACKlB,EAAAkB,cACAiT,OAEN,CA8BGzM,UACF,MAAO,CACLnI,MAAOS,EAAAkB,KAAIukB,GAAA,KAAMlmB,MACjB0M,MAAOjM,EAAAkB,KAAIukB,GAAA,KAAMxZ,MACjBoX,IAAKrjB,EAAAkB,KAAY2kB,GAAA,IAAAoB,IAEpB,CAEGvf,QAAIyM,GACN1T,EAAAS,uCACKlB,EAAAkB,cACAiT,OAEN,CASGxM,UACF,MAAO,CACLpI,MAAOS,EAAAkB,KAAIwkB,GAAA,KAAMnmB,MACjB0M,MAAOjM,EAAAkB,KAAIwkB,GAAA,KAAMzZ,MACjBoX,IAAKrjB,EAAAkB,KAAY2kB,GAAA,IAAAqB,IACjBC,QAASnnB,EAAAkB,KAAmB2kB,GAAA,IAAAuB,IAC5BC,OAAQrnB,EAAAkB,KAAkB2kB,GAAA,IAAAyB,IAC1BC,IAAKvnB,EAAAkB,KAAoB2kB,GAAA,IAAA2B,IAE5B,CAEG7f,QAAIwM,GACN1T,EAAAS,uCACKlB,EAAAkB,cACAiT,OAEN,yHA7KC,OAAOiR,GAA4Be,eACjCf,GAA4BqC,sBAC5BznB,EAAAkB,KAAImkB,GAAA,KAAM9lB,MAEd,EAAC2mB,GAAA,WAmBC,OAAOd,GAA4Be,eACjCf,GAA4BsC,aAC5B1nB,EAAAkB,KAAImkB,GAAA,KAAM9lB,MAEd,EAAC+mB,GAAA,WAoBC,OAAOlB,GAA4Be,eACjCf,GAA4BqC,sBAC5BznB,EAAAkB,KAAIokB,GAAA,KAAM/lB,MAEd,EAACinB,GAAA,WAGC,OAAOpB,GAA4Be,eACjCf,GAA4BuC,aAC5B3nB,EAAAkB,KAAIokB,GAAA,KAAM/lB,MAEd,EAACmnB,GAAA,WAGC,OAAOtB,GAA4Be,eACjCf,GAA4BwC,WAC5B5nB,EAAAkB,KAAIokB,GAAA,KAAM/lB,MAEd,EAAConB,GAAA,WAkBC,OAAOvB,GAA4Be,eACjCf,GAA4BqC,sBAC5BznB,EAAAkB,KAAIqkB,GAAA,KAAMhmB,MAEd,EAACqnB,GAAA,WAqBC,OAAOxB,GAA4Be,eACjCf,GAA4BqC,sBAC5BznB,EAAAkB,KAAIskB,GAAA,KAAMjmB,MAEd,EAACsnB,GAAA,WAGC,OAAOzB,GAA4Be,eACjCf,GAA4ByC,cAC5B7nB,EAAAkB,KAAIskB,GAAA,KAAMjmB,MAEd,EAACwnB,GAAA,WAGD,OAAO3B,GAA4Be,eACjCf,GAA4B0C,eAC5B9nB,EAAAkB,KAAIskB,GAAA,KAAMjmB,MAEd,EAACynB,GAAA,WAGG,OAAO5B,GAA4Be,eACjCf,GAA4B2C,oBAC5B/nB,EAAAkB,KAAIskB,GAAA,KAAMjmB,MAEd,EAAC0nB,GAAA,WAkBC,OAAO7B,GAA4Be,eACjCf,GAA4BqC,sBAC5BznB,EAAAkB,KAAIukB,GAAA,KAAMlmB,MAEd,EAAC2nB,GAAA,WAqBC,OAAO9B,GAA4Be,eACjCf,GAA4BqC,sBAC5BznB,EAAAkB,KAAIwkB,GAAA,KAAMnmB,MAEd,EAACioB,GAAA,WAGC,OAAOpC,GAA4Be,eACjCf,GAA4B2C,oBAC5B/nB,EAAAkB,KAAIwkB,GAAA,KAAMnmB,MAEd,EAAC+nB,GAAA,WAGC,OAAOtnB,EAAAkB,KAAY2kB,GAAA,IAAAqB,IAAG,CACxB,EAACE,GAAA,WAGC,OAAOpnB,EAAAkB,KAAY2kB,GAAA,IAAAqB,IAAG,CACxB,EA/WO9kB,OAAAC,eAAA+iB,GAAA,wBAAA,2CAAwB7lB,MAAA,CAC7B,GAAI,EACJ,GAAI,EACJ,GAAI,EACJ,GAAI,EACJ,EAAG,EACH,GAAI,EACJ,GAAI,EACJ,GAAI,KAKD6C,OAAAC,eAAA+iB,GAAA,qBAAA,2CAAqB7lB,MAAA,CACxB,GAAI,EACJ,GAAI,EACJ,GAAI,EACJ,EAAG,EACH,GAAI,EACJ,GAAI,EACJ,GAAI,KAGC6C,OAAAC,eAAA+iB,GAAA,qBAAA,2CAAqB7lB,MAAA,CAC1B,GAAI,EACJ,GAAI,EACJ,GAAI,EACJ,EAAG,EACH,GAAI,EACJ,GAAI,KAGC6C,OAAAC,eAAA+iB,GAAA,gBAAA,2CAAgB7lB,MAAA,CACrB,GAAI,EACJ,GAAI,EACJ,GAAI,EACJ,EAAG,EACH,GAAI,EACJ,GAAI,EACJ,GAAI,KAGC6C,OAAAC,eAAA+iB,GAAA,iBAAA,2CAAiB7lB,MAAA,CACtB,GAAI,EACJ,GAAI,EACJ,GAAI,EACJ,EAAG,EACH,GAAI,EACJ,GAAI,KAaC6C,OAAAC,eAAA+iB,GAAA,sBAAA,2CAAsB7lB,MAAA,CAC3B,GAAI,EACJ,GAAI,EACJ,GAAI,EACJ,GAAI,EACJ,EAAG,EACH,GAAI,EACJ,GAAI,EACJ,GAAI,KAQC6C,OAAAC,eAAA+iB,GAAA,eAAA,2CAAe7lB,MAAA,CACpB,EAAG,EACH,EAAG,EACH,EAAG,EACH,GAAI,EACJ,GAAI,EACJ,GAAI,KAQC6C,OAAAC,eAAA+iB,GAAA,eAAA,2CAAe7lB,MAAA,CACpB,EAAG,GACH,EAAG,iBACH,EAAG,oBACH,EAAG,kBAQE6C,OAAAC,eAAA+iB,GAAA,aAAA,2CAAa7lB,MAAA,CAClB,EAAG,mBACH,EAAG,aACH,GAAI,kBACJ,GAAI,kBACJ,GAAI,qBC1HM,MAAOyoB,GAOnBpnB,YACEyjB,EAIArD,UAJA3f,QACEA,GAEoDgjB,EADjD4D,EnBCF,SAAgBhd,EAAGvL,GACtB,IAAIwoB,EAAI,CAAA,EACR,IAAK,IAAInd,KAAKE,EAAO7I,OAAO+lB,UAAUC,eAAe7nB,KAAK0K,EAAGF,IAAMrL,EAAE2oB,QAAQtd,GAAK,IAC9Emd,EAAEnd,GAAKE,EAAEF,IACb,GAAS,MAALE,GAAqD,mBAAjC7I,OAAOkmB,sBACtB,KAAI/jB,EAAI,EAAb,IAAgBwG,EAAI3I,OAAOkmB,sBAAsBrd,GAAI1G,EAAIwG,EAAEwE,OAAQhL,IAC3D7E,EAAE2oB,QAAQtd,EAAExG,IAAM,GAAKnC,OAAO+lB,UAAUI,qBAAqBhoB,KAAK0K,EAAGF,EAAExG,MACvE2jB,EAAEnd,EAAExG,IAAM0G,EAAEF,EAAExG,IAF4B,CAItD,OAAO2jB,CACX,CmBXiBM,CAAAnE,EAFb,kBAIA,IAAArD,IAAAA,EAAsB,iBAXxByH,GAAA/nB,IAAAQ,KAAS,CAAA,GAETwnB,GAAAhoB,IAAAQ,KAAqB,IAErBynB,GAAkBjoB,IAAAQ,UAAA,GAShBT,EAAAS,KAAIwnB,GAAc1H,EAAS,KAC3BvgB,EAAAS,KAAgBynB,GAAAtnB,IAAW,OAE3B,MAAMunB,GAA6B,UAAjB5oB,EAAAkB,oBAAiB,IAAA2nB,OAAA,EAAAA,EAAA/lB,OAAO9C,EAAAkB,KAAsB4nB,GAAA,IAAAC,IAAE,CAAE,KAAK,CAAA,EAEzEtoB,EAAAS,KAAcunB,GAAArmB,OAAO4mB,KAAKf,GAAY,IAAInlB,QACxC,CAACwP,EAAMoD,EAAMuT,IACXjpB,EAAAkB,KAAqB4nB,GAAA,IAAAI,IAAA3oB,KAArBW,KAAsBoR,EAAMoD,EAAMuT,EAAKL,EAAWX,IACpD,CAAA,OAEH,CAEG5mB,cACF,OAAOrB,EAAAkB,KAAIynB,GAAA,IACZ,CAEGtnB,YAAQnB,GACVO,EAAAS,KAAIynB,GAAYzoB,EAAK,IACtB,CAEG8gB,gBACF,OAAOhhB,EAAAkB,KAAewnB,GAAA,KAAC5lB,QACrB,CAACwP,EAAMoD,IAnDS,EAACpD,EAAcoD,KACnC,MAAMgI,IAAEA,GAAQhI,EAAK1S,OACfmmB,EAAc7W,EAAKoL,IAAQ,GACjC,OAAAtb,OAAAgnB,OAAAhnB,OAAAgnB,OAAA,CAAA,EACK9W,GAAI,CACPoL,CAACA,GAAM,IAAIyL,EAAazT,GAAM6L,MAAK,CAACC,EAAGxW,IAAMwW,EAAE/P,KAAK4X,cAAcre,EAAEyG,SACpE,EA6CkB6X,CAAchX,EAAMoD,IACpC,CAAE,EAEL,CAiCGuL,YACF,OAAOjhB,EAAAkB,KAAIunB,GAAA,IACZ,EAhCiBA,GAAA,IAAAc,QAAAb,GAAA,IAAAa,QAAAZ,GAAA,IAAAY,QAAAT,GAAA,IAAAU,QAAAT,GAAA,SAAAzW,EAA+BoD,GAC/C,MAAMgI,IAAEA,GAAQhI,EAAK1S,OACrB,IAAIymB,KAAEA,GAAS/T,EAAK1S,OAChB0mB,OAAOC,MAAMF,KAAOA,EAAO,GAC/B,MAAMG,EAAYtX,EAAKoL,IAAQ,EAC/B,OACKtb,OAAAgnB,OAAAhnB,OAAAgnB,OAAA,CAAA,EAAA9W,IACHoL,CAACA,GAAMkM,EAAYH,GAEvB,EAACP,GAAA,SAIC5W,EACAoD,EACAuT,EACAL,EACAX,SAEA,GAAa,YAATvS,EAAoB,OAAOpD,EAC/B,MAAMuX,EAAKZ,EAAM,EACXnoB,GAAoB,QAAdujB,EAAA4D,EAAS4B,UAAK,IAAAxF,OAAA,EAAAA,EAAAvjB,MAAO,EAC3BgpB,EAAOlB,EAAUiB,GAEvB,OACKznB,OAAAgnB,OAAAhnB,OAAAgnB,OAAA,CAAA,EAAA9W,GACH,CAAAuX,CAACA,GAAK,CAAEC,OAAMhpB,QAElB,EC7FF,MAAMipB,GAAwB,CAACpb,EAAOqb,EAAYC,EAAW,OAC3Dtb,EAAM3N,MACHqO,QAAO,EAAG5M,UAAWA,IAASunB,IAC9B3a,OAAO4a,GAAQ,MAAW,IAEhB,MAAMC,WAA8BvY,QAAQwY,SAASC,UAClEC,qBACEnpB,KAAKmG,OAAS,IAAI+d,GAA4BlkB,KAAKmG,QAGnDnG,KAAK2F,YAAc,IAAI2D,OAAOjE,IAAIM,YAChC3F,KAAK2F,YAAY/F,IACjB,IAAII,KAAKwb,OAAO1b,OAChB,CACE6B,oBAAqB6D,KAAKI,SAAStG,IACjCkG,KAAK1D,OAAO2D,GACZ,uBAEFU,OAAQnG,KAAKmG,SAIjBnG,KAAKopB,SAAW,IAAIhG,GAClBpjB,KAAK2F,YACL3F,KAAK8K,OAAOue,aACZrpB,KAAKopB,SAASzG,MAKhB3iB,KAAKsN,GAAK,IAAI0U,IACZ,EACA,IACK6G,GACD7oB,KAAKwb,OACL,SACC8E,GAAMA,EAAExe,OAAOM,YAGpBpC,KAAKmG,OAAOG,IAAIsf,IAChB5lB,KAAKsN,GAAG6U,KAGVniB,KAAK4N,IAAM,IAAIoU,IACb,EACA6G,GAAsB7oB,KAAKwb,OAAQ,SAAU8E,GAAMA,EAAExe,OAAOM,WAC5DpC,KAAKmG,OAAOG,IAAIsf,IAChB5lB,KAAK4N,IAAIuU,KAGXniB,KAAK6f,OAAS,IAAIiH,GAA4B9mB,KAAK6f,OAAQ7f,MAAK8f,EACjE,CAGD2E,sBACE,MAAM6E,YAAEA,EAAWC,YAAEA,EAAWC,aAAEA,EAAYC,YAAEA,EAAWC,YAAEA,GAC3DjZ,QAAQrG,KAAKuf,OAEf,MAAO,CACL9J,OAAQ,IAAI4J,EACZtjB,OAAQ,IAAIsjB,EACZtc,QAAS,IAAIsc,EACbnc,GAAI,IAAImc,EACR7b,IAAK,IAAI6b,EACT9jB,YAAa,IAAI8jB,EACjBL,SAAU,IAAIK,EACd3e,OAAQ,IAAI2e,EACZ7T,WAAY,IAAI6T,EAChBG,GAAI,IAAIF,EAAY,CAClBG,GAAI,IAAIP,EACRjrB,MAAO,IAAIkrB,EAAY,CAAEO,SAAS,IAClClqB,IAAK,IAAI2pB,EAAY,CAAEO,SAAS,MAElCzc,MAAO,IAAIoc,EACXhhB,UAAW,IAAIghB,EACfM,MAAO,IAAIL,EAAY,CACrBliB,OAAQ,IAAIkiB,EAAY,CAAErrB,MAAO,IAAIkrB,EAAY,CAAEO,SAAS,MAC5DziB,MAAO,IAAIqiB,EAAY,CAAErrB,MAAO,IAAIkrB,EAAY,CAAEO,SAAS,MAC3DviB,UAAW,IAAImiB,EAAY,CACzBrrB,MAAO,IAAIkrB,EAAY,CAAEO,SAAS,MAEpCriB,MAAO,IAAIiiB,EAAY,CAAErrB,MAAO,IAAIkrB,EAAY,CAAEO,SAAS,MAC3DxiB,KAAM,IAAIoiB,EAAY,CAAErrB,MAAO,IAAIkrB,EAAY,CAAEO,SAAS,QAE5DnI,YAAa,IAAI+H,EAAY,CAC3BM,GAAI,IAAIT,EAAY,CAAEO,SAAS,EAAMG,UAAU,IAC/CrjB,GAAI,IAAI2iB,EAAY,CAAEO,SAAS,EAAMG,UAAU,IAC/CpjB,GAAI,IAAI0iB,EAAY,CAAEO,SAAS,EAAMG,UAAU,IAC/CnjB,GAAI,IAAIyiB,EAAY,CAAEO,SAAS,EAAMG,UAAU,MAEjDC,SAAU,IAAIR,EAAY,CACxBvpB,QAAS,IAAIqpB,EACbvD,QAAS,IAAIsD,EAAY,CAAEO,SAAS,IACpCK,KAAM,IAAIb,IAGf,CAKGrJ,sBACF,OAAOza,KAAKI,SAAStG,IAAIkG,KAAK1D,OAAO2D,GAAI,cAC1C,CAEGya,eACF,MAAMkK,EAAiBpqB,KAAKigB,iBAAkBjgB,KAAKqN,MAAMgd,KAAW,EACpE,OACGrqB,KAAKmG,OAAOC,KAAK+b,KAAO,IACxBniB,KAAKqN,OAAO8U,KAAKxZ,OAAS,GAC3ByhB,CAEH,CAEGjK,gBACF,MAAMiK,EAAiBpqB,KAAKigB,iBAAkBjgB,KAAKqN,MAAMgd,KAAW,EACpE,OACGrqB,KAAKmG,OAAOG,KAAK6b,KAAO,IACxBniB,KAAKqN,OAAO8U,KAAKvZ,SAAW,GAC7BwhB,CAEH,CAEGvU,YACF,MAAMzP,IAAEA,EAAGC,IAAEA,EAAGE,IAAEA,EAAGD,IAAEA,EAAGE,IAAEA,EAAGC,IAAEA,GAAQzG,KAAKmG,OAC9C,OAAQ,CAACC,EAAKC,EAAKE,EAAKD,EAAKE,EAAKC,GAAK7E,QACrC,CAACC,EAAK+Q,IAAO/Q,EAAM+Q,EAAGvU,OACtB,EAEH,CAEGqhB,iBACF,OAAOmJ,GACL7oB,KAAKwb,OACL,aACA,EAAG1Z,QAAUmV,mBAAqBA,GAErC,CAEGwI,gBACF,OAAOoJ,GACL7oB,KAAKwb,OACL,QACA,EAAG1Z,QAAUC,WAAUkV,kBAAoBlV,IAAakV,GAE3D,CAEG0I,sBACF,MAAM9S,EAAQ7M,KAAKyf,UAAU7d,QAC3B,CAACC,GAAOC,QAAUE,WAAU2R,WAAa9R,EAAMG,EAAS3D,MAAQsV,GAChE,GAEF,OAAOtT,KAAK4R,MAAc,IAARpF,GAAe,GAClC,CAEG/M,YACF,OAAO+oB,GACL7oB,KAAKwb,OACL,QACA,EAAG1Z,QAAUC,WAAUkV,mBAAqBlV,IAAakV,GAE5D,CAEGuI,cACF,OAAOqJ,GACL7oB,KAAKwb,OACL,UACA,EAAG1Z,QAAUmV,mBAAqBA,GAErC,CAEGtP,YACF,OAAOkhB,GACL7oB,KAAKwb,OACL,SACA,EAAG1Z,QAAUmV,mBAAqBA,GAErC,CAEG2I,gBACF,OAAOiJ,GACL7oB,KAAKwb,OACL,WACA,EAAG1Z,QAAUmV,mBAAqBA,IAClCoJ,MAAK,CAACC,EAAGxW,KAAOwW,EAAED,MAAQ,IAAMvW,EAAEuW,MAAQ,IAC7C,CAEGP,QACF,OAAO+I,GACL7oB,KAAKwb,OACL,SACA,EAAG1Z,QAAUmV,mBAAqBA,GAErC,CAEGqT,aACF,OAA+B,IAAxBtqB,KAAKwf,QAAQnR,QAEhBrO,KAAKwf,QAAQ+K,OACV/V,KAEiB,WAAdA,EAAKjT,OACJiT,EAAK1S,OAAO+G,OACZ2L,EAAK1S,OAAOM,WAGxB,CAGGge,WAGF,MAFkE,UAApD5a,KAAKI,SAAStG,IAAIkG,KAAK1D,OAAO2D,GAAI,eAG3CzF,KAAK4V,WAAWvX,OAAS,IACvB2B,KAAK4V,WAAWuM,KAAO,GACxBniB,KAAKmG,OAAOG,IAAI8Z,KAClB,CACL,ECzNH,MAAMyI,GAAwB,CAACpb,EAAOqb,EAAYC,EAAW,OAC3Dtb,EAAM3N,MACHqO,QAAO,EAAG5M,UAAWA,IAASunB,IAC9B3a,OAAO4a,GAAQ,MAAW,IAEhB,MAAMyB,WAA4B/Z,QAAQwY,SAASC,UAChEC,qBACEnpB,KAAK2F,YAAc,IAAIpC,EACvBvD,KAAK6f,OAAS,IAAIiH,GAA4B9mB,KAAK6f,OAAQ7f,MAAK8f,GAChE9f,KAAKopB,SAAW,IAAIhG,GAClBpjB,KAAK2F,YACL3F,KAAK8K,OAAOue,cAAe,EAC3BrpB,KAAKopB,SAASzG,KAEjB,CAGD8B,sBACE,MAAM6E,YAAEA,EAAWC,YAAEA,EAAWC,aAAEA,EAAYC,YAAEA,EAAWC,YAAEA,GAC3DjZ,QAAQrG,KAAKuf,OAEf,MAAO,CACL9J,OAAQ,IAAI4J,EACZtc,QAAS,IAAIsc,EACbnc,GAAI,IAAImc,EACR7b,IAAK,IAAI6b,EACT9jB,YAAa,IAAI+jB,EAAY,CAC3BrrB,MAAO,IAAIkrB,EAAY,CAAEO,SAAS,IAClClqB,IAAK,IAAI2pB,EAAY,CAAEO,SAAS,MAElCV,SAAU,IAAIK,EACd3e,OAAQ,IAAI2e,EACZ7T,WAAY,IAAI6T,EAChBG,GAAI,IAAIF,EAAY,CAClBG,GAAI,IAAIP,EACRjrB,MAAO,IAAIkrB,EAAY,CAAEO,SAAS,IAClClqB,IAAK,IAAI2pB,EAAY,CAAEO,SAAS,MAElCzc,MAAO,IAAIoc,EACXhhB,UAAW,IAAIghB,EACfM,MAAO,IAAIL,EAAY,CACrBliB,OAAQ,IAAIkiB,EAAY,CAAErrB,MAAO,IAAIkrB,EAAY,CAAEO,SAAS,MAC5DziB,MAAO,IAAIqiB,EAAY,CAAErrB,MAAO,IAAIkrB,EAAY,CAAEO,SAAS,MAC3DviB,UAAW,IAAImiB,EAAY,CACzBrrB,MAAO,IAAIkrB,EAAY,CAAEO,SAAS,MAEpCriB,MAAO,IAAIiiB,EAAY,CAAErrB,MAAO,IAAIkrB,EAAY,CAAEO,SAAS,MAC3DxiB,KAAM,IAAIoiB,EAAY,CAAErrB,MAAO,IAAIkrB,EAAY,CAAEO,SAAS,QAE5DI,SAAU,IAAIR,EAAY,CACxBvpB,QAAS,IAAIqpB,EACbvD,QAAS,IAAIsD,EAAY,CAAEO,SAAS,IACpCK,KAAM,IAAIb,IAGf,CAKGrJ,sBACF,OAAOza,KAAKI,SAAStG,IAAIkG,KAAK1D,OAAO2D,GAAI,cAC1C,CAEGoQ,YACF,OAAQ3U,OAAO8B,OAAOhD,KAAK+pB,OAAOnoB,QAChC,CAAC6oB,EAAMC,IAASD,GAAQjT,SAASkT,GAAMrsB,MAAO,KAAO,IACrD,EAEH,CAEGqhB,iBACF,OAAOmJ,GACL7oB,KAAKwb,OACL,aACA,EAAG1Z,QAAUmV,mBAAqBA,GAErC,CAEGwI,gBACF,OAAOoJ,GACL7oB,KAAKwb,OACL,QACA,EAAG1Z,QAAUC,WAAUkV,kBAAoBlV,IAAakV,IACxDoJ,MAAK,CAACC,EAAGxW,IAAMwW,EAAE/P,KAAK4X,cAAcre,EAAEyG,OACzC,CAEGzQ,YACF,OAAO+oB,GACL7oB,KAAKwb,OACL,QACA,EAAG1Z,QAAUC,WAAUkV,mBAAqBlV,IAAakV,IACzDoJ,MAAK,CAACC,EAAGxW,IAAMwW,EAAE/P,KAAK4X,cAAcre,EAAEyG,OACzC,CAEGiP,cACF,OAAOqJ,GACL7oB,KAAKwb,OACL,UACA,EAAG1Z,QAAUmV,mBAAqBA,IAClCoJ,MAAK,CAACC,EAAGxW,IAAMwW,EAAE/P,KAAK4X,cAAcre,EAAEyG,OACzC,CAEG5I,YACF,OAAOkhB,GACL7oB,KAAKwb,OACL,SACA,EAAG1Z,QAAUmV,mBAAqBA,IAClCoJ,MAAK,CAACC,EAAGxW,IAAMwW,EAAE/P,KAAK4X,cAAcre,EAAEyG,OACzC,CAEGqP,gBACF,OAAOiJ,GACL7oB,KAAKwb,OACL,WACA,EAAG1Z,QAAUmV,mBAAqBA,IAClCoJ,MAAK,CAACC,EAAGxW,KAAOwW,EAAED,MAAQ,IAAMvW,EAAEuW,MAAQ,IAC7C,CAEGsK,qBACF,MAAO,IAAI3qB,KAAKwf,WAAYxf,KAAK4f,WAC9BS,MAAK,CAACC,EAAGxW,IAEe,gBAArBwW,EAAExe,OAAO8oB,SACY,gBAArB9gB,EAAEhI,OAAO8oB,SAED,EACH9gB,EAAEvI,KAAK4mB,cAAc7H,EAAE/e,OAAS+e,EAAE/P,KAAK4X,cAAcre,EAAEyG,QAE/D3O,QAAO,CAAC6oB,EAAMC,KACb,MAAMG,EAAU,IAAKJ,IACfG,QAAEA,GAAYF,EAAK5oB,OAEzB,OADK+oB,EAAQD,KAAUC,EAAQD,GAAW,IACnC,IAAKC,EAASD,CAACA,GAAU,IAAIC,EAAQD,GAAUF,GAAO,GAC5D,CAAE,EACR,CAEG5K,QACF,OAAO+I,GACL7oB,KAAKwb,OACL,SACA,EAAG1Z,QAAUmV,mBAAqBA,GAErC,CAEGqT,aACF,OAA+B,IAAxBtqB,KAAKwf,QAAQnR,QAEhBrO,KAAKwf,QAAQ+K,OACV/V,KAAyB,WAAdA,EAAKjT,OAAsBiT,EAAK1S,OAAO+G,OAE1D,CAEGuX,WAGF,MAFkE,UAApD5a,KAAKI,SAAStG,IAAIkG,KAAK1D,OAAO2D,GAAI,cAEjCzF,KAAK4V,WAAWuM,IAAM,CACtC,EC5JY,MAAM2I,WAAgBlQ,KAExBmQ,0BACT,MAAO,CACLtjB,MAAO,GAAGpC,EAAIK,+BACdslB,QAAS,GAAG3lB,EAAIK,iCAChBiC,MAAO,GAAGtC,EAAIK,+BACdulB,OAAQ,GAAG5lB,EAAIK,gCACf8O,KAAM,GAAGnP,EAAIK,8BACb0V,UAAW,GAAG/V,EAAIK,6BAErB,CAED+e,oBAAoBra,EAAM8gB,EAAU,IAIlC,YAHiBxG,IAAbta,EAAKsJ,MACPtJ,EAAKsJ,IAAM1T,KAAK+qB,aAAa3gB,EAAK7I,OAE7BD,MAAMgL,OAAOlC,EAAM8gB,EAC3B,CAEDzG,mBAAmBlM,GAgBjB,MAfoB,KAAhBA,GAAQ7E,KAAc6E,EAAOhX,OAC/BgX,EAAO7E,IAAM1T,KAAK+qB,aAAaxS,EAAOhX,YAENmjB,IAA9BnM,GAAQzW,QAAQwC,aAEfiU,GAAQzW,QAAQ4G,MAAQ,IAAItF,MAC1B+nB,GAAsB,eAAdA,EAAI9sB,SAEE,WAAjBka,GAAQhX,OAERgX,EAAOzW,OAAOwC,UAAY,GACC,UAAzBiU,GAAQzW,QAAQP,MAAoC,UAAhBgX,EAAOhX,OAC7CgX,EAAOzW,OAAOwC,UAAY,IAGvBiU,CACR,CAED6S,cACE9pB,MAAM8pB,aACP,CAEDlhB,2BAEElK,KAAK8B,OAAOupB,0BAA4B5K,WAAWC,WACjD1gB,KAAK8B,OAAOqL,SAASme,aAAetrB,KAAK8B,OAAOwpB,YAChD,CAAEphB,OAAO,GAEZ,CAEDua,qBAAqBjV,GACnBA,EAAK+b,GAAG,QAAS,uBAAwBvrB,KAAKwrB,kBAAkB7M,KAAK3e,OACrEwP,EAAK+b,GAAG,QAAS,aAAcvrB,KAAKyrB,yBAAyB9M,KAAK3e,MACnE,CAEDkK,kBAAkBwhB,GAChB,MAAMC,EAAW3rB,KAAKuB,KAEhBkS,EAAWzT,KAAK8B,OAGhB8pB,EAAQ,GAkBd,MAhBiB,WAAbD,GACFlY,EAAS/K,KAAKmM,SAASmS,GAAM4E,EAAM5gB,KAAKgc,EAAE3oB,SAE3B,UAAbstB,GACFC,EAAM5gB,KACJ,GAAGyI,EAASmK,SAASnK,EAAS+I,MAC9B/I,EAASoY,MACTpY,EAASqY,UAGTrY,EAASyT,eAAe,aAC1B0E,EAAM5gB,KAAKyI,EAASrR,SAAW,WAAa,gBAI9CqR,EAASsY,WAAaH,EAAMzd,QAAQtE,KAAQA,IACrC4J,CACR,CAEDoE,WAAWxW,EAAU,IACnB,MAAM2qB,EAA2B,aAAnBhsB,KAAKyN,MAAMlM,KAEnBkS,EAAWzT,KAAK8B,OAEtB,IAAIP,EAAOyqB,EAAQ,SAAW,QAC9B,MAAM9c,EAAW,CACfsF,KAAMxU,KAAKisB,QACXxe,MAAOzN,KAAKyN,MACZxC,KAAM,CACJiN,KAAMzE,EAASyE,KACftL,OAAQ,OAIZ,OAAI6G,EAAS7K,SAAW6K,EAAS9K,QAAUqjB,GAEzC,IAAIpc,OAAO,CACTvF,MAAO,sBACP6B,QAAS,GACTkD,QAAS,CACPzG,MAAO,CACLa,KAAM,qCACNH,MAAO,QACPkG,SAAU,KACRvP,KAAKyN,MAAM4K,aAAanJ,EAAU,QAAS7N,EAAQ,GAGvDuH,QAAS,CACPY,KAAM,kCACNH,MAAO,UACPkG,SAAU,KACRvP,KAAKyN,MAAM4K,aAAanJ,EAAU,UAAW7N,EAAQ,IAI3DwO,QAAS,UACR/D,QAAO,IACH,IAEL2H,EAAS7K,UAAYojB,IACvBzqB,EAAO,WAETvB,KAAKyN,MAAM4K,aAAanJ,EAAU3N,EAAMF,IACjC,EACR,CAED6I,kBAAkB7I,EAAU,IAC1B,MAAMoS,EAAWzT,KAAK8B,OAEtB,IAAK2R,EAASxI,KACZ,MAAM,IAAIyN,MAAM,8CAGlB,MAAMrP,EAAQ,GAAGrJ,KAAKuQ,OAChB8B,EAAY,CAACoB,EAASxI,MAEtB1J,EAAOkS,EAASyY,SAEhBhd,EAAW,CACfzB,MAAOzN,KAAKyN,MACZ+G,KAAMxU,KAAKisB,QACXX,YAAa,KACbpT,KAAMzE,EAASyE,KACf6T,WAAY/rB,KAAK8B,OAAOqqB,SACxBlhB,KAAM,CACJ1J,OACAqL,OAAQ6G,EAAS2Y,WACjB9gB,UAAWmI,EAASnI,YASxB,MALkB,UAAdtL,KAAKuB,OACP2N,EAASoc,YAAc7X,EAAS6X,aAI3BrhB,EAAQiB,KAAK,CAClBqH,MAAOlR,EAAQkR,MACfpI,MAAOkI,EACPjI,KAAM8E,EACNN,YAAY,EACZrE,QAASkB,YAAY+G,WAAW,CAAE/E,MAAOzN,OACzCsK,OAAQ9E,KAAKuI,KAAKC,OAAO,mBAAoB,CAAE3E,UAC/CgB,MAAO7E,KAAKuI,KAAKC,OAAO,mBAAoB,CAAE3E,WAEjD,CAEDa,mBACE,GAAkB,UAAdlK,KAAKuB,KACP,MAAM,IAAImX,MACR,2DAGJ,MAAMjF,EAAWzT,KAAK8B,aAChB9B,KAAK+T,OAAO,CAChBjS,OAAQ,CACNymB,KAAM9U,EAAS8U,KAAO,KAItB9U,EAASxI,WACLjL,KAAK+X,oBAEL/X,KAAK+W,KAAK,CAAEnI,YAAY,GAEjC,CAEDyd,YAAYjiB,GACV,GAAIA,EAAKa,KAAM,CACb,MAAMA,EAAO,GAAGb,EAAKa,OAAOb,EAAKgiB,WAAa9iB,OAAOjE,IAAI4B,UAAUmD,EAAK8hB,UAAY,KAC/E9hB,EAAKgiB,WAAahiB,EAAKgiB,WAAa,KACzC,MAAO,CACL/iB,MAAO,GAAG7D,KAAKuI,KAAKuB,SAAS,qBAAqBrE,IAErD,CACF,CAEDqhB,YAAYliB,GACV,GAAIA,EAAK8N,KACP,MAAO,CACL7O,MAAOC,OAAOjE,IAAIqC,WAAW0C,EAAK8N,MAClC1O,KAAM,WAGX,CAED+iB,iBACE,MAAMC,EAAU,GACVpiB,EAAOpK,KAAK8B,OAGlB,OAFiB9B,KAAKuB,MAGpB,IAAK,YACL,IAAK,OACH,MAGF,IAAK,SACHirB,EAAQxhB,KAAK,CAAE3B,MAAOe,EAAKqiB,OAAQjjB,KAAM,YACrCY,EAAKxB,SACP4jB,EAAQxhB,KAAK,CACX3B,MAAO,GAAGe,EAAKyhB,MAAMa,SAAStiB,EAAKyhB,MAAMc,UAAUviB,EAAKyhB,MAAMe,OAC9DpjB,KAAM,gBAKVY,EAAK1B,KAAKmM,SAASmS,IACjBwF,EAAQxhB,KAAK,CAAE3B,MAAO2d,EAAE3oB,OAAQ,IAElC,MAGF,IAAK,QACHmuB,EAAQxhB,KAAK,CAAE3B,MAAOC,OAAOjE,IAAIsC,MAAMyC,EAAK7I,MAAOiI,KAAM,cACzD,MAGF,IAAK,QACHgjB,EAAQxhB,KACN,CAAE3B,MAAOe,EAAKwT,OACd,CAAEvU,MAAOe,EAAKyhB,OACd,CAAExiB,MAAOe,EAAK0hB,WAEhB,MAGF,IAAK,UACU1hB,EAAKyiB,aAAalQ,MAAM,KAChC9H,SAASiY,GAAQN,EAAQxhB,KAAK,CAAE3B,MAAOyjB,MAC5C,MAIJ,MAAMC,EAAU/sB,KAAKqsB,YAAYjiB,GAC7B2iB,GACFP,EAAQxhB,KAAK+hB,GAGf,MAAMC,EAAUhtB,KAAKssB,YAAYliB,GAKjC,OAJI4iB,GACFR,EAAQxhB,KAAKgiB,GAGRR,CACR,CAEDS,cAAcjqB,GACZ,MAAMoH,EAAOpK,MAAM8B,OACnB,IAAIiS,EAAS,GACT3J,EAAK1B,OACPqL,EAAS3J,EAAK1B,MAEhB,MAAMuY,EAAU,CAAA,EACViM,EAAS,cAqCf,OApCInZ,EACF/Q,EAAO6R,SAAS9B,IAEd,MAAMoa,EAAUD,EAAOE,KAAKra,GAC5B,IAAI1I,EAAQ,GASZ,OARI8iB,GACF9iB,EAAQ8iB,EAAQ,GAChBpa,EAAMA,EAAIsa,MAAM,EAAGhtB,KAAKT,IAAI,EAAGutB,EAAQG,QAAQC,QAG/CljB,EADA0I,EAAMA,EAAIwa,OAIJxa,GACN,KAAKzJ,OAAOjE,IAAIqD,KAAKC,MACnBsY,EAAQtY,OAAQ,EAChB,MAGF,KAAKW,OAAOjE,IAAIqD,KAAKG,KACnBoY,EAAQpY,MAAO,EACf,MAGF,KAAKS,OAAOjE,IAAIqD,KAAKE,QACnBqY,EAAQrY,SAAU,EAIjBqY,EAAQtY,OAAUsY,EAAQpY,MAASoY,EAAQrY,SAC9CmL,EAAO/I,KAAK,CAAEX,QAAOhM,MAAO0U,EAAK1J,MAAO0J,GAAM,IAGlDgB,EAAS/Q,EAEXie,EAAQvY,KAAOqL,EACR/T,KAAK+T,OAAO,CAAEjS,OAAQmf,GAC9B,CAEDuM,aAAanvB,GACX,MAAMoV,EAAWzT,KAAK8B,QAEhB4G,KAAEA,GAAS+K,EACjB,IAAK/K,EAAM,OAEX,MACMuY,EAAU,CACdvY,KAFaA,EAAKyF,QAAQyE,GAAOA,EAAGvU,OAASA,KAI/C,OAAO2B,KAAK+T,OAAO,CAAEjS,OAAQmf,GAC9B,CAEDhW,KAAK5J,EAAU,IACb,MAAMoS,EAAWzT,KAAK8B,OACtB,OAAQ9B,KAAKuB,MACX,IAAK,SACHvB,KAAK6X,WAAWxW,GAChB,MAGF,IAAK,QACHrB,KAAK8X,WAAWzW,GAChB,MAGF,IAAK,UACCoS,EAASxI,KACXjL,KAAK+X,cAEL/X,KAAK+W,OAEP,MAGF,IAAK,OACL,IAAK,QACH/W,KAAK+W,OAGV,CAOD7M,aACE,MAAMyhB,EAAW3rB,KAAKuB,MAEhBiY,MAAEA,GAAUxZ,KAAKyN,MACjB5C,EAAe,CACnB4C,MAAOzN,KAAKyN,MACZ8L,QAASC,EAAQ,GAAGA,EAAMgC,OAAO/V,MAAM+T,EAAM/T,KAAO,KACpD+O,KAAMxU,KAAKisB,QACX/V,OAAQlW,KAAKisB,QAAQxmB,GACrB2E,WAAYpK,KAAKytB,cACjBC,OAAQ1tB,KAAK0tB,OACbC,UAAW3tB,KAAK2tB,UAChBC,UAAW5tB,KAAK4tB,UAChBC,QAAsB,UAAblC,EACTmC,QAAS9tB,KAAK8tB,QACdhjB,OAAQxB,OAAOjE,KAEjBwF,EAAakN,YAAc,IAAI7M,KAAKL,EAAaT,KAAKa,KAAMJ,GAAckE,QAC1ElE,EAAaT,KAAK2hB,WAAa/rB,KAAK8B,OAAOqqB,SAG3C,MAAMzhB,EAAW,GAAGrF,EAAIC,6CAClBkK,QAAavD,eAAevB,EAAUG,GAGtCF,EAAW,CACfC,KAAMpF,KAAKoF,KAAKnF,GAChBlE,KAAMwsB,MAAMC,mBAAmBC,MAC/B/hB,QAASsD,EACTjF,QAAS,CACPkD,MAAOzN,KAAKyN,MAAMhI,GAClB+T,MAAOxZ,KAAKyN,MAAM+L,MAClB0U,MAAOluB,KAAKyN,MAAM8C,OAKhBlF,EAAW7F,KAAKI,SAAStG,IAAI,OAAQ,YAO3C,MANI,CAAC,SAAU,aAAayD,SAASsI,KACnCV,EAASa,QAAUC,YAAYC,qBAAqB,OACrC,aAAbL,IAAyBV,EAASa,QAAU,CAAChG,KAAKoF,KAAKnF,KAC1C,cAAb4F,IAA0BV,EAASiB,OAAQ,GAGxCH,YAAYa,OAAO3B,EAC3B,CAQD8Z,gCAAgClS,GAC9BA,EAAMuB,iBACN,MAEM5H,EAFSqG,EAAMjB,cACDC,QAAQ,cACP9B,cAAc,iBACL,SAA1BvD,EAAQ2K,MAAMC,QAChBzF,EAAEnF,GAASqK,UAAU,KAErBlF,EAAEnF,GAASsK,QAAQ,IAEtB,CAEDiO,+BAA+BlS,GAC7BA,EAAMuB,iBAGN,MAAMqa,EAAS5b,EAAMjB,cACrB6c,EAAOroB,UAAW,EAClB,MAAMsoB,EAAOD,EAAO5c,QAAQ,eACtB8c,UAAEA,GAAcD,EAAK7c,QAAQ,YAAYuB,QACzCwb,EAAU9oB,KAAK+oB,SAASjvB,IAAI+uB,IAC5BG,OAAEA,GAAWL,EAAOrb,QAGpB2b,EAAyB,SAAXD,EACpB,KAAMC,GAAejpB,KAAKoF,KAAKW,MAAQ+iB,EAAQI,UAAW,OAG1D,MAAMjhB,EAAQzN,KAAK2uB,kBAAkBP,GACrC,IAAK3gB,EAAO,OAGZ,MAAM+G,EAAO/G,EAAM3N,MAAMR,IAAI8uB,EAAKtb,QAAQoD,QAC1C,IAAK1B,EACH,OAAOlG,GAAGC,cAAcC,MACtBhJ,KAAKuI,KAAKC,OAAO,sCAAuC,CACtD4gB,UAAWnhB,EAAM8C,KACjB2F,OAAQkY,EAAKtb,QAAQoD,UAM3B,IAAI2Y,EAAU,GAMd,OALIJ,IACFI,EAAU7uB,KAAK8uB,oBAAoBV,IAI7BI,GACN,IAAK,eACGha,EAAK7F,WAAW,CAAE4D,UACxB,MAGF,IAAK,gBACGiC,EAAKuD,YAAY,CAAExF,UACzB,MAGF,IAAK,OACH,GAAuB,IAAnBsc,EAAQxgB,OAIV,OAHAC,GAAGC,cAAcC,MACfhJ,KAAKuI,KAAKuB,SAAS,gCAEb6e,EAAOroB,UAAW,EAE5B,IAAK,MAAMkhB,KAAK6H,QACR7H,EAAE7O,SAASgW,EAAOrb,QAAQoF,KAAM,CAAE3F,UAS9C4b,EAAOroB,UAAW,CACnB,CAED2e,yBAAyB2J,GAEvB,MAAMW,EAAWX,EAAKtb,QAAQyG,QAC9B,GAAIwV,EAAU,CACZ,MAAO5V,EAASI,GAAWwV,EAASpS,MAAM,KACpCrD,EAAQ9T,KAAKwpB,OAAO1vB,IAAI6Z,GAC9B,IAAKG,EAAO,OAAO,KACnB,MAAM2V,EAAY3V,EAAM4V,oBAAoB,QAAS3V,GACrD,IAAK0V,EAAW,OAAO,KAEvB,OADc,IAAIE,MAAMF,GACXxhB,KACd,CAGD,MAAMyL,QAAEA,GAAYkV,EAAKtb,QACzB,OAAOtN,KAAK4pB,OAAO9vB,IAAI4Z,IAAY,IACpC,CAEDuL,2BAA2B2J,GACzB,MAAMiB,UAAEA,GAAc7pB,KAAKoF,MACrB0kB,WAAEA,GAAejW,OAAOkW,OACxBV,EAAUS,EAAW1tB,QACzB,CAAC4tB,EAAKxI,IAAOA,EAAEvZ,MAAQ,IAAI+hB,EAAKxI,EAAEvZ,OAAS+hB,GAC3C,IAGF,OADIH,GAAmC,IAAtBC,EAAWjhB,QAAcwgB,EAAQ7jB,KAAKqkB,GAChDR,CACR,EC3gBH,MAAMY,GAAuBD,GAC3BA,EAAI5tB,QAAO,CAAC0e,EAAGxW,IAAOA,EAAI,IAAIwW,EAAGxW,GAAKwW,GAAI,IAE7B,MAAMoP,WAAiBC,MACpCxG,qBACM3jB,KAAKoqB,QAAQC,WAAW,OAAO7vB,KAAK8B,OAAOqnB,sBAChD,CAED1E,mBAAmBlM,GAcjB,MAZoB,KAAhBA,GAAQ7E,MACV6E,EAAO7E,IAAM,6BAE8B,KAAzC6E,GAAQuX,gBAAgBC,SAASrc,MACnC6E,EAAOuX,eAAeC,QAAQrc,IAAM,6BAGlC6E,GAAQzW,QAAQsnB,UAAU/qB,QAAUka,GAAQzW,QAAQqL,QAAQic,WAC9D7Q,EAAOzW,OAAOqL,QAAQic,SAAW7Q,EAAOzW,OAAOsnB,SAAS/qB,aACjDka,EAAOzW,OAAOsnB,SAAS/qB,OAGzBka,CACR,CAEDrO,aAAaE,EAAM/I,EAAU,IAC3B,MAAM4f,EAAU,IAAK7W,IAEnB,kBAAmB4lB,EACnB,mBAAoBC,EACpB,mBAAoBC,EACpB,qBAAsBC,GACpBlP,EAGA+O,EACF/O,EAAQ,oBAAsB,GAAK+O,EAC1BC,IACThP,EAAQ,mBAAqB,GAAKgP,GAIhCE,EACFlP,EAAQ,oBAAsB,GAAKkP,EAC1BD,IACTjP,EAAQ,sBAAwB,GAAKiP,GAGvC5uB,MAAMyS,OAAOkN,EAAS5f,EACvB,CAED6I,8BAA8BkmB,EAAchmB,EAAO,GAAI8gB,EAAU,CAAA,GAM/D,OALA9gB,EAAKwH,KAAK4C,SACSkQ,IAAblQ,EAAKd,MACPc,EAAKd,IAAMoX,GAAQC,aAAavW,EAAKjT,MACtC,IAEID,MAAMsS,wBAAwBwc,EAAchmB,EAAM8gB,EAC1D,CAKDmF,cAAchyB,EAAOgD,EAAU,IAC7B,MAAMivB,EAAYtwB,KAAK8B,OAKvB,GAAkB,cAJA9B,KAAKuB,KAKrB,OAEF,MAAMgvB,EAAWlwB,KAAKmwB,MACpBnyB,EAASiyB,EAAUnjB,QAAQsjB,GAAG1lB,MAAQ1M,EAAS,KAEjD,OAAO2B,KAAK+T,OAAO,CACjB,0BAASwc,EAAWD,EAAUnjB,QAAQsjB,GAAGpyB,QACxCO,MAAK,KACN,MAAM2L,EAAUkB,YAAY+G,WAAW,CAAE/E,MAAOzN,OAChDyL,YAAYa,OAAO,CACjBJ,QAAS1G,KAAKuI,KAAKC,OAAO,6BAA8B,CACtDuC,KAAMvQ,KAAKuQ,KACXlS,MAAOkyB,IAEThmB,WACA,GAEL,CAEDsL,QACE,OAAO7V,KAAK8B,OAAO+T,KACpB,CAED6a,aAAa7G,GACXA,EAAKA,EAAG9mB,SAAS,KAAOyU,SAASqS,GAAM,EAAIrS,SAASqS,GAGpD,IAAIE,EAAQ,CAAA,EACZ,IAAK,IAAI1mB,EAAI,EAAGA,GAAKwmB,EAAIxmB,IAAK,CAC5B,MAAMstB,EAAMrnB,OAAOjE,IAAIqE,cAAcrG,GACjCstB,IACF5G,EAAQ4G,EAEX,CAGD,IAAItjB,EAAQ,GACZnM,OAAO4mB,KAAKxe,OAAOjE,IAAI2E,eAAe6K,SAAS+b,IACzC/G,EAAKrS,SAASoZ,KAClBvjB,EAAQ/D,OAAOjE,IAAI2E,cAAc4mB,GAAE,IAGrC5wB,KAAK+T,OAAO,CACV,qBAAsB1G,EACtB,mBAAoB,GAAKA,EACzB,eAAgB,CACdhG,MAAO,CACLhJ,MAAO0rB,EAAMpgB,GAEfrC,KAAM,CACJjJ,MAAO0rB,EAAMngB,GAEfrC,UAAW,CACTlJ,MAAO0rB,EAAMlgB,GAEfrC,OAAQ,CACNnJ,MAAO0rB,EAAMjgB,GAEfrC,MAAO,CACLpJ,MAAO0rB,EAAMhgB,KAIpB,CAMDG,aAAa7I,EAAU,IACrB,MAAMwL,MAAEA,SAAgB,IAAI3B,KAAKlL,KAAK8B,OAAO8nB,GAAGC,IAAI5e,KAAK,CAAEf,OAAO,IAClE,OAAOlK,KAAK+T,OAAO,CAAE,YAAa,CAAEnU,IAAKiN,EAAOxO,MAAOwO,IACxD,CAEDsL,SAASD,EAAM7W,EAAU,IACvB,MAAMgI,EAAQ7D,KAAKuI,KAAKuB,SAAS,aAAa4I,UAExCoY,EAAYtwB,KAAK8B,OACjB+uB,EAAY7wB,KAAKuB,KAEjB6I,EAAO,CACXqD,MAAOzN,KACPiL,KAAM,CACJ1J,KAAM,QACNqL,OAAQ0jB,EAAUvG,MAAM7R,GAAM7Z,MAC9BqR,MAAqB,cAAdmhB,EAA4BP,EAAUnqB,OAAOI,IAAI4b,IAAM,GAEhEhV,QAAS3H,KAAKuI,KAAKC,OAAO,wBAAyB,CAAEkK,KAAM7O,KAO7D,OAHgB,cAAdwnB,EAA4B5mB,EAAQ6mB,SAAW7mB,EAAQiB,MAGvC,CAChBqH,MAAOlR,EAAQkR,MACfpI,MApBgB,CAAC,QAqBjBC,OACAwE,WAAYvN,EAAQ0vB,aAAehc,EAAoB1T,EAAQkR,OAC/DhI,QAASkB,YAAY+G,WAAW,CAAE/E,MAAOzN,OACzCsK,OAAQ9E,KAAKuI,KAAKC,OAAO,gBAAiB,CAAEkK,KAAM7O,IAClDgB,MAAO7E,KAAKuI,KAAKC,OAAO,gBAAiB,CAAEkK,KAAM7O,IACjDoB,YAAapJ,EAAQoJ,aAExB,CAEDumB,WAAW3vB,EAAU,IACnB,MAIM+I,EAAO,CACXqD,MAAOzN,KACPiL,KAAM,CACJ1J,KAAM,QACNqL,OARc5M,KAAK8B,OAQDqL,QAAQ8jB,SAK9B,OAAOhnB,EAAQiB,KAAK,CAClBqH,MAAOlR,EAAQkR,MACfpI,MAbgB,CAAC,OAcjBC,OACAwE,YAAY,EACZrE,QAASkB,YAAY+G,WAAW,CAAE/E,MAAOzN,OACzCsK,OAAQ9E,KAAKuI,KAAKuB,SAAS,mBAC3BjF,MAAO7E,KAAKuI,KAAKuB,SAAS,oBAE7B,CAEDmS,YAAYpgB,EAAU,IACpB,MAAMgI,EAAQ7D,KAAKuI,KAAKuB,SAAS,oBAK3BlF,EAAO,CACXqD,MAAOzN,KACPiL,KAAM,CACJ1J,KAAM,QACNqL,OANc5M,KAAK8B,OAMDooB,SAASjE,UAK/B,OAAOhc,EAAQiB,KAAK,CAClBqH,MAAOlR,EAAQkR,MACfpI,MAfgB,CAAC,OAgBjBC,OACAwE,YAAY,EACZrE,QAASkB,YAAY+G,WAAW,CAAE/E,MAAOzN,OACzCsK,OAAQjB,EACRgB,MAAOhB,GAEV,CAED6nB,aAAa7vB,EAAU,IACrB,MAEM+I,EAAO,CACXqD,MAAOzN,KACPiL,KAAM,CACJ1J,KAAM,QACN0L,MAAO,CACL,EAAGzH,KAAKuI,KAAKC,OAAO,uBAAwB,CAC1CuC,KAAMvQ,KAAKuQ,OAEb,EAAG/K,KAAKuI,KAAKC,OAAO,0BAA2B,CAC7CuC,KAAMvQ,KAAKuQ,OAEb,EAAG/K,KAAKuI,KAAKC,OAAO,uBAAwB,CAC1CuC,KAAMvQ,KAAKuQ,OAEb,EAAG/K,KAAKuI,KAAKC,OAAO,2BAA4B,CAC9CuC,KAAMvQ,KAAKuQ,OAEb,GAAI/K,KAAKuI,KAAKC,OAAO,wBAAyB,CAC5CuC,KAAMvQ,KAAKuQ,UAOnB,OAAOtG,EAAQiB,KAAK,CAClBqH,MAAOlR,EAAQkR,MACfpI,MA7BgB,CAAC,OA8BjBC,OACAwE,WAAYvN,EAAQ0vB,aAAehc,EAAoB1T,EAAQkR,OAC/DhI,QAASkB,YAAY+G,WAAW,CAAE/E,MAAOzN,OACzCsK,OAAQ9E,KAAKuI,KAAKuB,SAAS,sBAC3BjF,MAAO7E,KAAKuI,KAAKuB,SAAS,uBAE7B,CAEDkS,UAAUpP,EAAO/Q,EAAU,IAGzB,GAAkB,cAFArB,KAAKuB,KAEQ,OAE/B,MAAM+uB,EAAYtwB,KAAK8B,OAEjBuH,EAAQ7D,KAAKuI,KAAKuB,SAAS,cAAc8C,UAGzChI,EAAO,CACXqD,MAAOzN,KACPiL,KAAM,CACJ1J,KAAM,QACNqL,OAAQ0jB,EAAUnqB,OAAOiM,GAAO/T,OAGlC8O,QAAS3H,KAAKuI,KAAKC,OAAO,6BAA8B,CACtDoE,MAAO/I,KAKX,OAAOY,EAAQiB,KAAK,CAClBqH,MAAOlR,EAAQkR,MACfpI,MAjBgB,CAAC,QAkBjBC,OACAwE,WAAYvN,EAAQ0vB,aAAehc,EAAoB1T,EAAQkR,OAC/DhI,QAASkB,YAAY+G,WAAW,CAAE/E,MAAOzN,OACzCsK,OAAQ9E,KAAKuI,KAAKC,OAAO,qBAAsB,CAAEmjB,UAAW9nB,IAC5DgB,MAAO7E,KAAKuI,KAAKC,OAAO,qBAAsB,CAAEmjB,UAAW9nB,IAC3DoB,YAAapJ,EAAQoJ,aAExB,CAEDwT,YAAY5c,EAAU,IACpB,MAAMwvB,EAAY7wB,KAAKuB,KAEjB+uB,EAAYtwB,KAAK8B,OAEjBuH,EAAQ7D,KAAKuI,KAAKuB,SAAS,eAC3B+C,EAAY,CAACie,EAAU1G,GAAGC,IACd,cAAdgH,GACFxe,EAAUrH,KAAKslB,EAAUnqB,OAAOK,IAAI2b,IAAMmO,EAAUnjB,QAAQikB,OAG9D,MAAMhnB,EAAO,CACXqD,MAAOzN,KACPiL,KAAM,CACJ1J,KAAM,YAKV,OAAO0I,EAAQiB,KAAK,CAClBqH,MAAOlR,EAAQkR,MACfpI,MAAOkI,EACPjI,OACAwE,YAAY,EACZrE,QAASkB,YAAY+G,WAAW,CAAE/E,MAAOzN,OACzCsK,OAAQjB,EACRgB,MAAOhB,GAEV,CAEDgoB,cAAchwB,EAAU,IAEtB,GAAkB,YADArB,KAAKuB,KACM,OAE7B,MAAM+uB,EAAYtwB,KAAK8B,OAEjBuQ,EAAY,GAClB,IAAIhJ,EAAQ,GACU,eAAlBhI,EAAQiwB,OACVjf,EAAUrH,KAAKslB,EAAUnjB,QAAQokB,UAAU3nB,GAC3CP,EAAQ,QAERgJ,EAAUrH,KAAKslB,EAAUnjB,QAAQokB,UAAU5nB,GAC3CN,EAAQ,OAEV,MAAMe,EAAO,CACXqD,MAAOzN,KACPiL,KAAM,CACJ1J,KAAM,CACJA,KAAM,eAMZ,OAAO0I,EAAQiB,KAAK,CAClBqH,MAAOlR,EAAQkR,MACfpI,MAAOkI,EACPjI,OACAwE,YAAY,EACZrE,QAASkB,YAAY+G,WAAW,CAAE/E,MAAOzN,OACzCsK,OAAQ9E,KAAKuI,KAAKC,OAAO,qBAAsB,CAAEzM,KAAM8H,IACvDgB,MAAO7E,KAAKuI,KAAKC,OAAO,qBAAsB,CAAEzM,KAAM8H,KAEzD,CAEDuY,gBAAgBF,EAAMrgB,EAAU,IAE9B,GAAkB,cADArB,KAAKuB,KACQ,OAC/B,MAAM+uB,EAAYtwB,KAAK8B,OAEjBuH,EAAQ7D,KAAKuI,KAAKuB,SAAS,mBAAmBoS,UAG9CtX,EAAO,CACXqD,MAAOzN,KACPiL,KAAM,CACJ1J,KAAM,QACNqL,OAAQ0jB,EAAU3O,YAAYD,GAC9BpW,WAAW,GAEb6B,QAAS3H,KAAKuI,KAAKC,OAAO,+BAAgC,CACxD0T,KAAMrY,KAKV,OAAOY,EAAQiB,KAAK,CAClBqH,MAAOlR,EAAQkR,MACfpI,MAjBgB,CAAC,OAkBjBC,OACAwE,WAAYvN,EAAQ0vB,aAAehc,EAAoB1T,EAAQkR,OAC/DhI,QAASkB,YAAY+G,WAAW,CAAE/E,MAAOzN,OACzCsK,OAAQ9E,KAAKuI,KAAKC,OAAO,uBAAwB,CAAE2T,YAAatY,IAChEgB,MAAO7E,KAAKuI,KAAKC,OAAO,uBAAwB,CAAE2T,YAAatY,KAElE,CAEDsF,WAAW6iB,EAASnwB,EAAU,IAC5B,MAAM+I,EAAOpK,KAAK8B,OAEZoN,EAAW,CACfzB,MAAOzN,KACPwU,KAAMgd,EAAQhd,KACdvJ,KAAM,CACJ1J,KAAM,WAIJkwB,EAAW,GACbD,EAAQvmB,KAAKiD,IACfujB,EAASzmB,KAAKwmB,EAAQvmB,KAAKiD,KAE3BujB,EAASzmB,KAAK,OAIU,UAAtBwmB,EAAQvmB,KAAK1J,MAAoB6I,EAAKjE,OAAOC,IAAI+b,KACnDsP,EAASzmB,KAAKZ,EAAKjE,OAAOC,IAAI+b,KAIhClY,EAAQiB,KAAK,CACXqH,MAAOlR,EAAQkR,MACfpI,MAAOsnB,EACPrnB,KAAM8E,EACNN,YAAY,EACZrE,QAASkB,YAAY+G,WAAW,CAAE/E,MAAOzN,OACzCsK,OAAQ,GAAGknB,EAAQnoB,WAAW7D,KAAKuI,KAAKuB,SAAS,gBACjDjF,MAAO,GAAGmnB,EAAQnoB,WAAW7D,KAAKuI,KAAKuB,SAAS,iBAEnD,CAEDpF,mBAAmBE,EAAM7I,EAAMF,GAC7B,GAAImE,KAAKoF,KAAKikB,QAAQ6C,KAAO,EAC3B,IAAK,MAAM1K,KAAKxhB,KAAKoF,KAAKikB,QAAQ7rB,SAChCoH,EAAKa,KAAK2B,OAASoa,QACbhnB,KAAK2xB,WAAWvnB,EAAM,CAC1B7I,OACAqN,WAAYvN,EAAQuN,kBAIxB5O,KAAK2xB,WAAWvnB,EAAM,CAAE7I,OAAMqN,WAAYvN,EAAQuN,YAErD,CAgBD+iB,WAAWH,EAASnwB,EAAU,IAC5B,MAAM+I,EAAOpK,KAAK8B,OAEZuH,EAAQmoB,EAAQhd,KAClBhP,KAAKuI,KAAKC,OAAO,uBAAwB,CACvCuC,KAAMihB,EAAQhd,KAAKjE,OAErB/K,KAAKuI,KAAKC,OAAO,mBAAoB,CACnCuC,KAAMvQ,KAAKuQ,OAGXkhB,EAAWhC,GAAoB,CAEnC+B,EAAQhd,MAAM1S,QAAQ2qB,QAAU,SAE7BzsB,KAAK8B,OAAOgJ,QAAQ8mB,mBAAqBJ,EAAQhd,MAAM1S,QAAQiJ,OAElE0mB,EAASzmB,KAAKwmB,EAAQhd,MAAM1S,QAAQiJ,OAEtC,MAAMsH,EAAY,CAAC,QACD7M,KAAKI,SAAStG,IAAIkG,KAAK1D,OAAO2D,GAAI,gBAEnC2E,EAAKiD,MAAMgd,KAAKhY,EAAUrH,KAAKZ,EAAKiD,MAAMgd,KAI3D,IAAIwH,EAAa,GACbC,EAAY,GACZC,EAAc,CAAC,EAAG,GAGpBD,OAD4BpN,IAA1Bta,EAAKjE,QAAQC,KAAK8H,UAAgDwW,IAA3Bta,EAAKiD,OAAO8U,KAAKxZ,MAC7C,CAACyB,EAAKjE,OAAOC,IAAI8H,IAAK9D,EAAKiD,MAAM8U,IAAIxZ,OAGrCopB,EAGM,UAAjB1wB,EAAQE,OACVswB,EAAa,CAACznB,EAAKjE,OAAOC,IAAIye,IAAKza,EAAKiD,MAAM8U,IAAIxZ,OAClD8oB,EAASzmB,QAAQykB,GAAoBqC,KAIlB,YAAjBzwB,EAAQE,OACVswB,EAAa,CAACznB,EAAKjE,OAAOG,IAAIue,IAAKza,EAAKiD,MAAM8U,IAAIvZ,UAGhD4oB,EAAQhd,MAAMqd,EAAW7mB,KAAKwmB,EAAQhd,MAAM1S,QAAQiJ,OAExDsH,EAAUrH,QAAQykB,GAAoBoC,IAEtC,MAAM3iB,EAAW,CACfzB,MAAOzN,KACPwU,KAAMgd,EAAQhd,KACd0B,OAAQsb,EAAQhd,MAAM7I,IACtBV,KAAM,CACJ1J,KAAMF,EAAQE,KACd8L,MAAOjD,EAAKiD,MAAMhP,MAClB6P,IAAKujB,EACLvZ,KAAMsZ,EAAQvmB,KAAKiN,KACnBtL,OAAQ4kB,EAAQvmB,KAAK2B,SAIzB,OAAO3C,EAAQiB,KAAK,CAClBqH,MAAOlR,EAAQkR,MACfpI,MAAOkI,EACPjI,KAAM8E,EACNN,WAAYvN,EAAQuN,WACpBrE,QAASkB,YAAY+G,WAAW,CAAE/E,MAAOzN,OACzCsK,OAAQjB,EACR4E,MAAO,CAAE+jB,IAAK,CAAE/mB,KAAM,SAAUiL,OAAQsb,EAAQhd,MAAM7I,MACtDtB,MAAOhB,GAEV,CAODa,kBAAkB+nB,EAAS,EAAGC,EAAa,GACzCD,EAAS5xB,KAAKmwB,MAAMhZ,SAASya,GAAUC,GAEvC,MAAM7zB,MAAEA,EAAKuB,IAAEA,GAAQI,KAAK8B,OAAO8nB,GAGnC,OAAO5pB,KAAK+T,OAAO,CACjB,kBAAmB1T,KAAKC,QAAQjC,EAAQ4zB,EAAQ,EAAGryB,IAEtD,EC1iBY,MAAMuyB,WAA6B7c,EAMrCpF,4BACT,OAAOO,QAAQC,MAAMqO,YAAYzd,MAAM4O,eAAgB,CACrDC,QAAS,CAAC,MAAO,QAAS,UAAW,SACrCzF,SAAU,GAAGrF,EAAIC,mDACjB8K,MAAO,IACP8M,OAAQ,IACRF,WAAW,EACXgC,KAAM,CACJ,CACEC,YAAa,QACbC,gBAAiB,cACjBC,QAAS,gBAIhB,CAQDE,cAAcjV,GAEZA,EAAKkV,MAAQ,CACXE,QAASxf,KAAKyN,MAAM3L,OAAO0d,QAC3B1f,MAAOE,KAAKyN,MAAM3L,OAAOhC,MACzB4f,WAAY1f,KAAKyN,MAAM3L,OAAO4d,WAC9BH,OAAQvf,KAAKyN,MAAM3L,OAAO6F,MAC1B8X,UAAWzf,KAAKyN,MAAM3L,OAAO2d,WAG/BrV,EAAKugB,eAAiB3qB,KAAKyN,MAAM3L,OAAO6oB,eACxCvgB,EAAKyV,OAAS7f,KAAKyN,MAAM3L,OAAO+d,OAAOC,SACxC,CAMD5V,gBACE,MAAME,EAAO9I,MAAMkP,UAEnBxQ,KAAKqf,cAAcjV,GAEnB,MAAMgoB,EAAchoB,GAAMtI,OAgB1B,OAbAsI,EAAKU,OAAOmmB,OAASzrB,KAAKI,SAAStG,IAAIkG,KAAK1D,OAAO2D,GAAI,UACvD2sB,EAAYjlB,QAAQpL,SAASswB,WAAa5R,WAAWC,WACnD0R,EAAYjlB,QAAQpL,SAASkL,MAC7B,CAAE/C,OAAO,IAEXE,EAAKyL,MAAQ7V,KAAKyN,MAAMoI,QAEpByc,eAAe9sB,KAAKoqB,QAAS,YAC/BxlB,EAAKoW,wBAA0BC,WAAWC,WACxC1gB,KAAKsQ,OAAOxO,OAAOqL,QAAQwT,UAC3B,CAAEzW,OAAO,KAGNE,CACR,CAKDF,qBACE,MAEMW,EAAe,CAAEsR,QAFP7S,OAAOjE,IAAIqE,eAGrB2S,QAAYpQ,eAChB,GAAG5G,EAAIC,2DACPuF,GAGF,IAAI+E,OACF,CACEvF,MAAO7E,KAAKuI,KAAKuB,SAAS,4BAC1BpD,QAASmQ,EACTjN,QAAS,CACPC,GAAI,CACFhG,MAAO7D,KAAKuI,KAAKuB,SAAS,UAC1B9F,KAAM,+BACN+F,SAAWC,IACT,MAAMqa,EAAKra,EAAKuC,KAAK,oBAAoBgB,MACzC/S,KAAKyN,MAAMijB,aAAa7G,EAAG,GAG/Bla,OAAQ,CACNnG,KAAM,+BACNH,MAAO7D,KAAKuI,KAAKuB,SAAS,gBAG9BO,QAAS,MAEX,CACEO,MAAO,MAETtE,QAAO,EACV,CAED5B,cAAcqI,GAEZ,IAAInI,EADJ9I,MAAMixB,QAAQhgB,GAEd,IAEE,GADAnI,EAAO2P,KAAKkC,MAAM1J,EAAMsH,aAAarJ,QAAQ,eAC3B,cAAdpG,EAAK7I,KAAsB,MAGhC,CAFC,MAAOiN,GACP,OAAO,CACR,CAED,IAAI6jB,EAAO,GACX,GAAIjoB,EAAKqP,KAAM,CACb,MAAM+Y,EAAahtB,KAAKitB,MACrBnzB,IAAI8K,EAAKqP,MACT6T,MAAMvb,MAAMa,GAAOA,EAAGjH,MAAQvB,EAAK3E,KACtC4sB,EAAO,SAASjoB,EAAKgQ,SAASoY,EAAWjiB,OAC/C,MACM8hB,EAAO,SAASjoB,EAAKgQ,QAEvBpa,KAAKyN,MAAMsG,OAAO,CAAE,gCAAiCse,GACtD,CAGDnoB,oBAAoBqI,GAClB,OAAOtU,QAAQy0B,IACb1yB,KAAKyN,MAAM3N,MACRqO,QAAQ9K,GAAiB,WAAXA,EAAE9B,OAChBqQ,KAAKqZ,GACJA,EAAOlX,OAAO,CACZ,uBAAwByD,SAASyT,EAAOnpB,OAAO8V,QAAQhY,SAIhE,CAEDsK,2BAA2BqI,GACzBA,EAAMuB,iBACN,MAAMU,EAAOxU,KAAKgW,kBAAkBzD,GAEpC,MAAmC,UAA/BA,EAAM3F,OAAOkG,QAAQyE,MAChB/C,EAAKT,OAAO,CACjB,uBAAwByD,SAASjF,EAAM3F,OAAOvO,SAGf,QAA/BkU,EAAM3F,OAAOkG,QAAQyE,MAChB/C,EAAKT,OAAO,CACjB,qBAAsByD,SAASjF,EAAM3F,OAAOvO,cAFhD,CAKD,CAEDs0B,qBAAqBpgB,GACnB,MAAMiC,EAAOlT,MAAM0U,kBAAkBzD,GAC/BqgB,EAAepe,EAAK1S,OAAO8oB,QAE3B3iB,EAAS/G,OAAO4mB,KAAKxe,OAAOjE,IAAI4C,QACtCA,EAAO+C,KAAK,eACZ,IAAIsiB,EAAQrlB,EAAOkf,QAAQyL,GACvBtF,EAAQ,IAAMrlB,EAAOoG,OACvBif,EAAQ,EAERA,IAEF9Y,EAAKT,OAAO,CACV,iBAAkB9L,EAAOqlB,IAE5B,CAOD5a,kBAAkBlD,GAChBlO,MAAMoR,kBAAkBlD,GAExBA,EAAKuC,KAAK,mBAAmBY,OAAOxB,IACdnR,KAAKyN,MACbujB,WAAW,CAAEze,MAAOpB,GAAK,IAGvC3B,EAAKuC,KAAK,qBAAqBY,OAAOxB,IAChBnR,KAAKyN,MACbyjB,aAAa,CAAE3e,MAAOpB,GAAK,IAGzC3B,EAAKuC,KAAK,sBAAsBY,OAAOxB,IACrC,MAAM6G,EAAchY,KAAKyN,MACnB6jB,EAAQjgB,EAAEF,EAAGG,eAAeC,QAAQ,gBAAgBnH,KAAK,SAC/D4N,EAAYqZ,cAAc,CAAE9e,MAAOpB,EAAImgB,SAAQ,IAGjD9hB,EAAKuC,KAAK,qBAAqB8gB,aAAa1hB,IAC1CnR,KAAKyN,MAAMsG,OAAO,CAAE,gCAAiC,MAAO,IAIzD/T,KAAKqB,QAAQqU,WAElBlG,EAAKuC,KAAK,4CAA4CY,OAAOxB,IAC3DnR,KAAK8yB,cAAc3hB,EAAG,IAGxB3B,EACGuC,KAAK,kBACLY,OAAOxB,GAAOA,EAAGvE,OAAO6R,WACxBxL,OAAOjT,KAAK+yB,qBAAqBpU,KAAK3e,OAEzCwP,EAAKuC,KAAK,YAAYY,OAAOxB,IAC3BnR,KAAKyN,MAAMulB,OAAO,CAAEzgB,MAAOpB,GAAK,IAGlC3B,EAAKuC,KAAK,iBAAiBY,OAAOxB,GAAOnR,KAAK2yB,qBAAqBxhB,KAEnE3B,EACGuC,KAAK,wCACLY,OAAM,IAAM3S,KAAK0wB,iBACrB,ECvOH,MAAMuC,GAAU,CAOdC,gBAAezlB,MACbA,EAAQ,CAAE,EAAArD,KACVA,EAAO,CACLa,KAAM,KAEN,CAAA,GAEF,MAAMkoB,EAAc,CAClB1lB,QACArD,QAIF,OADmB,IAAIc,KAAKd,EAAKa,KAAMkoB,GAAapkB,OAErD,EAODqkB,cAAa,EAAClH,SACZA,EAAW,GAAuCE,WAClDA,EAAa,MACX,KAGe,OAAfA,EACI,GACA,IAAI9iB,OAAOjE,IAAI4B,UAAUilB,KAAYE,KCnChC,MAAMiH,WAA4B5iB,QAAQwY,SAASC,UAChEzE,sBACE,MAAM6E,YAAEA,EAAWC,YAAEA,EAAWC,aAAEA,EAAY8J,WAAEA,EAAU7J,YAAEA,GAC1DhZ,QAAQrG,KAAKuf,OACf,MAAO,CACLzR,KAAM,IAAIoR,EACVsB,QAAS,IAAItB,EACbuD,aAAc,IAAIvD,EAClBre,KAAM,IAAIqe,EACV4C,SAAU,IAAI5C,EACd8C,WAAY,IAAI7C,EAChBje,UAAW,IAAIke,EACf8B,YAAa,IAAIhC,EACjB5gB,KAAM,IAAI4qB,EAAW,IAAI7J,GAE5B,CAEGsD,QACF,IAAK/sB,KAAKiL,KAAM,OAAO,KAcvB,MAAO,CACL5B,MAAO,GAbS7D,KAAKuI,KAAKuB,SAAS,qBAEjB2jB,GAAQC,eAAe,CACzCzlB,MAAOzN,KAAKwb,OAAO/N,MACnBrD,KAAMpK,KAAKisB,YAGMgH,GAAQG,cAAc,CACvClH,SAAUlsB,KAAKksB,SACfE,WAAYpsB,KAAKosB,eAMpB,CAEGY,QACF,OAAKhtB,KAAKkY,KAEH,CACL7O,MAAOC,OAAOjE,IAAIqC,WAAW1H,KAAKkY,MAClC1O,KAAM,YAJe,IAMxB,CAEG+pB,iBACF,OAAOvzB,KAAK0I,MAAQ,EACrB,CAEGyjB,eACF,MAAO,IACFnsB,KAAK6sB,aAAalQ,MAAM,KAAK/K,KAAKkb,IAAG,CAAQzjB,MAAOyjB,EAAIS,WAC3DvtB,MAAK+sB,EACL/sB,MAAKgtB,GACL7e,QAAQ6Y,KAAQA,GACnB,EC1DY,MAAMwM,WAA0B/iB,QAAQwY,SAASC,UAC9DzE,kBAAoB,CAClBniB,UAAW,sBACXC,MAAO,kBACPC,MAAO,kBACPoF,OAAQ,oBAGV6c,sBACE,MAAMiF,YACJA,EAAWJ,YACXA,EAAWC,YACXA,EAAWC,aACXA,EAAY8J,WACZA,EAAU7J,YACVA,GACEhZ,QAAQrG,KAAKuf,OACjB,MAAO,CACLpoB,KAAM,IAAI+nB,EAAY,CACpBnK,QAAS,QACThD,QAASjb,OAAO4mB,KAAK0L,GAAkBC,cAEzCnmB,GAAI,IAAIoc,EAAY,CAClBrrB,MAAO,IAAIkrB,EAAY,CACrBpK,QAAS,MAGbvR,IAAK,IAAI8b,EAAY,CACnBrrB,MAAO,IAAIkrB,EAAY,CACrBpK,QAAS,OAGbmM,YAAa,IAAIhC,EACjB5gB,KAAM,IAAI4qB,EAAW,IAAI7J,GACzBrnB,SAAU,IAAIonB,EACd7V,KAAM,IAAI4V,EAAY,CAAEmK,IAAK,EAAGvU,QAAS,IACzClI,YAAa,IAAIqS,EACjBtnB,SAAU,IAAI0nB,EAAY,CACxBrrB,MAAO,IAAIkrB,EAAY,CAAEmK,IAAK,EAAGvU,QAAS,IAC1Cvf,IAAK,IAAI2pB,EAAY,CAAEmK,IAAK,EAAGvU,QAAS,MAE1Cld,OAAQ,IAAIsnB,EAAY,CAAEmK,IAAK,EAAGvU,QAAS,IAC3C7a,UAAW,IAAIilB,EAAY,CAAEmK,IAAK,EAAGvU,QAAS,IAEjD,CAEGoU,iBACF,IAAKvzB,KAAK0I,KAAM,OAAO,KAEvB,MAAMirB,EAAW,IAAI/e,IACnB1T,OAAO8B,OAAOsG,OAAOjE,IAAI+D,WAAWwI,KAAI,EAAGvI,WAAYA,KAEzD,OAAOrJ,KAAK0I,KACTyF,QAAO,EAAG9P,YAAas1B,EAASv0B,IAAIf,KACpCuT,KAAI,EAAGvH,QAAOhM,YAAa,CAC1BgM,QACAhM,QACAgL,MAAOhL,KAEZ,CAEG8tB,eACF,MAAMwH,EAAWzyB,OAAO8B,OAAOsG,OAAOjE,IAAI+D,WAEpC+iB,EAAWnsB,KAAK0I,KAAKkJ,KAAI,EAAGvT,WAChCs1B,EAAS5hB,MAAK,EAAG1I,WAAYhL,IAAUgL,MAGzC,MAAO,CACL,CAAEA,MAAOmqB,GAAkBC,WAAWzzB,KAAKuB,MAAOiI,KAAM,gBACrD2iB,KACAnsB,KAAKuzB,YAEPK,OACAzlB,QAAQ6Y,KAAQA,GACpB,EC3EY,MAAM6M,WAA8BpjB,QAAQwY,SAASC,UAClEzE,sBACE,MAAMiF,YACJA,EAAWJ,YACXA,EAAWC,YACXA,EAAW+J,WACXA,EAAU7J,YACVA,EAAWD,aACXA,GACE/Y,QAAQrG,KAAKuf,OACjB,MAAO,CACLxS,QAAS,IAAImc,EAAW,IAAIhK,GAC5BgC,YAAa,IAAIhC,EACjB5gB,KAAM,IAAI4qB,EAAW,IAAI7J,GACzBrnB,SAAU,IAAIonB,EACd7V,KAAM,IAAI4V,EAAY,CAAEmK,IAAK,EAAGvU,QAAS,IACzClI,YAAa,IAAIqS,EACjBtnB,SAAU,IAAI0nB,EAAY,CACxBrrB,MAAO,IAAIkrB,EAAY,CAAEmK,IAAK,EAAGvU,QAAS,IAC1Cvf,IAAK,IAAI2pB,EAAY,CAAEmK,IAAK,EAAGvU,QAAS,MAE1Cld,OAAQ,IAAIsnB,EAAY,CAAEmK,IAAK,EAAGvU,QAAS,IAC3C7a,UAAW,IAAIilB,EAAY,CAAEmK,IAAK,EAAGvU,QAAS,IAEjD,CAEG7E,eACF,IAAKta,KAAKmX,QAAS,OAAO,KAC1B,IAAKnX,MAAMwb,QAAQA,QAAQ1b,MAAO,OAAO,KACzC,MAAM2F,GAAEA,GAAOzF,KAAKwb,OACpB,OAAOxb,KAAKwb,OAAOA,OAAO1b,MAAMqO,QAC9B,EAAGrM,QAAUmV,kBAAoBxR,IAAOwR,GAE3C,CAEG6c,kBACF,OAAO9zB,KAAKsa,SAAS1Y,QACnB,CAACC,GAAOC,QAAUG,SAAQD,eACxBH,EAAMI,GAAUD,GAAU3D,OAAS,IACrC,EAEH,CAEGk1B,iBACF,IAAKvzB,KAAK0I,KAAM,OAAO,KAEvB,MAAMirB,EAAW,IAAI/e,IACnB1T,OAAO8B,OAAOsG,OAAOjE,IAAI+D,WAAWwI,KAAI,EAAGvI,WAAYA,KAEzD,OAAOrJ,KAAK0I,KACTyF,QAAO,EAAG9P,YAAas1B,EAASv0B,IAAIf,KACpCuT,KAAI,EAAGvH,QAAOhM,YAAa,CAAEgM,QAAOhM,QAAOgL,MAAOhL,KACtD,CAEG8tB,eACF,MAAMwH,EAAWzyB,OAAO8B,OAAOsG,OAAOjE,IAAI+D,WAM1C,MAAO,IAJUpJ,KAAK0I,KAAKkJ,KAAI,EAAGvT,WAChCs1B,EAAS5hB,MAAK,EAAG1I,WAAYhL,IAAUgL,SAGjBrJ,KAAKuzB,YAAYK,OAAOzlB,QAAQ6Y,KAAQA,GACjE,EC9DY,MAAM+M,WAAyBtjB,QAAQwY,SAASC,UAC7DzE,sBACE,MAAMiF,YACJA,EAAWJ,YACXA,EAAWC,YACXA,EAAWC,aACXA,EAAY8J,WACZA,EAAU7J,YACVA,GACEhZ,QAAQrG,KAAKuf,OACjB,MAAO,CACL5nB,SAAU,IAAIynB,EACd8B,YAAa,IAAIhC,EACjB5gB,KAAM,IAAI4qB,EAAW,IAAI7J,GACzBrnB,SAAU,IAAIonB,EACd7V,KAAM,IAAI4V,EAAY,CAAEmK,IAAK,EAAGvU,QAAS,IACzClI,YAAa,IAAIqS,EACjBtnB,SAAU,IAAI0nB,EAAY,CACxBrrB,MAAO,IAAIkrB,EAAY,CAAEmK,IAAK,EAAGvU,QAAS,IAC1Cvf,IAAK,IAAI2pB,EAAY,CAAEmK,IAAK,EAAGvU,QAAS,MAE1Cld,OAAQ,IAAIsnB,EAAY,CAAEmK,IAAK,EAAGvU,QAAS,IAC3C7a,UAAW,IAAIilB,EAAY,CAAEmK,IAAK,EAAGvU,QAAS,IAEjD,CACG6U,uBACF,OAAOh0B,KAAKiC,OAASjC,KAAKgC,SAAS3D,KACpC,CAEG41B,qBACF,OAAOj0B,KAAK2T,KAAO3T,KAAKgC,SAAS3D,KAClC,CAEG61B,0BACF,OAAO7zB,KAAKgE,KAAKrE,KAAKsE,UAAYtE,KAAKgC,SAAS3D,MACjD,CAEDomB,mBAAmBlM,GAGjB,OAFIA,EAAOpL,SAASme,cAAgB/S,EAAO+S,cACzC/S,EAAO+S,YAAc/S,EAAOpL,QAAQme,aAC/B/S,CACR,CAEGgb,iBACF,IAAKvzB,KAAK0I,KAAM,OAAO,KAEvB,MAAMirB,EAAW,IAAI/e,IACnB1T,OAAO8B,OAAOsG,OAAOjE,IAAI+D,WAAWwI,KAAI,EAAGvI,WAAYA,KAEzD,OAAOrJ,KAAK0I,KACTyF,QAAO,EAAG9P,YAAas1B,EAASv0B,IAAIf,KACpCuT,KAAI,EAAGvH,QAAOhM,YAAa,CAAEgM,QAAOhM,QAAOgL,MAAOhL,KACtD,CAEG8tB,eACF,MAAMwH,EAAWzyB,OAAO8B,OAAOsG,OAAOjE,IAAI+D,WAM1C,MAAO,IAJUpJ,KAAK0I,KAAKkJ,KAAI,EAAGvT,WAChCs1B,EAAS5hB,MAAK,EAAG1I,WAAYhL,IAAUgL,SAGjBrJ,KAAKuzB,YAAYK,OAAOzlB,QAAQ6Y,KAAQA,GACjE,EC5DY,MAAMmN,WAA0B1jB,QAAQwY,SAASC,UAC9DzE,sBACE,MAAM6E,YAAEA,EAAWC,YAAEA,EAAW+J,WAAEA,EAAU7J,YAAEA,GAC5ChZ,QAAQrG,KAAKuf,OACf,MAAO,CACLzR,KAAM,IAAIoR,EACV9M,IAAK,IAAI+M,EAAY,CAAEU,UAAU,EAAMyJ,IAAK,IAC5C9V,MAAO,IAAI0L,EACXwC,SAAU,IAAIxC,EACduC,MAAO,IAAIvC,EACXre,KAAM,IAAIqe,EACV3R,UAAW,IAAI4R,EAAY,CAAEmK,IAAK,IAClCnL,KAAM,IAAIgB,EAAY,CAAEmK,IAAK,IAC7BpI,YAAa,IAAIhC,EACjB5gB,KAAM,IAAI4qB,EAAW,IAAI7J,GAE5B,CAEGsD,QACF,IAAK/sB,KAAKiL,KAAM,OAAO,KASvB,MAAO,CACL5B,MAAO,GARS7D,KAAKuI,KAAKuB,SAAS,qBAEjB2jB,GAAQC,eAAe,CACzCzlB,MAAOzN,KAAKwb,OAAO/N,MACnBrD,KAAMpK,KAAKisB,YAMd,CAEGe,QACF,OAAKhtB,KAAKkY,KAEH,CACL7O,MAAOC,OAAOjE,IAAIqC,WAAW1H,KAAKkY,MAClC1O,KAAM,YAJe,IAMxB,CAEG+pB,iBACF,OAAOvzB,KAAK0I,MAAQ,EACrB,CAEGyjB,eACF,MAAO,CACL,CAAE9iB,MAAOrJ,KAAK4d,OACd,CAAEvU,MAAOrJ,KAAK6rB,OACd,CAAExiB,MAAOrJ,KAAK8rB,UACd9rB,MAAK+sB,EACL/sB,MAAKgtB,GACL7e,QAAQ6Y,KAAQA,GACnB,ECxDY,MAAMoN,WAA2B3jB,QAAQwY,SAASC,UAC/DzE,sBACE,MAAMiF,YACJA,EAAWJ,YACXA,EAAWC,YACXA,EAAWC,aACXA,EAAY8J,WACZA,EAAU7J,YACVA,GACEhZ,QAAQrG,KAAKuf,OACjB,MAAO,CACL8C,OAAQ,IAAInD,EACZgC,YAAa,IAAIhC,EACjB5gB,KAAM,IAAI4qB,EAAW,IAAI7J,GACzBrnB,SAAU,IAAIonB,EACdtR,KAAM,IAAIoR,EACVuC,MAAO,IAAInC,EAAY,CACrBgD,MAAO,IAAInD,EAAY,CAAEO,SAAS,EAAM4J,IAAK,EAAGvU,QAAS,IACzDwN,OAAQ,IAAIpD,EAAY,CAAEO,SAAS,EAAM4J,IAAK,EAAGvU,QAAS,IAC1DyN,KAAM,IAAIrD,EAAY,CAAEO,SAAS,EAAM4J,IAAK,EAAGvU,QAAS,MAE1DpU,MAAO,IAAIwe,EAAY,IACvBqB,QAAS,IAAItB,EACb1gB,QAAS,IAAI4gB,EACb7gB,MAAO,IAAI6gB,EACX3gB,KAAM,IAAI2gB,EACV5R,QAAS,IAAI8R,EAAY,CACvBrrB,MAAO,IAAIkrB,EAAY,CAAEO,SAAS,EAAM4J,IAAK,EAAGvU,QAAS,IACzDvf,IAAK,IAAI2pB,EAAY,CAAEO,SAAS,EAAM4J,IAAK,EAAGvU,QAAS,MAEzDxL,KAAM,IAAI4V,EAAY,CAAEmK,IAAK,EAAGvU,QAAS,IACzClI,YAAa,IAAIqS,EACjBtnB,SAAU,IAAI0nB,EAAY,CACxBrrB,MAAO,IAAIkrB,EAAY,CAAEmK,IAAK,IAC9B9zB,IAAK,IAAI2pB,EAAY,CAAEmK,IAAK,MAE9BzxB,OAAQ,IAAIsnB,EAAY,CAAEmK,IAAK,IAC/BpvB,UAAW,IAAIilB,EAAY,CAAEmK,IAAK,EAAGvU,QAAS,IAEjD,CAEGkV,QACF,OAAKr0B,KAAK4I,QACH,CACLU,OAAOjE,IAAI+D,UAAUR,QACrB,CACES,MAAO,GAAGrJ,KAAK6rB,MAAMa,SAAS1sB,KAAK6rB,MAAMc,UAAU3sB,KAAK6rB,MAAMe,OAC9DpjB,KAAM,gBALgB,IAQ3B,CAEG8qB,QACF,OAAKt0B,KAAK2I,MACHW,OAAOjE,IAAI+D,UAAUT,MADJ,IAEzB,CAEG4rB,QACF,OAAKv0B,KAAK6I,KACHS,OAAOjE,IAAI+D,UAAUP,KADL,IAExB,CAEGmkB,QACF,OAAKhtB,KAAKkY,KAEH,CACL7O,MAAOC,OAAOjE,IAAIqC,WAAW1H,KAAKkY,MAClC1O,KAAM,YAJe,IAMxB,CAEG+pB,iBACF,IAAKvzB,KAAK0I,KAAM,OAAO,KAEvB,MAAMirB,EAAW,IAAI/e,IACnB1T,OAAO8B,OAAOsG,OAAOjE,IAAI+D,WAAWwI,KAAI,EAAGvI,WAAYA,KAEzD,OAAOrJ,KAAK0I,KAAKyF,QAAO,EAAG9P,YAAas1B,EAASv0B,IAAIf,IACtD,CAOGm2B,gBACF,MAAO,IACFx0B,KAAKmsB,SACLhe,QAAQ6Y,KAAQA,EAAEzd,QAClBqI,KAAKoV,IAAO,IACRA,EACH3c,MAAO2c,EAAE3d,aAEVrJ,KAAKuzB,WAEX,CAEGpH,eACF,MAAMwH,EAAWzyB,OAAO8B,OAAOsG,OAAOjE,IAAI+D,WAEpC+iB,EAAWnsB,KAAK0I,KAAKkJ,KAAI,EAAGvT,WAChCs1B,EAAS5hB,MAAK,EAAG1I,WAAYhL,IAAUgL,MAGzC,MAAO,CACL,CAAEA,MAAOrJ,KAAKysB,OAAQjjB,KAAM,WAC5BxJ,MAAKs0B,EACLt0B,MAAKq0B,EACLr0B,MAAKu0B,KACFpI,EACHnsB,MAAKgtB,GAEJ4G,OACAzlB,QAAQ6Y,KAAQA,GACpB,EC7GY,MAAMyN,WAAqBC,UAM7BxkB,4BACT,OAAOO,QAAQC,MAAMqO,YAAYzd,MAAM4O,eAAgB,CACrDC,QAAS,CAAC,MAAO,QAAS,QAC1BC,MAAO,IACP8M,OAAQ,IACRF,WAAW,EACXgC,KAAM,CACJ,CACEC,YAAa,QACbC,gBAAiB,cACjBC,QAAS,iBAIhB,CAKGzU,eAEF,MAAO,GADM,GAAGrF,EAAIC,kCACFtF,KAAKwU,KAAKjT,iBAC7B,CAQD2I,gBACE,MAAME,KAAEA,GAAS9I,MAAMkP,UAYvB,OAXApG,EAAKsL,SAAW1V,KAAKqhB,SAASrN,MAAM2B,WACpCvL,EAAKU,OAAS,IACTxB,OAAOjE,IACVM,YAAaH,KAAKI,SAAStG,IAAIkG,KAAK1D,OAAO2D,GAAI,sBAEjD2E,EAAKuqB,SAAW,CACdrJ,kBAAmB7K,WAAWC,WAC5B1gB,KAAKwU,KAAK1S,QAAQwpB,aAAe,GACjC,CAAEphB,OAAO,KAGNE,CACR,CASDsI,kBAAkBlD,GAChBA,EAAKuC,KAAK,gCAAgC6iB,UAAUzjB,IAClD,GAAiB,KAAbA,EAAG0jB,MAAc,CACnB,MACM7xB,EADQqO,EAAEF,EAAGG,eAAeyB,MACb4J,MAAM,KAC3B3c,KAAKsQ,OAAO2c,cAAcjqB,EAC3B,KAEHwM,EAAKuC,KAAK,eAAeY,OAAOxB,IAC9B,MAAM9S,EAAQ8S,EAAGG,cAAcuB,cAAcC,QAAQqY,IACrDnrB,KAAKsQ,OAAOkd,aAAanvB,EAAM,IAEjCmR,EAAKuC,KAAK,kBAAkBY,OAAM,KAChC3S,KAAKsQ,OAAOyD,OAAO,CAAE,gBAAiB/T,KAAKsQ,OAAOxO,OAAO6G,OAAQ,IAGnE6G,EAAKuC,KAAK,oBAAoBY,OAAM,KAClC3S,KAAKsQ,OAAOyD,OAAO,CAAE,kBAAmB/T,KAAKsQ,OAAOxO,OAAO8G,SAAU,IAGvEtH,MAAMoR,kBAAkBlD,EACzB,EC5EH,SAASslB,GAAoBtlB,EAAc0iB,WACzC,MAAMD,EAASziB,EAAKuC,KAAK,eAAegjB,OAAO/iB,OACzCgjB,EAASxvB,KAAKI,SAAStG,IAAIkG,KAAK1D,OAAO2D,GAAI,qBACjD,GAAIuvB,IAAW1rB,OAAOjE,IAAIwC,qBAAqBG,eAAgB,CAC7D,MAAMitB,EAAWzlB,EAAKuC,KAAK,gBAAgBgjB,OAAO3qB,KAAK,MACvD,MAAYxM,EAAAoC,UAAA,OAAA,GAAA,kBACV,MAAMyN,EAA2D,QAAnDynB,QAAQ/a,SAAS8a,GAAY,WAAsB,IAAAC,OAAA,EAAAA,EAAEznB,YAC7D0nB,GAAoB1nB,EAAOwkB,EAAQC,GAAYzkB,aAAK,EAALA,EAAO8C,OAAQ0kB,GAAY,kBACjF,GAAA,EAHD,EAID,CACGD,IAAW1rB,OAAOjE,IAAIwC,qBAAqBE,WACpC,QAATob,EAAA3d,KAAKoF,YAAI,IAAAuY,GAAAA,EAAE0L,QAAQha,SAASmS,GAAMmO,GAAoBnO,EAAEvZ,MAAOwkB,EAAQC,EAAYlL,EAAEzW,SAEnFykB,IAAW1rB,OAAOjE,IAAIwC,qBAAqBC,WAChC,QAAb6f,EAAAtO,OAAOkW,cAAM,IAAA5H,GAAAA,EAAE2H,WAAWza,SAASmS,GAAMmO,GAAoBnO,EAAEvZ,MAAOwkB,EAAQC,EAAYlL,EAAEzW,QAEhG,CAEA,SAAe4kB,GAAoB1nB,EAAqBwkB,EAAgBC,EAAoBkD,qDAC1E,QAAXjS,EAAA3d,KAAKoF,YAAM,IAAAuY,OAAA,EAAAA,EAAA5X,OAAUkC,aAAiBiiB,SAIrCjiB,EAAM4nB,YAAYpD,EAAQC,WAH9BvK,EAAArZ,GAAGC,8BAAeC,MAAMhJ,KAAKuI,KAAKC,OAAO,6BAA8B,CAAEonB,gBAI5E,CAED,MAAME,GAA2Crf,GAC/Csf,GAAetf,MAASA,EAAGlE,KAAK,cAAc1D,OAEhD,SAASknB,GAAe/lB,eACtB,IAAKA,EAAKuC,KAAK,eAAe1D,OAAQ,OAAO,EAC7C,MAAMmnB,EAAoBhwB,KAAKI,SAAStG,IAAIkG,KAAK1D,OAAO2D,GAAI,qBAC5D,OAAQ+vB,GACN,KAAKlsB,OAAOjE,IAAIwC,qBAAqBG,eACnC,QAASwH,EAAKuC,KAAK,gBAAgBgjB,OAAO3qB,KAAK,MACjD,KAAKd,OAAOjE,IAAIwC,qBAAqBE,SACnC,SAA6B,QAApB4f,EAAW,QAAXxE,EAAA3d,KAAKoF,YAAM,IAAAuY,OAAA,EAAAA,EAAA0L,eAAS,IAAAlH,OAAA,EAAAA,EAAA+J,MAC/B,KAAKpoB,OAAOjE,IAAIwC,qBAAqBC,SACnC,SAAsB,QAAbotB,EAAA7b,OAAOkW,cAAM,IAAA2F,OAAA,EAAAA,EAAE5F,WAAWjhB,QACrC,QAKE,OAJgB,QAAhBonB,EAAAnnB,GAAGC,qBAAa,IAAAknB,GAAAA,EAAEjnB,MAAMhJ,KAAKuI,KAAKC,OAAO,+BAAgC,CACvE0nB,WAAY,oBACZC,YAAaH,MAER,EAGb,CAUO,MChEDI,GAAY,CAChBC,aAAc,IACdC,cAAe,IAEfC,SAASxmB,EAAUymB,GACjB,IAAIC,EAAY,KAChB,MAAO,IAAInZ,KACToZ,OAAOC,aAAaF,GACpBA,EAAYC,OAAOE,YAAW,KAC5B7mB,EAAS1Q,MAAM,KAAMie,EAAK,GACzBkZ,EAAK,CAEX,EACD9rB,qBAAqBmsB,EAAQjsB,GAE3BA,EAAKksB,WAAa,GAClB,MAAMC,EAAS,CAAA,EACTD,EAAaD,GAAQC,WAC3BA,EAAWzhB,SAAS2hB,IAClB,MAAMC,EAAQD,EAAIE,QAAQlxB,KAAK1D,OAAO2D,GAAI,SAC1C8wB,EAAOE,GAAS,CAAEE,SAAS,GAC3BvsB,EAAKksB,WAAWtrB,KAAKwrB,EAAI,IAG3B,IAAK,MAAMC,KAASF,EAAQ,CAE1B,MAAMtrB,EAAO,IAAIC,KAAK,OAAOE,SAAS,CAAElB,OAAO,UACzCe,EAAK2rB,UAAU,CACnBtsB,OAAQ9E,KAAKuI,KAAKC,OAAO,sBAAuB,CAC9CyoB,MAAOntB,OAAOjE,IAAI4C,OAAOwuB,OAG7BF,EAAOE,GAAO7gB,WAAa3K,EAAK4B,KAEjC,CAED,IAAK,IAAIxJ,EAAI,EAAGA,EAAI+G,EAAKksB,WAAWjoB,SAAUhL,EAC5C,GAAImC,KAAKoF,KAAKW,KAAM,CAClB,IAAKnB,EAAKksB,WAAWjzB,GAAGoK,MACtB,OAEF,MAAM6iB,EAAYlmB,EAAKksB,WAAWjzB,GAAGoK,OAAO3L,OAC5C,GAAIwuB,EAAUhG,aACNlgB,EAAKksB,WAAWjzB,GAAG0Q,OAAO,CAC9B6B,WAAYggB,GAAUC,kBAEnB,CACL,MAAMY,EAAQrsB,EAAKksB,WAAWjzB,GAAGqzB,QAAQlxB,KAAK1D,OAAO2D,GAAI,SACzDzF,KAAK+1B,SACH3rB,EAAKksB,WAAWjzB,GAAG0Q,OAAO,CAAE6B,WAAY2gB,EAAOE,GAAO7gB,aACtD,IAEH,CACF,OAGGygB,EAAOQ,YACd,EAED3sB,sBAAsBmsB,EAAQjsB,GAC5B,MAAM0sB,EAAStxB,KAAKI,SAAStG,IAAIkG,KAAK1D,OAAO2D,GAAI,oBAC5C,CAAC,QAAS,UAAU1C,SAAS+zB,IAGlCT,EAAOU,UACR,EAED7sB,2BAA2BmsB,EAAQjsB,GACjC,MAAM4sB,EAAU,GACVC,EAAQ,GACRX,EAAaD,GAAQC,WAC3B,IAAK,IAAIjzB,EAAI,EAAGA,EAAIizB,EAAW5E,KAAMruB,IAAK,CACxC,MAAM6zB,EAAIZ,EAAWhc,SAASjX,GAE9B,GAAI6zB,GAAGthB,YAA+B,IAAjBygB,EAAOpkB,MAC1B,SAIF,MAAMklB,QAAWD,EAAEE,sBAAsBF,GACnCjsB,QAAaisB,EAAEG,kBAAkBF,GACvCF,EAAMjsB,KAAKC,GACX,MAAMb,EAAO,CAAEuB,IAAKurB,EAAEzxB,IACtBuxB,EAAQhsB,KAAKZ,EACd,CAED,MAAMktB,EAAOC,SAASC,UAAUP,GAC1BQ,QAAqBvsB,KAAKwsB,UAAU,CAACJ,IAErCK,QAAiBF,EAAab,UAAU,CAAE,EAAE,CAAEtqB,QAAQ,IACtDsrB,EAAUH,EAAa1qB,MAAM,GAAGkqB,MACtC,IAAIY,EAAa,GACjB,IAAK,MAAOx0B,EAAG4H,KAAS2sB,EAAQE,UAAW,CAEzC,MAAMtB,EAAMhxB,KAAKuyB,QAAQC,OAAO1B,WAAWvkB,MACxCmlB,GAAMA,EAAEzxB,KAAOuxB,EAAQ3zB,GAAGsI,MAI7B,IAAItN,EAAQm4B,EAAI/oB,OAAO3L,QAAQwoB,OAC3BsL,GAAUC,YACV5qB,EAAK4B,MAELwpB,EAAOzwB,SAASqyB,cAAgBzB,EAAI0B,aACtC75B,EAAQu3B,GAAUE,cAEpBkB,EAAQ3zB,GAAGuS,WAAavX,EAGxB,MAAMqM,EAAW,GAAGrF,EAAIC,8DAClB6yB,EAAQ,CACZ5nB,KAAMimB,EAAIjmB,KACVxB,QAAS9D,EAAK8D,QACdrQ,OAAQuM,EAAKvM,OACbmO,MAAO5B,EAAK4B,OAGdgrB,SADuB5rB,eAAevB,EAAUytB,EAEjD,CACDR,EAASzrB,QAAU,iCAER1G,KAAKuI,KAAKuB,SAAS,kDAC5BuoB,oBAEFpsB,YAAYa,OAAOqrB,GAEfnyB,KAAKoF,KAAKW,YACN8qB,EAAO3hB,wBAAwB,YAAasiB,GACpD5sB,EAAKguB,KAAO,CACb,EAEDpqB,OAAOsC,EAAQd,EAAM5E,GACnB4E,EAAKuC,KAAK,eAAe0F,MAAK,CAACC,EAAG2gB,KAChCA,EAAKC,UACHD,EAAKC,YAAc,GAAG1C,GAAUC,cAC5B,wCACAwC,EAAKC,UACXD,EAAKC,UACHD,EAAKC,YAAc,GAAG1C,GAAUE,eAC5B,+BACAuC,EAAKC,SAAS,IAGtB9oB,EAAKuC,KAAK,cAAc0F,MAAK,CAACC,EAAG6gB,KAE/B,MAAMC,EAAWnnB,EAAEknB,GAAIxmB,KAAK,0CACtB0mB,EAAUnoB,EAAO0nB,OAAO1B,WAAWh3B,IAAIi5B,EAAGzlB,QAAQ4lB,aAClDC,EAAeF,EAAQ/B,QAAQlxB,KAAK1D,OAAO2D,GAAI,gBAC/CmzB,EAAiBH,EAAQ/B,QAAQlxB,KAAK1D,OAAO2D,GAAI,gBACjDozB,EAAaF,EAAe,SAAW,GAC7CH,EACGM,GAAG,GACHC,MACC,2CAA2CF,aAAsBrzB,KAAKuI,KAAKuB,SACzE,kFAGN,MAAM0pB,EAAcJ,EAAiB,SAAW,GAChDJ,EACGM,GAAG,GACHC,MACC,6CAA6CC,aAAuBxzB,KAAKuI,KAAKuB,SAC5E,oEAEH,IAELsmB,GAAUqD,iBAAiBzpB,GAG3B,KADiE,UAApDhK,KAAKI,SAAStG,IAAIkG,KAAK1D,OAAO2D,GAAI,eAE7C,OAGF+J,EAAKuC,KAAK,2CAA2CmnB,SACrD1pB,EAAKuC,KAAK,2CAA2CmnB,SACrD,MAAMC,EAAQ3pB,EAAKuC,KACjB,yDAEFV,EACE,mFACA+nB,aAAaD,GAEf3pB,EAAKuC,KAAK,cAAc0F,MAAK,CAACC,EAAG6gB,KAE/BlnB,EAAEknB,GAAIxmB,KAAK,SAASmnB,SAGpB,MACMG,EADU/oB,EAAO0nB,OAAO1B,WAAWh3B,IAAIi5B,EAAGzlB,QAAQ4lB,aAClChC,QAAQlxB,KAAK1D,OAAO2D,GAAI,SAG7B4L,EAAEknB,GAAIxmB,KAAK,uBACnBunB,QACP,kDAAkDD,aAAiB/vB,OAAOjE,IAAI4C,OAAOoxB,sCACtF,IAEHzD,GAAU2D,aAAa/pB,EACxB,EAEDgqB,gBAAgBC,EAAWrvB,GACzB,MAAMgW,EAAO5a,KAAKI,SAAStG,IAAIkG,KAAK1D,OAAO2D,GAAI,cAEzC6qB,EAAYmJ,EAAUhsB,OAAO3L,OACnC,GAAIwuB,EAAUhG,OACZlgB,EAAKwL,YAAc,SAGrB,GAAIxL,EAAKwL,YAAuB,UAATwK,EAAkB,CACvC,MAAMsZ,EAAYtvB,EAAKwL,WACjB+jB,EAAYF,EAAU/C,QAAQlxB,KAAK1D,OAAO2D,GAAI,SAEpDD,KAAKuyB,QAAQC,OAAO1B,WAAWzhB,SAAS0jB,IACtC,MAAM9B,EAAQ8B,EAAG7B,QAAQlxB,KAAK1D,OAAO2D,GAAI,SAEvC8yB,EAAG3iB,YACc,WAAjB2iB,EAAG3iB,YACH2iB,EAAG9yB,IAAM2E,EAAK3E,IACdgxB,IAAUkD,GACVn0B,KAAKoF,KAAKW,MAGVkuB,EAAU1lB,OAAO,CAAE6B,WAAY4B,SAASkiB,IACzC,GAEJ,CACF,EAEDT,iBAAiBzpB,GACfA,EAAKuC,KAAK,oCAAoCY,OAAOxB,IACnDA,EAAG2C,iBAEH,MAAMrO,EAAK4L,EAAEF,EAAGG,eAAeC,QAAQ,cAAc,GAAGuB,QACrD4lB,YACGkB,EAAWzoB,EAAGG,cAAcyH,UAAUC,SAAS,UACnCxT,KAAK6wB,OAAOC,WAAWh3B,IAAImG,GACnCo0B,QAAQr0B,KAAK1D,OAAO2D,GAAI,gBAAiBm0B,EAAS,IAE9DpqB,EAAKuC,KAAK,kCAAkCY,OAAOxB,IACjDA,EAAG2C,iBAEH,MAAMrO,EAAK4L,EAAEF,EAAGG,eAAeC,QAAQ,cAAc,GAAGuB,QACrD4lB,YACGkB,EAAWzoB,EAAGG,cAAcyH,UAAUC,SAAS,UAC/CygB,EAAYj0B,KAAK6wB,OAAOC,WAAWh3B,IAAImG,GACzCD,KAAKoF,KAAKW,MACZkuB,EAAUI,QAAQr0B,KAAK1D,OAAO2D,GAAI,gBAAiBm0B,EACpD,GAEJ,EAEDL,aAAa/pB,GAEXA,EAAKuC,KAAK,2BAA2BY,OAAOxB,IAC1C,IAAK3L,KAAKoF,KAAKW,KACb,OAEF,MAAMqnB,EAAezhB,EAAGG,cAAcuF,MAAMwiB,MACtCpxB,EAAS/G,OAAO4mB,KAAKxe,OAAOjE,IAAI4C,QACtC,IAAIqlB,EAAQrlB,EAAOkf,QAAQyL,GACvBtF,EAAQ,IAAMrlB,EAAOoG,OACvBif,EAAQ,EAERA,IAEF,MAAM7nB,EAAK4L,EAAEF,EAAGG,eAAeC,QAAQ,cAAc,GAAGuB,QACrD4lB,YACGe,EAAYj0B,KAAK6wB,OAAOC,WAAWh3B,IAAImG,GACzCD,KAAKoF,KAAKW,MACZkuB,EAAUI,QAAQr0B,KAAK1D,OAAO2D,GAAI,QAASwC,EAAOqlB,GACnD,IAGH9d,EAAKuC,KAAK,0CAA0CY,OAAOxB,IACzD,IAAK3L,KAAK6wB,OACR,OAEF,MAAMjsB,EAAO,CAAA,EACbwrB,GAAUkE,eAAet0B,KAAK6wB,OAAQjsB,GAClC5E,KAAKoF,KAAKW,MACZ/F,KAAK6wB,OAAOtiB,OAAO,CAAE3J,SAAQxL,MAAK,KAChC4G,KAAK6wB,OAAOQ,YAAY,GAE3B,GAEJ,EAEDkD,aAAa1D,EAAQjsB,EAAM/I,EAASoE,GAClC,MAAM+T,EAAQH,OAAOkW,OAAOjwB,IAAI8K,EAAKmP,SACrC,IAAI8f,EAAQ,QAEZ,OADoB7f,GAAOwgB,aAAexgB,GAAOpP,MAAM4vB,aAErD,KAAM,EACJX,EAAQ,MACR,MAGF,KAAK,EACHA,EAAQ,SACR,MAGF,KAAK,EACHA,EAAQ,QAIZjvB,EAAK6D,MAAQ,CACX+jB,IAAK,CACHyE,MAAO4C,IAGXhD,EAAO4D,aAAa,CAAEhsB,MAAO,CAAE+jB,IAAK,CAAEyE,MAAO4C,KAC9C,EAEDa,kBAAkBjkB,GAChB,MAAMmiB,EAAO5yB,KAAK6wB,OAAO8D,MAAMh1B,WAC5BizB,GAASA,EAAK3yB,KAAOwQ,EAAG7L,KAAK,kBAE5B5E,KAAKoF,KAAKW,MACZ/F,KAAK6wB,OAAOtiB,OAAO,CAAEqkB,QAExB,EAEDgC,gBAAgB5qB,EAAMnO,GACpBA,EAAQg5B,QAAQ,CACd9pB,KAAM,aACN/G,KAAM,sCACN+F,SAAUqmB,GAAUsE,mBAEvB,EAEDhwB,sBAAsBmsB,EAAQjsB,EAAMkwB,EAAM70B,GACxC,MAAM2a,EAAO5a,KAAKI,SAAStG,IAAIkG,KAAK1D,OAAO2D,GAAI,cACzCqxB,EAAStxB,KAAKI,SAAStG,IAAIkG,KAAK1D,OAAO2D,GAAI,oBACjD,GAAK2E,EAAK6H,MAAV,CAGA,GAAmB,IAAf7H,EAAK6H,MAAa,CACpB,GAAe,UAAX6kB,EAEF,YADAlB,GAAU2E,gBAAgBlE,EAAQjsB,EAAMkwB,EAAM70B,GAGhD,GAAe,SAAXqxB,EACF,MAEH,CACY,UAAT1W,EACFwV,GAAUkE,eAAezD,EAAQjsB,EAAMkwB,EAAM70B,GAC3B,eAAT2a,GACTwV,GAAU4E,qBAAqBnE,EAAQjsB,EAAMkwB,EAAM70B,EAbpD,CAeF,GCtSHyE,eAAeuwB,GAAaxtB,EAAO7C,GAOjC,GADAA,EAAKrI,SAAW,GACZkL,EAAMypB,QAAQlxB,KAAK1D,OAAO2D,GAAI,YAChCwH,EAAMD,QAAQ6H,SAAQ3K,MAAO6B,IAC3B,GARY,CAAC2uB,IACf,MAAMzvB,EAAO,IAAIC,KAAK,SAEtB,OADAD,EAAKG,SAAS,CAAElB,OAAO,IAChBe,EAAK4B,OAAS6tB,CAAM,EAKrBC,CAAQ5uB,EAAE9J,QAAS,CACrB,MAAM+P,EAAOjG,EAAE6uB,YAAY7uB,GAK3B,GAJA3B,EAAKrI,SAASgK,EAAEtG,IAAM,CACpBiO,IAAK3H,EAAE2H,IACP1B,KAAMyO,WAAWC,WAAW1O,EAAM,CAAE9H,OAAO,KAG3C6B,EAAExK,OAASwsB,MAAM8M,mBAAmBC,UACnB,cAAjB/uB,EAAEgvB,WACF,CACA,MAAMC,EAAgBx1B,KAAKy1B,OAAO37B,IAAIyM,EAAEmvB,gBAClCT,GAAaO,EAAe5wB,EAAKrI,SAASgK,EAAEtG,IACnD,CACF,SAEE,CACL,MAAMuH,QAAEA,SAAkBC,EAAMhC,OAChC+B,EAAQ6H,SAAS9K,IACfK,EAAKrI,SAASgI,EAAEtE,IAAM,CAAEiO,IAAK3J,EAAE2J,IAAK1B,KAAMjI,EAAEiI,KAAM,GAErD,CACD,OAAO5H,CACT,CAOOF,eAAeixB,GAAaluB,EAAO5L,EAAU,IAElD,MAAM+I,QAAaqwB,GAAaxtB,EAAO,CAAE,GACnCpC,EAAe,CACnB9I,SAAUqI,EAAKrI,SACfkL,SAIF,GAAI5L,EAAQkR,MAAO,CACDlB,EAAEhQ,EAAQkR,MAAMjB,cAAcuB,eAC3C4X,OACA1Y,KAAK,iBACA0F,MAAK,CAACC,EAAGlD,KACfA,EAAKuE,UAAUmgB,OAAO,UAClB9uB,EAAKrI,SAASyS,EAAK1B,QAAQooB,WAC7B1mB,EAAKuE,UAAUqiB,IAAI,SACpB,GAEJ,CAED,MAKMzwB,EAAW,CACfuB,cANiBD,eACjB,GAAG5G,EAAIC,iDACPuF,IAQIQ,EAAW7F,KAAKI,SAAStG,IAAI,OAAQ,YACvC,CAAC,SAAU,aAAayD,SAASsI,KACnCV,EAASa,QAAUC,YAAYC,qBAAqB,OACrC,aAAbL,IAAyBV,EAASa,QAAU,CAAChG,KAAKoF,KAAKe,MAC1C,cAAbN,IAA0BV,EAASiB,OAAQ,GAE/CH,YAAYa,OAAO3B,EACrB,CAEO,MAAM0wB,GAAsB,CACnCZ,aAAEA,GACFU,aAAEA,IC9HKjxB,eAAeoxB,GAAelxB,EAAMmxB,GACzC,GAAkB,UAAdnxB,EAAK7I,KACP,OAAOiE,KAAKoF,KAAK4wB,wBAAwBrhB,SAAS/P,EAAKgQ,MAAOmhB,GAEhE,GAAkB,cAAdnxB,EAAK7I,KAAsB,CAC7B,MAAMk6B,EAAU,4BAA4BrxB,EAAKgQ,UAC3CnN,QAAckN,SAAS/P,EAAKgQ,MAC5BshB,QAAcC,MAAMrvB,OAAO,CAC/BiE,KAAMtD,EAAMsD,KACZhP,KAAM,SACNmS,IAAKzG,EAAMyG,IACX+nB,UACAxtB,MAAO,CAAE,kBAAkB,KAE7B,OAAOzI,KAAKoF,KAAK4wB,kBAAkBE,EAAOH,EAC3C,CACD,GAAkB,SAAdnxB,EAAK7I,KACP,OAAO+M,GAAGC,cAAcqtB,KACtBp2B,KAAKuI,KAAKuB,SAAS,6BAEvB,GAAIlF,EAAKgQ,KAAK+M,QAAQ,UAAY,EAChC,OAAO7Y,GAAGC,cAAcqtB,KACtBp2B,KAAKuI,KAAKuB,SAAS,qCAEvB,MAAMkF,KAAEA,GAASpK,EAGXqxB,EAAU,2BAA2BjnB,EAAKjE,UAChD,IAAImrB,EAAQl2B,KAAKq2B,OAAOvhB,SAASvI,MAC9B+pB,GAAMA,EAAEvrB,OAASiE,EAAKjE,MAAQurB,EAAEL,UAAYA,IAW/C,OATKC,QAA0ChX,IAAjCgX,EAAMK,UAAUv2B,KAAKw2B,UACjCN,QAAcC,MAAMrvB,OAAO,CACzBiE,KAAMiE,EAAKjE,KACXhP,KAAM,SACNmS,IAAKc,EAAKd,IACV+nB,UACAxtB,MAAO,CAAE,iBAAiB,MAGvBzI,KAAKoF,KAAK4wB,kBAAkBE,EAAOH,EAC5C,CAWO,SAASU,GAAcC,GAC5B,MAAM3xB,EAAUkB,YAAY+G,aAE5B,IAAMjI,EAAQkD,QAASlD,EAAQ+O,MAC7B,OAAOhL,GAAGC,cAAcqtB,KACtBp2B,KAAKuI,KAAKuB,SAAS,uCAGvB,IAAI7B,EACAlD,EAAQiP,QAAO/L,EAAQjI,KAAK4pB,OAAOG,OAAOhlB,EAAQiP,QACjD/L,IAAOA,EAAQjI,KAAK4pB,OAAO9vB,IAAIiL,EAAQkD,QAG5C,MAAM3N,EAAQ2N,EAAQA,EAAM3N,MAAMqO,QAAQ9K,GAAMA,EAAEkN,OAAS2rB,IAAY,GACvE,GAAIp8B,EAAMuO,OAAS,EACjBC,GAAGC,cAAcqtB,KACfp2B,KAAKuI,KAAKC,OAAO,mCAAoC,CACnD4gB,UAAWnhB,EAAM8C,KACjB2rB,mBAGC,GAAqB,IAAjBp8B,EAAMuO,OACf,OAAOC,GAAGC,cAAcC,MACtBhJ,KAAKuI,KAAKC,OAAO,2BAA4B,CAC3C4gB,UAAWnhB,EAAM8C,KACjB2rB,cAON,OAHap8B,EAAM,GAGPmL,MACd,CAOO,SAASkxB,GAAeC,GAC7BjiB,SAASiiB,GAAWx9B,MAAMqO,GACV,OAAVA,EACKqB,GAAGC,cAAcC,MACtBhJ,KAAKuI,KAAKC,OAAO,gCAAiC,CAChDoM,KAAMgiB,KAMRnvB,EAAMypB,QAAQlxB,KAAK1D,OAAO2D,GAAI,YACzB01B,GAAaluB,GAEfA,EAAMovB,KAAK,CAAEC,aAAa,KAErC,CCxHA,MAAMC,GAAW,CAOXC,mBACF,OAAOh3B,KAAK4pB,OAAOjhB,QAChBsuB,GACc,cAAbA,EAAIl7B,MACJk7B,EAAIxuB,MAAMzI,KAAK1D,OAAO2D,MACc,IAApCg3B,EAAIxuB,MAAMzI,KAAK1D,OAAO2D,IAAIi3B,OAE/B,GCZY,MAAMC,WAAmB1sB,gBAC3BC,4BACT,OAAOO,QAAQC,MAAMqO,YAAYzd,MAAM4O,eAAgB,CACrDC,QAAS,CAAC,MAAO,SAAU,YAC3BzF,SAAU,GAAGrF,EAAIC,4CACjB8K,MAAO,IACP8M,OAAQ,OACRF,WAAW,EACX4f,eAAe,GAElB,CAUGvyB,YACF,OAAO7E,KAAKuI,KAAKuB,SAAS,qBAC3B,CASDkB,UACE,MAAO,CACL4e,OAAQmN,GAASC,aACjBpyB,KAAMpK,KAAKsQ,OACXxF,OAAQxB,OAAOjE,IACfuF,KAAMpF,KAAKoF,KACXhF,SAAUJ,KAAKI,SAElB,CAGD2sB,QAAQhgB,GAGN,IAAInI,EAFJmI,EAAMuB,iBAGN,IAEE,GADA1J,EAAO2P,KAAKkC,MAAM1J,EAAMsH,aAAarJ,QAAQ,eAC3B,SAAdpG,EAAK7I,KAAiB,MAG3B,CAFC,MAAOiN,GACP,OAAO,CACR,CACF,CAIDquB,cAActqB,GAEZvS,KAAK88B,QAAQvqB,EACd,CAGDwqB,kBACE,MAAMP,aAAEA,GAAiBD,GAEnB/sB,EAAO6B,EAAErR,KAAKwK,MACdwyB,EAAUxtB,EAAKuC,KAAK,uBAAuBgB,MAC3CkqB,EAAcvrB,WAAWsrB,GAAWR,EAAanuB,OAEvDmuB,EAAa3nB,SAASyL,IACpB,MAAMgQ,EAAYhQ,GAAGxe,OACfo7B,EAAU78B,KAAKmwB,MAClBF,EAAUnjB,QAAQsjB,GAAG0M,MAAQ,IAAOF,GAEvCztB,EAAKuC,KAAK,qBAAqBuO,EAAE7a,cAAcsN,IAAImqB,EAAQ,GAE9D,CAGDJ,UACezrB,EAAErR,KAAKwK,MACFuH,KAAK,UAClB0F,MAAK,CAACC,EAAG0lB,KACZ,MAAMC,EAAOhsB,EAAE+rB,GACT/+B,EAAQg/B,EAAKtrB,KAAK,SAASgB,MAC3BtN,EAAK43B,EAAKjzB,KAAK,WACfqD,EAAQ8uB,GAASC,aAAazqB,MAAMvT,GAAMA,EAAEiH,KAAOA,IACrDpH,GACFoP,EAAM4iB,cAAchwB,KAAKmwB,MAAMhZ,SAASnZ,EAAO,KAChD,GAEJ,CAEDqU,kBAAkBlD,GAChBlO,MAAMoR,kBAAkBlD,GAELA,EAAKuC,KAAK,uBAElBwZ,GAAG,QAASvrB,KAAK+8B,gBAAgBpe,KAAK3e,OAEjDwP,EAAKuC,KAAK,gCAAgCY,OAAOJ,IAC/CjR,MAAM6R,OAAOZ,EAAM,GAEtB,ECtGH,MAAM+qB,GAAQ,CACZC,gBAAY,GAGC,MAAMC,WAAsBvtB,gBAC9BC,4BACT,OAAOO,QAAQC,MAAMqO,YAAYzd,MAAM4O,eAAgB,CACrDC,QAAS,CAAC,MAAO,SAAU,eAC3BzF,SAAU,GAAGrF,EAAIC,+CACjB8K,MAAO,IACP8M,OAAQ,IACRF,WAAW,EACXygB,SAAU,CACR,CAAEC,aAAc,qBAAsBC,aAAc,mBAEtDf,eAAe,GAElB,CAEDnY,cACE6Y,GAAMC,WAAa,IAAIC,EACxB,CAED/Y,sBAAsBpjB,EAAU,IAC9Bm8B,GAAcD,WAAWzxB,QAAO,EAAM,CAAE8xB,OAAO,KAASv8B,GACzD,CAEUk8B,wBACT,OAAOD,GAAMC,UACd,CASGlzB,YACF,OAAO7E,KAAKuI,KAAKuB,SAAS,wBAC3B,CASDkB,UACE,MAAM5K,EAAW,CACfi4B,UAAWr4B,KAAKI,SAAStG,IAAIkG,KAAK1D,OAAO2D,GAAI,gBAG/C,MAAO,CACLq4B,YAAavB,GAASC,aAEtB1xB,OAAQxB,OAAOjE,IACfuF,KAAMpF,KAAKoF,KACXhF,WAEH,CAEDsE,uBAAuBuD,GACF,cAAfA,EAAMlM,YAIJkM,EAAMosB,QAAQr0B,KAAK1D,OAAO2D,GAAI,SAAS,EAC9C,CAEDyE,4BAA4BuD,SACpBA,EAAMosB,QAAQr0B,KAAK1D,OAAO2D,GAAI,SAAS,EAC9C,CAOD8sB,QAAQhgB,GAGN,IAAInI,EAFJmI,EAAMuB,iBAGN,IAGE,OAFA1J,EAAO2P,KAAKkC,MAAM1J,EAAMsH,aAAarJ,QAAQ,eAErCpG,EAAK7I,MACX,IAAK,QACH,OAAOvB,KAAK+9B,aAAaxrB,EAAOnI,GAGlC,IAAK,SACH,OAAOpK,KAAKg+B,cAAczrB,EAAOnI,GAKtC,CAFC,MAAOoE,GACP,OAAO,CACR,CACF,CAEDtE,mBAAmBqI,EAAOnI,GACxB,GAAkB,UAAdA,EAAK7I,KACP,OAGiBiE,KACnB,MAAMy4B,QAAqB9jB,SAAS/P,EAAKgQ,MAEzCpa,KAAKk+B,iBAAiBD,EACvB,CAEDE,oBAAoBjkB,GAClBA,EAAOI,SAASzF,SAASpH,GAAUzN,KAAKk+B,iBAAiBzwB,KACzDyM,EAAOkkB,SAASvpB,SAASqF,GAAWla,KAAKm+B,oBAAoBjkB,EAAOA,SACrE,CAEDhQ,oBAAoBqI,EAAOnI,GACzB,GAA0B,UAAtBA,EAAKi0B,aACP,OAGF,MAAMnkB,QAAeC,SAAS/P,EAAKgQ,MAC9BF,GAELla,KAAKm+B,oBAAoBjkB,EAC1B,CAGDhQ,mBAAmBqI,GACjB,IACE,MAAM6H,KAAEA,GAAS7H,EAAMjB,cAAcwB,QAC/B+F,SAAkBsB,SAASC,IAAOnB,aAExC1G,EAAMsH,aAAaC,QAAQ,aAAcC,KAAKC,UAAUnB,GAGzD,CAFC,MAAOrK,GACP,OAAO,CACR,CAED,OAAO,CACR,CAIDtE,cAAciH,GACZ,IAAIwrB,GAAW38B,KAAKsQ,OAAQ,CAAE,GAAExE,QAAO,EACxC,CAGD4G,kBAAkBlD,GAChBlO,MAAMoR,kBAAkBlD,GAExBA,EAAKuC,KAAK,oBAAoBY,MAAM3S,KAAK88B,QAAQne,KAAK3e,OAGtD,MAAMs+B,EAAY/rB,IAChB,MAAM9M,EAAK8M,EAAMjB,cAAcC,QAAQ,UAAUuB,QAAQoG,QACzD,OAAO1T,KAAK4pB,OAAO9vB,IAAImG,EAAG,EAG5B+J,EAAKuC,KAAK,+CAA+CY,OAAOJ,IAC9D+rB,EAAS/rB,GAAOyB,MAAMlI,QAAO,EAAK,IAGpC0D,EACGuC,KAAK,iDACLY,OAAMzI,MAAOqI,UACNvS,KAAKu+B,sBAAsBD,EAAS/rB,GAAO,GAEtD,EC3KI,MAWMwB,GAAUtG,IAGH,OAFAA,EAAMipB,QAAQlxB,KAAK1D,OAAO2D,GAAI,UAMhD+3B,GAAcD,WAAWzxB,QAAQ,ECjBtB0yB,GAASC,GACpB,IAAIxgC,SAASC,IACXk4B,WAAWl4B,EAASugC,EAAG,IAMdC,GAAY,sBACnBvb,EAAA3d,KAAK+oB,+BAAUmD,QACF,QAAf/J,EAAAniB,KAAK+oB,gBAAU,IAAA5G,GAAAA,EAAAgX,cAAcC,gBAAgB,GAAI,CAAEC,WAAW,IAAO,EAQ5DC,GAAe,IAAMN,GApBf,KAsBNO,GAAeC,GAC1B99B,OAAO8B,OAAOsL,GAAG2wB,SAAS9wB,QAAQiJ,GAChCA,EAAE/V,QAAQ8O,QAAQpN,SAASi8B,KAGlBE,GAAc,IACzBh+B,OAAO8B,OAAOsL,GAAG2wB,SAAS9wB,QAAQiJ,GAAMA,EAAE/V,QAAQ8O,QAAQpN,SAAS,YAExDo8B,GAAe,IAAWvhC,OAAA,OAAA,OAAA,GAAA,kBACtB,QAAfulB,EAAA+b,YAAe,IAAA/b,GAAAA,EAAAtO,SAAeuC,GAAKxZ,OAAA,OAAA,OAAA,GAAA,kBAC3BwZ,EAAEtH,OACT,KACH,IAEasvB,GAAc,IAAWxhC,OAAA,OAAA,OAAA,GAAA,YACpCmhC,GAAY,SAASlqB,SAAejL,GAAMhM,OAAA,OAAA,OAAA,GAAA,YAAA,OAAAgM,EAAEkG,OAAO,MACnDgvB,IACF,IAMaO,GAAqB,CAChC99B,EACA6I,EAAe,CAAA,EACf6P,EAAc,KACZrc,OAAA,OAAA,OAAA,GAAA,YACF,OAAA+xB,MAAMrjB,OAAMpL,OAAAgnB,OAAAhnB,OAAAgnB,OAAA,GACP9d,GACH,CAAAmG,KAAM,cAAc0J,IACpB1Y,aAGS+9B,GAAsB,CACjC/9B,EACAgP,EAAe,kBAAkBhP,EAAKmb,iBACpC9e,OAAA,OAAA,OAAA,GAAA,YACF,OAAAgd,KAAKtO,OAAO,CACV/K,OACAgP,YAGSgvB,GAAsB,CACjC9xB,EACAlM,EACAgP,EAAe,kBAAkBhP,EAAKmb,eACtCtS,EAAe,CAAE,wCACd,OAAAqD,aAAK,EAALA,EAAOmG,wBAAwB,OAAQ,gBAAGrS,OAAMgP,QAASnG,IAAQ,IAEzDo1B,GAAkB,IAAW5hC,OAAA,OAAA,OAAA,GAAA,YACxC,OAAA+9B,MAAMrvB,OAAO,CACXiE,KAAM,cAAcE,QAAQC,MAAM+uB,aAClCl+B,KAAM,SACNk6B,QAAS,qCAGAiE,GAAkB,IAC7B9hC,OAAA,OAAA,OAAA,GAAA,YAAA,OAAA+hC,MAAMrzB,OAAO,CAAEiE,KAAM,aAAcqvB,aAAa,GAAO,IAE5CC,GAAyB5lB,GAAerc,OAAA,OAAA,OAAA,GAAA,YAAA,IAAA+pB,EACnD,OAAa,QAAbA,EAAAniB,KAAK4pB,cAAQ,IAAAzH,OAAA,EAAAA,EAAAmY,QAAQ,cAAc7lB,IAAM,IAM9B8lB,GAAgB,IAAWniC,OAAA,OAAA,OAAA,GAAA,kBACtC,MAAMoiC,EAAwB,QAAX9K,EAAA1vB,KAAKq2B,cAAM,IAAA3G,OAAA,EAAAA,EAAE/mB,QAAQiJ,IAAM,IAAA+L,EAAA,OAAQ,QAARA,EAAA/L,EAAE7G,YAAM,IAAA4S,OAAA,EAAAA,EAAApgB,SAAS,aAAa,IAE5E,OADAi9B,SAAAA,EAAYnrB,SAAeuC,GAAMxZ,OAAA,OAAA,OAAA,GAAA,YAAA,aAAMwZ,EAAE6oB,QAAQ,OAC1C,CACT,IAEaC,GAA4BjmB,GAAerc,OAAA,OAAA,OAAA,GAAA,kBAC3C,QAAX63B,EAAAjwB,KAAK4pB,cAAM,IAAAqG,GAAAA,EACPtnB,QAAQmS,GAAMA,EAAE/P,OAAS,cAAc0J,MACxCpF,SAAeyL,GAAM1iB,OAAA,OAAA,OAAA,GAAA,YAAA,aAAM0iB,EAAE2f,QAAQ,KAC1C,IAEaE,GAAoB,IAAWviC,OAAA,OAAA,OAAA,GAAA,kBAChC,QAAVwiC,EAAA56B,KAAK1F,aAAK,IAAAsgC,GAAAA,EACNjyB,QAAQmS,UAAM,OAAS,QAAT6C,EAAA7C,eAAAA,EAAG/P,YAAM,IAAA4S,OAAA,EAAAA,EAAApgB,SAAS,iBAAiB,IAClD8R,SAAeyL,uCAAM,aAAMA,EAAE2f,QAAQ,KAC1C,IAEaI,GAAgB,IAAWziC,OAAA,OAAA,OAAA,GAAA,kBAC3B,QAAX0iC,EAAA96B,KAAKwpB,cAAM,IAAAsR,GAAAA,EACPnyB,QAAQpE,GAAiB,eAAXA,EAAEwG,OACjBsE,SAAe9K,GAAMnM,OAAA,OAAA,OAAA,GAAA,YAAA,aAAMmM,EAAEk2B,QAAQ,KAC1C,IAKaM,GAAY,IAAI3rB,IAAI,CAC/B,QACA,UACA,QACA,SACA,OACA,cClHWqF,GAAM,gCACN5Y,GAAU,CAAEm/B,YAAa,qCAEhCC,GAAkB,IAAMpB,GAAmB,YAAa,CAAE,EAAEplB,IAElE,IAAAymB,GAAe,EAAGC,WAAUC,KAAIC,SAAQ9H,QAAO+H,aAC7C,MAAMC,EAAY,IAAI/X,GAChBgY,EAAqBx7B,KAAKI,SAAStG,IAAIkG,KAAK1D,OAAO2D,GAAI,eACvDw7B,EAAoBz7B,KAAKI,SAAStG,IAAIkG,KAAK1D,OAAO2D,GAAI,cAE5DszB,GAAM,KACJvzB,KAAKI,SAASpG,IAAIgG,KAAK1D,OAAO2D,GAAI,cAAeu7B,GACjDx7B,KAAKI,SAASpG,IAAIgG,KAAK1D,OAAO2D,GAAI,aAAcw7B,GAChDf,GAAmBjmB,GAAI,IAIzB0mB,EAAS,wBAAwB,KAC/BG,GAAO,IAAWljC,OAAA,OAAA,OAAA,GAAA,kBACV6iC,IACP,MAEDG,EAAG,cAAc,IAAWhjC,OAAA,OAAA,OAAA,GAAA,YAC1B,MAAM6P,QAAcoyB,GAAgB5lB,IACpC4mB,EAAOpzB,eAAAA,EAAO3L,OAAOqE,QAAQ+6B,IAAIxc,UACjCmc,EAAOpzB,aAAK,EAALA,EAAO3L,OAAOqE,OAAOC,KAAK86B,IAAIxc,UACrCmc,EAAOpzB,aAAA,EAAAA,EAAO3L,OAAOqE,OAAOC,IAAIS,IAAIq6B,IAAIxc,UACxCmc,EAAOpzB,aAAK,EAALA,EAAO3L,OAAOqE,OAAOE,KAAK66B,IAAIxc,UACrCmc,EAAOpzB,aAAA,EAAAA,EAAO3L,OAAOqE,OAAOE,IAAIgf,UAAU6b,IAAIxc,UAC9Cmc,EAAOpzB,aAAA,EAAAA,EAAO3L,OAAOqE,OAAOE,IAAIkf,QAAQ2b,IAAIxc,UAC5Cmc,EAAOpzB,aAAK,EAALA,EAAO3L,OAAOqE,OAAOI,KAAK26B,IAAIxc,UACrCmc,EAAOpzB,aAAK,EAALA,EAAO3L,OAAOqE,OAAOG,KAAK46B,IAAIxc,UACrCmc,EAAOpzB,aAAA,EAAAA,EAAO3L,OAAOqE,OAAOG,IAAI8Z,MAAM8gB,IAAIxc,UAC1Cmc,EAAOpzB,aAAK,EAALA,EAAO3L,OAAOqE,OAAOK,KAAK06B,IAAIxc,UACrCmc,EAAOpzB,aAAK,EAALA,EAAO3L,OAAOqE,OAAOM,KAAKy6B,IAAIxc,UACrCmc,EAAOpzB,aAAA,EAAAA,EAAO3L,OAAOqE,OAAOM,IAAIwf,SAASib,IAAIxc,UAC7Cmc,EAAOpzB,aAAA,EAAAA,EAAO3L,OAAOqE,OAAOM,IAAI0f,QAAQ+a,IAAIxc,UAC5Cmc,EAAOpzB,aAAA,EAAAA,EAAO3L,OAAOqE,OAAOM,IAAI4f,KAAK6a,IAAIxc,SAC1C,MAEDkc,EAAG,mBAAmB,IAAWhjC,OAAA,OAAA,OAAA,GAAA,YAC/B,MAAM6P,QAAcoyB,GAAgB5lB,IACpC4mB,EAAOpzB,eAAAA,EAAO3L,OAAO6D,aAAau7B,IAAIxc,UACtCmc,EAAOpzB,aAAK,EAALA,EAAO3L,OAAO6D,YAAYhG,SAASuhC,IAAIxc,UAC9Cmc,EAAOpzB,aAAK,EAALA,EAAO3L,OAAO6D,YAAYxF,SAAS+gC,IAAIxc,UAC9Cmc,EAAOpzB,aAAK,EAALA,EAAO3L,OAAO6D,YAAYvF,KAAK8gC,IAAIxc,UAC1Cmc,EAAOpzB,aAAK,EAALA,EAAO3L,OAAO6D,YAAYpF,YAAY2gC,IAAIxc,UACjDmc,EAAOpzB,aAAK,EAALA,EAAO3L,OAAO6D,YAAYnF,OAAO0gC,IAAIxc,UAC5Cmc,EAAOpzB,aAAK,EAALA,EAAO3L,OAAO6D,YAAYtH,OAAO6iC,IAAIxc,UAC5Cmc,EAAOpzB,aAAK,EAALA,EAAO3L,OAAO6D,YAAY/F,KAAKshC,IAAIxc,UAC1Cmc,EAAOpzB,aAAK,EAALA,EAAO3L,OAAO6D,YAAYw7B,kBAAkBD,IAAIxc,UACvDmc,EAAOpzB,aAAK,EAALA,EAAO3L,OAAO6D,YAAYy7B,qBAAqBF,IAAIxc,UAC1Dmc,EAAOpzB,aAAK,EAALA,EAAO3L,OAAO6D,YAAY07B,oBAAoBH,IAAIxc,SAC1D,MAEDkc,EAAG,gBAAgB,IAAWhjC,OAAA,OAAA,OAAA,GAAA,YAC5B,MAAM6P,QAAcoyB,GAAgB5lB,IACpC4mB,EAAOpzB,eAAAA,EAAO3L,OAAOsnB,UAAU8X,IAAIxc,UACnCmc,EAAOpzB,aAAK,EAALA,EAAO3L,OAAOsnB,SAASzG,MAAMue,IAAIxc,UACxCmc,EAAOpzB,aAAK,EAALA,EAAO3L,OAAOsnB,SAASpF,WAAWkd,IAAIxc,UAC7Cmc,EAAOpzB,aAAK,EAALA,EAAO3L,OAAOsnB,SAASnF,UAAUid,IAAIxc,SAC7C,MAEDkc,EAAG,UAAU,IAAWhjC,OAAA,OAAA,OAAA,GAAA,YACtB,MAAM6P,QAAcoyB,GAAgB5lB,IACpC4mB,EAAOpzB,eAAAA,EAAO3L,OAAOwL,IAAI4zB,IAAIxc,UAC7Bmc,EAAOpzB,aAAK,EAALA,EAAO3L,OAAOwL,GAAGqV,MAAMue,IAAIxc,UAClCmc,EAAOpzB,aAAK,EAALA,EAAO3L,OAAOwL,GAAGwV,OAAOoe,IAAIxc,UACnCmc,EAAOpzB,aAAK,EAALA,EAAO3L,OAAOwL,GAAG1F,QAAQs5B,IAAIxc,UACpCmc,EAAOpzB,aAAK,EAALA,EAAO3L,OAAOwL,GAAGjP,OAAO6iC,IAAIxc,UACnCmc,EAAOpzB,aAAK,EAALA,EAAO3L,OAAOwL,GAAG6U,KAAK+e,IAAIxc,SAClC,MAEDkc,EAAG,WAAW,IAAWhjC,OAAA,OAAA,OAAA,GAAA,YACvB,MAAM6P,QAAcoyB,GAAgB5lB,IACpC4mB,EAAOpzB,eAAAA,EAAO3L,OAAO8L,KAAKszB,IAAIxc,UAC9Bmc,EAAOpzB,aAAK,EAALA,EAAO3L,OAAO8L,IAAI+U,MAAMue,IAAIxc,UACnCmc,EAAOpzB,aAAK,EAALA,EAAO3L,OAAO8L,IAAIkV,OAAOoe,IAAIxc,UACpCmc,EAAOpzB,aAAK,EAALA,EAAO3L,OAAO8L,IAAIhG,QAAQs5B,IAAIxc,UACrCmc,EAAOpzB,aAAK,EAALA,EAAO3L,OAAO8L,IAAIvP,OAAO6iC,IAAIxc,UACpCmc,EAAOpzB,aAAK,EAALA,EAAO3L,OAAO8L,IAAIuU,KAAK+e,IAAIxc,SACnC,MAEDic,EAAS,cAAc,KACrB,MAAMW,EAAc,IAAI1sB,IAAI,CAAC,IAAK,IAAK,IAAK,IAAK,IAAK,MAEtDgsB,EAAG,cAAc,IAAWhjC,OAAA,OAAA,OAAA,GAAA,YAC1B,MAAM6P,QAAcoyB,GAAgB5lB,IACpC4mB,EAAOpzB,eAAAA,EAAO3L,OAAO+d,QAAQqhB,IAAIxc,UACjCmc,EAAOpzB,aAAK,EAALA,EAAO3L,OAAO+d,OAAO1f,SAAS+gC,IAAIxc,UACzCmc,EAAOpzB,aAAK,EAALA,EAAO3L,OAAO+d,OAAOC,WAAWohB,IAAIxc,UAC3Cmc,EAAOpzB,aAAK,EAALA,EAAO3L,OAAO+d,OAAOE,OAAOmhB,IAAIxc,SACxC,MAED4c,EAAYzsB,SAAS2H,IACnBokB,EAAG,mBAAmBpkB,KAAO,IAAW5e,OAAA,OAAA,OAAA,GAAA,YACtC,MAAM6P,QAAcoyB,GAAgB5lB,IACpC4mB,EAAOpzB,eAAAA,EAAO3L,OAAO+d,OAAOE,MAAMvD,IAAM0kB,IAAIxc,UAC5Cmc,EAAO3/B,OAAO4mB,KAAKra,aAAK,EAALA,EAAO3L,OAAO+d,OAAOE,MAAMvD,KAAO+kB,QAAQ,QAC7DV,EAAO3/B,OAAO4mB,KAAKra,aAAK,EAALA,EAAO3L,OAAO+d,OAAOE,MAAMvD,KAAO+kB,QAAQ,MAC9D,KAAC,GACF,IAGJxI,GAAM,KACJmH,GAAmBjmB,GAAI,GACvB,IAGJ0mB,EAAS,kBAAkB,KACzBG,GAAO,IAAWljC,OAAA,OAAA,OAAA,GAAA,kBACV6iC,IACP,MAEkB,CAAC,SAAU,aAAc,QAAS,aAC1C5rB,SAAS0C,IAClBqpB,EAAG,OAAOrpB,KAAS,IAAW3Z,OAAA,OAAA,OAAA,GAAA,YAC5B,MAAM6P,QAAcoyB,GAAgB5lB,IACpC4mB,EAAOpzB,aAAK,EAALA,EAAO3L,OAAOyV,IAAQ2pB,IAAIxc,SAClC,KAAC,IAGoB,CACtB,CAAEnN,MAAO,KAAMiqB,UAAW,CAAC,KAAM,QAAS,QAC1C,CAAEjqB,MAAO,cAAeiqB,UAAW,CAAC,KAAM,KAAM,KAAM,OACtD,CAAEjqB,MAAO,WAAYiqB,UAAW,CAAC,UAAW,UAAW,UAEzC3sB,SAAQ,EAAG0C,QAAOiqB,gBAChCA,EAAU3sB,SAAS4sB,IACjBb,EAAG,GAAGrpB,eAAmBkqB,cAAqB,IAAW7jC,OAAA,OAAA,OAAA,GAAA,YACvD,MAAM6P,QAAcoyB,GAAgB5lB,IACpC4mB,EAAOpzB,aAAK,EAALA,EAAO3L,OAAOyV,IAAQ2pB,IAAIxc,UACjCmc,EAAOpzB,aAAA,EAAAA,EAAO3L,OAAOyV,GAAOkqB,IAAWP,IAAIxc,SAC5C,KAAC,GACF,IAG0B,CAC5B,CACEnN,MAAO,QACPiqB,UAAW,CACT,CAAEC,SAAU,SAAUC,YAAa,CAAC,UACpC,CAAED,SAAU,QAASC,YAAa,CAAC,UACnC,CAAED,SAAU,YAAaC,YAAa,CAAC,UACvC,CAAED,SAAU,QAASC,YAAa,CAAC,UACnC,CAAED,SAAU,OAAQC,YAAa,CAAC,aAIlB7sB,SAAQ,EAAG0C,QAAOiqB,gBACtCA,EAAU3sB,SAAQ,EAAG4sB,WAAUC,kBAC7Bd,EAAG,GAAGrpB,eAAmBkqB,yBAAgCC,WAAqB,IAAW9jC,OAAA,OAAA,OAAA,GAAA,YACvF,MAAM6P,QAAcoyB,GAAgB5lB,IACpC4mB,EAAOpzB,aAAK,EAALA,EAAO3L,OAAOyV,IAAQ2pB,IAAIxc,UACjCmc,EAAOpzB,aAAA,EAAAA,EAAO3L,OAAOyV,GAAOkqB,IAAWP,IAAIxc,UAC3Cmc,EAAOpzB,eAAAA,EAAO3L,OAAOyV,GAAOkqB,GAAUC,IAAcR,IAAIxc,SACzD,KAAC,GACF,IAGJqU,GAAM,KACJmH,GAAmBjmB,GAAI,GACvB,IAGJ0mB,EAAS,qBAAqB,KAC5BC,EAAG,oCAAoC,KACrCC,EAAOE,EAAU9gB,iBAAiB0hB,MAChCn8B,KAAKI,SAAStG,IAAIkG,KAAK1D,OAAO2D,GAAI,eACnC,GACD,IAGJk7B,EAAS,cAAc,KACrBA,EAAS,kBAAkB,KACzBG,GAAO,IAAWljC,OAAA,OAAA,OAAA,GAAA,kBACV4H,KAAKI,SAASpG,IAAIgG,KAAK1D,OAAO2D,GAAI,eAAe,EACxD,MAEDm7B,EAAG,6CAA6C,KAC9CC,EAAOE,EAAU7gB,UAAUyhB,MAAM,EAAE,IAGrCf,EAAG,qDAAqD,KACtDG,EAAU1zB,MAAMgd,IAAM,GACtBwW,EAAOE,EAAU7gB,UAAUyhB,MAAM,IACjCZ,EAAU1zB,MAAMgd,IAAM,EACtBwW,EAAOE,EAAU1zB,MAAMgd,KAAKsX,MAAM,EAAE,GACpC,IAGJhB,EAAS,mBAAmB,KAC1BG,GAAO,IAAWljC,OAAA,OAAA,OAAA,GAAA,kBACV4H,KAAKI,SAASpG,IAAIgG,KAAK1D,OAAO2D,GAAI,eAAe,EACxD,MAEDm7B,EAAG,4BAA4B,IAAWhjC,OAAA,OAAA,OAAA,GAAA,YACxCijC,EAAOE,EAAU7gB,UAAUyhB,MAAM,EAClC,KAAC,IAGJf,EAAG,qBAAqB,KACtBG,EAAU56B,OAAOC,IAAM,CAAE+b,IAAK,IAC9B0e,EAAOE,EAAU7gB,UAAUyhB,MAAM,IACjCZ,EAAU56B,OAAOC,IAAI+b,IAAM,EAC3B0e,EAAOE,EAAU56B,OAAOC,IAAI+b,KAAKwf,MAAM,EAAE,IAG3Cf,EAAG,6BAA6B,KAC9BG,EAAU1zB,MAAM8U,IAAM,CAAExZ,MAAO,GAC/Bk4B,EAAOE,EAAU7gB,UAAUyhB,MAAM,GACjCZ,EAAU1zB,MAAM8U,IAAIxZ,MAAQ,EAC5Bk4B,EAAOE,EAAU1zB,MAAM8U,IAAIxZ,OAAOg5B,MAAM,EAAE,GAC1C,IAGJhB,EAAS,eAAe,KACtBA,EAAS,kBAAkB,KACzBG,GAAO,IAAWljC,OAAA,OAAA,OAAA,GAAA,kBACV4H,KAAKI,SAASpG,IAAIgG,KAAK1D,OAAO2D,GAAI,eAAe,EACxD,MAEDm7B,EAAG,6CAA6C,KAC9CC,EAAOE,EAAU5gB,WAAWwhB,MAAM,EAAE,IAGtCf,EAAG,qDAAqD,KACtDG,EAAU1zB,MAAMgd,IAAM,GACtBwW,EAAOE,EAAU5gB,WAAWwhB,MAAM,IAClCZ,EAAU1zB,MAAMgd,IAAM,EACtBwW,EAAOE,EAAU1zB,MAAMgd,KAAKsX,MAAM,EAAE,GACpC,IAGJhB,EAAS,mBAAmB,KAC1BG,GAAO,IAAWljC,OAAA,OAAA,OAAA,GAAA,kBACV4H,KAAKI,SAASpG,IAAIgG,KAAK1D,OAAO2D,GAAI,eAAe,EACxD,MAEDm7B,EAAG,4BAA4B,IAAWhjC,OAAA,OAAA,OAAA,GAAA,YACxCijC,EAAOE,EAAU5gB,WAAWwhB,MAAM,EACnC,KAAC,IAGJf,EAAG,qBAAqB,KACtBG,EAAU56B,OAAOG,IAAM,CAAE6b,IAAK,IAC9B0e,EAAOE,EAAU5gB,WAAWwhB,MAAM,IAClCZ,EAAU56B,OAAOG,IAAI6b,IAAM,EAC3B0e,EAAOE,EAAU56B,OAAOG,IAAI6b,KAAKwf,MAAM,EAAE,IAG3Cf,EAAG,+BAA+B,KAChCG,EAAU1zB,MAAM8U,IAAM,CAAEvZ,QAAS,GACjCi4B,EAAOE,EAAU5gB,WAAWwhB,MAAM,GAClCZ,EAAU1zB,MAAM8U,IAAIvZ,QAAU,EAC9Bi4B,EAAOE,EAAU1zB,MAAM8U,IAAIvZ,SAAS+4B,MAAM,EAAE,GAC5C,IAGJhB,EAAS,WAAW,KAClBC,EAAG,wCAAwC,IAAWhjC,OAAA,OAAA,OAAA,GAAA,YACpD,MAAMgkC,QAAkBvC,GACtB,YACA,CACEv9B,OAAQ,CACNqE,OAAQ,CACNC,IAAK,CAAE/H,MAAO,GACdgI,IAAK,CAAEhI,MAAO,GACdkI,IAAK,CAAElI,MAAO,GACdiI,IAAK,CAAEjI,MAAO,GACdmI,IAAK,CAAEnI,MAAO,GACdoI,IAAK,CAAEpI,MAAO,MAIpB4b,IAEF4mB,EAAOe,aAAS,EAATA,EAAW9/B,OAAO+T,OAAOgsB,GAAGC,GAAGC,IACvC,MAEDnB,EAAG,6CAA6C,IAAWhjC,OAAA,OAAA,OAAA,GAAA,YACzD,MAAMgkC,QAAkBvC,GACtB,YACA,CACEv9B,OAAQ,CACNqE,OAAQ,CACNC,IAAK,CAAE/H,MAAO,IACdgI,IAAK,CAAEhI,MAAO,GACdkI,IAAK,CAAElI,MAAO,GACdiI,IAAK,CAAEjI,MAAO,GACdmI,IAAK,CAAEnI,MAAO,GACdoI,IAAK,CAAEpI,MAAO,MAIpB4b,IAEF4mB,EAAOe,aAAS,EAATA,EAAW9/B,OAAO+T,OAAOgsB,GAAGC,GAAGE,KACvC,MAEDpB,EAAG,+BAA+B,IAAWhjC,OAAA,OAAA,OAAA,GAAA,YAC3C,MAAMgkC,QAAkBvC,GACtB,UACA,CACEv9B,OAAQ,CACNioB,MAAO,CACLviB,OAAQ,CAAEnJ,MAAO,GACjBgJ,MAAO,CAAEhJ,MAAO,GAChBkJ,UAAW,CAAElJ,MAAO,GACpBoJ,MAAO,CAAEpJ,MAAO,GAChBiJ,KAAM,CAAEjJ,MAAO,MAIrB4b,IAEF4mB,EAAOe,aAAS,EAATA,EAAW9/B,OAAO+T,OAAOgsB,GAAGC,GAAGC,IACvC,MAEDnB,EAAG,oCAAoC,IAAWhjC,OAAA,OAAA,OAAA,GAAA,YAChD,MAAMgkC,QAAkBvC,GACtB,UACA,CACEv9B,OAAQ,CACNioB,MAAO,CACLviB,OAAQ,CAAEnJ,MAAO,IACjBgJ,MAAO,CAAEhJ,MAAO,GAChBkJ,UAAW,CAAElJ,MAAO,GACpBoJ,MAAO,CAAEpJ,MAAO,GAChBiJ,KAAM,CAAEjJ,MAAO,MAIrB4b,IAEF4mB,EAAOe,aAAS,EAATA,EAAW9/B,OAAO+T,OAAOgsB,GAAGC,GAAGE,KACvC,KAAC,IAGJrB,EAAS,gBAAgB,KACvBC,EAAG,0BAA0B,IAAWhjC,OAAA,OAAA,OAAA,GAAA,YACtC,MAAM6P,QAAcgzB,KACpBI,EAAOpzB,aAAA,EAAAA,EAAO3N,MAAMwa,SAASjM,QAAQszB,MAAM,GAC3Cd,EAAOpzB,aAAA,EAAAA,EAAO3L,OAAO4d,WAAWrR,QAAQszB,MAAM,SACxCl0B,aAAK,EAALA,EAAOmG,wBAAwB,OAAQ,CAC3C,CAAErS,KAAM,YAAagP,KAAM,oBAE7BswB,EAAOpzB,aAAA,EAAAA,EAAO3N,MAAMwa,SAASjM,QAAQszB,MAAM,GAC3Cd,EAAOpzB,eAAAA,EAAO3N,MAAMwa,SAAS,GAAG/J,MAAMoxB,MAAM,kBAE5C,MAAMzrB,EAASzI,aAAA,EAAAA,EAAO3N,MAAMwa,SAAS,GAAG7U,GACxCo7B,EAAOpzB,aAAA,EAAAA,EAAO3L,OAAO4d,WAAWrR,QAAQszB,MAAM,GAE9Cd,EAAOpzB,eAAAA,EAAO3L,OAAO4d,WAAW,GAAG/T,KAAKg2B,MAAMzrB,GAC9CzI,SAAAA,EAAOwyB,QACR,MAEDlH,GAAM,KACJmH,GAAmBjmB,GAAI,GACvB,IAGJ0mB,EAAS,eAAe,KACtBC,EAAG,8BAA8B,IAAWhjC,OAAA,OAAA,OAAA,GAAA,YAC1C,MAAM6P,QAAcgzB,KACpBI,EAAOpzB,aAAA,EAAAA,EAAO3N,MAAMwa,SAASjM,QAAQszB,MAAM,GAC3Cd,EAAOpzB,aAAA,EAAAA,EAAO3L,OAAO2d,UAAUpR,QAAQszB,MAAM,SACvCl0B,aAAK,EAALA,EAAOmG,wBAAwB,OAAQ,CAC3C,CAAErS,KAAM,OAAQgP,KAAM,gBAAiBzO,OAAQ,CAAEC,UAAU,MAE7D8+B,EAAOpzB,aAAA,EAAAA,EAAO3N,MAAMwa,SAASjM,QAAQszB,MAAM,GAC3Cd,EAAOpzB,eAAAA,EAAO3N,MAAMwa,SAAS,GAAG/J,MAAMoxB,MAAM,iBAC5Cd,EAAOpzB,eAAAA,EAAO3N,MAAMwa,SAAS,GAAGxY,OAAOC,UAAUkgC,GAAGF,KAEpD,MAAM7rB,EAASzI,aAAA,EAAAA,EAAO3N,MAAMwa,SAAS,GAAG7U,GACxCo7B,EAAOpzB,aAAA,EAAAA,EAAO3L,OAAO2d,UAAUpR,QAAQszB,MAAM,GAE7Cd,EAAOpzB,eAAAA,EAAO3L,OAAO2d,UAAU,GAAG9T,KAAKg2B,MAAMzrB,GAC7CzI,SAAAA,EAAOwyB,QACR,MAEDW,EAAG,sDAAsD,IAAWhjC,OAAA,OAAA,OAAA,GAAA,YAClE,MAAM6P,QAAcgzB,KACpBI,EAAOpzB,aAAA,EAAAA,EAAO3N,MAAMwa,SAASjM,QAAQszB,MAAM,GAC3Cd,EAAOpzB,aAAA,EAAAA,EAAO3L,OAAO2d,UAAUpR,QAAQszB,MAAM,SACvCl0B,aAAK,EAALA,EAAOmG,wBAAwB,OAAQ,CAC3C,CAAErS,KAAM,YAAagP,KAAM,oBAE7B,MAAM6K,EAAY3N,aAAA,EAAAA,EAAO3N,MAAMggC,QAAQ,wBACjCryB,aAAK,EAALA,EAAOmG,wBAAwB,OAAQ,CAE3C,CACErS,KAAM,OACNgP,KAAM,gBACNzO,OAAQ,CAAEC,UAAU,EAAMkV,YAAamE,aAAS,EAATA,EAAW3V,OAGtDo7B,EAAOpzB,aAAA,EAAAA,EAAO3N,MAAMwa,SAASjM,QAAQszB,MAAM,GAC3Cd,EAAOpzB,eAAAA,EAAO3N,MAAMwa,SAAS,GAAG/J,MAAMoxB,MAAM,kBAC5Cd,EAAOpzB,eAAAA,EAAO3N,MAAMwa,SAAS,GAAG/J,MAAMoxB,MAAM,iBAC5Cd,EAAOpzB,eAAAA,EAAO3N,MAAMwa,SAAS,GAAGxY,OAAOC,UAAUkgC,GAAGF,KACpDlB,EAAOpzB,aAAA,EAAAA,EAAO3N,MAAMwa,SAAS,GAAGxY,OAAOmV,aAAa0qB,MAAMvmB,aAAS,EAATA,EAAW3V,IACrEo7B,EAAOpzB,aAAA,EAAAA,EAAO3L,OAAO2d,UAAUpR,QAAQszB,MAAM,GAC7Cl0B,SAAAA,EAAOwyB,QACR,MAEDlH,GAAM,KACJmH,GAAmBjmB,GAAI,GACvB,IAGJ0mB,EAAS,qBAAqB,KAC5BC,EAAG,kCAAkC,IAAWhjC,OAAA,OAAA,OAAA,GAAA,YAC9C,MAAM6P,QAAcgzB,KACpBI,EAAOpzB,aAAA,EAAAA,EAAO3N,MAAMwa,SAASjM,QAAQszB,MAAM,GAC3Cd,EAAOpzB,aAAK,EAALA,EAAO3L,OAAO6d,iBAAiBgiB,MAAM,SACtCl0B,aAAK,EAALA,EAAOmG,wBAAwB,OAAQ,CAC3C,CACErS,KAAM,OACNgP,KAAM,gBACNzO,OAAQ,CAAEC,UAAU,EAAMC,SAAU,CAAE3D,MAAO,GAAKsV,KAAM,OAG5DktB,EAAOpzB,aAAA,EAAAA,EAAO3N,MAAMwa,SAASjM,QAAQszB,MAAM,GAC3Cd,EAAOpzB,eAAAA,EAAO3N,MAAMwa,SAAS,GAAG/J,MAAMoxB,MAAM,iBAC5Cd,EAAOpzB,eAAAA,EAAO3N,MAAMwa,SAAS,GAAGxY,OAAOC,UAAUkgC,GAAGF,KACpDlB,EAAOpzB,aAAK,EAALA,EAAO3L,OAAO6d,iBAAiBgiB,MAAM,IAC5Cl0B,SAAAA,EAAOwyB,QACR,MAEDW,EAAG,2CAA2C,IAAWhjC,OAAA,OAAA,OAAA,GAAA,YACvD,MAAM6P,QAAcgzB,KACpBI,EAAOpzB,aAAA,EAAAA,EAAO3N,MAAMwa,SAASjM,QAAQszB,MAAM,GAC3Cd,EAAOpzB,aAAK,EAALA,EAAO3L,OAAO6d,iBAAiBgiB,MAAM,SACtCl0B,aAAK,EAALA,EAAOmG,wBAAwB,OAAQ,CAC3C,CACErS,KAAM,OACNgP,KAAM,gBACNzO,OAAQ,CAAEC,UAAU,EAAMC,SAAU,CAAE3D,MAAO,GAAKsV,KAAM,KAE1D,CACEpS,KAAM,OACNgP,KAAM,kBACNzO,OAAQ,CAAEC,UAAU,EAAMC,SAAU,CAAE3D,MAAO,GAAKsV,KAAM,MAG5DktB,EAAOpzB,aAAA,EAAAA,EAAO3N,MAAMwa,SAASjM,QAAQszB,MAAM,GAC3Cd,EAAOpzB,eAAAA,EAAO3N,MAAMwa,SAAS,GAAG/J,MAAMoxB,MAAM,iBAC5Cd,EAAOpzB,eAAAA,EAAO3N,MAAMwa,SAAS,GAAGxY,OAAOC,UAAUkgC,GAAGF,KACpDlB,EAAOpzB,eAAAA,EAAO3N,MAAMwa,SAAS,GAAG/J,MAAMoxB,MAAM,mBAC5Cd,EAAOpzB,eAAAA,EAAO3N,MAAMwa,SAAS,GAAGxY,OAAOC,UAAUkgC,GAAGF,KACpDlB,EAAOpzB,eAAAA,EAAO3L,OAAO6d,iBAAiBgiB,MAAM,IAC5Cl0B,SAAAA,EAAOwyB,QACR,MAEDW,EAAG,2DAA2D,IAAWhjC,OAAA,OAAA,OAAA,GAAA,YACvE,MAAM6P,QAAcgzB,KACpBI,EAAOpzB,aAAA,EAAAA,EAAO3N,MAAMwa,SAASjM,QAAQszB,MAAM,GAC3Cd,EAAOpzB,aAAK,EAALA,EAAO3L,OAAO6d,iBAAiBgiB,MAAM,SACtCl0B,aAAK,EAALA,EAAOmG,wBAAwB,OAAQ,CAC3C,CAAErS,KAAM,YAAagP,KAAM,oBAE7B,MAAM6K,EAAY3N,aAAA,EAAAA,EAAO3N,MAAMggC,QAAQ,wBACjCryB,aAAK,EAALA,EAAOmG,wBAAwB,OAAQ,CAE3C,CACErS,KAAM,OACNgP,KAAM,gBACNzO,OAAQ,CACNC,UAAU,EACVkV,YAAamE,aAAA,EAAAA,EAAW3V,GACxBzD,SAAU,CAAE3D,MAAO,GACnBsV,KAAM,OAIZktB,EAAOpzB,aAAA,EAAAA,EAAO3N,MAAMwa,SAASjM,QAAQszB,MAAM,GAC3Cd,EAAOpzB,eAAAA,EAAO3N,MAAMwa,SAAS,GAAG/J,MAAMoxB,MAAM,kBAC5Cd,EAAOpzB,eAAAA,EAAO3N,MAAMwa,SAAS,GAAG/J,MAAMoxB,MAAM,iBAC5Cd,EAAOpzB,eAAAA,EAAO3N,MAAMwa,SAAS,GAAGxY,OAAOC,UAAUkgC,GAAGF,KAEpDlB,EAAOpzB,aAAA,EAAAA,EAAO3N,MAAMwa,SAAS,GAAGxY,OAAOmV,aAAa0qB,MAAMvmB,aAAS,EAATA,EAAW3V,IACrEo7B,EAAOpzB,aAAK,EAALA,EAAO3L,OAAO6d,iBAAiBgiB,MAAM,GAC5Cl0B,SAAAA,EAAOwyB,QACR,MAEDlH,GAAM,KACJmH,GAAmBjmB,GAAI,GACvB,IAGJ0mB,EAAS,WAAW,KAClBC,EAAG,0CAA0C,IAAWhjC,OAAA,OAAA,OAAA,GAAA,YACtD,MAAM6P,QAAcgzB,KACpBI,EAAOpzB,aAAA,EAAAA,EAAO3N,MAAMwa,SAASjM,QAAQszB,MAAM,GAC3Cd,EAAOpzB,aAAA,EAAAA,EAAO3L,OAAOhC,MAAMuO,QAAQszB,MAAM,SACnCl0B,aAAK,EAALA,EAAOmG,wBAAwB,OAAQ,CAC3C,CACErS,KAAM,OACNgP,KAAM,aAER,CACEhP,KAAM,OACNgP,KAAM,gBACNzO,OAAQ,CAAEC,UAAU,EAAMC,SAAU,CAAE3D,MAAO,GAAKsV,KAAM,MAG5DktB,EAAOpzB,aAAA,EAAAA,EAAO3N,MAAMwa,SAASjM,QAAQszB,MAAM,GAC3Cd,EAAOpzB,eAAAA,EAAO3N,MAAMwa,SAAS,GAAG/J,MAAMoxB,MAAM,aAC5Cd,EAAOpzB,eAAAA,EAAO3N,MAAMwa,SAAS,GAAG/J,MAAMoxB,MAAM,iBAC5Cd,EAAOpzB,eAAAA,EAAO3N,MAAMwa,SAAS,GAAGxY,OAAOC,UAAUkgC,GAAGF,KACpDlB,EAAOpzB,aAAA,EAAAA,EAAO3L,OAAOhC,MAAMuO,QAAQszB,MAAM,GACzCd,EAAOpzB,eAAAA,EAAO3L,OAAOhC,MAAM,GAAGyQ,MAAMoxB,MAAM,aAC1Cl0B,SAAAA,EAAOwyB,QACR,MAEDW,EAAG,sDAAsD,IAAWhjC,OAAA,OAAA,OAAA,GAAA,YAClE,MAAM6P,QAAcgzB,KACpBI,EAAOpzB,aAAA,EAAAA,EAAO3N,MAAMwa,SAASjM,QAAQszB,MAAM,GAC3Cd,EAAOpzB,aAAA,EAAAA,EAAO3L,OAAOhC,MAAMuO,QAAQszB,MAAM,SACnCl0B,aAAK,EAALA,EAAOmG,wBAAwB,OAAQ,CAC3C,CACErS,KAAM,YACNgP,KAAM,oBAGV,MAAM6K,EAAY3N,aAAA,EAAAA,EAAO3N,MAAMggC,QAAQ,wBACjCryB,aAAK,EAALA,EAAOmG,wBAAwB,OAAQ,CAE3C,CACErS,KAAM,OACNgP,KAAM,yBACNzO,OAAQ,CAAEmV,YAAamE,aAAA,EAAAA,EAAW3V,KAEpC,CACElE,KAAM,OACNgP,KAAM,eAGVswB,EAAOpzB,aAAA,EAAAA,EAAO3N,MAAMwa,SAASjM,QAAQszB,MAAM,GAC3Cd,EAAOpzB,eAAAA,EAAO3N,MAAMwa,SAAS,GAAG/J,MAAMoxB,MAAM,kBAC5Cd,EAAOpzB,eAAAA,EAAO3N,MAAMwa,SAAS,GAAG/J,MAAMoxB,MAAM,0BAC5Cd,EAAOpzB,eAAAA,EAAO3N,MAAMwa,SAAS,GAAG/J,MAAMoxB,MAAM,aAC5Cd,EAAOpzB,aAAA,EAAAA,EAAO3L,OAAOhC,MAAMuO,QAAQszB,MAAM,GACzCd,EAAOpzB,eAAAA,EAAO3L,OAAOhC,MAAM,GAAGyQ,MAAMoxB,MAAM,aAC1Cl0B,SAAAA,EAAOwyB,QACR,KAAC,IAGc,CAChB,CAAE1+B,KAAM,SAAU2gC,OAAQ,WAC1B,CAAE3gC,KAAM,UAAW2gC,OAAQ,aAC3B,CAAE3gC,KAAM,QAAS2gC,OAAQ,SACzB,CAAE3gC,KAAM,QAAS2gC,OAAQ,eAEjBrtB,SAAQ,EAAGtT,OAAM2gC,aACzBvB,EAAS,GAAGuB,OAAY,KACtBtB,EAAG,eAAesB,KAAU,IAAWtkC,OAAA,OAAA,OAAA,GAAA,YACrC,MAAM6P,QAAcgzB,KACpBI,EAAOpzB,aAAA,EAAAA,EAAO3N,MAAMwa,SAASjM,QAAQszB,MAAM,GAC3Cd,EAAOpzB,aAAA,EAAAA,EAAO3L,OAAOogC,GAAQ7zB,QAAQszB,MAAM,SACrCl0B,aAAK,EAALA,EAAOmG,wBAAwB,OAAQ,CAC3C,CAAErS,OAAMgP,KAAM,QAAQhP,OAExBs/B,EAAOpzB,aAAA,EAAAA,EAAO3N,MAAMwa,SAASjM,QAAQszB,MAAM,GAC3Cd,EAAOpzB,eAAAA,EAAO3N,MAAMwa,SAAS,GAAG/J,MAAMoxB,MAAM,QAAQpgC,KAEpD,MAAM2U,EAASzI,aAAA,EAAAA,EAAO3N,MAAMwa,SAAS,GAAG7U,GACxCo7B,EAAOpzB,aAAA,EAAAA,EAAO3L,OAAOogC,GAAQ7zB,QAAQszB,MAAM,GAE3Cd,EAAOpzB,eAAAA,EAAO3L,OAAOogC,GAAQ,GAAGv2B,KAAKg2B,MAAMzrB,GAC3CzI,SAAAA,EAAOwyB,QACR,MAEDW,EAAG,eAAesB,8BAAmC,IAAWtkC,OAAA,OAAA,OAAA,GAAA,YAC9D,GAAe,cAAXskC,EAAwB,OAE5B,MAAMz0B,QAAcgzB,KACpBI,EAAOpzB,aAAA,EAAAA,EAAO3N,MAAMwa,SAASjM,QAAQszB,MAAM,GAC3Cd,EAAOpzB,aAAA,EAAAA,EAAO3L,OAAOogC,GAAQ7zB,QAAQszB,MAAM,SACrCl0B,aAAK,EAALA,EAAOmG,wBAAwB,OAAQ,CAC3C,CACErS,KAAM,YACNgP,KAAM,oBAGV,MAAM6K,EAAY3N,aAAA,EAAAA,EAAO3N,MAAMggC,QAAQ,wBACjCryB,aAAK,EAALA,EAAOmG,wBAAwB,OAAQ,CAE3C,CACErS,OACAgP,KAAM,QAAQhP,iBACdO,OAAQ,CAAEmV,YAAamE,aAAA,EAAAA,EAAW3V,KAEpC,CACElE,OACAgP,KAAM,QAAQhP,OAGlBs/B,EAAOpzB,aAAA,EAAAA,EAAO3N,MAAMwa,SAASjM,QAAQszB,MAAM,GAC3Cd,EAAOpzB,eAAAA,EAAO3N,MAAMwa,SAAS,GAAG/J,MAAMoxB,MAAM,kBAC5Cd,EAAOpzB,eAAAA,EAAO3N,MAAMwa,SAAS,GAAG/J,MAAMoxB,MACpC,QAAQpgC,kBAEVs/B,EAAOpzB,eAAAA,EAAO3N,MAAMwa,SAAS,GAAG/J,MAAMoxB,MAAM,QAAQpgC,KAEpD,MAAM2U,EAASzI,aAAA,EAAAA,EAAO3N,MAAMwa,SAAS,GAAG7U,GACxCo7B,EAAOpzB,aAAA,EAAAA,EAAO3L,OAAOogC,GAAQ7zB,QAAQszB,MAAM,GAE3Cd,EAAOpzB,eAAAA,EAAO3L,OAAOogC,GAAQ,GAAGv2B,KAAKg2B,MAAMzrB,GAC3CzI,SAAAA,EAAOwyB,QACR,MAEDlH,GAAM,KACJmH,GAAmBjmB,GAAI,GACvB,GACF,IAGJ0mB,EAAS,YAAY,KACnBC,EAAG,+BAA+B,IAAWhjC,OAAA,OAAA,OAAA,GAAA,YAC3C,MAAM6P,QAAcgzB,KACpBI,EAAOpzB,eAAAA,EAAO3L,OAAOwoB,QAAQ2X,GAAGD,MAChCv0B,SAAAA,EAAOwyB,QACR,MAEDW,EAAG,8DAA8D,IAAWhjC,OAAA,OAAA,OAAA,GAAA,YAC1E,MAAM6P,QAAcgzB,KACpBI,EAAOpzB,aAAA,EAAAA,EAAO3N,MAAMwa,SAASjM,QAAQszB,MAAM,SACrCl0B,aAAK,EAALA,EAAOmG,wBAAwB,OAAQ,CAC3C,CACErS,KAAM,SACNgP,KAAM,cACNzO,OAAQ,CAAE+G,MAAM,EAAMzG,UAAU,MAGpCy+B,EAAOpzB,aAAA,EAAAA,EAAO3N,MAAMwa,SAASjM,QAAQszB,MAAM,GAC3Cd,EAAOpzB,eAAAA,EAAO3N,MAAMwa,SAAS,GAAG/J,MAAMoxB,MAAM,eAC5Cd,EAAOpzB,eAAAA,EAAO3L,OAAOwoB,QAAQ2X,GAAGD,MAChCv0B,SAAAA,EAAOwyB,QACR,MAEDW,EAAG,uEAAuE,IAAWhjC,OAAA,OAAA,OAAA,GAAA,YACnF,MAAM6P,QAAcgzB,KACpBI,EAAOpzB,aAAA,EAAAA,EAAO3N,MAAMwa,SAASjM,QAAQszB,MAAM,SACrCl0B,aAAK,EAALA,EAAOmG,wBAAwB,OAAQ,CAC3C,CACErS,KAAM,SACNgP,KAAM,cACNzO,OAAQ,CAAE+G,MAAM,EAAOzG,UAAU,MAGrCy+B,EAAOpzB,aAAA,EAAAA,EAAO3N,MAAMwa,SAASjM,QAAQszB,MAAM,GAC3Cd,EAAOpzB,eAAAA,EAAO3N,MAAMwa,SAAS,GAAG/J,MAAMoxB,MAAM,eAC5Cd,EAAOpzB,eAAAA,EAAO3L,OAAOwoB,QAAQ2X,GAAGD,MAChCv0B,SAAAA,EAAOwyB,QACR,MAEDW,EAAG,4DAA4D,IAAWhjC,OAAA,OAAA,OAAA,GAAA,YACxE,MAAM6P,QAAcgzB,KACpBI,EAAOpzB,aAAA,EAAAA,EAAO3N,MAAMwa,SAASjM,QAAQszB,MAAM,SACrCl0B,aAAK,EAALA,EAAOmG,wBAAwB,OAAQ,CAC3C,CACErS,KAAM,SACNgP,KAAM,cACNzO,OAAQ,CAAE+G,MAAM,EAAMzG,UAAU,MAGpCy+B,EAAOpzB,aAAA,EAAAA,EAAO3N,MAAMwa,SAASjM,QAAQszB,MAAM,GAC3Cd,EAAOpzB,eAAAA,EAAO3N,MAAMwa,SAAS,GAAG/J,MAAMoxB,MAAM,eAC5Cd,EAAOpzB,eAAAA,EAAO3L,OAAOwoB,QAAQ2X,GAAGF,KAChCt0B,SAAAA,EAAOwyB,QACR,MAEDlH,GAAM,KACJmH,GAAmBjmB,GAAI,GACvB,IAGJ0mB,EAAS,UAAU,KACjBA,EAAS,qBAAqB,KAC5BG,GAAO,IAAWljC,OAAA,OAAA,OAAA,GAAA,kBACV4H,KAAKI,SAASpG,IAAIgG,KAAK1D,OAAO2D,GAAI,aAAc,QACvD,MAEDm7B,EAAG,aAAa,KACdC,EAAOE,EAAU3gB,MAAMuhB,MAAM,EAAE,IAGjCf,EAAG,uCAAuC,IAAWhjC,OAAA,OAAA,OAAA,GAAA,YACnDmjC,EAAUnrB,WAAWvX,MAAQ,GAC7BwiC,EAAOE,EAAU3gB,MAAMuhB,MAAM,GAC7BZ,EAAUnrB,WAAWvX,MAAQ,EAC7BwiC,EAAOE,EAAUnrB,WAAWvX,OAAOsjC,MAAM,EAC1C,MAEDf,EAAG,qCAAqC,IAAWhjC,OAAA,OAAA,OAAA,GAAA,YACjDmjC,EAAUnrB,WAAWuM,IAAM,GAC3B0e,EAAOE,EAAU3gB,MAAMuhB,MAAM,GAC7BZ,EAAUnrB,WAAWuM,IAAM,EAC3B0e,EAAOE,EAAUnrB,WAAWuM,KAAKwf,MAAM,EACxC,MAEDf,EAAG,mCAAmC,IAAWhjC,OAAA,OAAA,OAAA,GAAA,YAC/CmjC,EAAUz6B,IAAM,CAAE6b,IAAK,CAAE/B,KAAM,IAC/BygB,EAAOE,EAAU3gB,MAAMuhB,MAAM,GAC7BZ,EAAUz6B,IAAI6b,IAAI/B,KAAO,EACzBygB,EAAOE,EAAUz6B,IAAI6b,IAAI/B,MAAMuhB,MAAM,EACtC,KAAC,IAGJhB,EAAS,0BAA0B,KACjCG,GAAO,IAAWljC,OAAA,OAAA,OAAA,GAAA,kBACV4H,KAAKI,SAASpG,IAAIgG,KAAK1D,OAAO2D,GAAI,aAAc,aAGvD,MAEDm7B,EAAG,wBAAwB,KACzBC,EAAOE,EAAUnrB,WAAWvX,OAAOsjC,MAAM,GACzCd,EAAOE,EAAUnrB,WAAWuM,KAAKwf,MAAM,GACvCd,EAAOE,EAAU56B,OAAOG,IAAI8Z,MAAMuhB,MAAM,GACxCd,EAAOE,EAAU3gB,MAAMuhB,MAAM,EAAE,IAGjCf,EAAG,+CAA+C,IAAWhjC,OAAA,OAAA,OAAA,GAAA,YAC3DmjC,EAAUnrB,WAAWvX,MAAQ,GAC7BwiC,EAAOE,EAAU3gB,MAAMuhB,MAAM,IAC7BZ,EAAUnrB,WAAWvX,MAAQ,EAC7BwiC,EAAOE,EAAUnrB,WAAWvX,OAAOsjC,MAAM,EAC1C,MAEDf,EAAG,6CAA6C,IAAWhjC,OAAA,OAAA,OAAA,GAAA,YACzDmjC,EAAUnrB,WAAWuM,IAAM,GAC3B0e,EAAOE,EAAU3gB,MAAMuhB,MAAM,IAC7BZ,EAAUnrB,WAAWuM,IAAM,EAC3B0e,EAAOE,EAAUnrB,WAAWuM,KAAKwf,MAAM,EACxC,MACDf,EAAG,2CAA2C,IAAWhjC,OAAA,OAAA,OAAA,GAAA,YACvDmjC,EAAU56B,OAAOG,IAAM,CAAE8Z,KAAM,GAC/BygB,EAAOE,EAAU3gB,MAAMuhB,MAAM,GAC7BZ,EAAU56B,OAAOG,IAAI8Z,KAAO,EAC5BygB,EAAOE,EAAU56B,OAAOG,IAAI8Z,MAAMuhB,MAAM,EACzC,KAAC,GACF,GACF,EC/uBG,MACMtgC,GAAU,CAAEm/B,YAAa,wCAEtC,IAAe2B,GAAA,EAAGxB,WAAUC,KAAIC,aAC9B,MAGMl5B,EAAQ,IAAIiT,KAAKC,eAAe,CACpCtK,KAAM,QACNhP,KAAM,QACNO,OAAQ,CACNwL,GAAI,CAAEjP,MAPM,GAQZuP,IAAK,CAAEvP,MARK,GASZkD,KAAM,QACNa,UAAU,KAKRwF,EAAS,IAAIgT,KAAKC,eAAe,CACrCtK,KAAM,SACNhP,KAAM,QACNO,OAAQ,CACNwL,GAAI,CAAEjP,MAlBO,GAmBbuP,IAAK,CAAEvP,MAnBM,GAoBbkD,KAAM,SACNa,UAAU,KAIRggC,EAAa,CAACz6B,GACd06B,EAAc,CAACz6B,GACf06B,EAAY,CAAC36B,EAAOC,GAGpB26B,GAAkB,EAGlBC,GAAwB,EAE9B7B,EAAS,mBAAmB,KAC1BA,EAAS,+BAA+B,KACtCC,EAAG,kBAAkB,KACnB,MAAMtzB,EAAK,IAAI0U,IAAwB,GACvC6e,EAAOvzB,EAAGjP,OAAOwjC,GAAGF,MAAM3f,GAAwBY,cAAc,IAElEge,EAAG,mBAAmB,KACpB,MAAMtzB,EAAK,IAAI0U,GACf6e,EAAOvzB,EAAGjP,OAAOwjC,GAAGF,MAAM3f,GAAwBa,eAAe,GACjE,GACF,IAGJ8d,EAAS,qBAAqB,KAC5BA,EAAS,+CAA+C,KACtDA,EAAS,cAAc,KACrBC,EAAG,kBAAkB,KACnB,MAAMtzB,EAAK,IAAI0U,IAAwB,EAAMogB,GAG7CvB,EAAOvzB,EAAGjP,OAAOwjC,GAAGF,MAxDZ,EAwD0B,IAEpCf,EAAG,mBAAmB,KACpB,MAAMtzB,EAAK,IAAI0U,IAAwB,EAAOogB,GAG9CvB,EAAOvzB,EAAGjP,OAAOwjC,GAAGF,MA9DZ,EA8D0B,GAClC,IAGJhB,EAAS,eAAe,KACtBC,EAAG,kBAAkB,KACnB,MAAMtzB,EAAK,IAAI0U,IAAwB,EAAMqgB,GAC7CxB,EAAOvzB,EAAGjP,OAAOwjC,GAAGF,MAClB3f,GAAwBY,cArEjB,EAsER,IAEHge,EAAG,mBAAmB,KACpB,MAAMtzB,EAAK,IAAI0U,IAAwB,EAAOqgB,GAC9CxB,EAAOvzB,EAAGjP,OAAOwjC,GAAGF,MAClB3f,GAAwBa,eA3EjB,EA4ER,GACD,IAGJ8d,EAAS,yBAAyB,KAChCC,EAAG,kBAAkB,KACnB,MAAMtzB,EAAK,IAAI0U,IAAwB,EAAMsgB,GAG7CzB,EAAOvzB,EAAGjP,OAAOwjC,GAAGF,MAAMc,EAAmB,IAE/C7B,EAAG,mBAAmB,KACpB,MAAMtzB,EAAK,IAAI0U,IAAwB,EAAOsgB,GAG9CzB,EAAOvzB,EAAGjP,OAAOwjC,GAAGF,MAAMc,EAAmB,GAC7C,GACF,GACF,IAGJ9B,EAAS,6BAA6B,KACpCA,EAAS,qBAAqB,KAC5BA,EAAS,kBAAkB,KACzB,MAAMhe,EAAOX,GAAwBY,cACrCge,EAAG,wBAAwB,KACzB,MAAMtzB,EAAK,IAAI0U,IAAwB,EAAM,GAzE9B,GA0Ef6e,EAAOvzB,EAAGjP,OAAOwjC,GAAGF,MAAMhf,EA1EX,EA0EiC,IAElDie,EAAG,sBAAsB,KACvB,MAAMtzB,EAAK,IAAI0U,IACb,EACAogB,EA/Ea,GAkFfvB,EAAOvzB,EAAGjP,OAAOwjC,GAAGF,MAAMc,EAAyB,IAErD7B,EAAG,qBAAqB,KACtB,MAAMtzB,EAAK,IAAI0U,IACb,EACAqgB,EAvFa,GA0FfxB,EAAOvzB,EAAGjP,OAAOwjC,GAAGF,MAAMhf,EAvHjB,EA6BM,EA0F4C,IAE7Die,EAAG,mBAAmB,KACpB,MAAMtzB,EAAK,IAAI0U,IACb,EACAsgB,EA/Fa,GAkGfzB,EAAOvzB,EAAGjP,OAAOwjC,GAAGF,MAAMc,EAAoC,GAC9D,IAEJ9B,EAAS,mBAAmB,KAC1B,MAAMhe,EAAOX,GAAwBa,eACrC+d,EAAG,wBAAwB,KACzB,MAAMtzB,EAAK,IAAI0U,IAAwB,EAAO,GAxG/B,GAyGf6e,EAAOvzB,EAAGjP,OAAOwjC,GAAGF,MAAMhf,EAzGX,EAyGiC,IAElDie,EAAG,sBAAsB,KACvB,MAAMtzB,EAAK,IAAI0U,IACb,EACAogB,EA9Ga,GAiHfvB,EAAOvzB,EAAGjP,OAAOwjC,GAAGF,MAAMc,EAAyB,IAErD7B,EAAG,qBAAqB,KACtB,MAAMtzB,EAAK,IAAI0U,IACb,EACAqgB,EAtHa,GAyHfxB,EAAOvzB,EAAGjP,OAAOwjC,GAAGF,MAAMhf,EAtJjB,EA6BM,EAyH4C,IAE7Die,EAAG,mBAAmB,KACpB,MAAMtzB,EAAK,IAAI0U,IACb,EACAsgB,EA9Ha,GAiIfzB,EAAOvzB,EAAGjP,OAAOwjC,GAAGF,OAAMc,EAAoC,GAC9D,GACF,IAEJ9B,EAAS,qBAAqB,KAC5BA,EAAS,kBAAkB,KACzB,MAAMhe,EAAOX,GAAwBY,cACrCge,EAAG,wBAAwB,KACzB,MAAMtzB,EAAK,IAAI0U,IAAwB,EAAM,GAAIugB,GACjD1B,EAAOvzB,EAAGjP,OAAOwjC,GAAGF,MAAMhf,EAAO4f,EAAe,IAElD3B,EAAG,sBAAsB,KACvB,MAAMtzB,EAAK,IAAI0U,IACb,EACAogB,EACAG,GAEF1B,EAAOvzB,EAAGjP,OAAOwjC,GAAGF,MAAMc,EAAyB,IAErD7B,EAAG,qBAAqB,KACtB,MAAMtzB,EAAK,IAAI0U,IACb,EACAqgB,EACAE,GAEF1B,EAAOvzB,EAAGjP,OAAOwjC,GAAGF,MAAMhf,EAvLjB,EAuLmC4f,EAAe,IAE7D3B,EAAG,mBAAmB,KACpB,MAAMtzB,EAAK,IAAI0U,IACb,EACAsgB,EACAC,GAEF1B,EAAOvzB,EAAGjP,OAAOwjC,GAAGF,MAAMc,EAAoC,GAC9D,IAEJ9B,EAAS,mBAAmB,KAC1B,MAAMhe,EAAOX,GAAwBa,eACrC+d,EAAG,wBAAwB,KACzB,MAAMtzB,EAAK,IAAI0U,IAAwB,EAAO,GAAIugB,GAClD1B,EAAOvzB,EAAGjP,OAAOwjC,GAAGF,MAAMhf,EAAO4f,EAAe,IAElD3B,EAAG,sBAAsB,KACvB,MAAMtzB,EAAK,IAAI0U,IACb,EACAogB,EACAG,GAEF1B,EAAOvzB,EAAGjP,OAAOwjC,GAAGF,MAAMc,EAAyB,IAErD7B,EAAG,qBAAqB,KACtB,MAAMtzB,EAAK,IAAI0U,IACb,EACAqgB,EACAE,GAEF1B,EAAOvzB,EAAGjP,OAAOwjC,GAAGF,MAAMhf,EAtNjB,EAsNmC4f,EAAe,IAE7D3B,EAAG,mBAAmB,KACpB,MAAMtzB,EAAK,IAAI0U,IACb,EACAsgB,EACAC,GAEF1B,EAAOvzB,EAAGjP,OAAOwjC,GAAGF,MAAMc,EAAoC,GAC9D,GACF,GACF,IAGJ9B,EAAS,8BAA8B,KACrCA,EAAS,qBAAqB,KAC5BA,EAAS,kBAAkB,KACzB,MAAMhe,EAAOX,GAAwBY,cACrCge,EAAG,wBAAwB,KACzB,MAAMtzB,EAAK,IAAI0U,IACb,EACA,GACA,EA5MmB,GA+MrB6e,EAAOvzB,EAAGjP,OAAOwjC,GAAGF,MAAMhf,EA/ML,EA+MiC,IAExDie,EAAG,sBAAsB,KACvB,MAAMtzB,EAAK,IAAI0U,IACb,EACAogB,EACA,EArNmB,GAwNrBvB,EAAOvzB,EAAGjP,OAAOwjC,GAAGF,MAAMc,EAA+B,IAE3D7B,EAAG,qBAAqB,KACtB,MAAMtzB,EAAK,IAAI0U,IACb,EACAqgB,EACA,EA9NmB,GAiOrBxB,EAAOvzB,EAAGjP,OAAOwjC,GAAGF,MAAMhf,EAjQjB,EAgCY,EAiO4C,IAEnEie,EAAG,mBAAmB,KACpB,MAAMtzB,EAAK,IAAI0U,IACb,EACAsgB,EACA,EAvOmB,GA0OrBzB,EAAOvzB,EAAGjP,OAAOwjC,GAAGF,MAAMc,EAA0C,GACpE,IAEJ9B,EAAS,mBAAmB,KAC1B,MAAMhe,EAAOX,GAAwBa,eACrC+d,EAAG,wBAAwB,KACzB,MAAMtzB,EAAK,IAAI0U,IACb,EACA,GACA,EAnPmB,GAsPrB6e,EAAOvzB,EAAGjP,OAAOwjC,GAAGF,MAAMhf,EAtPL,EAsPiC,IAExDie,EAAG,sBAAsB,KACvB,MAAMtzB,EAAK,IAAI0U,IACb,EACAogB,EACA,EA5PmB,GA+PrBvB,EAAOvzB,EAAGjP,OAAOwjC,GAAGF,MAAMc,EAA+B,IAE3D7B,EAAG,qBAAqB,KACtB,MAAMtzB,EAAK,IAAI0U,IACb,EACAqgB,EACA,EArQmB,GAwQrBxB,EAAOvzB,EAAGjP,OAAOwjC,GAAGF,MAAMhf,EAxSjB,EAgCY,EAwQ4C,IAEnEie,EAAG,mBAAmB,KACpB,MAAMtzB,EAAK,IAAI0U,IACb,EACAsgB,EACA,EA9QmB,GAiRrBzB,EAAOvzB,EAAGjP,OAAOwjC,GAAGF,MAAMc,EAA0C,GACpE,GACF,IAEJ9B,EAAS,qBAAqB,KAC5BA,EAAS,kBAAkB,KACzB,MAAMhe,EAAOX,GAAwBY,cACrCge,EAAG,wBAAwB,KACzB,MAAMtzB,EAAK,IAAI0U,IACb,EACA,GACA,EACAwgB,GAEF3B,EAAOvzB,EAAGjP,OAAOwjC,GAAGF,MAAMhf,EAAO6f,EAAqB,IAExD5B,EAAG,sBAAsB,KACvB,MAAMtzB,EAAK,IAAI0U,IACb,EACAogB,EACA,EACAI,GAEF3B,EAAOvzB,EAAGjP,OAAOwjC,GAAGF,MAAMc,EAA+B,IAE3D7B,EAAG,qBAAqB,KACtB,MAAMtzB,EAAK,IAAI0U,IACb,EACAqgB,EACA,EACAG,GAEF3B,EAAOvzB,EAAGjP,OAAOwjC,GAAGF,MAAMhf,EAjVjB,EAiVmC6f,EAAqB,IAEnE5B,EAAG,mBAAmB,KACpB,MAAMtzB,EAAK,IAAI0U,IACb,EACAsgB,EACA,EACAE,GAEF3B,EAAOvzB,EAAGjP,OAAOwjC,GAAGF,MAAMc,EAA0C,GACpE,IAEJ9B,EAAS,mBAAmB,KAC1B,MAAMhe,EAAOX,GAAwBa,eACrC+d,EAAG,wBAAwB,KACzB,MAAMtzB,EAAK,IAAI0U,IACb,EACA,GACA,EACAwgB,GAEF3B,EAAOvzB,EAAGjP,OAAOwjC,GAAGF,MAAMhf,EAAO6f,EAAqB,IAExD5B,EAAG,sBAAsB,KACvB,MAAMtzB,EAAK,IAAI0U,IACb,EACAogB,EACA,EACAI,GAEF3B,EAAOvzB,EAAGjP,OAAOwjC,GAAGF,MAAMc,EAA+B,IAE3D7B,EAAG,qBAAqB,KACtB,MAAMtzB,EAAK,IAAI0U,IACb,EACAqgB,EACA,EACAG,GAEF3B,EAAOvzB,EAAGjP,OAAOwjC,GAAGF,MAAMhf,EAxXjB,EAwXmC6f,EAAqB,IAEnE5B,EAAG,mBAAmB,KACpB,MAAMtzB,EAAK,IAAI0U,IACb,EACAsgB,EACA,EACAE,GAEF3B,EAAOvzB,EAAGjP,OAAOwjC,GAAGF,MAAMc,EAA0C,GACpE,GACF,GACF,GACF,ECrYG,MACMphC,GAAU,CACrBm/B,YAAa,iDAGTkC,GAAQ,CAACrkC,EAAeuB,IAC5BS,KAAKC,QAAS,IAAMjC,EAASuB,EAAK,EAAG,KACjC+iC,GAAiB,CACrBphC,EACAU,EACAD,EACA4gC,EAAc,CAAE,IAGhB,IAAIhoB,KAAKC,eAAe,CACtBtK,KAAM,QAAQhP,KAAQkP,QAAQC,MAAM+uB,aACpCl+B,OACAO,OAAaZ,OAAAgnB,OAAAhnB,OAAAgnB,OAAA,CAAA,EAAA0a,GAAa,CAAA3gC,SAAQD,SAAU,CAAE3D,MAAO2D,OAGzD,IAAe6gC,GAAA,EAAGlC,WAAUC,KAAIC,aAC9BF,EAAS,wBAAwB,KAC/BC,EAAG,eAAe,KAChB,IAAIkC,EAAM,IAAIrjC,EACdohC,EAAOiC,EAAI3iC,SAAS0hC,GAAGC,GAAGE,MAE1Bc,EAAM,IAAIC,EACVlC,EAAOiC,EAAI3iC,SAAS0hC,GAAGC,GAAGE,KAAK,GAC/B,IAGJrB,EAAS,qBAAqB,KAC5BC,EAAG,cAAc,KACf,MAAMkC,EAAM,IAAIE,EAChBnC,EAAOiC,EAAI3iC,SAAS0hC,GAAGC,GAAGC,IAAI,IAGhCnB,EAAG,6CAA6C,KAC9C,MAAMkC,EAAM,IAAIE,EAEVC,EAAgB,CAAE,IADXz9B,KAAKI,SAAStG,IAAIkG,KAAK1D,OAAO2D,GAAI,uBACGq9B,EAAIljC,KACtDihC,EAAOiC,EAAItiC,OAAOqhC,GAAGqB,KAAKC,QAAQF,EAAc,IAGlDtC,EAAS,kCAAkC,KACzCC,EAAG,iBAAiB,KAClB,MAAMhhC,EAAM,KAKZ,IAAIkjC,EAAM,IAAIE,EAAiBpjC,EAAK,CAClC+iC,GAAe,OALH,IAKkB,EAAG,CAAE5gC,UAAU,MAE/C8+B,EAAOiC,EAAI1iC,KAAKyhC,GAAGF,MAAMe,GAPX,IAOwB9iC,IAEtCkjC,EAAM,IAAIE,EAAiBpjC,EAAK,CAC9B+iC,GAAe,OATH,IASkB,EAAG,CAAE5gC,UAAU,MAE/C8+B,EAAOiC,EAAI1iC,KAAKyhC,GAAGF,MAAMe,GAXX,IAWwB9iC,IAEtCkjC,EAAM,IAAIE,EAAiBpjC,EAAK,CAC9B+iC,GAAe,OAbH,KAakB,EAAG,CAAE5gC,UAAU,MAE/C8+B,EAAOiC,EAAI1iC,KAAKyhC,GAAGF,MAAMe,GAfX,KAewB9iC,IAEtCkjC,EAAM,IAAIE,EAAiBpjC,EAAK,CAC9B+iC,GAAe,OAAQ/iC,EAAK,EAAG,CAAEmC,UAAU,MAE7C8+B,EAAOiC,EAAI1iC,KAAKyhC,GAAGF,MAAM,KAEzBmB,EAAM,IAAIE,EAAiBpjC,EAAK,CAC9B+iC,GAAe,OAAQ/iC,EAAK,EAAG,CAAEmC,UAAU,MAE7C8+B,EAAOiC,EAAI1iC,KAAKyhC,GAAGF,MAAM,EAAE,IAE7Bf,EAAG,YAAY,KACb,MAAMhhC,EAAM,KAKZ,IAAIkjC,EAAM,IAAIE,EAAiBpjC,EAAK,CAClC+iC,GAAe,OALH,IAKkB,EAAG,CAAE5gC,UAAU,MAE/C8+B,EAAOiC,EAAIzkC,OAAOwjC,GAAGF,MAPP,KASdmB,EAAM,IAAIE,EAAiBpjC,EAAK,CAC9B+iC,GAAe,OATH,IASkB,EAAG,CAAE5gC,UAAU,MAE/C8+B,EAAOiC,EAAIzkC,OAAOwjC,GAAGF,MAXP,KAadmB,EAAM,IAAIE,EAAiBpjC,EAAK,CAC9B+iC,GAAe,OAbH,KAakB,EAAG,CAAE5gC,UAAU,MAE/C8+B,EAAOiC,EAAIzkC,OAAOwjC,GAAGF,MAfP,MAiBdmB,EAAM,IAAIE,EAAiBpjC,EAAK,CAC9B+iC,GAAe,OAAQ/iC,EAAK,EAAG,CAAEmC,UAAU,MAE7C8+B,EAAOiC,EAAIzkC,OAAOwjC,GAAGF,MAAM/hC,GAE3BkjC,EAAM,IAAIE,EAAiBpjC,EAAK,CAC9B+iC,GAAe,OAAQ/iC,EAAK,EAAG,CAAEmC,UAAU,MAE7C8+B,EAAOiC,EAAIzkC,OAAOwjC,GAAGF,MAAM,EAAE,IAE/BhB,EAAS,4BAA4B,KACnCC,EAAG,sCAAsC,KACvC,MAAMkC,EAAM,IAAIE,EAAiB,KAAM,CACrCL,GAAe,OAAQ,OAAQ,EAAG,CAAE5gC,UAAU,MAEhD8+B,EAAOiC,EAAIviC,YAAYshC,GAAGC,GAAGC,IAAI,IAEnCpB,EAAS,kBAAkB,KACzBC,EAAG,2BAA2B,KAC5B,MAAMkC,EAAM,IAAIE,EAAiB,KAAM,CACrCL,GAAe,SAAU,OAAQ,GACjCA,GAAe,QAAS,OAAQ,GAChCA,GAAe,YAAa,OAAQ,GACpCA,GAAe,OAAQ,OAAQ,KAEjC9B,EAAOiC,EAAIviC,YAAYshC,GAAGC,GAAGE,KAAK,IAEpCpB,EAAG,uBAAuB,KACxB,MAAMkC,EAAM,IAAIE,EAAiB,KAAM,CACrCL,GAAe,OAAQ,IAAK,EAAG,CAAE5gC,UAAU,MAE7C8+B,EAAOiC,EAAIviC,YAAYshC,GAAGC,GAAGE,KAAK,GAClC,GACF,IAEJpB,EAAG,iDAAiD,KAClD,IAAIkC,EAAM,IAAIE,EAAiB,KAAM,CACnCL,GAAe,OAAQ,IAAK,EAAG,CAAE5gC,UAAU,MAE7C8+B,EAAOiC,EAAIpgC,kCAAkCm/B,GAAGC,GAAGE,MAEnDc,EAAM,IAAIE,EAAiB,KAAM,CAC/BL,GAAe,OAAQ,IAAK,EAAG,CAAE5gC,UAAU,MAE7C8+B,EAAOiC,EAAIpgC,kCAAkCm/B,GAAGC,GAAGC,KAEnDe,EAAM,IAAIE,EAAiB,KAAM,CAACL,GAAe,SAAU,IAAK,KAChE9B,EAAOiC,EAAIpgC,kCAAkCm/B,GAAGC,GAAGE,KAAK,GACxD,IAGJpB,EAAG,4BAA4B,KAG7B,IAAIkC,EAAM,IAAIE,EAFC,KAGfnC,EAAOiC,EAAIljC,KAAKiiC,GAAGF,MAHJ,KAKfmB,EAAM,IAAIE,EACVnC,EAAOiC,EAAIljC,KAAKiiC,GAAGF,MACjBliC,EAAiCI,mBAClC,GACD,IAGJ8gC,EAAS,wBAAwB,KAC/BC,EAAG,cAAc,KACf,MAAMkC,EAAM,IAAIM,EAChBvC,EAAOiC,EAAI3iC,SAAS0hC,GAAGC,GAAGC,IAAI,IAEhCnB,EAAG,6CAA6C,KAC9C,MAAMkC,EAAM,IAAIM,EAChBvC,EAAOiC,EAAItiC,OAAOqhC,GAAGqB,KAAKC,QACxBjiC,OAAO8B,OAAOvD,EAAiCiB,kBAChD,IAEHigC,EAAS,kCAAkC,KACzCC,EAAG,iBAAiB,KAClB,MAAMhhC,EAAM,KAKZ,IAAIkjC,EAAM,IAAIM,EAAoBxjC,EAAK,CACrC+iC,GAAe,OALH,IAKkB,EAAG,CAAE5gC,UAAU,MAE/C8+B,EAAOiC,EAAI1iC,KAAKyhC,GAAGF,MAAMe,GAPX,IAOwB9iC,IAEtCkjC,EAAM,IAAIM,EAAoBxjC,EAAK,CACjC+iC,GAAe,OATH,IASkB,EAAG,CAAE5gC,UAAU,MAE/C8+B,EAAOiC,EAAI1iC,KAAKyhC,GAAGF,MAAMe,GAXX,IAWwB9iC,IAEtCkjC,EAAM,IAAIM,EAAoBxjC,EAAK,CACjC+iC,GAAe,OAbH,KAakB,EAAG,CAAE5gC,UAAU,MAE/C8+B,EAAOiC,EAAI1iC,KAAKyhC,GAAGF,MAAMe,GAfX,KAewB9iC,IAEtCkjC,EAAM,IAAIM,EAAoBxjC,EAAK,CACjC+iC,GAAe,OAAQ/iC,EAAK,EAAG,CAAEmC,UAAU,MAE7C8+B,EAAOiC,EAAI1iC,KAAKyhC,GAAGF,MAAM,KAEzBmB,EAAM,IAAIM,EAAoBxjC,EAAK,CACjC+iC,GAAe,OAAQ/iC,EAAK,EAAG,CAAEmC,UAAU,MAE7C8+B,EAAOiC,EAAI1iC,KAAKyhC,GAAGF,MAAMe,GAAMU,EAAoB9/B,WAAY1D,GAAK,IAEtEghC,EAAG,YAAY,KACb,MAAMhhC,EAAM,KAKZ,IAAIkjC,EAAM,IAAIM,EAAoBxjC,EAAK,CACrC+iC,GAAe,OALH,IAKkB,EAAG,CAAE5gC,UAAU,MAE/C8+B,EAAOiC,EAAIzkC,OAAOwjC,GAAGF,MAPP,KASdmB,EAAM,IAAIM,EAAoBxjC,EAAK,CACjC+iC,GAAe,OATH,IASkB,EAAG,CAAE5gC,UAAU,MAE/C8+B,EAAOiC,EAAIzkC,OAAOwjC,GAAGF,MAXP,KAadmB,EAAM,IAAIM,EAAoBxjC,EAAK,CACjC+iC,GAAe,OAbH,KAakB,EAAG,CAAE5gC,UAAU,MAE/C8+B,EAAOiC,EAAIzkC,OAAOwjC,GAAGF,MAfP,MAiBdmB,EAAM,IAAIM,EAAoBxjC,EAAK,CACjC+iC,GAAe,OAAQ/iC,EAAK,EAAG,CAAEmC,UAAU,MAE7C8+B,EAAOiC,EAAIzkC,OAAOwjC,GAAGF,MAAM/hC,GAE3BkjC,EAAM,IAAIM,EAAoBxjC,EAAK,CACjC+iC,GAAe,OAAQ/iC,EAAK,EAAG,CAAEmC,UAAU,MAE7C8+B,EAAOiC,EAAIzkC,OAAOwjC,GAAGF,MAAMyB,EAAoB9/B,WAAW,IAE5Dq9B,EAAS,4BAA4B,KACnCC,EAAG,sCAAsC,KACvC,MAAMkC,EAAM,IAAIM,EAAoB,KAAM,CACxCT,GAAe,OAAQ,OAAQ,EAAG,CAAE5gC,UAAU,MAEhD8+B,EAAOiC,EAAIviC,YAAYshC,GAAGC,GAAGC,IAAI,IAEnCpB,EAAS,kBAAkB,KACzBC,EAAG,2BAA2B,KAC5B,MAAMkC,EAAM,IAAIM,EAAoB,KAAM,CACxCT,GAAe,OAAQ,OAAQ,KAEjC9B,EAAOiC,EAAIviC,YAAYshC,GAAGC,GAAGE,MAC7BnB,EAAOiC,EAAIzkC,OAAOwjC,GAAGF,MAAM,GAAG,IAEhCf,EAAG,uBAAuB,KACxB,MAAMkC,EAAM,IAAIM,EAAoB,KAAM,CACxCT,GAAe,OAAQ,IAAK,EAAG,CAAE5gC,UAAU,MAE7C8+B,EAAOiC,EAAIviC,YAAYshC,GAAGC,GAAGE,KAAK,GAClC,GACF,GACF,IAGJpB,EAAG,4BAA4B,KAG7B,IAAIkC,EAAM,IAAIM,EAFC,KAGfvC,EAAOiC,EAAIljC,KAAKiiC,GAAGF,MAHJ,KAKfmB,EAAM,IAAIM,EACVvC,EAAOiC,EAAIljC,KAAKiiC,GAAGF,MACjBliC,EAAiCI,mBAClC,GACD,IAGJ8gC,EAAS,wBAAwB,KAC/BC,EAAG,cAAc,KACf,MAAMkC,EAAM,IAAIO,EAChBxC,EAAOiC,EAAI3iC,SAAS0hC,GAAGC,GAAGC,IAAI,IAEhCnB,EAAG,6CAA6C,KAC9C,MAAMkC,EAAM,IAAIO,EAEhBxC,EAAOiC,EAAItiC,OAAOqhC,GAAGqB,KAAKC,QACxBjiC,OAAO8B,OAAOvD,EAAiCiB,kBAChD,IAEHigC,EAAS,kCAAkC,KACzCC,EAAG,iBAAiB,KAClB,MAAMhhC,EAAM,KAKZ,IAAIkjC,EAAM,IAAIO,EAAoBzjC,EAAK,CACrC+iC,GAAe,OALH,IAKkB,EAAG,CAAE5gC,UAAU,MAE/C8+B,EAAOiC,EAAI1iC,KAAKyhC,GAAGF,MAAMe,GAPX,IAOwB9iC,IAEtCkjC,EAAM,IAAIO,EAAoBzjC,EAAK,CACjC+iC,GAAe,OATH,IASkB,EAAG,CAAE5gC,UAAU,MAE/C8+B,EAAOiC,EAAI1iC,KAAKyhC,GAAGF,MAAMe,GAXX,IAWwB9iC,IAEtCkjC,EAAM,IAAIO,EAAoBzjC,EAAK,CACjC+iC,GAAe,OAbH,KAakB,EAAG,CAAE5gC,UAAU,MAE/C8+B,EAAOiC,EAAI1iC,KAAKyhC,GAAGF,MAAMe,GAfX,KAewB9iC,IAEtCkjC,EAAM,IAAIO,EAAoBzjC,EAAK,CACjC+iC,GAAe,OAAQ/iC,EAAK,EAAG,CAAEmC,UAAU,MAE7C8+B,EAAOiC,EAAI1iC,KAAKyhC,GAAGF,MAAM,KAEzBmB,EAAM,IAAIO,EAAoBzjC,EAAK,CACjC+iC,GAAe,OAAQ/iC,EAAK,EAAG,CAAEmC,UAAU,MAE7C8+B,EAAOiC,EAAI1iC,KAAKyhC,GAAGF,MAAM,IAAI,IAE/Bf,EAAG,YAAY,KACb,MAAMhhC,EAAM,KAKZ,IAAIkjC,EAAM,IAAIO,EAAoBzjC,EAAK,CACrC+iC,GAAe,OALH,IAKkB,EAAG,CAAE5gC,UAAU,MAE/C8+B,EAAOiC,EAAIzkC,OAAOwjC,GAAGF,MAPP,KASdmB,EAAM,IAAIO,EAAoBzjC,EAAK,CACjC+iC,GAAe,OATH,IASkB,EAAG,CAAE5gC,UAAU,MAE/C8+B,EAAOiC,EAAIzkC,OAAOwjC,GAAGF,MAXP,KAadmB,EAAM,IAAIO,EAAoBzjC,EAAK,CACjC+iC,GAAe,OAbH,KAakB,EAAG,CAAE5gC,UAAU,MAE/C8+B,EAAOiC,EAAIzkC,OAAOwjC,GAAGF,MAfP,MAiBdmB,EAAM,IAAIO,EAAoBzjC,EAAK,CACjC+iC,GAAe,OAAQ/iC,EAAK,EAAG,CAAEmC,UAAU,MAE7C8+B,EAAOiC,EAAIzkC,OAAOwjC,GAAGF,MAAM/hC,GAE3BkjC,EAAM,IAAIO,EAAoBzjC,EAAK,CACjC+iC,GAAe,OAAQ/iC,EAAK,EAAG,CAAEmC,UAAU,MAE7C8+B,EAAOiC,EAAIzkC,OAAOwjC,GAAGF,MAAM/hC,EAAI,IAEjC+gC,EAAS,4BAA4B,KACnCC,EAAG,sCAAsC,KACvC,IAAIkC,EAAM,IAAIO,EAAoB,KAAM,CACtCV,GAAe,OAAQ,OAAQ,EAAG,CAAE5gC,UAAU,MAEhD8+B,EAAOiC,EAAIviC,YAAYshC,GAAGC,GAAGC,KAC7Be,EAAM,IAAIO,EAAoB,KAAM,CAClCV,GAAe,OAAQ,OAAQ,EAAG,CAAE5gC,UAAU,MAEhD8+B,EAAOiC,EAAIviC,YAAYshC,GAAGC,GAAGC,IAAI,IAEnCpB,EAAS,kBAAkB,KACzBC,EAAG,uBAAuB,KACxB,MAAMkC,EAAM,IAAIO,EAAoB,KAAM,CACxCV,GAAe,OAAQ,IAAK,EAAG,CAAE5gC,UAAU,MAE7C8+B,EAAOiC,EAAIviC,YAAYshC,GAAGC,GAAGE,KAAK,IAEpCpB,EAAG,oBAAoB,KACrB,IAAIkC,EAAM,IAAIO,EAAoB,KAAM,CACtCV,GAAe,OAAQ,KAAM,EAAG,CAAE5gC,UAAU,MAE9C8+B,EAAOiC,EAAIviC,YAAYshC,GAAGC,GAAGE,MAC7Bc,EAAM,IAAIO,EAAoB,KAAM,CAClCV,GAAe,OAAQ,KAAM,EAAG,CAAE5gC,UAAU,MAE9CuhC,QAAQC,KAAKT,GACbjC,EAAOiC,EAAIviC,YAAYshC,GAAGC,GAAGE,KAAK,GAClC,GACF,GACF,IAGJpB,EAAG,4BAA4B,KAG7B,IAAIkC,EAAM,IAAIO,EAFC,KAGfxC,EAAOiC,EAAIljC,KAAKiiC,GAAGF,MAHJ,KAKfmB,EAAM,IAAIO,EAEVxC,EAAOiC,EAAIljC,KAAKiiC,GAAGF,MACjBliC,EAAiCI,mBAClC,GACD,IAGJ8gC,EAAS,0BAA0B,KACjCC,EAAG,cAAc,KACf,MAAMkC,EAAM,IAAIU,EAChB3C,EAAOiC,EAAI3iC,SAAS0hC,GAAGC,GAAGC,IAAI,IAEhCnB,EAAG,6CAA6C,KAC9C,MAAMkC,EAAM,IAAIU,EAEhB3C,EAAOiC,EAAItiC,OAAOqhC,GAAGqB,KAAKC,QACxBjiC,OAAO8B,OAAOvD,EAAiCiB,kBAChD,IAEHigC,EAAS,kCAAkC,KACzCC,EAAG,iBAAiB,KAClB,MAAMhhC,EAAM,KAKZ,IAAIkjC,EAAM,IAAIU,EAAqB5jC,EAAK,CACtC+iC,GAAe,OALH,IAKkB,EAAG,CAAE5gC,UAAU,MAE/C8+B,EAAOiC,EAAI1iC,KAAKyhC,GAAGF,MAAMe,GAPX,IAOwB9iC,IAEtCkjC,EAAM,IAAIU,EAAqB5jC,EAAK,CAClC+iC,GAAe,OATH,IASkB,EAAG,CAAE5gC,UAAU,MAE/C8+B,EAAOiC,EAAI1iC,KAAKyhC,GAAGF,MAAMe,GAXX,IAWwB9iC,IAEtCkjC,EAAM,IAAIU,EAAqB5jC,EAAK,CAClC+iC,GAAe,OAbH,KAakB,EAAG,CAAE5gC,UAAU,MAE/C8+B,EAAOiC,EAAI1iC,KAAKyhC,GAAGF,MAAMe,GAfX,KAewB9iC,IAEtCkjC,EAAM,IAAIU,EAAqB5jC,EAAK,CAClC+iC,GAAe,OAAQ/iC,EAAK,EAAG,CAAEmC,UAAU,MAE7C8+B,EAAOiC,EAAI1iC,KAAKyhC,GAAGF,MAAM,KAEzBmB,EAAM,IAAIU,EAAqB5jC,EAAK,CAClC+iC,GAAe,OAAQ/iC,EAAK,EAAG,CAAEmC,UAAU,MAE7C8+B,EAAOiC,EAAI1iC,KAAKyhC,GAAGF,MAAM,IAAI,IAE/Bf,EAAG,YAAY,KACb,MAAMhhC,EAAM,KAKZ,IAAIkjC,EAAM,IAAIU,EAAqB5jC,EAAK,CACtC+iC,GAAe,OALH,IAKkB,EAAG,CAAE5gC,UAAU,MAE/C8+B,EAAOiC,EAAIzkC,OAAOwjC,GAAGF,MAPP,KASdmB,EAAM,IAAIU,EAAqB5jC,EAAK,CAClC+iC,GAAe,OATH,IASkB,EAAG,CAAE5gC,UAAU,MAE/C8+B,EAAOiC,EAAIzkC,OAAOwjC,GAAGF,MAXP,KAadmB,EAAM,IAAIU,EAAqB5jC,EAAK,CAClC+iC,GAAe,OAbH,KAakB,EAAG,CAAE5gC,UAAU,MAE/C8+B,EAAOiC,EAAIzkC,OAAOwjC,GAAGF,MAfP,MAiBdmB,EAAM,IAAIU,EAAqB5jC,EAAK,CAClC+iC,GAAe,OAAQ/iC,EAAK,EAAG,CAAEmC,UAAU,MAE7C8+B,EAAOiC,EAAIzkC,OAAOwjC,GAAGF,MAAM/hC,GAE3BkjC,EAAM,IAAIU,EAAqB5jC,EAAK,CAClC+iC,GAAe,OAAQ/iC,EAAK,EAAG,CAAEmC,UAAU,MAE7C8+B,EAAOiC,EAAIzkC,OAAOwjC,GAAGF,MAAM/hC,EAAI,IAEjC+gC,EAAS,4BAA4B,KACnCC,EAAG,sCAAsC,KACvC,IAAIkC,EAAM,IAAIU,EAAqB,KAAM,CACvCb,GAAe,OAAQ,OAAQ,EAAG,CAAE5gC,UAAU,MAEhD8+B,EAAOiC,EAAIviC,YAAYshC,GAAGC,GAAGC,KAC7Be,EAAM,IAAIU,EAAqB,KAAM,CACnCb,GAAe,OAAQ,OAAQ,EAAG,CAAE5gC,UAAU,MAEhD8+B,EAAOiC,EAAIviC,YAAYshC,GAAGC,GAAGC,IAAI,IAEnCpB,EAAS,kBAAkB,KACzBC,EAAG,uBAAuB,KACxB,MAAMkC,EAAM,IAAIU,EAAqB,KAAM,CACzCb,GAAe,OAAQ,IAAK,EAAG,CAAE5gC,UAAU,MAE7C8+B,EAAOiC,EAAIviC,YAAYshC,GAAGC,GAAGE,KAAK,IAEpCpB,EAAG,oBAAoB,KACrB,IAAIkC,EAAM,IAAIU,EAAqB,KAAM,CACvCb,GAAe,OAAQ,KAAM,EAAG,CAAE5gC,UAAU,MAE9C8+B,EAAOiC,EAAIviC,YAAYshC,GAAGC,GAAGE,MAC7Bc,EAAM,IAAIU,EAAqB,KAAM,CACnCb,GAAe,OAAQ,KAAM,EAAG,CAAE5gC,UAAU,MAE9CuhC,QAAQC,KAAKT,GACbjC,EAAOiC,EAAIviC,YAAYshC,GAAGC,GAAGE,KAAK,GAClC,GACF,GACF,IAGJpB,EAAG,4BAA4B,KAG7B,IAAIkC,EAAM,IAAIU,EAFC,KAGf3C,EAAOiC,EAAIljC,KAAKiiC,GAAGF,MAHJ,KAKfmB,EAAM,IAAIU,EAEV3C,EAAOiC,EAAIljC,KAAKiiC,GAAGF,MACjBliC,EAAiCI,mBAClC,GACD,GACF,ECpgBG,MACMwB,GAAU,CACrBm/B,YAAa,8CAGTmC,GAAiB,CACrBphC,EACAU,EACAD,EACA4gC,EAAc,CAAE,IAGhB,IAAIhoB,KAAKC,eAAe,CACtBtK,KAAM,QAAQhP,KAAQkP,QAAQC,MAAM+uB,aACpCl+B,OACAO,OAAaZ,OAAAgnB,OAAAhnB,OAAAgnB,OAAA,CAAA,EAAA0a,GAAa,CAAA3gC,SAAQD,SAAU,CAAE3D,MAAO2D,OAGzD,IAAeyhC,GAAA,EAAG9C,WAAUC,KAAIC,aAC9BF,EAAS,mCAAmC,KAC1CC,EAAG,0BAA0B,KAC3B,MAAMkC,EAAM,IAAIE,EACVU,EAAO,IAAItgB,GAA0B0f,GAAK,GAChDjC,EAAO6C,EAAK/gB,MAAMkf,GAAGF,MAAMve,GAA0BE,aAAa,IAEpEsd,EAAG,2BAA2B,KAC5B,MAAMkC,EAAM,IAAIrjC,EAAiC,YAC3CikC,EAAO,IAAItgB,GAA0B0f,GAC3CjC,EAAO6C,EAAK/gB,MAAMkf,GAAGF,MAAMve,GAA0BE,aAAa,IAEpEsd,EAAG,+BAA+B,KAChC,MAAM8C,EAAO,IAAItgB,GACjByd,EAAO6C,EAAK/gB,MAAMkf,GAAGF,MAAMve,GAA0BE,aAAa,GAClE,IAGJqd,EAAS,+CAA+C,KACtDC,EAAG,mBAAmB,KACpB,IAAIkC,EAAM,IAAIE,EACVU,EAAO,IAAItgB,GAA0B0f,GACzCjC,EAAO6C,EAAK/gB,MAAMkf,GAAGF,MAAMve,GAA0BE,cAErDwf,EAAM,IAAIE,OAAiBte,EAAW,CACpCie,GAAe,QAAS,IAAK,EAAG,CAAEphC,KAAM,YAAaa,UAAU,IAC/DugC,GAAe,QAAS,IAAK,EAAG,CAAEphC,KAAM,QAASa,UAAU,IAC3DugC,GAAe,QAAS,IAAK,EAAG,CAAEphC,KAAM,QAASa,UAAU,MAE7DshC,EAAO,IAAItgB,GAA0B0f,GACrCjC,EAAO6C,EAAK/gB,MAAMkf,GAAGF,MAAMve,GAA0BE,cAErDud,EAAO6C,EAAK1f,WAAW6d,GAAGF,MACxBve,GAA0BE,aAAe,GAG3Cud,EAAO6C,EAAKzf,UAAU4d,GAAGF,MACvBve,GAA0BE,aAAe,EAC1C,IAEHsd,EAAG,yBAAyB,KAC1B,MAAMkC,EAAM,IAAIE,OAAiBte,EAAW,CAC1Cie,GAAe,QAAS,IAAK,EAAG,CAAEphC,KAAM,YAAaa,UAAU,IAC/DugC,GAAe,QAAS,IAAK,EAAG,CAAEphC,KAAM,QAASa,UAAU,IAC3DugC,GAAe,QAAS,IAAK,EAAG,CAAEphC,KAAM,QAASa,UAAU,MAEvDshC,EAAO,IAAItgB,GAA0B0f,GAC3CjC,EAAO6C,EAAK/gB,MAAMkf,GAAGF,MAA+C,IAAzCve,GAA0BE,cAErDud,EAAO6C,EAAK1f,WAAW6d,GAAGF,MACkB,IAAzCve,GAA0BE,aAAuB,GAGpDud,EAAO6C,EAAKzf,UAAU4d,GAAGF,MACmB,IAAzCve,GAA0BE,aAAuB,EACnD,IAEHsd,EAAG,yBAAyB,KAC1B,MAAMkC,EAAM,IAAIE,OAAiBte,EAAW,CAC1Cie,GAAe,QAAS,IAAK,EAAG,CAAEphC,KAAM,YAAaa,UAAU,IAC/DugC,GAAe,QAAS,IAAK,EAAG,CAAEphC,KAAM,QAASa,UAAU,IAC3DugC,GAAe,QAAS,IAAK,EAAG,CAAEphC,KAAM,QAASa,UAAU,MAEvDshC,EAAO,IAAItgB,GAA0B0f,GAC3CjC,EAAO6C,EAAK/gB,MAAMkf,GAAGF,MAA+C,GAAzCve,GAA0BE,cAErDud,EAAO6C,EAAK1f,WAAW6d,GAAGF,MACkB,GAAzCve,GAA0BE,aAAsB,GAGnDud,EAAO6C,EAAKzf,UAAU4d,GAAGF,MACmB,GAAzCve,GAA0BE,aAAsB,EAClD,IAEHsd,EAAG,mDAAmD,KACpD,IAAIkC,EAAM,IAAIE,OAAiBte,EAAW,CACxCie,GAAe,OAAQK,EAAiBrhC,oBAAsB,EAAG,EAAG,CAClEI,UAAU,MAGV2hC,EAAO,IAAItgB,GAA0B0f,GACzCjC,EAAO6C,EAAK/gB,MAAMkf,GAAGF,MAAMve,GAA0BE,cAErDud,EAAO6C,EAAK1f,WAAW6d,GAAGF,MACxBve,GAA0BE,aAAe,GAG3Cud,EAAO6C,EAAKzf,UAAU4d,GAAGF,MACvBve,GAA0BE,aAAe,GAG3Cwf,EAAM,IAAIE,OAAiBte,EAAW,CACpCie,GAAe,OAAQK,EAAiBrhC,oBAAqB,EAAG,CAC9DI,UAAU,MAGd2hC,EAAO,IAAItgB,GAA0B0f,GACrCjC,EAAO6C,EAAK/gB,MAAMkf,GAAGF,MAAMve,GAA0BE,aAAe,IAEpEud,EAAO6C,EAAK1f,WAAW6d,GAAGF,OACvBve,GAA0BE,aAAe,IAAM,GAGlDud,EAAO6C,EAAKzf,UAAU4d,GAAGF,OACtBve,GAA0BE,aAAe,IAAM,EACjD,GACD,IAEJqd,EAAS,kDAAkD,KACzDC,EAAG,mBAAmB,KACpB,MAAM+C,EAAevgB,GAA0BE,aACzCsgB,EAAoBD,EAAe,EACnCE,EAAmBF,EAAe,EAExC,IAAIb,EAAM,IAAIM,EACVM,EAAO,IAAItgB,GAA0B0f,GAEzCjC,EAAO6C,EAAK/gB,MAAMkf,GAAGF,MAAMgC,GAC3B9C,EAAO6C,EAAK1f,WAAW6d,GAAGF,MAAMiC,GAChC/C,EAAO6C,EAAKzf,UAAU4d,GAAGF,MAAMkC,GAE/Bf,EAAM,IAAIM,OAAoB1e,EAAW,CACvCie,GAAe,OAAQ,IAAK,KAE9Be,EAAO,IAAItgB,GAA0B0f,GAErCjC,EAAO6C,EAAK/gB,MAAMkf,GAAGF,MAAMgC,GAC3B9C,EAAO6C,EAAK1f,WAAW6d,GAAGF,MAAMiC,GAChC/C,EAAO6C,EAAKzf,UAAU4d,GAAGF,MAAMkC,EAAiB,IAElDjD,EAAG,uCAAuC,KACxC,MAAM+C,EAAevgB,GAA0BE,aACzCsgB,EAAoBD,EAAe,EACnCE,EAAmBF,EAAe,EAElCb,EAAM,IAAIM,OAAoB1e,EAAW,CAC7Cie,GACE,OACsD,KAAtDljC,EAAiCI,mBACjC,EACA,CAAEkC,UAAU,MAGV2hC,EAAO,IAAItgB,GAA0B0f,GAE3CjC,EAAO6C,EAAK/gB,MAAMkf,GAAGF,MAAMgC,GAC3B9C,EAAO6C,EAAK1f,WAAW6d,GAAGF,MAAMiC,GAChC/C,EAAO6C,EAAKzf,UAAU4d,GAAGF,MAAMkC,EAAiB,IAElDjD,EAAG,qCAAqC,KACtC,MAAM+C,EAAevgB,GAA0BE,aACzCsgB,EAAoBD,EAAe,EACnCE,EAAmBF,EAAe,EAElCb,EAAM,IAAIM,OAAoB1e,EAAW,CAC7Cie,GACE,OACsD,IAAtDljC,EAAiCI,mBACjC,EACA,CAAEkC,UAAU,MAGV2hC,EAAO,IAAItgB,GAA0B0f,GAE3CjC,EAAO6C,EAAK/gB,MAAMkf,GAAGF,MAAMgC,GAC3B9C,EAAO6C,EAAK1f,WAAW6d,GAAGF,MAAMiC,GAChC/C,EAAO6C,EAAKzf,UAAU4d,GAAGF,MAAMkC,EAAiB,IAElDjD,EAAG,sCAAsC,KACvC,MAAM+C,EAAwD,IAAzCvgB,GAA0BE,aACzCsgB,EAAoBD,EAAe,EACnCE,EAAmBF,EAAe,EAExC,IAAIb,EAAM,IAAIM,OAAoB1e,EAAW,CAC3Cie,GAAe,OAA8D,KAAtDljC,EAAiCI,mBAA2B,EAAG,CAACkC,UAAU,MAE/F2hC,EAAO,IAAItgB,GAA0B0f,GAEzCjC,EAAO6C,EAAK/gB,MAAMkf,GAAGF,MAAMgC,GAC3B9C,EAAO6C,EAAK1f,WAAW6d,GAAGF,MAAMiC,GAChC/C,EAAO6C,EAAKzf,UAAU4d,GAAGF,MAAMkC,EAAiB,IAElDjD,EAAG,sCAAsC,KACvC,MAAM+C,EAAwD,IAAzCvgB,GAA0BE,aACzCsgB,EAAoBD,EAAe,EACnCE,EAAmBF,EAAe,EAExC,IAAIb,EAAM,IAAIM,OAAoB1e,EAAW,CAC3Cie,GAAe,OAA8D,KAAtDljC,EAAiCI,mBAA2B,EAAG,CAACkC,UAAU,MAE/F2hC,EAAO,IAAItgB,GAA0B0f,GAEzCjC,EAAO6C,EAAK/gB,MAAMkf,GAAGF,MAAMgC,GAC3B9C,EAAO6C,EAAK1f,WAAW6d,GAAGF,MAAMiC,GAChC/C,EAAO6C,EAAKzf,UAAU4d,GAAGF,MAAMkC,EAAiB,IAElDjD,EAAG,uCAAuC,KACxC,MAAM+C,EAAwD,GAAzCvgB,GAA0BE,aACzCsgB,EAAoBD,EAAe,EACnCE,EAAmBF,EAAe,EAExC,IAAIb,EAAM,IAAIM,OAAoB1e,EAAW,CAC3Cie,GAAe,OAA8D,MAAtDljC,EAAiCI,mBAA4B,EAAG,CAACkC,UAAU,MAEhG2hC,EAAO,IAAItgB,GAA0B0f,GAEzCjC,EAAO6C,EAAK/gB,MAAMkf,GAAGF,MAAMgC,GAC3B9C,EAAO6C,EAAK1f,WAAW6d,GAAGF,MAAMiC,GAChC/C,EAAO6C,EAAKzf,UAAU4d,GAAGF,MAAMkC,EAAiB,IAElDjD,EAAG,oCAAoC,KACrC,MAAM+C,EAAwD,GAAzCvgB,GAA0BE,aACzCsgB,EAAoBD,EAAe,EACnCE,EAAmBF,EAAe,EAExC,IAAIb,EAAM,IAAIM,OAAoB1e,EAAW,CAC3Cie,GAAe,OAA8D,GAAtDljC,EAAiCI,mBAAyB,EAAG,CAACkC,UAAU,MAE7F2hC,EAAO,IAAItgB,GAA0B0f,GAEzCjC,EAAO6C,EAAK/gB,MAAMkf,GAAGF,MAAMgC,GAC3B9C,EAAO6C,EAAK1f,WAAW6d,GAAGF,MAAMiC,GAChC/C,EAAO6C,EAAKzf,UAAU4d,GAAGF,MAAMkC,EAAiB,IAElDjD,EAAG,sCAAsC,KACvC,MAAM+C,EAAwD,IAAzCvgB,GAA0BE,aACzCsgB,EAAoBD,EAAe,EACnCE,EAAmBF,EAAe,EAExC,IAAIb,EAAM,IAAIM,OAAoB1e,EAAW,CAC3Cie,GAAe,OAA8D,KAAtDljC,EAAiCI,mBAA2B,EAAG,CAACkC,UAAU,MAE/F2hC,EAAO,IAAItgB,GAA0B0f,GAEzCjC,EAAO6C,EAAK/gB,MAAMkf,GAAGF,MAAMgC,GAC3B9C,EAAO6C,EAAK1f,WAAW6d,GAAGF,MAAMiC,GAChC/C,EAAO6C,EAAKzf,UAAU4d,GAAGF,MAAMkC,EAAiB,IAElDjD,EAAG,qCAAqC,KACtC,MAAM+C,EAAwD,IAAzCvgB,GAA0BE,aACzCsgB,EAAoBD,EAAe,EACnCE,EAAmBF,EAAe,EAExC,IAAIb,EAAM,IAAIM,OAAoB1e,EAAW,CAC3Cie,GAAe,OAAQljC,EAAiCI,mBAAoB,EAAG,CAACkC,UAAU,MAE5F,MAAM2hC,EAAO,IAAItgB,GAA0B0f,GAE3CjC,EAAO6C,EAAK/gB,MAAMkf,GAAGF,MAAMgC,GAC3B9C,EAAO6C,EAAK1f,WAAW6d,GAAGF,MAAMiC,GAChC/C,EAAO6C,EAAKzf,UAAU4d,GAAGF,MAAMkC,EAAiB,IAElDjD,EAAG,sCAAsC,KAKvC,IAAIkC,EAAM,IAAIM,OAAoB1e,EAAW,CAC3Cie,GAAe,OAAQljC,EAAiCI,mBAAoB,MAAO,CAACkC,UAAU,MAE5F2hC,EAAO,IAAItgB,GAA0B0f,GAEzCjC,EAAO6C,EAAK/gB,MAAMkf,GAAGF,MATA,GAUrBd,EAAO6C,EAAK1f,WAAW6d,GAAGF,MATA,GAU1Bd,EAAO6C,EAAKzf,UAAU4d,GAAGF,MATA,EASuB,GAChD,IAEJhB,EAAS,kDAAkD,KACzDC,EAAG,oCAAoC,KACrC,MAAM+C,EAAevgB,GAA0BE,aACzCsgB,EAAoBD,EAAe,EACnCE,EAAmBF,EAAe,EAElCb,EAAM,IAAIO,EACVK,EAAO,IAAItgB,GAA0B0f,GAE3CjC,EAAO6C,EAAK/gB,MAAMkf,GAAGF,MAAMgC,GAC3B9C,EAAO6C,EAAK1f,WAAW6d,GAAGF,MAAMiC,GAChC/C,EAAO6C,EAAKzf,UAAU4d,GAAGF,MAAMkC,EAAiB,IAElDjD,EAAG,uCAAuC,KACxC,MAAM+C,EAAevgB,GAA0BE,aACzCsgB,EAAoBD,EAAe,EACnCE,EAAmBF,EAAe,EAExC,IAAIb,EAAM,IAAIO,OAAoB3e,EAAW,CAC3Cie,GAAe,OAA8D,KAAtDljC,EAAiCI,mBAA2B,KAEjF6jC,EAAO,IAAItgB,GAA0B0f,GAEzCjC,EAAO6C,EAAK/gB,MAAMkf,GAAGF,MAAMgC,GAC3B9C,EAAO6C,EAAK1f,WAAW6d,GAAGF,MAAMiC,GAChC/C,EAAO6C,EAAKzf,UAAU4d,GAAGF,MAAMkC,EAAiB,IAElDjD,EAAG,qCAAqC,KACtC,MAAM+C,EAAevgB,GAA0BE,aACzCsgB,EAAoBD,EAAe,EACnCE,EAAmBF,EAAe,EAExC,IAAIb,EAAM,IAAIO,OAAoB3e,EAAW,CAC3Cie,GAAe,OAA8D,IAAtDljC,EAAiCI,mBAA0B,KAEhF6jC,EAAO,IAAItgB,GAA0B0f,GAEzCjC,EAAO6C,EAAK/gB,MAAMkf,GAAGF,MAAMgC,GAC3B9C,EAAO6C,EAAK1f,WAAW6d,GAAGF,MAAMiC,GAChC/C,EAAO6C,EAAKzf,UAAU4d,GAAGF,MAAMkC,EAAiB,IAElDjD,EAAG,sCAAsC,KACvC,MAAM+C,EAAwD,IAAzCvgB,GAA0BE,aACzCsgB,EAAoBD,EAAe,EACnCE,EAAmBF,EAAe,EAExC,IAAIb,EAAM,IAAIO,OAAoB3e,EAAW,CAC3Cie,GAAe,OAA8D,KAAtDljC,EAAiCI,mBAA2B,KAErF,MAAM6jC,EAAO,IAAItgB,GAA0B0f,GAE3CjC,EAAO6C,EAAK/gB,MAAMkf,GAAGF,MAAMgC,GAC3B9C,EAAO6C,EAAK1f,WAAW6d,GAAGF,MAAMiC,GAChC/C,EAAO6C,EAAKzf,UAAU4d,GAAGF,MAAMkC,EAAiB,IAElDjD,EAAG,sCAAsC,KACvC,MAAM+C,EAAwD,IAAzCvgB,GAA0BE,aACzCsgB,EAAoBD,EAAe,EACnCE,EAAmBF,EAAe,EAExC,IAAIb,EAAM,IAAIO,OAAoB3e,EAAW,CAC3Cie,GAAe,OAA8D,KAAtDljC,EAAiCI,mBAA2B,KAErF,MAAM6jC,EAAO,IAAItgB,GAA0B0f,GAE3CjC,EAAO6C,EAAK/gB,MAAMkf,GAAGF,MAAMgC,GAC3B9C,EAAO6C,EAAK1f,WAAW6d,GAAGF,MAAMiC,GAChC/C,EAAO6C,EAAKzf,UAAU4d,GAAGF,MAAMkC,EAAiB,IAElDjD,EAAG,uCAAuC,KACxC,MAAM+C,EAAwD,GAAzCvgB,GAA0BE,aACzCsgB,EAAoBD,EAAe,EACnCE,EAAmBF,EAAe,EAExC,IAAIb,EAAM,IAAIO,OAAoB3e,EAAW,CAC3Cie,GAAe,OAA8D,MAAtDljC,EAAiCI,mBAA4B,KAElF6jC,EAAO,IAAItgB,GAA0B0f,GAEzCjC,EAAO6C,EAAK/gB,MAAMkf,GAAGF,MAAMgC,GAC3B9C,EAAO6C,EAAK1f,WAAW6d,GAAGF,MAAMiC,GAChC/C,EAAO6C,EAAKzf,UAAU4d,GAAGF,MAAMkC,EAAiB,IAElDjD,EAAG,oCAAoC,KACrC,MAAM+C,EAAwD,GAAzCvgB,GAA0BE,aACzCsgB,EAAoBD,EAAe,EACnCE,EAAmBF,EAAe,EAExC,IAAIb,EAAM,IAAIO,OAAoB3e,EAAW,CAC3Cie,GAAe,OAA8D,GAAtDljC,EAAiCI,mBAAyB,KAE/E6jC,EAAO,IAAItgB,GAA0B0f,GAEzCjC,EAAO6C,EAAK/gB,MAAMkf,GAAGF,MAAMgC,GAC3B9C,EAAO6C,EAAK1f,WAAW6d,GAAGF,MAAMiC,GAChC/C,EAAO6C,EAAKzf,UAAU4d,GAAGF,MAAMkC,EAAiB,IAElDjD,EAAG,sCAAsC,KACvC,MAAM+C,EAAwD,IAAzCvgB,GAA0BE,aACzCsgB,EAAoBD,EAAe,EACnCE,EAAmBF,EAAe,EAExC,IAAIb,EAAM,IAAIO,OAAoB3e,EAAW,CAC3Cie,GAAe,OAA8D,KAAtDljC,EAAiCI,mBAA2B,KAEjF6jC,EAAO,IAAItgB,GAA0B0f,GAEzCjC,EAAO6C,EAAK/gB,MAAMkf,GAAGF,MAAMgC,GAC3B9C,EAAO6C,EAAK1f,WAAW6d,GAAGF,MAAMiC,GAChC/C,EAAO6C,EAAKzf,UAAU4d,GAAGF,MAAMkC,EAAiB,IAElDjD,EAAG,qCAAqC,KACtC,MAAM+C,EAAwD,IAAzCvgB,GAA0BE,aACzCsgB,EAAoBD,EAAe,EACnCE,EAAmBF,EAAe,EAExC,IAAIb,EAAM,IAAIO,OAAoB3e,EAAW,CAC3Cie,GAAe,OAAQljC,EAAiCI,mBAAoB,KAE1E6jC,EAAO,IAAItgB,GAA0B0f,GAEzCjC,EAAO6C,EAAK/gB,MAAMkf,GAAGF,MAAMgC,GAC3B9C,EAAO6C,EAAK1f,WAAW6d,GAAGF,MAAMiC,GAChC/C,EAAO6C,EAAKzf,UAAU4d,GAAGF,MAAMkC,EAAiB,IAElDjD,EAAG,sCAAsC,KAKvC,IAAIkC,EAAM,IAAIO,OAAoB3e,EAAW,CAC3Cie,GAAe,OAAQljC,EAAiCI,mBAAoB,SAE9E,MAAM6jC,EAAO,IAAItgB,GAA0B0f,GAE3CjC,EAAO6C,EAAK/gB,MAAMkf,GAAGF,MATA,GAUrBd,EAAO6C,EAAK1f,WAAW6d,GAAGF,MATA,GAU1Bd,EAAO6C,EAAKzf,UAAU4d,GAAGF,MATA,EASuB,GAChD,GACF,EC5aG,MACMtgC,GAAU,CACrBm/B,YAAa,oDAGf,IAAesD,GAAA,EAAGnD,WAAUC,KAAIC,aAE9B,MAAMkD,EAAcjoB,MAAMkoB,KAAK,CAAE31B,OAAQ,KAAM,CAAC41B,EAAKlc,IAAQA,IACvDmc,EAAY,CAAC,MAAO,MAAO,MAAO,MAAO,MAAO,OAChDjJ,EAAS,CACb/W,GAA4BqC,sBAC5BrC,GAA4B2C,oBAC5B3C,GAA4BsC,aAC5BtC,GAA4BuC,aAC5BvC,GAA4BwC,YAExByd,EAAY,CAACC,EAAkBhyB,IACnC8R,GAA4Be,eAAegW,EAAOmJ,GAAWhyB,GACzDiyB,EAAkBC,GACtBpjC,OAAOqjC,YACLL,EAAUtyB,KAAK4yB,GAAa,CAACA,EAAU,CAAEnmC,MAAOimC,EAAQv5B,MAAO,OAG7D05B,EAAiB,CACrBryB,EACAoyB,EACAriB,EACAlV,KAEA,MAAMy3B,EAAcL,EAAejyB,GAC7BuyB,EAAY,IAAIzgB,GAA4BwgB,GAClD,OAAO9D,EAAG,GAAGxuB,KAAS,KACpByuB,EAAO8D,EAAUH,GAAUriB,IAAM0f,GAAGF,MAAMwC,EAAUl3B,EAAOmF,GAAO,GAClE,EAEEwyB,EAA8B,CAClCxyB,EACAoyB,EACAriB,EACAlV,EACA43B,KAEA,MAAMH,EAAcL,EAAejyB,GAC7BuyB,EAAY,IAAIzgB,GAA4BwgB,GAClD,OAAO9D,EAAG,GAAGxuB,KAAS,KAEpByuB,EAAO8D,EAAUH,GAAUriB,IAAM0f,GAAGF,MAClCwC,EAAUl3B,EAAOmF,GAASyyB,EAC3B,GACD,EASJlE,EAAS,gCAAgC,KAAMmE,OANrBv0B,EAMsC,YAL9D2zB,EAAUtyB,KAAK4yB,GACb7D,EAAS,GAAGpwB,MAASi0B,KAAY,IAC/BT,EAAYnyB,KAAKQ,GAAUqyB,EAAeryB,EAAOoyB,EAAU,MAAO,SAH/C,IAACj0B,CAMkD,IAE5EowB,EAAS,sBAAsB,KAC7BA,EAAS,cAAc,IACrBoD,EAAYnyB,KAAKQ,GAAUqyB,EAAeryB,EAAO,MAAO,KAAM,MAAI,IAGtEuuB,EAAS,0BAA0B,KACjCA,EAAS,YAAY,IACnBoD,EAAYnyB,KAAKQ,GAAUqyB,EAAeryB,EAAO,MAAO,WAAY,OACtEuuB,EAAS,oBAAoB,IAC3BoD,EAAYnyB,KAAKQ,GAAUqyB,EAAeryB,EAAO,MAAO,SAAU,MAAI,IAG1EuuB,EAAS,uBAAuB,KAC9BA,EAAS,cAAc,IACrBoD,EAAYnyB,KAAKQ,GAAUqyB,EAAeryB,EAAO,MAAO,OAAQ,MAAI,IAGxEuuB,EAAS,sBAAsB,KAC7BA,EAAS,gBAAgB,IACvBoD,EAAYnyB,KAAKQ,GAAUqyB,EAAeryB,EAAO,MAAO,MAAO,OACjEuuB,EAAS,WAAW,IAClBoD,EAAYnyB,KAAKQ,GACfwyB,EAA4BxyB,EAAO,MAAO,SAAU,EAAG,OAE3DuuB,EAAS,uBAAuB,IAC9BoD,EAAYnyB,KAAKQ,GACfwyB,EAA4BxyB,EAAO,MAAO,UAAW,EAAG,MACxD,GACJ,ECxFG,MACM/Q,GAAU,CACrBm/B,YAAa,4CAGTuE,GAAkB,CAACvoB,EAAawoB,IAEpC,IAAIpqB,KAAKC,eAAe,CACtBtK,KAAM,cAAcE,QAAQC,MAAM+uB,aAClCl+B,KAAM,QACNO,OAAaZ,OAAAgnB,OAAAhnB,OAAAgnB,OAAA,CAAA,EAAA8c,GAAc,CAAAxoB,UAgBzByoB,GAAiB,CAAC,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,GAEhD,IAAeC,GAAA,EAAGvE,WAAUC,KAAIC,aAE9BF,EAAS,gBAAgB,KACvBC,EAAG,sEAAsE,KACvE,MAAM/gB,EAnBgB,EAACmlB,KAAsBG,IACjDA,EAAOvjC,QACL,CAAC4tB,EAAa4V,EAAiBrd,IAAgB,IAC1CyH,KACA1T,MAAMkoB,KAAK,CAAE31B,OAAQ+2B,IAAW,IACjCL,GAAgBhd,EAAM,EAAGid,OAG7B,IAWiBK,CAAoB,MAAOJ,IACpCK,EAAY,IAAIxe,GAA4B,CAAE,EAAEjH,GACtDolB,GAAepwB,SAAS8T,IACtBkY,EAAOyE,EAAUxlB,UAAU6I,GAAIta,QAAQwzB,GAAGF,MAAMhZ,EAAG,GACnD,GACF,IAGJgY,EAAS,eAAe,KACtBA,EAAS,iDAAiD,KACxDC,EAAG,2BAA2B,KAC5B,MAAM/gB,EAAS,CAACklB,GAAgB,IAC1BO,EAAY,IAAIxe,GACpB,CAAE,EAAG,CAAElnB,IAAK,IACZigB,GAEFghB,EAAOyE,EAAUvlB,MAAM,GAAG6I,MAAMiZ,GAAGF,MAAM,GACzCd,EAAOyE,EAAUvlB,MAAM,GAAGngB,KAAKiiC,GAAGF,MAAM,EAAE,IAG5Cf,EAAG,kCAAkC,KACnC,MAAM/gB,EAAS,CAACklB,GAAgB,EAAG,CAAEptB,UAAW,EAAG4Q,KAAM,KACnD+c,EAAY,IAAIxe,GACpB,CAAE,EAAG,CAAElnB,IAAK,IACZigB,GAEFghB,EAAOyE,EAAUvlB,MAAM,GAAG6I,MAAMiZ,GAAGF,MAAM,GACzCd,EAAOyE,EAAUvlB,MAAM,GAAGngB,KAAKiiC,GAAGF,MAAM,EAAE,IAG5Cf,EAAG,iCAAiC,KAClC,MAAM/gB,EAAS,CAACklB,GAAgB,EAAG,CAAEptB,UAAW,EAAG4Q,KAAM,KACnD+c,EAAY,IAAIxe,GACpB,CAAE,EAAG,CAAElnB,IAAK,IACZigB,GAEFghB,EAAOyE,EAAUvlB,MAAM,GAAG6I,MAAMiZ,GAAGF,MAAM,GACzCd,EAAOyE,EAAUvlB,MAAM,GAAGngB,KAAKiiC,GAAGF,MAAM,EAAE,GAC1C,GACF,IAGJhB,EAAS,6BAA6B,KACpCC,EAAG,gDAAgD,KACjD,MAAM0E,EAAY,IAAIxe,GAA4B,CAAE3mB,SAAS,GAAQ,IACrE0gC,EAAOyE,EAAUnlC,SAAS0hC,GAAGC,GAAGC,IAAI,IAEtCnB,EAAG,oDAAoD,KACrD,MAAM0E,EAAY,IAAIxe,GAA4B,CAAE3mB,SAAS,GAAS,IACtE0gC,EAAOyE,EAAUnlC,SAAS0hC,GAAGC,GAAGE,KAAK,IAEvCpB,EAAG,2DAA2D,KAC5D,MAAM0E,EAAY,IAAIxe,GAA4B,CAAE3mB,SAAS,GAAQ,IACrE0gC,EAAOyE,EAAUnlC,SAAS0hC,GAAGC,GAAGC,KAChCuD,EAAUnlC,SAAU,EACpB0gC,EAAOyE,EAAUnlC,SAAS0hC,GAAGC,GAAGE,KAAK,GACrC,GACF,ECnFG,MAAM/nB,GAAM,8BACN5Y,GAAU,CAAEm/B,YAAa,mCAEhCC,GAAkB,IAAMpB,GAAmB,UAAW,CAAE,EAAEplB,IAEhE,IAAAsrB,GAAe,EACb5E,WACAC,KACAC,SACA9H,QACAyM,YACA1E,aAEA,MAAMC,EAAY,IAAIvW,GAChBwW,EAAqBx7B,KAAKI,SAAStG,IAAIkG,KAAK1D,OAAO2D,GAAI,eACvDw7B,EAAoBz7B,KAAKI,SAAStG,IAAIkG,KAAK1D,OAAO2D,GAAI,cAE5DszB,GAAM,KACJvzB,KAAKI,SAASpG,IAAIgG,KAAK1D,OAAO2D,GAAI,cAAeu7B,GACjDx7B,KAAKI,SAASpG,IAAIgG,KAAK1D,OAAO2D,GAAI,aAAcw7B,GAChDf,GAAmBjmB,GAAI,IAIzB0mB,EAAS,wBAAwB,KAC/B6E,GAAU,KACRtF,GAAmBjmB,GAAI,IAGzB2mB,EAAG,sBAAsB,IAAWhjC,OAAA,OAAA,OAAA,GAAA,YAClC,MAAM6P,QAAcgzB,KACpBI,EAAOpzB,eAAAA,EAAO3L,OAAOqE,QAAQ87B,GAAGvd,SACjC,MAEDkc,EAAG,mBAAmB,IAAWhjC,OAAA,OAAA,OAAA,GAAA,YAC/B,MAAM6P,QAAcgzB,KACpBI,EAAOpzB,eAAAA,EAAO3L,OAAO6D,aAAau7B,IAAIxc,UACtCmc,EAAOpzB,aAAK,EAALA,EAAO3L,OAAO6D,YAAYhG,SAASuhC,IAAIxc,UAC9Cmc,EAAOpzB,aAAK,EAALA,EAAO3L,OAAO6D,YAAYxF,SAAS+gC,IAAIxc,UAC9Cmc,EAAOpzB,aAAK,EAALA,EAAO3L,OAAO6D,YAAYvF,KAAK8gC,IAAIxc,UAC1Cmc,EAAOpzB,aAAK,EAALA,EAAO3L,OAAO6D,YAAYpF,YAAY2gC,IAAIxc,UACjDmc,EAAOpzB,aAAK,EAALA,EAAO3L,OAAO6D,YAAYnF,OAAO0gC,IAAIxc,UAC5Cmc,EAAOpzB,aAAK,EAALA,EAAO3L,OAAO6D,YAAYtH,OAAO6iC,IAAIxc,UAC5Cmc,EAAOpzB,aAAK,EAALA,EAAO3L,OAAO6D,YAAY/F,KAAKshC,IAAIxc,UAC1Cmc,EAAOpzB,aAAK,EAALA,EAAO3L,OAAO6D,YAAYw7B,kBAAkBD,IAAIxc,UACvDmc,EAAOpzB,aAAK,EAALA,EAAO3L,OAAO6D,YAAYy7B,qBAAqBF,IAAIxc,UAC1Dmc,EAAOpzB,aAAK,EAALA,EAAO3L,OAAO6D,YAAY07B,oBAAoBH,IAAIxc,SAC1D,MAEDkc,EAAG,iBAAiB,IAAWhjC,OAAA,OAAA,OAAA,GAAA,YAC7B,MAAM6P,QAAcgzB,KACpBI,EAAOpzB,eAAAA,EAAO3L,OAAOsnB,UAAU8X,IAAIxc,UACnCmc,EAAOpzB,aAAK,EAALA,EAAO3L,OAAOsnB,SAASzG,MAAMue,IAAIxc,SACzC,MAEDkc,EAAG,WAAW,IAAWhjC,OAAA,OAAA,OAAA,GAAA,YACvB,MAAM6P,QAAcgzB,KACpBI,EAAOpzB,eAAAA,EAAO3L,OAAOwL,IAAI4zB,IAAIxc,UAC7Bmc,EAAOpzB,aAAK,EAALA,EAAO3L,OAAOwL,GAAGjP,OAAO6iC,IAAIxc,UACnCmc,EAAOpzB,aAAK,EAALA,EAAO3L,OAAOwL,GAAG6U,KAAK+e,IAAIxc,SAClC,MAEDkc,EAAG,YAAY,IAAWhjC,OAAA,OAAA,OAAA,GAAA,YACxB,MAAM6P,QAAcgzB,KACpBI,EAAOpzB,eAAAA,EAAO3L,OAAO8L,KAAKszB,IAAIxc,UAC9Bmc,EAAOpzB,aAAK,EAALA,EAAO3L,OAAO8L,IAAIvP,OAAO6iC,IAAIxc,UACpCmc,EAAOpzB,aAAK,EAALA,EAAO3L,OAAO8L,IAAIuU,KAAK+e,IAAIxc,SACnC,MAEDic,EAAS,cAAc,KAErB,MAAMW,EAAc,IAAI1sB,IAAI,CAAC,IAAK,IAAK,IAAK,IAAK,IAAK,MAEtDgsB,EAAG,cAAc,IAAWhjC,OAAA,OAAA,OAAA,GAAA,YAC1B,MAAM6P,QAAcgzB,KACpBI,EAAOpzB,eAAAA,EAAO3L,OAAO+d,QAAQqhB,IAAIxc,UACjCmc,EAAOpzB,aAAK,EAALA,EAAO3L,OAAO+d,OAAO1f,SAAS+gC,IAAIxc,UACzCmc,EAAOpzB,aAAK,EAALA,EAAO3L,OAAO+d,OAAOC,WAAWohB,IAAIxc,UAC3Cmc,EAAOpzB,aAAK,EAALA,EAAO3L,OAAO+d,OAAOE,OAAOmhB,IAAIxc,SACxC,MAED4c,EAAYzsB,SAAS2H,IACnBokB,EAAG,mBAAmBpkB,KAAO,IAAW5e,OAAA,OAAA,OAAA,GAAA,YACtC,MAAM6P,QAAcgzB,KACpBI,EAAOpzB,eAAAA,EAAO3L,OAAO+d,OAAOE,MAAMvD,IAAM0kB,IAAIxc,UAC5Cmc,EAAO3/B,OAAO4mB,KAAKra,aAAK,EAALA,EAAO3L,OAAO+d,OAAOE,MAAMvD,KAAO+kB,QAAQ,QAC7DV,EAAO3/B,OAAO4mB,KAAKra,aAAK,EAALA,EAAO3L,OAAO+d,OAAOE,MAAMvD,KAAO+kB,QAAQ,MAC9D,KAAC,GACF,GACF,IAGJZ,EAAS,kBAAkB,KACzBG,GAAO,IAAWljC,OAAA,OAAA,OAAA,GAAA,kBACV6iC,IACP,MAEkB,CAAC,SAAU,aAAc,QAAS,aAC1C5rB,SAAS0C,IAClBqpB,EAAG,OAAOrpB,KAAS,IAAW3Z,OAAA,OAAA,OAAA,GAAA,YAC5B,MAAM6P,QAAcoyB,GAAgB5lB,IACpC4mB,EAAOpzB,aAAK,EAALA,EAAO3L,OAAOyV,IAAQ2pB,IAAIxc,SAClC,KAAC,IAGoB,CACtB,CAAEnN,MAAO,KAAMiqB,UAAW,CAAC,KAAM,QAAS,QAC1C,CAAEjqB,MAAO,WAAYiqB,UAAW,CAAC,UAAW,UAAW,UAEzC3sB,SAAQ,EAAG0C,QAAOiqB,gBAChCA,EAAU3sB,SAAS4sB,IACjBb,EAAG,GAAGrpB,eAAmBkqB,cAAqB,IAAW7jC,OAAA,OAAA,OAAA,GAAA,YACvD,MAAM6P,QAAcoyB,GAAgB5lB,IACpC4mB,EAAOpzB,aAAK,EAALA,EAAO3L,OAAOyV,IAAQ2pB,IAAIxc,UACjCmc,EAAOpzB,aAAA,EAAAA,EAAO3L,OAAOyV,GAAOkqB,IAAWP,IAAIxc,SAC5C,KAAC,GACF,IAG0B,CAC5B,CACEnN,MAAO,QACPiqB,UAAW,CACT,CAAEC,SAAU,SAAUC,YAAa,CAAC,UACpC,CAAED,SAAU,QAASC,YAAa,CAAC,UACnC,CAAED,SAAU,YAAaC,YAAa,CAAC,UACvC,CAAED,SAAU,QAASC,YAAa,CAAC,UACnC,CAAED,SAAU,OAAQC,YAAa,CAAC,aAIlB7sB,SAAQ,EAAG0C,QAAOiqB,gBACtCA,EAAU3sB,SAAQ,EAAG4sB,WAAUC,kBAC7Bd,EAAG,GAAGrpB,eAAmBkqB,yBAAgCC,WAAqB,IAAW9jC,OAAA,OAAA,OAAA,GAAA,YACvF,MAAM6P,QAAcoyB,GAAgB5lB,IACpC4mB,EAAOpzB,aAAK,EAALA,EAAO3L,OAAOyV,IAAQ2pB,IAAIxc,UACjCmc,EAAOpzB,aAAA,EAAAA,EAAO3L,OAAOyV,GAAOkqB,IAAWP,IAAIxc,UAC3Cmc,EAAOpzB,eAAAA,EAAO3L,OAAOyV,GAAOkqB,GAAUC,IAAcR,IAAIxc,SACzD,KAAC,GACF,IAGJqU,GAAM,KACJmH,GAAmBjmB,GAAI,GACvB,IAGJ0mB,EAAS,WAAW,KAClBC,EAAG,+BAA+B,IAAWhjC,OAAA,OAAA,OAAA,GAAA,YAC3C,MAAMgkC,QAAkBvC,GACtB,UACA,CACEv9B,OAAQ,CACNioB,MAAO,CACLviB,OAAQ,CAAEnJ,MAAO,GACjBgJ,MAAO,CAAEhJ,MAAO,GAChBkJ,UAAW,CAAElJ,MAAO,GACpBoJ,MAAO,CAAEpJ,MAAO,GAChBiJ,KAAM,CAAEjJ,MAAO,MAIrB4b,IAEF4mB,EAAOe,aAAS,EAATA,EAAW9/B,OAAO+T,OAAOgsB,GAAGC,GAAGC,IACvC,MAEDnB,EAAG,oCAAoC,IAAWhjC,OAAA,OAAA,OAAA,GAAA,YAChD,MAAMgkC,QAAkBvC,GACtB,UACA,CACEv9B,OAAQ,CACNioB,MAAO,CACLviB,OAAQ,CAAEnJ,MAAO,IACjBgJ,MAAO,CAAEhJ,MAAO,GAChBkJ,UAAW,CAAElJ,MAAO,GACpBoJ,MAAO,CAAEpJ,MAAO,GAChBiJ,KAAM,CAAEjJ,MAAO,MAIrB4b,IAEF4mB,EAAOe,aAAS,EAATA,EAAW9/B,OAAO+T,OAAOgsB,GAAGC,GAAGE,KACvC,KAAC,IAGJrB,EAAS,gBAAgB,KACvBC,EAAG,0BAA0B,IAAWhjC,OAAA,OAAA,OAAA,GAAA,YACtC,MAAM6P,QAAcgzB,KACpBI,EAAOpzB,aAAA,EAAAA,EAAO3N,MAAMwa,SAASjM,QAAQszB,MAAM,GAC3Cd,EAAOpzB,aAAA,EAAAA,EAAO3L,OAAO4d,WAAWrR,QAAQszB,MAAM,SACxCl0B,aAAK,EAALA,EAAOmG,wBAAwB,OAAQ,CAC3C,CAAErS,KAAM,YAAagP,KAAM,oBAE7BswB,EAAOpzB,aAAA,EAAAA,EAAO3N,MAAMwa,SAASjM,QAAQszB,MAAM,GAC3Cd,EAAOpzB,eAAAA,EAAO3N,MAAMwa,SAAS,GAAG/J,MAAMoxB,MAAM,kBAE5C,MAAMzrB,EAASzI,aAAA,EAAAA,EAAO3N,MAAMwa,SAAS,GAAG7U,GACxCo7B,EAAOpzB,aAAA,EAAAA,EAAO3L,OAAO4d,WAAWrR,QAAQszB,MAAM,GAE9Cd,EAAOpzB,eAAAA,EAAO3L,OAAO4d,WAAW,GAAG/T,KAAKg2B,MAAMzrB,GAC9CzI,SAAAA,EAAOwyB,QACR,MAEDlH,GAAM,KACJmH,GAAmBjmB,GAAI,GACvB,IAGJ0mB,EAAS,eAAe,KACtBC,EAAG,8BAA8B,IAAWhjC,OAAA,OAAA,OAAA,GAAA,YAC1C,MAAM6P,QAAcgzB,KACpBI,EAAOpzB,aAAA,EAAAA,EAAO3N,MAAMwa,SAASjM,QAAQszB,MAAM,GAC3Cd,EAAOpzB,aAAA,EAAAA,EAAO3L,OAAO2d,UAAUpR,QAAQszB,MAAM,SACvCl0B,aAAK,EAALA,EAAOmG,wBAAwB,OAAQ,CAC3C,CAAErS,KAAM,OAAQgP,KAAM,gBAAiBzO,OAAQ,CAAEC,UAAU,MAE7D8+B,EAAOpzB,aAAA,EAAAA,EAAO3N,MAAMwa,SAASjM,QAAQszB,MAAM,GAC3Cd,EAAOpzB,eAAAA,EAAO3N,MAAMwa,SAAS,GAAG/J,MAAMoxB,MAAM,iBAC5Cd,EAAOpzB,eAAAA,EAAO3N,MAAMwa,SAAS,GAAGxY,OAAOC,UAAUkgC,GAAGF,KAEpD,MAAM7rB,EAASzI,aAAA,EAAAA,EAAO3N,MAAMwa,SAAS,GAAG7U,GACxCo7B,EAAOpzB,aAAA,EAAAA,EAAO3L,OAAO2d,UAAUpR,QAAQszB,MAAM,GAE7Cd,EAAOpzB,eAAAA,EAAO3L,OAAO2d,UAAU,GAAG9T,KAAKg2B,MAAMzrB,GAC7CzI,SAAAA,EAAOwyB,QACR,MAEDW,EAAG,sDAAsD,IAAWhjC,OAAA,OAAA,OAAA,GAAA,YAClE,MAAM6P,QAAcgzB,KACpBI,EAAOpzB,aAAA,EAAAA,EAAO3N,MAAMwa,SAASjM,QAAQszB,MAAM,GAC3Cd,EAAOpzB,aAAA,EAAAA,EAAO3L,OAAO2d,UAAUpR,QAAQszB,MAAM,SACvCl0B,aAAK,EAALA,EAAOmG,wBAAwB,OAAQ,CAC3C,CAAErS,KAAM,YAAagP,KAAM,oBAE7B,MAAM6K,EAAY3N,aAAA,EAAAA,EAAO3N,MAAMggC,QAAQ,wBACjCryB,aAAK,EAALA,EAAOmG,wBAAwB,OAAQ,CAE3C,CACErS,KAAM,OACNgP,KAAM,gBACNzO,OAAQ,CAAEC,UAAU,EAAMkV,YAAamE,aAAS,EAATA,EAAW3V,OAGtDo7B,EAAOpzB,aAAA,EAAAA,EAAO3N,MAAMwa,SAASjM,QAAQszB,MAAM,GAC3Cd,EAAOpzB,eAAAA,EAAO3N,MAAMwa,SAAS,GAAG/J,MAAMoxB,MAAM,kBAC5Cd,EAAOpzB,eAAAA,EAAO3N,MAAMwa,SAAS,GAAG/J,MAAMoxB,MAAM,iBAC5Cd,EAAOpzB,eAAAA,EAAO3N,MAAMwa,SAAS,GAAGxY,OAAOC,UAAUkgC,GAAGF,KAEpDlB,EAAOpzB,aAAA,EAAAA,EAAO3N,MAAMwa,SAAS,GAAGxY,OAAOmV,aAAa0qB,MAAMvmB,aAAS,EAATA,EAAW3V,IACrEo7B,EAAOpzB,aAAA,EAAAA,EAAO3L,OAAO2d,UAAUpR,QAAQszB,MAAM,GAC7Cl0B,SAAAA,EAAOwyB,QACR,MAEDlH,GAAM,KACJmH,GAAmBjmB,GAAI,GACvB,IAGJ0mB,EAAS,WAAW,KAClBC,EAAG,0CAA0C,IAAWhjC,OAAA,OAAA,OAAA,GAAA,YACtD,MAAM6P,QAAcgzB,KACpBI,EAAOpzB,aAAA,EAAAA,EAAO3N,MAAMwa,SAASjM,QAAQszB,MAAM,GAC3Cd,EAAOpzB,aAAA,EAAAA,EAAO3L,OAAOhC,MAAMuO,QAAQszB,MAAM,SACnCl0B,aAAK,EAALA,EAAOmG,wBAAwB,OAAQ,CAC3C,CACErS,KAAM,OACNgP,KAAM,aAER,CACEhP,KAAM,OACNgP,KAAM,gBACNzO,OAAQ,CAAEC,UAAU,EAAMC,SAAU,CAAE3D,MAAO,GAAKsV,KAAM,MAG5DktB,EAAOpzB,aAAA,EAAAA,EAAO3N,MAAMwa,SAASjM,QAAQszB,MAAM,GAC3Cd,EAAOpzB,eAAAA,EAAO3N,MAAMwa,SAAS,GAAG/J,MAAMoxB,MAAM,aAC5Cd,EAAOpzB,eAAAA,EAAO3N,MAAMwa,SAAS,GAAG/J,MAAMoxB,MAAM,iBAC5Cd,EAAOpzB,eAAAA,EAAO3N,MAAMwa,SAAS,GAAGxY,OAAOC,UAAUkgC,GAAGF,KACpDlB,EAAOpzB,aAAA,EAAAA,EAAO3L,OAAOhC,MAAMuO,QAAQszB,MAAM,GACzCd,EAAOpzB,eAAAA,EAAO3L,OAAOhC,MAAM,GAAGyQ,MAAMoxB,MAAM,aAC1Cl0B,SAAAA,EAAOwyB,QACR,MAEDW,EAAG,sDAAsD,IAAWhjC,OAAA,OAAA,OAAA,GAAA,YAClE,MAAM6P,QAAcgzB,KACpBI,EAAOpzB,aAAA,EAAAA,EAAO3N,MAAMwa,SAASjM,QAAQszB,MAAM,GAC3Cd,EAAOpzB,aAAA,EAAAA,EAAO3L,OAAOhC,MAAMuO,QAAQszB,MAAM,SACnCl0B,aAAK,EAALA,EAAOmG,wBAAwB,OAAQ,CAC3C,CACErS,KAAM,YACNgP,KAAM,oBAGV,MAAM6K,EAAY3N,aAAA,EAAAA,EAAO3N,MAAMggC,QAAQ,wBACjCryB,aAAK,EAALA,EAAOmG,wBAAwB,OAAQ,CAE3C,CACErS,KAAM,OACNgP,KAAM,yBACNzO,OAAQ,CAAEmV,YAAamE,aAAA,EAAAA,EAAW3V,KAEpC,CACElE,KAAM,OACNgP,KAAM,eAGVswB,EAAOpzB,aAAA,EAAAA,EAAO3N,MAAMwa,SAASjM,QAAQszB,MAAM,GAC3Cd,EAAOpzB,eAAAA,EAAO3N,MAAMwa,SAAS,GAAG/J,MAAMoxB,MAAM,kBAC5Cd,EAAOpzB,eAAAA,EAAO3N,MAAMwa,SAAS,GAAG/J,MAAMoxB,MAAM,0BAC5Cd,EAAOpzB,eAAAA,EAAO3N,MAAMwa,SAAS,GAAG/J,MAAMoxB,MAAM,aAC5Cd,EAAOpzB,aAAA,EAAAA,EAAO3L,OAAOhC,MAAMuO,QAAQszB,MAAM,GACzCd,EAAOpzB,eAAAA,EAAO3L,OAAOhC,MAAM,GAAGyQ,MAAMoxB,MAAM,aAC1Cl0B,SAAAA,EAAOwyB,QACR,KAAC,IAGc,CAChB,CAAE1+B,KAAM,SAAU2gC,OAAQ,WAC1B,CAAE3gC,KAAM,UAAW2gC,OAAQ,aAC3B,CAAE3gC,KAAM,QAAS2gC,OAAQ,UAGjBrtB,SAAQ,EAAGtT,OAAM2gC,aACzBvB,EAAS,GAAGuB,OAAY,KACtBtB,EAAG,eAAesB,KAAU,IAAWtkC,OAAA,OAAA,OAAA,GAAA,YACrC,MAAM6P,QAAcgzB,KACpBI,EAAOpzB,aAAA,EAAAA,EAAO3N,MAAMwa,SAASjM,QAAQszB,MAAM,GAC3Cd,EAAOpzB,aAAA,EAAAA,EAAO3L,OAAOogC,GAAQ7zB,QAAQszB,MAAM,SACrCl0B,aAAK,EAALA,EAAOmG,wBAAwB,OAAQ,CAC3C,CAAErS,OAAMgP,KAAM,QAAQhP,OAExBs/B,EAAOpzB,aAAA,EAAAA,EAAO3N,MAAMwa,SAASjM,QAAQszB,MAAM,GAC3Cd,EAAOpzB,eAAAA,EAAO3N,MAAMwa,SAAS,GAAG/J,MAAMoxB,MAAM,QAAQpgC,KAEpD,MAAM2U,EAASzI,aAAA,EAAAA,EAAO3N,MAAMwa,SAAS,GAAG7U,GACxCo7B,EAAOpzB,aAAA,EAAAA,EAAO3L,OAAOogC,GAAQ7zB,QAAQszB,MAAM,GAE3Cd,EAAOpzB,eAAAA,EAAO3L,OAAOogC,GAAQ,GAAGv2B,KAAKg2B,MAAMzrB,GAC3CzI,SAAAA,EAAOwyB,QACR,MAEDW,EAAG,eAAesB,8BAAmC,IAAWtkC,OAAA,OAAA,OAAA,GAAA,YAC9D,GAAe,cAAXskC,EAAwB,OAC5B,MAAMz0B,QAAcgzB,KACpBI,EAAOpzB,aAAA,EAAAA,EAAO3N,MAAMwa,SAASjM,QAAQszB,MAAM,GAC3Cd,EAAOpzB,aAAA,EAAAA,EAAO3L,OAAOogC,GAAQ7zB,QAAQszB,MAAM,SACrCl0B,aAAK,EAALA,EAAOmG,wBAAwB,OAAQ,CAC3C,CACErS,KAAM,YACNgP,KAAM,oBAGV,MAAM6K,EAAY3N,aAAA,EAAAA,EAAO3N,MAAMggC,QAAQ,wBACjCryB,aAAK,EAALA,EAAOmG,wBAAwB,OAAQ,CAE3C,CACErS,OACAgP,KAAM,QAAQhP,iBACdO,OAAQ,CAAEmV,YAAamE,aAAA,EAAAA,EAAW3V,KAEpC,CACElE,OACAgP,KAAM,QAAQhP,OAGlBs/B,EAAOpzB,aAAA,EAAAA,EAAO3N,MAAMwa,SAASjM,QAAQszB,MAAM,GAC3Cd,EAAOpzB,eAAAA,EAAO3N,MAAMwa,SAAS,GAAG/J,MAAMoxB,MAAM,kBAC5Cd,EAAOpzB,eAAAA,EAAO3N,MAAMwa,SAAS,GAAG/J,MAAMoxB,MACpC,QAAQpgC,kBAEVs/B,EAAOpzB,eAAAA,EAAO3N,MAAMwa,SAAS,GAAG/J,MAAMoxB,MAAM,QAAQpgC,KAEpD,MAAM2U,EAASzI,aAAA,EAAAA,EAAO3N,MAAMwa,SAAS,GAAG7U,GACxCo7B,EAAOpzB,aAAA,EAAAA,EAAO3L,OAAOogC,GAAQ7zB,QAAQszB,MAAM,GAE3Cd,EAAOpzB,eAAAA,EAAO3L,OAAOogC,GAAQ,GAAGv2B,KAAKg2B,MAAMzrB,GAC3CzI,SAAAA,EAAOwyB,QACR,KAAC,IAGJlH,GAAM,KACJmH,GAAmBjmB,GAAI,GACvB,IAGJ0mB,EAAS,oBAAoB,KAC3BC,EAAG,wEAAwE,IAAWhjC,OAAA,OAAA,OAAA,GAAA,YACpF,MAAM6P,QAAcgzB,WACdhzB,aAAK,EAALA,EAAOmG,wBAAwB,OAAQ,CAE3C,CACErS,KAAM,UACNgP,KAAM,gBAER,CACEhP,KAAM,SACNgP,KAAM,iBAGVswB,EAAO3/B,OAAO4mB,KAAKra,aAAK,EAALA,EAAO3L,OAAO6oB,gBAAgBtc,QAAQszB,MAAM,GAC/Dd,EAAO3/B,OAAO4mB,KAAKra,aAAA,EAAAA,EAAO3L,OAAO6oB,iBAAiB4W,QAAQ,eAC1DV,EAAOpzB,eAAAA,EAAO3L,OAAO6oB,eAAe8a,YAAYp3B,QAAQszB,MAAM,GAC9Dd,EAAOpzB,eAAAA,EAAO3L,OAAO6oB,eAAe8a,YAAY,GAAGl1B,MAAMoxB,MACvD,eAEFd,EAAOpzB,eAAAA,EAAO3L,OAAO6oB,eAAe8a,YAAY,GAAGl1B,MAAMoxB,MACvD,eAEH,MAEDf,EAAG,mEAAmE,IAAWhjC,OAAA,OAAA,OAAA,GAAA,YAC/E,MAAM6P,QAAcgzB,WACdhzB,aAAK,EAALA,EAAOmG,wBAAwB,OAAQ,CAE3C,CACErS,KAAM,UACNgP,KAAM,qBACNzO,OAAQ,CAAE8oB,QAAS,UAErB,CACErpB,KAAM,SACNgP,KAAM,oBACNzO,OAAQ,CAAE8oB,QAAS,UAErB,CACErpB,KAAM,UACNgP,KAAM,gBAER,CACEhP,KAAM,SACNgP,KAAM,iBAGVswB,EAAO3/B,OAAO4mB,KAAKra,aAAK,EAALA,EAAO3L,OAAO6oB,gBAAgBtc,QAAQszB,MAAM,GAC/Dd,EAAO3/B,OAAO4mB,KAAKra,aAAA,EAAAA,EAAO3L,OAAO6oB,iBAAiB4W,QAAQ,eAC1DV,EAAO3/B,OAAO4mB,KAAKra,aAAA,EAAAA,EAAO3L,OAAO6oB,iBAAiB4W,QAAQ,SAC1DV,EAAOpzB,eAAAA,EAAO3L,OAAO6oB,eAAe8a,YAAYp3B,QAAQszB,MAAM,GAC9Dd,EAAOpzB,eAAAA,EAAO3L,OAAO6oB,eAAe8a,YAAY,GAAGl1B,MAAMoxB,MACvD,gBAEFd,EAAOpzB,eAAAA,EAAO3L,OAAO6oB,eAAe8a,YAAY,GAAGl1B,MAAMoxB,MACvD,eAEFd,EAAOpzB,eAAAA,EAAO3L,OAAO6oB,eAAeziB,MAAMmG,QAAQszB,MAAM,GACxDd,EAAOpzB,eAAAA,EAAO3L,OAAO6oB,eAAeziB,MAAM,GAAGqI,MAAMoxB,MACjD,qBAEFd,EAAOpzB,eAAAA,EAAO3L,OAAO6oB,eAAeziB,MAAM,GAAGqI,MAAMoxB,MACjD,qBAEH,KAAC,IAGJhB,EAAS,YAAY,KACnBC,EAAG,+BAA+B,IAAWhjC,OAAA,OAAA,OAAA,GAAA,YAC3C,MAAM6P,QAAcgzB,KACpBI,EAAOpzB,eAAAA,EAAO3L,OAAOwoB,QAAQ2X,GAAGD,MAChCv0B,SAAAA,EAAOwyB,QACR,MAEDW,EAAG,sDAAsD,IAAWhjC,OAAA,OAAA,OAAA,GAAA,YAClE,MAAM6P,QAAcgzB,KACpBI,EAAOpzB,aAAA,EAAAA,EAAO3N,MAAMwa,SAASjM,QAAQszB,MAAM,SACrCl0B,aAAK,EAALA,EAAOmG,wBAAwB,OAAQ,CAC3C,CACErS,KAAM,SACNgP,KAAM,cACNzO,OAAQ,CAAE+G,MAAM,MAGpBg4B,EAAOpzB,aAAA,EAAAA,EAAO3N,MAAMwa,SAASjM,QAAQszB,MAAM,GAC3Cd,EAAOpzB,eAAAA,EAAO3N,MAAMwa,SAAS,GAAG/J,MAAMoxB,MAAM,eAC5Cd,EAAOpzB,eAAAA,EAAO3L,OAAOwoB,QAAQ2X,GAAGD,MAChCv0B,SAAAA,EAAOwyB,QACR,MAEDW,EAAG,4CAA4C,IAAWhjC,OAAA,OAAA,OAAA,GAAA,YACxD,MAAM6P,QAAcgzB,KACpBI,EAAOpzB,aAAA,EAAAA,EAAO3N,MAAMwa,SAASjM,QAAQszB,MAAM,SACrCl0B,aAAK,EAALA,EAAOmG,wBAAwB,OAAQ,CAC3C,CACErS,KAAM,SACNgP,KAAM,cACNzO,OAAQ,CAAE+G,MAAM,MAGpBg4B,EAAOpzB,aAAA,EAAAA,EAAO3N,MAAMwa,SAASjM,QAAQszB,MAAM,GAC3Cd,EAAOpzB,eAAAA,EAAO3N,MAAMwa,SAAS,GAAG/J,MAAMoxB,MAAM,eAC5Cd,EAAOpzB,eAAAA,EAAO3L,OAAOwoB,QAAQ2X,GAAGF,KAChCt0B,SAAAA,EAAOwyB,QACR,MAEDlH,GAAM,KACJmH,GAAmBjmB,GAAI,GACvB,IAGJ0mB,EAAS,UAAU,KACjBG,GAAO,IAAWljC,OAAA,OAAA,OAAA,GAAA,kBACV4H,KAAKI,SAASpG,IAAIgG,KAAK1D,OAAO2D,GAAI,aAAc,aAGvD,MAEDm7B,EAAG,wBAAwB,KACzBC,EAAOE,EAAUnrB,WAAWvX,OAAOsjC,MAAM,GACzCd,EAAOE,EAAUnrB,WAAWuM,KAAKwf,MAAM,GACvCd,EAAOE,EAAU56B,OAAOG,IAAI8Z,MAAMuhB,MAAM,GACxCd,EAAOE,EAAU3gB,MAAMuhB,MAAM,EAAE,IAGjCf,EAAG,+CAA+C,IAAWhjC,OAAA,OAAA,OAAA,GAAA,YAC3DmjC,EAAUnrB,WAAWvX,MAAQ,GAC7BwiC,EAAOE,EAAU3gB,MAAMuhB,MAAM,IAC7BZ,EAAUnrB,WAAWvX,MAAQ,EAC7BwiC,EAAOE,EAAUnrB,WAAWvX,OAAOsjC,MAAM,EAC1C,MAEDf,EAAG,6CAA6C,IAAWhjC,OAAA,OAAA,OAAA,GAAA,YACzDmjC,EAAUnrB,WAAWuM,IAAM,GAC3B0e,EAAOE,EAAU3gB,MAAMuhB,MAAM,IAC7BZ,EAAUnrB,WAAWuM,IAAM,EAC3B0e,EAAOE,EAAUnrB,WAAWuM,KAAKwf,MAAM,EACxC,MAEDf,EAAG,2CAA2C,IAAWhjC,OAAA,OAAA,OAAA,GAAA,YACvDmjC,EAAU56B,OAAOG,IAAM,CAAE8Z,KAAM,GAC/BygB,EAAOE,EAAU3gB,MAAMuhB,MAAM,GAC7BZ,EAAU56B,OAAOG,IAAI8Z,KAAO,EAC5BygB,EAAOE,EAAU56B,OAAOG,IAAI8Z,MAAMuhB,MAAM,EACzC,KAAC,GACF,EC1gBG,MAAM1nB,GAAM,mBACN5Y,GAAU,CACrBm/B,YAAa,qBACbkF,aAAa,GAGTjF,GAAyBl/B,GAAgB3D,OAAA,OAAA,OAAA,GAAA,YAC7C,OAAA8xB,GAASpjB,OAAO,CACdiE,KAAM,cAAc0J,KACpB1Y,YAGJ,IAAAokC,GAAe,EACbhF,WACAC,KACAC,SACA9H,QACAyM,YACA1E,SACA8E,aAEAJ,GAAU,IAAW5nC,OAAA,OAAA,OAAA,GAAA,kBACb8gC,KACNwB,GAAmBjmB,IACnBkmB,IACD,MAEDQ,EAAS,yBAAyB,KAEhCC,EAAG,aAAa,IAAWhjC,OAAA,OAAA,OAAA,GAAA,YACzB,MAAM6P,QAAcgzB,GAAgB,aACpCI,EAAOpzB,aAAA,EAAAA,EAAO3L,OAAOwL,GAAGjP,OAAOsjC,MAAM,IACrCd,EAAOpzB,aAAA,EAAAA,EAAO3L,OAAO8L,IAAIvP,OAAOsjC,MAAM,SAChCl0B,eAAAA,EAAO3L,OAAOiS,OAAO,CAAEzG,GAAI,CAAEjP,MAAO,YACpCygC,KACN+B,EAAOpzB,aAAA,EAAAA,EAAO3L,OAAOwL,GAAGjP,OAAOsjC,MAAM,IACrCd,EAAOpzB,eAAAA,EAAO3L,OAAO8L,IAAIvP,OAAOsjC,MAAM,EACvC,MAEDf,EAAG,aAAa,IAAWhjC,OAAA,OAAA,OAAA,GAAA,YACzB,MAAM6P,QAAcgzB,GAAgB,aACpCI,EAAOpzB,aAAA,EAAAA,EAAO3L,OAAOwL,GAAGjP,OAAOsjC,MAAM,IACrCd,EAAOpzB,aAAA,EAAAA,EAAO3L,OAAO8L,IAAIvP,OAAOsjC,MAAM,SAChCl0B,eAAAA,EAAO3L,OAAOiS,OAAO,CAAEnG,IAAK,CAAEvP,MAAO,YACrCygC,KACN+B,EAAOpzB,aAAA,EAAAA,EAAO3L,OAAO8L,IAAIvP,OAAOsjC,MAAM,IACtCd,EAAOpzB,eAAAA,EAAO3L,OAAOwL,GAAGjP,OAAOsjC,MAAM,EACtC,MAEDf,EAAG,gBAAgB,IAAWhjC,OAAA,OAAA,OAAA,GAAA,YAC5B,MAAM6P,QAAcgzB,GAAgB,aACpCI,EAAOpzB,aAAA,EAAAA,EAAO3L,OAAOuL,MAAMhP,OAAOsjC,MAAM,IACxCd,EAAOpzB,aAAA,EAAAA,EAAO3L,OAAOuL,MAAMhP,OAAOsjC,MAAM,SAClCl0B,eAAAA,EAAO3L,OAAOiS,OAAO,CAAE1G,MAAO,CAAEhP,MAAO,YACvCygC,KACN+B,EAAOpzB,aAAA,EAAAA,EAAO3L,OAAOuL,MAAMhP,OAAOsjC,MAAM,IACxCd,EAAOpzB,eAAAA,EAAO3L,OAAOuL,MAAMhP,OAAOsjC,MAAM,EACzC,MAEDf,EAAG,gBAAgB,IAAWhjC,OAAA,OAAA,OAAA,GAAA,YAC5B,MAAM6P,QAAcgzB,GAAgB,aACpCI,EAAOpzB,aAAA,EAAAA,EAAO3L,OAAOuL,MAAMhP,OAAOsjC,MAAM,IACxCd,EAAOpzB,aAAA,EAAAA,EAAO3L,OAAOuL,MAAMhP,OAAOsjC,MAAM,SAClCl0B,eAAAA,EAAO3L,OAAOiS,OAAO,CAAE1G,MAAO,CAAEgd,IAAK,YACrCyU,KACN+B,EAAOpzB,aAAA,EAAAA,EAAO3L,OAAOuL,MAAMhP,OAAOsjC,MAAM,IACxCd,EAAOpzB,eAAAA,EAAO3L,OAAOuL,MAAMhP,OAAOsjC,MAAM,EACzC,KAAC,IAGJhB,EAAS,wDAAwD,KAC/D5H,GAAM,IAAWn7B,OAAA,OAAA,OAAA,GAAA,kBACL,QAAVulB,EAAA3d,KAAK1F,aAAK,IAAAqjB,GAAAA,EACNhV,QAAQ9K,UAAM,OAAO,UAAPA,aAAA,EAAAA,EAAGkN,YAAI,IAAA4S,OAAA,EAAAA,EAAEgE,QAAQ,QAAQlN,QAAU,CAAC,IACnDpF,SAASxR,GAAMA,EAAE48B,UACrB,MACDM,GAAU1rB,SAAS8W,IACjBiV,EAAG,WAAWjV,EAASjP,0CAA0C,IAAW9e,OAAA,OAAA,OAAA,GAAA,YAC1E,MAAM6P,QAAcgzB,GAAgB,aAC9BjsB,QAAcsW,GAAQxe,OAAO,CACjCiE,KAAM,QAAQ0J,MAAO0R,EAASjP,eAC9Bnb,KAAMoqB,UAEFle,aAAK,EAALA,EAAOmG,wBAAwB,OAAQ,CAACY,IAC9C,MAAMqxB,EAAYp4B,aAAA,EAAAA,EAAO3N,MAAMggC,QAAQtrB,aAAI,EAAJA,EAAMjE,MAC7CswB,EAAOgF,aAAA,EAAAA,EAAWnyB,KAAKiuB,MAAM7W,GAAQC,aAAaY,IAClDnX,SAAAA,EAAMyrB,QACP,KAAC,GACF,IAGJU,EAAS,iCAAiC,KACxC6E,GAAU,IAAW5nC,OAAA,OAAA,OAAA,GAAA,kBACb8gC,IACP,MAEDkC,EAAG,yCAAyC,IAAWhjC,OAAA,OAAA,OAAA,GAAA,oBACrD,MAAM6P,QAAegzB,GAAgB,aACrCI,EAAOpzB,eAAAA,EAAO3L,OAAOqL,QAAQsjB,GAAGpyB,OAAOsjC,MAAM,GAC7Cd,EAAoB,QAAb1d,EAAA3d,KAAK+oB,gBAAQ,IAAApL,OAAA,EAAAA,EAAEuO,MAAMiQ,MAAM,SAC5Bl0B,aAAA,EAAAA,EAAO4iB,cAAc,IAC3BwQ,EAAOpzB,eAAAA,EAAO3L,OAAOqL,QAAQsjB,GAAGpyB,OAAOsjC,MAAM,UACvC7C,KACN+B,EAAoB,QAAblZ,EAAAniB,KAAK+oB,gBAAQ,IAAA5G,OAAA,EAAAA,EAAE+J,MAAMiQ,MAAM,SAC5Bl0B,aAAK,EAALA,EAAOwyB,QACd,MAEDW,EAAG,gDAAgD,IAAWhjC,OAAA,OAAA,OAAA,GAAA,oBAC5D,MAAM6P,QAAegzB,GAAgB,aACrCI,EAAOpzB,eAAAA,EAAO3L,OAAOqL,QAAQsjB,GAAGpyB,OAAOsjC,MAAM,GAC7Cd,EAAoB,QAAb3L,EAAA1vB,KAAK+oB,gBAAQ,IAAA2G,OAAA,EAAAA,EAAExD,MAAMiQ,MAAM,SAC5Bl0B,aAAA,EAAAA,EAAO4iB,eAAe,IAC5BwQ,EAAOpzB,eAAAA,EAAO3L,OAAOqL,QAAQsjB,GAAGpyB,OAAOsjC,OAAO,UACxC7C,KACN+B,EAAoB,QAAbpL,EAAAjwB,KAAK+oB,gBAAQ,IAAAkH,OAAA,EAAAA,EAAE/D,MAAMiQ,MAAM,SAC5Bl0B,aAAK,EAALA,EAAOwyB,QACd,MAEDW,EAAG,2DAA2D,IAAWhjC,OAAA,OAAA,OAAA,GAAA,oBACvE,MAAM6P,QAAegzB,GAAgB,mBAC/BhzB,aAAA,EAAAA,EAAOsG,OAAO,CAAEjS,OAAQ,CAAEqL,QAAS,CAAEsjB,GAAI,CAAE1lB,MAAO,QACxD81B,EAAOpzB,eAAAA,EAAO3L,OAAOqL,QAAQsjB,GAAGpyB,OAAOsjC,MAAM,GAC7Cd,EAAoB,QAAbT,EAAA56B,KAAK+oB,gBAAQ,IAAA6R,OAAA,EAAAA,EAAE1O,MAAMiQ,MAAM,SAC5Bl0B,aAAA,EAAAA,EAAO4iB,cAAc,IAC3BwQ,EAAOpzB,eAAAA,EAAO3L,OAAOqL,QAAQsjB,GAAGpyB,OAAOsjC,MAAM,UACvC7C,KACN+B,EAAoB,QAAbP,EAAA96B,KAAK+oB,gBAAQ,IAAA+R,OAAA,EAAAA,EAAE5O,MAAMiQ,MAAM,SAC5Bl0B,aAAK,EAALA,EAAOwyB,QACd,KAAC,IAGJU,EAAS,WAAW,KAClBC,EAAG,aAAa,IAAWhjC,OAAA,OAAA,OAAA,GAAA,YACzB,MAAM6P,QAAegzB,GAAgB,aACrCI,EAAOpzB,eAAAA,EAAOoI,SAAS8rB,OAAM,SACvBl0B,aAAK,EAALA,EAAOwyB,QACd,MAEDW,EAAG,WAAW,IAAWhjC,OAAA,OAAA,OAAA,GAAA,YACvB,MAAM6P,QAAegzB,GAAgB,WACrCI,EAAOpzB,eAAAA,EAAOoI,SAAS8rB,OAAM,SACvBl0B,aAAK,EAALA,EAAOwyB,QACd,KAAC,IAGJU,EAAS,oBAAoB,IAAW/iC,OAAA,OAAA,OAAA,GAAA,YACtC,MAAMmsB,EAAQ,CACZ,CACE+b,KAAM,GACNC,KAAM,EACN1+B,MAAO,GACP2+B,MAAO,GACPz+B,UAAW,GACXC,OAAQ,GACRC,MAAO,IAET,CACEq+B,IAAK,EACLC,KAAM,EACN1+B,MAAO,GACP2+B,MAAO,GACPz+B,UAAW,GACXC,OAAQ,GACRC,MAAO,IAET,CACEq+B,IAAK,EACLC,KAAM,EACN1+B,MAAO,GACP2+B,MAAO,GACPz+B,UAAW,GACXC,OAAQ,GACRC,MAAO,IAET,CACEq+B,IAAK,EACLC,KAAM,EACN1+B,MAAO,EACP2+B,MAAO,EACPz+B,UAAW,GACXC,OAAQ,GACRC,MAAO,IAET,CACEq+B,IAAK,GACLC,KAAM,GACN1+B,MAAO,EACP2+B,MAAO,EACPz+B,UAAW,EACXC,OAAQ,EACRC,MAAO,IAET,CACEq+B,IAAK,GACLC,KAAM,GACN1+B,MAAO,EACP2+B,MAAO,EACPz+B,UAAW,EACXC,OAAQ,EACRC,MAAO,IAET,CACEq+B,IAAK,GACLC,KAAM,GACN1+B,MAAO,EACP2+B,MAAO,EACPz+B,UAAW,EACXC,OAAQ,EACRC,MAAO,GAET,CACEq+B,IAAK,GACLC,KAAM,GACN1+B,MAAO,EACP2+B,MAAO,EACPz+B,UAAW,EACXC,OAAQ,EACRC,MAAO,GAET,CACEq+B,IAAK,GACLC,KAAM,GACN1+B,MAAO,EACP2+B,MAAO,EACPz+B,UAAW,EACXC,OAAQ,EACRC,MAAO,GAET,CACEq+B,IAAK,GACLC,KAAM,GACN1+B,MAAO,EACP2+B,MAAO,EACPz+B,UAAW,EACXC,OAAQ,EACRC,MAAO,IAIL4F,EAAQ,CACZ,CAAEy4B,KAAM,IAAKC,KAAM,EAAG1nC,MAAO,IAC7B,CAAEynC,IAAK,EAAGC,KAAM,EAAG1nC,MAAO,IAC1B,CAAEynC,IAAK,EAAGC,KAAM,EAAG1nC,MAAO,IAC1B,CAAEynC,IAAK,EAAGC,KAAM,EAAG1nC,MAAO,IAC1B,CAAEynC,IAAK,EAAGC,KAAM,EAAG1nC,MAAO,IAC1B,CAAEynC,IAAK,EAAGC,KAAM,EAAG1nC,MAAO,IAC1B,CAAEynC,IAAK,EAAGC,KAAM,EAAG1nC,MAAO,IAC1B,CAAEynC,IAAK,EAAGC,KAAM,EAAG1nC,MAAO,IAC1B,CAAEynC,IAAK,EAAGC,KAAM,EAAG1nC,MAAO,IAC1B,CAAEynC,IAAK,EAAGC,KAAM,GAAI1nC,MAAO,IAC3B,CAAEynC,IAAK,GAAIC,KAAM,GAAI1nC,MAAO,GAC5B,CAAEynC,IAAK,GAAIC,KAAM,GAAI1nC,MAAO,GAC5B,CAAEynC,IAAK,GAAIC,KAAM,GAAI1nC,MAAO,GAC5B,CAAEynC,IAAK,GAAIC,KAAM,GAAI1nC,MAAO,GAC5B,CAAEynC,IAAK,GAAIC,KAAM,GAAI1nC,MAAO,GAC5B,CAAEynC,IAAK,GAAIC,KAAM,IAAK1nC,MAAO,IAGzB0lC,EAAcjoB,MAAMkoB,KAAK,CAAE31B,OAAQ,KAAM,CAAC41B,EAAKlc,IAAQA,EAAM,IAE7Dta,QAAegzB,GAAgB,WAErCsD,EAAYlvB,SAASgV,IACnB,MAAMoc,EAAYlc,EAAMhY,MAAMhI,GAAM8f,GAAM9f,EAAE+7B,KAAOjc,GAAM9f,EAAEg8B,OACrDG,EAAY74B,EAAM0E,MAAMhI,GAAM8f,GAAM9f,EAAE+7B,KAAOjc,GAAM9f,EAAEg8B,OACrDI,EAAgB94B,EAAM0E,MACzBhI,GAAM8f,EAAK,GAAK9f,EAAE+7B,KAAOjc,EAAK,GAAK9f,EAAEg8B,OAExCt4B,SAAAA,EAAOijB,aAAa,GAAG7G,KAEvB+W,EAAG,MAAM/W,6BAA8B,KACrCgX,EAAOpzB,aAAK,EAALA,EAAO3L,OAAOioB,MAAM1iB,MAAMhJ,OAAOsjC,MAAMsE,aAAS,EAATA,EAAW5+B,OACzDw5B,EAAOpzB,aAAK,EAALA,EAAO3L,OAAOioB,MAAMziB,KAAKjJ,OAAOsjC,MAAMsE,aAAS,EAATA,EAAWD,OACxDnF,EAAOpzB,aAAK,EAALA,EAAO3L,OAAOioB,MAAMxiB,UAAUlJ,OAAOsjC,MAAMsE,aAAS,EAATA,EAAW1+B,WAC7Ds5B,EAAOpzB,aAAK,EAALA,EAAO3L,OAAOioB,MAAMviB,OAAOnJ,OAAOsjC,MAAMsE,aAAS,EAATA,EAAWz+B,QAC1Dq5B,EAAOpzB,aAAK,EAALA,EAAO3L,OAAOioB,MAAMtiB,MAAMpJ,OAAOsjC,MAAMsE,aAAS,EAATA,EAAWx+B,MAAM,IAGjEm5B,EAAG,MAAM/W,6BAA8B,KACrCgX,EAAOpzB,aAAK,EAALA,EAAO3L,OAAOuL,MAAMhP,OAAOsjC,MAAMuE,eAAAA,EAAW7nC,OACnDwiC,EAAOpzB,aAAK,EAALA,EAAO3L,OAAOuL,MAAMgd,KAAKsX,MAAM,IAAKuE,aAAA,EAAAA,EAAW7nC,OAAM,IAG9DoP,SAAAA,EAAOijB,aAAa,GAAG7G,MACvB+W,EAAG,MAAM/W,8BAA+B,KACtCgX,EAAOpzB,aAAK,EAALA,EAAO3L,OAAOuL,MAAMhP,OAAOsjC,MAAMwE,eAAAA,EAAe9nC,OACvDwiC,EAAOpzB,aAAK,EAALA,EAAO3L,OAAOuL,MAAMgd,KAAKsX,MAAM,IAAKwE,aAAA,EAAAA,EAAe9nC,OAAM,GAChE,UAGEoP,aAAK,EAALA,EAAOwyB,QACd,MAEDU,EAAS,mBAAmB,IAAW/iC,OAAA,OAAA,OAAA,GAAA,YACrC,MAAM6P,QAAegzB,GAAgB,WAC/B2F,EAAiBtqB,MAAMkoB,KAAK,CAAE31B,OAAQ,KAAM,CAAC41B,EAAKlc,IAAQA,EAAM,IAChEse,EAAiB,EACpB,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,GAE7DC,EAAW,CAAC,EAAG,EAAG,EAAG,GAAI,GAAI,IACnCF,EAAevxB,SAAQ,CAACrO,EAAKuhB,KAC3Bue,EAASzxB,SAASgV,IAChB+W,EAAG,GAAG/W,aAAcrjB,4BAA8B,IAAW5I,OAAA,OAAA,OAAA,GAAA,kBACrD6P,eAAAA,EAAOsG,OAAO,CAClBjS,OAAQ,CAAE8nB,GAAI,CAAEC,GAAI,KAAKA,KAAQ1jB,OAAQ,CAAEK,IAAK,CAAEnI,MAAOmI,aAErDiH,aAAK,EAALA,EAAOulB,SACb4S,GAAOn4B,aAAA,EAAAA,EAAO3L,OAAO8nB,GAAGhqB,KAAMymC,EAAete,IAAQ,GACrD6d,GAAOn4B,aAAA,EAAAA,EAAO3L,OAAO8nB,GAAGvrB,OAAQgoC,EAAete,IAAQ,GACvD6d,GAAOn4B,aAAA,EAAAA,EAAO3L,OAAO8nB,GAAGhqB,KAAMymC,EAAete,IAAQ8B,GACrD+b,GAAOn4B,aAAA,EAAAA,EAAO3L,OAAO8nB,GAAGvrB,OAAQgoC,EAAete,IAAQ8B,EACxD,KAAC,GACF,UAEEpc,aAAK,EAALA,EAAOwyB,QACd,MAEDU,EAAS,2BAA2B,KAClC6E,GAAU,IAAW5nC,OAAA,OAAA,OAAA,GAAA,kBACb8gC,IACP,MAEa,CAAC,QAAS,OAAQ,YAAa,SAAU,SACjD7pB,SAASqD,IACb0oB,EAAG,qBAAqB1oB,wBAA2B,IAAWta,OAAA,OAAA,OAAA,GAAA,oBAC5D,MAAM6P,QAAegzB,GAAgB,aACrCI,EAAoB,QAAb1d,EAAA3d,KAAK+oB,gBAAQ,IAAApL,OAAA,EAAAA,EAAEuO,MAAMiQ,MAAM,SAC5Bl0B,aAAA,EAAAA,EAAO0K,SAASD,EAAM,CAAE6Y,aAAa,UACrC+N,KACN+B,EAAoB,QAAblZ,EAAAniB,KAAK+oB,gBAAQ,IAAA5G,OAAA,EAAAA,EAAE+J,MAAMiQ,MAAM,SAC5Bl0B,aAAK,EAALA,EAAOwyB,QACd,MAEDW,EAAG,qBAAqB1oB,sBAAyB,IAAWta,OAAA,OAAA,OAAA,GAAA,oBAC1D,MAAM6P,QAAegzB,GAAgB,WACrCI,EAAoB,QAAb3L,EAAA1vB,KAAK+oB,gBAAQ,IAAA2G,OAAA,EAAAA,EAAExD,MAAMiQ,MAAM,SAC5Bl0B,EAAM0K,SAASD,EAAM,CAAE6Y,aAAa,UACpC+N,KACN+B,EAAoB,QAAbpL,EAAAjwB,KAAK+oB,gBAAQ,IAAAkH,OAAA,EAAAA,EAAE/D,MAAMiQ,MAAM,SAC5Bl0B,aAAK,EAALA,EAAOwyB,QACd,KAAC,GACF,IAGJU,EAAS,uBAAuB,KAC9B6E,GAAU,IAAW5nC,OAAA,OAAA,OAAA,GAAA,kBACb8gC,IACP,MAEDkC,EAAG,iBAAiB,IAAWhjC,OAAA,OAAA,OAAA,GAAA,oBAC7B,MAAM6P,QAAegzB,GAAgB,aACrCI,EAAoB,QAAb1d,EAAA3d,KAAK+oB,gBAAQ,IAAApL,OAAA,EAAAA,EAAEuO,MAAMiQ,MAAM,SAC5Bl0B,EAAMujB,mBACN8N,KACN+B,EAAoB,QAAblZ,EAAAniB,KAAK+oB,gBAAQ,IAAA5G,OAAA,EAAAA,EAAE+J,MAAMiQ,MAAM,SAC5Bl0B,aAAK,EAALA,EAAOwyB,QACd,MAEDW,EAAG,eAAe,IAAWhjC,OAAA,OAAA,OAAA,GAAA,oBAC3B,MAAM6P,QAAegzB,GAAgB,WACrCI,EAAoB,QAAb3L,EAAA1vB,KAAK+oB,gBAAQ,IAAA2G,OAAA,EAAAA,EAAExD,MAAMiQ,MAAM,SAC5Bl0B,EAAMujB,mBACN8N,KACN+B,EAAoB,QAAbpL,EAAAjwB,KAAK+oB,gBAAQ,IAAAkH,OAAA,EAAAA,EAAE/D,MAAMiQ,MAAM,SAC5Bl0B,aAAK,EAALA,EAAOwyB,QACd,KAAC,IAGJU,EAAS,wBAAwB,KAC/B6E,GAAU,IAAW5nC,OAAA,OAAA,OAAA,GAAA,kBACb8gC,IACP,MAEDkC,EAAG,iBAAiB,IAAWhjC,OAAA,OAAA,OAAA,GAAA,oBAC7B,MAAM6P,QAAegzB,GAAgB,aACrCI,EAAoB,QAAb1d,EAAA3d,KAAK+oB,gBAAQ,IAAApL,OAAA,EAAAA,EAAEuO,MAAMiQ,MAAM,SAC5Bl0B,EAAMgU,oBACNqd,KACN+B,EAAoB,QAAblZ,EAAAniB,KAAK+oB,gBAAQ,IAAA5G,OAAA,EAAAA,EAAE+J,MAAMiQ,MAAM,SAC5Bl0B,aAAK,EAALA,EAAOwyB,QACd,MAEDW,EAAG,eAAe,IAAWhjC,OAAA,OAAA,OAAA,GAAA,oBAC3B,MAAM6P,QAAegzB,GAAgB,WACrCI,EAAoB,QAAb3L,EAAA1vB,KAAK+oB,gBAAQ,IAAA2G,OAAA,EAAAA,EAAExD,MAAMiQ,MAAM,SAC5Bl0B,EAAMgU,oBACNqd,KACN+B,EAAoB,QAAbpL,EAAAjwB,KAAK+oB,gBAAQ,IAAAkH,OAAA,EAAAA,EAAE/D,MAAMiQ,MAAM,SAC5Bl0B,aAAK,EAALA,EAAOwyB,QACd,KAAC,IAGJU,EAAS,yBAAyB,KAChC6E,GAAU,IAAW5nC,OAAA,OAAA,OAAA,GAAA,kBACb8gC,IACP,MAEDkC,EAAG,iBAAiB,IAAWhjC,OAAA,OAAA,OAAA,GAAA,oBAC7B,MAAM6P,QAAegzB,GAAgB,aACrCI,EAAoB,QAAb1d,EAAA3d,KAAK+oB,gBAAQ,IAAApL,OAAA,EAAAA,EAAEuO,MAAMiQ,MAAM,SAC5Bl0B,EAAMyjB,aAAa,CAAEH,aAAa,UAClC+N,KACN+B,EAAoB,QAAblZ,EAAAniB,KAAK+oB,gBAAQ,IAAA5G,OAAA,EAAAA,EAAE+J,MAAMiQ,MAAM,SAC5Bl0B,EAAMwyB,QACb,MAEDW,EAAG,eAAe,IAAWhjC,OAAA,OAAA,OAAA,GAAA,oBAC3B,MAAM6P,QAAegzB,GAAgB,WACrCI,EAAoB,QAAb3L,EAAA1vB,KAAK+oB,gBAAQ,IAAA2G,OAAA,EAAAA,EAAExD,MAAMiQ,MAAM,SAC5Bl0B,EAAMyjB,aAAa,CAAEH,aAAa,UAClC+N,KACN+B,EAAoB,QAAbpL,EAAAjwB,KAAK+oB,gBAAQ,IAAAkH,OAAA,EAAAA,EAAE/D,MAAMiQ,MAAM,SAC5Bl0B,EAAMwyB,QACb,KAAC,IAGJU,EAAS,6BAA6B,KAGpC6E,GAAU,IAAW5nC,OAAA,OAAA,OAAA,GAAA,kBACb8gC,IACP,MAJc,CAAC,MAAO,MAAO,MAAO,MAAO,MAAO,OAM5C7pB,SAASzC,IACdwuB,EAAG,GAAGxuB,mBAAuB,IAAWxU,OAAA,OAAA,OAAA,GAAA,oBACtC,MAAM6P,QAAegzB,GAAgB,aACrCI,EAAoB,QAAb1d,EAAA3d,KAAK+oB,gBAAQ,IAAApL,OAAA,EAAAA,EAAEuO,MAAMiQ,MAAM,SAC5Bl0B,EAAM+T,UAAUpP,EAAO,CAAE2e,aAAa,UACtC+N,KACN+B,EAAoB,QAAblZ,EAAAniB,KAAK+oB,gBAAQ,IAAA5G,OAAA,EAAAA,EAAE+J,MAAMiQ,MAAM,SAC5Bl0B,EAAMwyB,QACb,MAEDW,EAAG,GAAGxuB,mBAAuB,IAAWxU,OAAA,OAAA,OAAA,GAAA,oBACtC,MAAM6P,QAAegzB,GAAgB,WACrCI,EAAoB,QAAb3L,EAAA1vB,KAAK+oB,gBAAQ,IAAA2G,OAAA,EAAAA,EAAExD,MAAMiQ,MAAM,SAC5Bl0B,EAAM+T,UAAUpP,EAAO,CAAE2e,aAAa,UACtC+N,KACN+B,EAAoB,QAAbpL,EAAAjwB,KAAK+oB,gBAAQ,IAAAkH,OAAA,EAAAA,EAAE/D,MAAMiQ,MAAM,SAC5Bl0B,EAAMwyB,QACb,KAAC,GACF,IAGJU,EAAS,wBAAwB,KAC/B,MAAMyF,EAAiBtqB,MAAMkoB,KAAK,CAAE31B,OAAQ,KAAM,CAAC41B,EAAKlc,IAAQA,EAAM,IAChEse,EAAiB,EACpB,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,GAE7DE,EAAczqB,MAAMkoB,KAAK,CAAE31B,OAAQ,IAAK,CAAC41B,EAAKlc,IAAQA,EAAM,IAElEqe,EAAevxB,SAAQ,CAACrO,EAAKuhB,KAC3B,MAAMye,EAASH,EAAete,GACxB0e,EAAgBD,GAAU,EAAI,EAAI,EAClCE,EAAUF,EAAS,EAAI,IAAM,IAC7BG,EAA0B,MAAZD,GAA4B,EAAVF,EAAcA,EACpDD,EAAY1xB,SAASuc,IACnBwP,EAAG,kDAAkDxP,aAAiB5qB,KAAO,IAAW5I,OAAA,OAAA,OAAA,GAAA,YACtF,MAAM6P,QAAegzB,GAAgB,mBAC/BhzB,eAAAA,EAAOsG,OAAO,CAClBjS,OAAQ,CAAEqL,QAAS,CAAEikB,SAASjrB,OAAQ,CAAEK,IAAK,CAAEnI,MAAOmI,OAExD,MAAMyE,QAAawC,EAAMwQ,cAEzB4iB,EAAO51B,EAAK8B,MAAMsB,QAAQszB,MAAM8E,GAChC5F,EAAO51B,EAAK8B,MAAM,GAAG65B,YAAYjF,MAAMl0B,aAAK,EAALA,EAAO3L,OAAO8nB,GAAGC,IACpD2c,EAAS,GACX3F,EAAO51B,EAAK8B,MAAM05B,EAAgB,GAAGI,UAAUlF,MAAM,KAEvDd,EAAO51B,EAAK8B,MAAM05B,EAAgB,GAAGI,UAAUlF,MAAM+E,GACrD7F,EAAO51B,EAAK8B,MAAM05B,EAAgB,GAAGG,YAAYjF,MAC/CgF,EAAYG,YAEdjG,EAAO51B,EAAK8B,MAAM05B,EAAgB,GAAGI,UAAUlF,MAAM,KACrDd,EAAO51B,EAAK8B,MAAM05B,EAAgB,GAAGG,YAAYjF,MAC/CvQ,EAAM0V,YAERjG,EAAOpzB,eAAAA,EAAO3L,OAAOqE,OAAOK,IAAI2b,KAAKwf,MAAM6E,SACrC/4B,aAAK,EAALA,EAAOwyB,QACd,KAAC,GACF,GACF,IAGJU,EAAS,0BAA0B,KACjC6E,GAAU,IAAW5nC,OAAA,OAAA,OAAA,GAAA,kBACb8gC,IACP,MAEDkC,EAAG,iBAAiB,IAAWhjC,OAAA,OAAA,OAAA,GAAA,oBAC7B,MAAM6P,QAAegzB,GAAgB,aACrCI,EAAoB,QAAb1d,EAAA3d,KAAK+oB,gBAAQ,IAAApL,OAAA,EAAAA,EAAEuO,MAAMiQ,MAAM,SAC5Bl0B,EAAM4jB,sBACNyN,KACN+B,EAAoB,QAAblZ,EAAAniB,KAAK+oB,gBAAQ,IAAA5G,OAAA,EAAAA,EAAE+J,MAAMiQ,MAAM,SAC5Bl0B,EAAMwyB,QACb,MAEDU,EAAS,eAAe,KACtBC,EAAG,iBAAiB,IAAWhjC,OAAA,OAAA,OAAA,GAAA,sBAC7B,MAAM6P,QAAegzB,GAAgB,WACrCI,EAAoB,QAAb1d,EAAA3d,KAAK+oB,gBAAQ,IAAApL,OAAA,EAAAA,EAAEuO,MAAMiQ,MAAM,SAC5Bl0B,EAAM4jB,cAAc,CAAEC,MAAO,qBAC7BwN,KACN+B,EAAoB,QAAblZ,EAAAniB,KAAK+oB,gBAAQ,IAAA5G,OAAA,EAAAA,EAAE+J,MAAMiQ,MAAM,GAClCd,EAAoB,QAAb3L,EAAA1vB,KAAK+oB,gBAAQ,IAAA2G,OAAA,EAAAA,EAAE5a,SAAS,GAAGpO,SAASq1B,QACzC/7B,KAAKuI,KAAKC,OAAO,qBAAsB,CAAEzM,KAAM,eAE3CkM,EAAMwyB,QACb,MAEDW,EAAG,YAAY,IAAWhjC,OAAA,OAAA,OAAA,GAAA,sBACxB,MAAM6P,QAAegzB,GAAgB,WACrCI,EAAoB,QAAbpL,EAAAjwB,KAAK+oB,gBAAQ,IAAAkH,OAAA,EAAAA,EAAE/D,MAAMiQ,MAAM,SAC5Bl0B,EAAM4jB,cAAc,CAAEC,MAAO,gBAC7BwN,KACN+B,EAAoB,QAAbT,EAAA56B,KAAK+oB,gBAAQ,IAAA6R,OAAA,EAAAA,EAAE1O,MAAMiQ,MAAM,GAClCd,EAAoB,QAAbP,EAAA96B,KAAK+oB,gBAAQ,IAAA+R,OAAA,EAAAA,EAAEhmB,SAAS,GAAGpO,SAASq1B,QACzC/7B,KAAKuI,KAAKC,OAAO,qBAAsB,CAAEzM,KAAM,eAE3CkM,EAAMwyB,QACb,KAAC,GACF,IAGJU,EAAS,kCAAkC,KACzC6E,GAAU,IAAW5nC,OAAA,OAAA,OAAA,GAAA,kBACb8gC,IACP,MAE0B,CAAC,KAAM,KAAM,KAAM,MAC3B7pB,SAAS6M,IAC1Bkf,EAAG,iBAAiB,IAAWhjC,OAAA,OAAA,OAAA,GAAA,oBAC7B,MAAM6P,QAAegzB,GAAgB,aACrCI,EAAoB,QAAb1d,EAAA3d,KAAK+oB,gBAAQ,IAAApL,OAAA,EAAAA,EAAEuO,MAAMiQ,MAAM,SAC5Bl0B,EAAMmU,gBAAgBF,EAAM,CAAEqP,aAAa,UAC3C+N,KACN+B,EAAsB,UAAfr7B,KAAK+oB,gBAAU,IAAA5G,OAAA,EAAAA,EAAArN,SAAS,GAAGpO,SAASq1B,QACzC/7B,KAAKuI,KAAKC,OAAO,uBAAwB,CACvC2T,YAAanc,KAAKuI,KAAKuB,SAAS,mBAAmBoS,mBAGjDjU,EAAMwyB,QACb,KAAC,IAGJW,EAAG,eAAe,IAAWhjC,OAAA,OAAA,OAAA,GAAA,oBAC3B,MAAM6P,QAAegzB,GAAgB,WACrCI,EAAoB,QAAb1d,EAAA3d,KAAK+oB,gBAAQ,IAAApL,OAAA,EAAAA,EAAEuO,MAAMiQ,MAAM,SAC5Bl0B,EAAMmU,gBAAgB,KAAM,CAAEmP,aAAa,UAC3C+N,KACN+B,EAAoB,QAAblZ,EAAAniB,KAAK+oB,gBAAQ,IAAA5G,OAAA,EAAAA,EAAE+J,MAAMiQ,MAAM,SAC5Bl0B,EAAMwyB,QACb,KAAC,IAGJU,EAAS,gCAAgC,KACvC6E,GAAU,IAAW5nC,OAAA,OAAA,OAAA,GAAA,kBACb8gC,IACP,MAEDkC,EAAG,iBAAiB,IAAWhjC,OAAA,OAAA,OAAA,GAAA,sBAC7B,MAAM6P,QAAegzB,GAAgB,aACrCI,EAAoB,QAAb1d,EAAA3d,KAAK+oB,gBAAQ,IAAApL,OAAA,EAAAA,EAAEuO,MAAMiQ,MAAM,SAC5Bl0B,EAAMkB,WAAW,CAAEtF,MAAO,eAC1By1B,KACN+B,EAAoB,QAAblZ,EAAAniB,KAAK+oB,gBAAQ,IAAA5G,OAAA,EAAAA,EAAE+J,MAAMiQ,MAAM,GAClCd,EAAsB,QAAf3L,EAAA1vB,KAAK+oB,gBAAU,IAAA2G,OAAA,EAAAA,EAAA5a,SAAS,GAAGpO,SAASq1B,QACzC,UAAU/7B,KAAKuI,KAAKuB,SAAS,uBAEzB7B,EAAMwyB,QACb,MAEDW,EAAG,eAAe,IAAWhjC,OAAA,OAAA,OAAA,GAAA,sBAC3B,MAAM6P,QAAegzB,GAAgB,WACrCI,EAAoB,QAAbpL,EAAAjwB,KAAK+oB,gBAAQ,IAAAkH,OAAA,EAAAA,EAAE/D,MAAMiQ,MAAM,SAC5Bl0B,EAAMkB,WAAW,CAAEtF,MAAO,eAC1By1B,KACN+B,EAAoB,QAAbT,EAAA56B,KAAK+oB,gBAAQ,IAAA6R,OAAA,EAAAA,EAAE1O,MAAMiQ,MAAM,GAClCd,EAAsB,QAAfP,EAAA96B,KAAK+oB,gBAAU,IAAA+R,OAAA,EAAAA,EAAAhmB,SAAS,GAAGpO,SAASq1B,QACzC,UAAU/7B,KAAKuI,KAAKuB,SAAS,uBAEzB7B,EAAMwyB,QACb,MAEDW,EAAG,6CAA6C,IAAWhjC,OAAA,OAAA,OAAA,GAAA,wBACzD,MAAM6P,QAAegzB,GAAgB,aACrCI,EAAoB,QAAbkG,EAAAvhC,KAAK+oB,gBAAQ,IAAAwY,OAAA,EAAAA,EAAErV,MAAMiQ,MAAM,SAC5Bl0B,EAAMkB,WAAW,CACrBtF,MAAO,OACP4B,KAAM,CAAEiD,IAAK,cAET4wB,KACN+B,EAAoB,QAAbmG,EAAAxhC,KAAK+oB,gBAAQ,IAAAyY,OAAA,EAAAA,EAAEtV,MAAMiQ,MAAM,GAClCd,EAAsB,QAAfoG,EAAAzhC,KAAK+oB,gBAAU,IAAA0Y,OAAA,EAAAA,EAAA3sB,SAAS,GAAGpO,SAASq1B,QACzC,UAAU/7B,KAAKuI,KAAKuB,SAAS,iBAE/BuxB,UAAOqG,EAAA1hC,KAAK+oB,+BAAUjU,SAAS,GAAGpO,SAASq1B,QAAQ,YAC7C9zB,EAAMwyB,QACb,MAEDW,EAAG,4CAA4C,IAAWhjC,OAAA,OAAA,OAAA,GAAA,wBACxD,MAAM6P,QAAegzB,GAAgB,mBAC/BhzB,aAAA,EAAAA,EAAOsG,OAAO,CAAEjS,OAAQ,CAAEqE,OAAQ,CAAEC,IAAK,CAAE/H,MAAO,OACxDwiC,EAAOpzB,EAAM3L,OAAOqE,OAAOC,IAAI/H,OAAOsjC,MAAM,GAC5Cd,EAAoB,QAAbsG,EAAA3hC,KAAK+oB,gBAAQ,IAAA4Y,OAAA,EAAAA,EAAEzV,MAAMiQ,MAAM,SAC5Bl0B,EAAMkB,WAAW,CACrBtF,MAAO,OACP4B,KAAM,CAAEiD,IAAK,KAAM3M,KAAM,iBAErBu9B,KACN+B,EAAoB,QAAbuG,EAAA5hC,KAAK+oB,gBAAQ,IAAA6Y,OAAA,EAAAA,EAAE1V,MAAMiQ,MAAM,GAClCd,EAAsB,QAAfwG,EAAA7hC,KAAK+oB,gBAAU,IAAA8Y,OAAA,EAAAA,EAAA/sB,SAAS,GAAGpO,SAASq1B,QACzC,UAAU/7B,KAAKuI,KAAKuB,SAAS,iBAE/BuxB,UAAOyG,EAAA9hC,KAAK+oB,+BAAUjU,SAAS,GAAGpO,SAASq1B,QAAQ,mBAC7C9zB,EAAMwyB,QACb,KAAC,IAGJU,EAAS,qCAAqC,KAC5CG,GAAO,IAAWljC,OAAA,OAAA,OAAA,GAAA,YAChB,MAAM0b,QAAcomB,WACdpmB,aAAK,EAALA,EAAOiuB,UACd,MAED/B,GAAU,IAAW5nC,OAAA,OAAA,OAAA,GAAA,kBACb8gC,IACP,MAEDkC,EAAG,qCAAqC,IAAWhjC,OAAA,OAAA,OAAA,GAAA,sCACjD,MAAM6P,QAAegzB,GAAgB,aAC/BjnB,QAAc/L,EAAM+5B,yBACN,QAAdrkB,EAAA9J,OAAOC,aAAO,IAAA6J,OAAA,EAAAA,EAAAvP,wBAAwB,QAAS,CAAC4F,UAChDslB,KACN+B,EAAkB,QAAXlZ,EAAAniB,KAAKoF,YAAM,IAAA+c,OAAA,EAAAA,EAAAkH,QAAQ6C,MAAMiQ,MAAM,GACzB,QAAbzM,EAAA7b,OAAOkW,cAAM,IAAA2F,GAAAA,EAAEuS,WAAW5yB,SAASmS,GACjCA,EAAE0gB,WAAU,EAAM,CAAEC,eAAe,EAAOC,gBAAgB,MAE5D/G,UAAOpL,EAAApc,OAAOkW,6BAAQkY,WAAW,GAAGh6B,OAAOyzB,IAAI2G,KAC/ChH,EAA2C,UAAvB,QAAbT,EAAA/mB,OAAOkW,cAAM,IAAA6Q,OAAA,EAAAA,EAAEqH,WAAW,GAAGh6B,aAAO,IAAA6yB,OAAA,EAAAA,EAAAx+B,OAAOwL,GAAGjP,OAAO6iC,IAAI2G,KAChEhH,EAAkB,QAAXkG,EAAAvhC,KAAKoF,YAAM,IAAAm8B,OAAA,EAAAA,EAAAlY,QAAQ6C,MAAMiQ,MAAM,GACtCd,EAAoB,QAAbmG,EAAAxhC,KAAK+oB,gBAAQ,IAAAyY,OAAA,EAAAA,EAAEtV,MAAMiQ,MAAM,SAC5Bl0B,EAAM4K,aAAa,CAAEpN,KAAM,CAAE2B,OAAQ,CAAE,IAAM,QAAS,CAC1DgC,YAAY,UAERkwB,KACN+B,EAAoB,QAAboG,EAAAzhC,KAAK+oB,gBAAQ,IAAA0Y,OAAA,EAAAA,EAAEvV,MAAMiQ,MAAM,WAClCuF,EAAA7tB,OAAOkW,uBAAQkY,WAAW,GAAGC,WAAU,EAAO,CAAEC,eAAe,IAC/D9G,EAAkB,QAAXsG,EAAA3hC,KAAKoF,YAAM,IAAAu8B,OAAA,EAAAA,EAAAtY,QAAQ6C,MAAMiQ,MAAM,SAChCl0B,EAAMwyB,QACb,MAEDW,EAAG,gDAAgD,IAAWhjC,OAAA,OAAA,OAAA,GAAA,gCAC5D,MAAM6P,QAAegzB,GAAgB,aAC/BjnB,QAAc/L,EAAM+5B,yBACN,QAAdJ,EAAA/tB,OAAOC,aAAO,IAAA8tB,OAAA,EAAAA,EAAAxzB,wBAAwB,QAAS,CAAC4F,UAChDslB,KACN+B,EAAkB,QAAXwG,EAAA7hC,KAAKoF,YAAM,IAAAy8B,OAAA,EAAAA,EAAAxY,QAAQ6C,MAAMiQ,MAAM,GACzB,QAAb2F,EAAAjuB,OAAOkW,cAAM,IAAA+X,GAAAA,EAAEG,WAAW5yB,SAASmS,GACjCA,EAAE0gB,WAAU,EAAM,CAAEC,eAAe,EAAOC,gBAAgB,MAE5D/G,EAAkB,QAAXiH,EAAAtiC,KAAKoF,YAAM,IAAAk9B,OAAA,EAAAA,EAAAjZ,QAAQ6C,MAAMiQ,MAAM,GACtCd,EAAoB,QAAbkH,EAAAviC,KAAK+oB,gBAAQ,IAAAwZ,OAAA,EAAAA,EAAErW,MAAMiQ,MAAM,SAC5Bl0B,EAAM4K,aAAa,CAAEpN,KAAM,CAAE2B,OAAQ,CAAE,IAAM,QAAS,CAC1DgC,YAAY,UAERkwB,KACN+B,EAAoB,QAAbmH,EAAAxiC,KAAK+oB,gBAAQ,IAAAyZ,OAAA,EAAAA,EAAEtW,MAAMiQ,MAAM,WAClCsG,EAAA5uB,OAAOkW,uBAAQkY,WAAW,GAAGC,WAAU,EAAO,CAAEC,eAAe,IAC/D9G,EAAkB,QAAXqH,EAAA1iC,KAAKoF,YAAM,IAAAs9B,OAAA,EAAAA,EAAArZ,QAAQ6C,MAAMiQ,MAAM,SAChCl0B,EAAMwyB,QACb,MAEDW,EAAG,2CAA2C,IAAWhjC,OAAA,OAAA,OAAA,GAAA,sBACvD,MAUM6P,QAAegzB,GAAgB,aACrCI,EAAkB,QAAXsH,EAAA3iC,KAAKoF,YAAM,IAAAu9B,OAAA,EAAAA,EAAAtZ,QAAQ6C,MAAMiQ,MAAM,GACtCd,EAAoB,QAAbuH,EAAA5iC,KAAK+oB,gBAAQ,IAAA6Z,OAAA,EAAAA,EAAE1W,MAAMiQ,MAAM,SAC5Bl0B,EAAM4K,aAbC,CACXpN,KAAM,CACJK,WAAW,EACX4C,IAAK,CAAC,OACNb,MAAO,GACPT,OAAQ,CACNa,MAAO,CAAE3L,OAAQ,CAAEwL,GAAI,CAAEjP,MAAO,GAAKuP,IAAK,CAAEvP,MAAO,QAO1B,QAAS,CAAEuQ,YAAY,UAChDkwB,KACN+B,EAAoB,QAAbwH,EAAA7iC,KAAK+oB,gBAAQ,IAAA8Z,OAAA,EAAAA,EAAE3W,MAAMiQ,MAAM,SAC5Bl0B,EAAMwyB,QACb,MAEDlH,GAAM,KACJsH,IAAe,GACf,IAGJM,EAAS,gCAAgC,KACvCG,GAAO,IAAWljC,OAAA,OAAA,OAAA,GAAA,kBACV8gC,IACP,MAED8G,GAAU,IAAW5nC,OAAA,OAAA,OAAA,GAAA,kBACb8gC,IACP,MAEDkC,EAAG,mCAAmC,IAAWhjC,OAAA,OAAA,OAAA,GAAA,oBAC/C,MAAM6P,QAAegzB,GAAgB,aACrCI,EAAoB,QAAb1d,EAAA3d,KAAK+oB,gBAAQ,IAAApL,OAAA,EAAAA,EAAEuO,MAAMiQ,MAAM,GAClC,MAAM2G,QAAiB76B,EAAMkkB,WAC3B,CAAE1mB,KAAM,CAAE,GACV,CAAE2D,YAAY,IAEhBiyB,EAAOyH,EAASv5B,SAAS4yB,MAAM,cACzB7C,KACN+B,EAAoB,QAAblZ,EAAAniB,KAAK+oB,gBAAQ,IAAA5G,OAAA,EAAAA,EAAE+J,MAAMiQ,MAAM,SAC5Bl0B,EAAMwyB,QACb,MAEDW,EAAG,kDAAkD,IAAWhjC,OAAA,OAAA,OAAA,GAAA,YAY/D,MAEDgjC,EAAG,iDAAiD,IAAWhjC,OAAA,OAAA,OAAA,GAAA,oBAC7D,MAAM6P,QAAegzB,GAAgB,aACrCI,EAAoB,QAAb3L,EAAA1vB,KAAK+oB,gBAAQ,IAAA2G,OAAA,EAAAA,EAAExD,MAAMiQ,MAAM,GAClC,MAAM2G,QAAiB76B,EAAMkkB,WAC3B,CAAE1mB,KAAM,CAAA,GACR,CAAE1J,KAAM,UAAWqN,YAAY,IAEjCiyB,EAAOyH,EAASv5B,SAAS4yB,MAAM,yBACzB7C,KACN+B,EAAoB,QAAbpL,EAAAjwB,KAAK+oB,gBAAQ,IAAAkH,OAAA,EAAAA,EAAE/D,MAAMiQ,MAAM,SAC5Bl0B,EAAMwyB,QACb,MAEDW,EAAG,+CAA+C,IAAWhjC,OAAA,OAAA,OAAA,GAAA,oBAC3D,MAAM6P,QAAegzB,GAAgB,mBAC/BhzB,EAAMsG,OAAO,CAAEjS,OAAQ,CAAEqE,OAAQ,CAAEC,IAAK,CAAE/H,MAAO,QACvDwiC,EAAoB,QAAbT,EAAA56B,KAAK+oB,gBAAQ,IAAA6R,OAAA,EAAAA,EAAE1O,MAAMiQ,MAAM,GAClC,MAAM2G,QAAiB76B,EAAMkkB,WAC3B,CAAE1mB,KAAM,CAAA,GACR,CAAE1J,KAAM,QAASqN,YAAY,IAE/BiyB,EAAOyH,EAASv5B,SAAS4yB,MAAM,sBACzB7C,KACN+B,EAAoB,QAAbP,EAAA96B,KAAK+oB,gBAAQ,IAAA+R,OAAA,EAAAA,EAAE5O,MAAMiQ,MAAM,SAC5Bl0B,EAAMwyB,QACb,MAGDW,EAAG,+CAA+C,IAAahjC,OAAA,OAAA,OAAA,GAAA,YAAC,MAEhEgjC,EAAG,sEAAsE,IAAWhjC,OAAA,OAAA,OAAA,GAAA,oBAClF,MAAM6P,QAAegzB,GAAgB,aAC/BjsB,QAAa8qB,GAAoB,gBACjC9qB,eAAAA,EAAMT,OAAO,CAAEjS,OAAQ,CAAEiJ,MAAO,MACtC81B,EAAoB,QAAbkG,EAAAvhC,KAAK+oB,gBAAQ,IAAAwY,OAAA,EAAAA,EAAErV,MAAMiQ,MAAM,GAClC,MAAM2G,QAAiB76B,EAAMkkB,WAC3B,CAAE1mB,KAAM,GAAIuJ,QACZ,CAAE5F,YAAY,IAEhBiyB,EAAOyH,EAASv5B,SAAS4yB,MAAM,mBACzB7C,KACN+B,EAAoB,QAAbmG,EAAAxhC,KAAK+oB,gBAAQ,IAAAyY,OAAA,EAAAA,EAAEtV,MAAMiQ,MAAM,SAC5Bl0B,EAAMwyB,QACb,KAAC,IAGJU,EAAS,mCAAmC,KAC1CC,EAAG,+CAA+C,IAAWhjC,OAAA,OAAA,OAAA,GAAA,YAC3D,MAAM6P,QAAegzB,GAAgB,mBAC/BhzB,EAAMsG,OAAO,CAAEjS,OAAQ,CAAE8nB,GAAI,CAAEvrB,MAAO,GAAIuB,IAAK,OACrDihC,EAAOpzB,EAAM3L,OAAO8nB,GAAGvrB,OAAOsjC,MAAM,UAC9Bl0B,EAAM4nB,cACZwL,EAAOpzB,EAAM3L,OAAO8nB,GAAGvrB,OAAOsjC,MAAM,UAC9Bl0B,EAAMwyB,QACb,MAEDW,EAAG,qCAAqC,IAAWhjC,OAAA,OAAA,OAAA,GAAA,YACjD,MAAM6P,QAAegzB,GAAgB,mBAC/BhzB,EAAMsG,OAAO,CAAEjS,OAAQ,CAAE8nB,GAAI,CAAEvrB,MAAO,GAAIuB,IAAK,OACrDihC,EAAOpzB,EAAM3L,OAAO8nB,GAAGvrB,OAAOsjC,MAAM,UAC9Bl0B,EAAM4nB,YAAY,GACxBwL,EAAOpzB,EAAM3L,OAAO8nB,GAAGvrB,OAAOsjC,MAAM,SAC9Bl0B,EAAMwyB,QACb,MAEDW,EAAG,oDAAoD,IAAWhjC,OAAA,OAAA,OAAA,GAAA,YAChE,MAAM6P,QAAegzB,GAAgB,mBAC/BhzB,EAAMsG,OAAO,CAAEjS,OAAQ,CAAE8nB,GAAI,CAAEvrB,MAAO,GAAIuB,IAAK,OACrDihC,EAAOpzB,EAAM3L,OAAO8nB,GAAGvrB,OAAOsjC,MAAM,UAC9Bl0B,EAAM4nB,YAAY,EAAG,GAC3BwL,EAAOpzB,EAAM3L,OAAO8nB,GAAGvrB,OAAOsjC,MAAM,SAC9Bl0B,EAAMwyB,QACb,MAEDW,EAAG,6DAA6D,IAAWhjC,OAAA,OAAA,OAAA,GAAA,YACzE,MAAM6P,QAAegzB,GAAgB,mBAC/BhzB,EAAMsG,OAAO,CAAEjS,OAAQ,CAAE8nB,GAAI,CAAEvrB,MAAO,EAAGuB,IAAK,OACpDihC,EAAOpzB,EAAM3L,OAAO8nB,GAAGvrB,OAAOsjC,MAAM,SAC9Bl0B,EAAM4nB,YAAY,GAAI,GAC5BwL,EAAOpzB,EAAM3L,OAAO8nB,GAAGvrB,OAAOsjC,MAAM,SAC9Bl0B,EAAMwyB,QACb,MAEDW,EAAG,8CAA8C,IAAWhjC,OAAA,OAAA,OAAA,GAAA,YAC1D,MAAM6P,QAAegzB,GAAgB,mBAC/BhzB,EAAMsG,OAAO,CAAEjS,OAAQ,CAAE8nB,GAAI,CAAEvrB,MAAO,EAAGuB,IAAK,OACpDihC,EAAOpzB,EAAM3L,OAAO8nB,GAAGvrB,OAAOsjC,MAAM,SAC9Bl0B,EAAM4nB,aAAa,GACzBwL,EAAOpzB,EAAM3L,OAAO8nB,GAAGvrB,OAAOsjC,MAAM,SAC9Bl0B,EAAMwyB,QACb,MAEDW,EAAG,mDAAmD,IAAWhjC,OAAA,OAAA,OAAA,GAAA,YAC/D,MAAM6P,QAAegzB,GAAgB,mBAC/BhzB,EAAMsG,OAAO,CAAEjS,OAAQ,CAAE8nB,GAAI,CAAEvrB,MAAO,GAAIuB,IAAK,OACrDihC,EAAOpzB,EAAM3L,OAAO8nB,GAAGvrB,OAAOsjC,MAAM,UAC9Bl0B,EAAM4nB,YAAY,IACxBwL,EAAOpzB,EAAM3L,OAAO8nB,GAAGvrB,OAAOsjC,MAAM,SAC9Bl0B,EAAMwyB,QACb,MAEDW,EAAG,6DAA6D,IAAWhjC,OAAA,OAAA,OAAA,GAAA,YACzE,MAAM6P,QAAegzB,GAAgB,mBAC/BhzB,EAAMsG,OAAO,CAAEjS,OAAQ,CAAE8nB,GAAI,CAAEvrB,MAAO,GAAIuB,IAAK,OACrDihC,EAAOpzB,EAAM3L,OAAO8nB,GAAGvrB,OAAOsjC,MAAM,UAC9Bl0B,EAAM4nB,YAAY,EAAG,GAC3BwL,EAAOpzB,EAAM3L,OAAO8nB,GAAGvrB,OAAOsjC,MAAM,SAC9Bl0B,EAAMwyB,QACb,MAEDW,EAAG,wDAAwD,IAAWhjC,OAAA,OAAA,OAAA,GAAA,YACpE,MAAM6P,QAAegzB,GAAgB,mBAC/BhzB,EAAMsG,OAAO,CAAEjS,OAAQ,CAAE8nB,GAAI,CAAEvrB,MAAO,EAAGuB,IAAK,OACpDihC,EAAOpzB,EAAM3L,OAAO8nB,GAAGvrB,OAAOsjC,MAAM,SAC9Bl0B,EAAM4nB,aAAa,IACzBwL,EAAOpzB,EAAM3L,OAAO8nB,GAAGvrB,OAAOsjC,MAAM,UAC9Bl0B,EAAMwyB,QACb,MAEDW,EAAG,kEAAkE,IAAWhjC,OAAA,OAAA,OAAA,GAAA,YAC9E,MAAM6P,QAAegzB,GAAgB,mBAC/BhzB,EAAMsG,OAAO,CAAEjS,OAAQ,CAAE8nB,GAAI,CAAEvrB,MAAO,EAAGuB,IAAK,OACpDihC,EAAOpzB,EAAM3L,OAAO8nB,GAAGvrB,OAAOsjC,MAAM,SAC9Bl0B,EAAM4nB,YAAY,GAAI,GAC5BwL,EAAOpzB,EAAM3L,OAAO8nB,GAAGvrB,OAAOsjC,MAAM,UAC9Bl0B,EAAMwyB,QACb,KAAC,GACF,EC31BG,MAAMhmB,GAAM,kBACN5Y,GAAU,CACrBm/B,YAAa,oBACbkF,aAAa,GAwBTpH,GAAW,IAAY1gC,OAAA,OAAA,OAAA,GAAA,YAAA,IAAAulB,EAAA,OAAa,UAAb3d,KAAK4pB,cAAQ,IAAAjM,OAAA,EAAAA,EAAA2c,QAAQ,cAAc7lB,SAEhE,IAAAsuB,GAAe,EACb5H,WACAC,KACAC,SACA9H,QACAyM,YACA1E,aAGA,MAAM0H,EAAsBhjC,KAAKI,SAAStG,IACxCkG,KAAK1D,OAAO2D,GACZ,wBAGFszB,GAAM,IAAWn7B,OAAA,OAAA,OAAA,GAAA,kBACTsiC,GAAmBjmB,UACnBmlB,KACN55B,KAAKI,SAASpG,IACZgG,KAAK1D,OAAO2D,GACZ,uBACA+iC,EAEH,MAED7H,EAAS,aAAa,KACpBC,EAAG,6BAA6B,IAAWhjC,OAAA,OAAA,OAAA,GAAA,kBACzC,MAAM6P,QAAe4xB,GACnB,YACA,CAAE,EACFplB,IAGI7P,EADQ,IAAIkL,EAAc7H,GACb+C,UAEnBqwB,EAAOz2B,EAAKoL,OAAOmsB,MAAMl0B,aAAA,EAAAA,EAAOgI,SAChCorB,EAAOz2B,EAAKsL,UAAUisB,MAAoB,QAAdxe,EAAA1V,eAAAA,EAAOuG,aAAO,IAAAmP,OAAA,EAAAA,EAAAxN,YAC1CkrB,EAAO3/B,OAAO4mB,KAAK1d,EAAKU,SAASy2B,QAAQ,eACzCV,EAAO3/B,OAAO4mB,KAAK1d,EAAKU,SAASy2B,QAAQ,cACzCV,EAAO3/B,OAAO4mB,KAAK1d,EAAKU,SAASy2B,QAAQ,eACzCV,EAAOz2B,EAAKyL,OAAO8rB,MAAMl0B,aAAA,EAAAA,EAAOoI,QACjC,KAAC,IAIJ8qB,EAAS,4BAA4B,KACnCJ,GAAU1rB,SAAS8W,IACjBiV,EAAG,cAAcjV,EAASjP,qBAAqB,IAAW9e,OAAA,OAAA,OAAA,GAAA,sBAExD,MAAM6P,QAAc4xB,GAAmB,YAAa,CAAE,EAAEplB,UAClDxM,aAAK,EAALA,EAAOsG,OAAO,CAAEjS,OAAQ,CAAE+d,OAAQ,CAAE1f,SAAS,MACvC,QAAZgjB,EAAA1V,aAAK,EAALA,EAAOuG,aAAK,IAAAmP,GAAAA,EAAErX,QAAO,SACf0yB,GAAM,KAEZ,MAAMhqB,QAAa+qB,GAAoB9xB,EAAOke,SACxCmT,KAEN+B,EAAOpzB,aAAK,EAALA,EAAO3N,MAAM4xB,MAAMiQ,MAAM,GAChC,MAAM8G,EAAaj0B,eAAAA,EAAMmH,MACzBklB,EAAOpzB,eAAAA,EAAO3N,MAAMwa,SAASvI,MAAMqF,GAAMA,EAAE3R,MAAOgjC,aAAA,EAAAA,EAAYhjC,OAAKy7B,IAChExc,UAGH,IAAIgkB,EAAM,GACV,OAAQ/c,GAEN,IAAK,QACH+c,EAAM,wBACN,MAIF,IAAK,UACHA,EAAM,2BACN,MAIF,QACEA,EAAM,2BAKV,MAAMC,EAAetnB,SAAS5R,cAAc,GAAGi5B,gBACzCE,EAC2C,QAA/C1T,EAA2B,QAA3BvN,EAAAghB,aAAA,EAAAA,EAAc91B,qBAAa,IAAA8U,OAAA,EAAAA,EAAEkhB,0BAAkB,IAAA3T,OAAA,EAAAA,EAAEre,MACnDgqB,EAAO+H,EAAiB9xB,SAAS6qB,MAAM,IAGvCtwB,EAAE,GAAGq3B,gBAAkB11B,QAAQ,eACzBwrB,GAAM,KAGZqC,EAAO+H,EAAiB9xB,SAAS6qB,MAAM,eAGjCl0B,aAAK,EAALA,EAAOwyB,QACd,MAEDlH,GAAM,IAAWn7B,OAAA,OAAA,OAAA,GAAA,kBACTsiC,GAAmBjmB,UACnBmlB,IACP,KAAC,GACF,IAIJuB,EAAS,8BAA8B,KAErC,MAAMmI,EAAgB,IAAWlrC,OAAA,OAAA,OAAA,GAAA,YAC/ByT,EAAE,iDAAiD2B,QAAQ,eACrDwrB,GAAM,IACd,IAEAsC,GAAO,IAAWljC,OAAA,OAAA,OAAA,GAAA,kBAChB,MAAM6P,QAAe4xB,GACnB,YACA,CAAE,EACFplB,UAEIxM,EAAMsG,OAAO,CAAEjS,OAAQ,CAAE+d,OAAQ,CAAE1f,SAAS,MACtC,QAAZgjB,EAAA1V,aAAK,EAALA,EAAOuG,aAAK,IAAAmP,GAAAA,EAAErX,QAAO,SACf0yB,GAAM,IACb,MAEDoC,EAAG,sDAAsD,IAAWhjC,OAAA,OAAA,OAAA,GAAA,YAClE,MAAMmrC,EAAShK,GAAY,SAC3B8B,EAAOkI,EAAO16B,QAAQszB,MAAM,GAC5B,MAAMqH,EAAkB3nB,SAAS5R,cAC/B,uCAEFoxB,EAAOmI,aAAe,EAAfA,EAAiBnyB,MAAMC,SAAS6qB,MAAM,UACvCmH,IACNjI,EAAOmI,aAAe,EAAfA,EAAiBnyB,MAAMC,SAAS6qB,MAAM,OAC9C,MAEDf,EAAG,4DAA4D,IAAWhjC,OAAA,OAAA,OAAA,GAAA,YACxE,MAAMmrC,EAAShK,GAAY,SAC3B8B,EAAOkI,EAAO16B,QAAQszB,MAAM,GAC5B,MAAMqH,EAAkB3nB,SAAS5R,cAC/B,uCAEFoxB,EAAOmI,aAAe,EAAfA,EAAiBnyB,MAAMC,SAAS6qB,MAAM,cACvCmH,IACNjI,EAAOmI,aAAe,EAAfA,EAAiBnyB,MAAMC,SAAS6qB,MAAM,GAC9C,MAED5I,GAAM,IAAWn7B,OAAA,OAAA,OAAA,GAAA,kBACTsiC,GAAmBjmB,UACnBmlB,IACP,KAAC,IAGJuB,EAAS,gCAAgC,KAEvC,MAAMsI,EAAsB,IAAWrrC,OAAA,OAAA,OAAA,GAAA,YACrCyT,EAAE,uDAAuD2B,QAAQ,eAC3DwrB,GAAM,IACd,IAEAsC,GAAO,IAAWljC,OAAA,OAAA,OAAA,GAAA,kBAChB,MAAM6P,QAAc4xB,GAAmB,YAAa,CAAE,EAAEplB,UAClDslB,GAAoB9xB,EAAO,mBAC3B8xB,GAAoB9xB,EAAO,UACjC,MAAMwd,EAASxd,aAAA,EAAAA,EAAO3N,MAAMggC,QAAQ,yBAC9B1kB,EAAY3N,aAAA,EAAAA,EAAO3N,MAAMggC,QAAQ,kCAEjC7U,aAAM,EAANA,EAAQlX,OAAO,CAAEjS,OAAQ,CAAEmV,YAAamE,aAAA,EAAAA,EAAW3V,MAC7C,QAAZ0d,EAAA1V,aAAK,EAALA,EAAOuG,aAAK,IAAAmP,GAAAA,EAAErX,QAAO,EACtB,MAED80B,EAAG,kDAAkD,IAAWhjC,OAAA,OAAA,OAAA,GAAA,oBAC9D,MAAMmrC,EAAShK,GAAY,SAC3B8B,EAAOkI,EAAO16B,QAAQszB,MAAM,GAE5B,MAAMl0B,QAAc6wB,KACpBuC,EAAOpzB,aAAK,EAALA,EAAO3N,MAAM4xB,MAAMiQ,MAAM,GAEhC,MAAMvmB,EAA0B,QAAduM,EAAAla,aAAK,EAALA,EAAO3N,aAAO,IAAA6nB,OAAA,EAAAA,EAAAmY,QAAQ,4BACxCe,EAC+C,QAA7C3L,EAAAznB,aAAK,EAALA,EAAO3N,MAAMggC,QAAQ,gCAAwB,IAAA5K,OAAA,EAAAA,EAAEpzB,OAAOmV,aACtD0qB,MAAMvmB,aAAA,EAAAA,EAAW3V,IACnB,MAAMyjC,EAAmB7nB,SAAS5R,cAChC,wDAEFoxB,EAAOqI,aAAgB,EAAhBA,EAAkBryB,MAAMC,SAAS6qB,MAAM,UAExCsH,IACNpI,EAAOqI,aAAgB,EAAhBA,EAAkBryB,MAAMC,SAAS6qB,MAAM,OAC/C,MAEDf,EAAG,wDAAwD,IAAWhjC,OAAA,OAAA,OAAA,GAAA,oBACpE,MAAMmrC,EAAShK,GAAY,SAC3B8B,EAAOkI,EAAO16B,QAAQszB,MAAM,GAE5B,MAAMl0B,QAAc6wB,KACpBuC,EAAOpzB,aAAK,EAALA,EAAO3N,MAAM4xB,MAAMiQ,MAAM,GAEhC,MAAMvmB,EAA0B,QAAdqa,EAAAhoB,aAAK,EAALA,EAAO3N,aAAO,IAAA21B,OAAA,EAAAA,EAAAqK,QAAQ,4BACxCe,EAC+C,QAA7CT,EAAA3yB,aAAK,EAALA,EAAO3N,MAAMggC,QAAQ,gCAAwB,IAAAM,OAAA,EAAAA,EAAEt+B,OAAOmV,aACtD0qB,MAAMvmB,aAAA,EAAAA,EAAW3V,IACnB,MAAMyjC,EAAmB7nB,SAAS5R,cAChC,wDAGFoxB,EAAOqI,aAAgB,EAAhBA,EAAkBryB,MAAMC,SAAS6qB,MAAM,cACxCsH,IACNpI,EAAOqI,aAAgB,EAAhBA,EAAkBryB,MAAMC,SAAS6qB,MAAM,GAC/C,MAED5I,GAAM,IAAWn7B,OAAA,OAAA,OAAA,GAAA,kBACTsiC,GAAmBjmB,UACnBmlB,IACP,KAAC,IAGJuB,EAAS,6BAA6B,KAEpC,MAAMwI,EAA0BT,GAAe9qC,OAAA,OAAA,OAAA,GAAA,YAC7CyT,EAAE,GAAGq3B,gBAAkB11B,QAAQ,eACzBwrB,GAAM,IACd,IAEAsC,GAAO,IAAWljC,OAAA,OAAA,OAAA,GAAA,kBAChB,MAAM6P,QAAc4xB,GAAmB,YAAa,CAAE,EAAEplB,UAClDxM,aAAK,EAALA,EAAOsG,OAAO,CAAEjS,OAAQ,CAAE+d,OAAQ,CAAE1f,SAAS,MACvC,QAAZgjB,EAAA1V,aAAK,EAALA,EAAOuG,aAAK,IAAAmP,GAAAA,EAAErX,QAAO,SACf0yB,GAAM,IACb,MAED+B,GAAU1rB,SAAe8W,GAAY/tB,OAAA,OAAA,OAAA,GAAA,YACnC,IAAI8qC,EAAM,GACV,OAAQ/c,GAEN,IAAK,QACH+c,EAAM,wBACN,MAIF,IAAK,UACHA,EAAM,2BACN,MAIF,QACEA,EAAM,2BAIV/H,EAAS,YAAYhV,KAAY,KAC/BmV,GAAO,IAAWljC,OAAA,OAAA,OAAA,GAAA,YAChB,MAAM6P,QAAc6wB,WACdiB,GAAoB9xB,EAAOke,EAClC,MAEDiV,EAAG,4CAA4C,IAAWhjC,OAAA,OAAA,OAAA,GAAA,YACxD,MAAMmrC,EAAShK,GAAY,SAC3B8B,EAAOkI,EAAO16B,QAAQszB,MAAM,GAE5B,MAAMl0B,QAAc6wB,KACpBuC,EAAOpzB,aAAK,EAALA,EAAO3N,MAAM4xB,MAAMiQ,MAAM,GAEhC,MAAMyH,EAAiB/nB,SAAS5R,cAAc,GAAGi5B,mBACjD7H,EAAOuI,aAAc,EAAdA,EAAgBvyB,MAAMC,SAAS6qB,MAAM,UAEtCwH,EAAiBT,GACvB7H,EAAOuI,aAAc,EAAdA,EAAgBvyB,MAAMC,SAAS6qB,MAAM,QAC7C,MACDf,EAAG,kDAAkD,IAAWhjC,OAAA,OAAA,OAAA,GAAA,YAC9D,MAAMmrC,EAAShK,GAAY,SAC3B8B,EAAOkI,EAAO16B,QAAQszB,MAAM,GAE5B,MAAMl0B,QAAc6wB,KACpBuC,EAAOpzB,aAAK,EAALA,EAAO3N,MAAM4xB,MAAMiQ,MAAM,GAEhC,MAAMyH,EAAiB/nB,SAAS5R,cAAc,GAAGi5B,mBACjD7H,EAAOuI,aAAc,EAAdA,EAAgBvyB,MAAMC,SAAS6qB,MAAM,eACtCwH,EAAiBT,GACvB7H,EAAOuI,aAAc,EAAdA,EAAgBvyB,MAAMC,SAAS6qB,MAAM,GAC7C,MACDf,EAAG,uDAAuD,IAAWhjC,OAAA,OAAA,OAAA,GAAA,YAGnE,MAAM6P,QAAc6wB,KACd9pB,EAAO/G,aAAK,EAALA,EAAO3N,MAAMggC,QACxB,kBAAkBnU,EAASjP,sBAGvBysB,EAAiBT,SACjBl0B,eAAAA,EAAMT,OAAO,CAAEjS,OAAQ,CAAEwpB,YAAa,uBACtCwT,KACN+B,EAAOrsB,aAAI,EAAJA,EAAM1S,OAAOwpB,aAAaqW,MAAM,eAEvC,MAAMyH,EAAiB/nB,SAAS5R,cAAc,GAAGi5B,mBACjD7H,GAAOuI,aAAA,EAAAA,EAAgB9Q,UAAUnR,QAAQ,iBAAkB,GAAG8a,GAAGF,WAE3DvtB,eAAAA,EAAMT,OAAO,CAAEjS,OAAQ,CAAEwpB,YAAa,KAC7C,MACDsV,EAAG,uEAAuE,IAAWhjC,OAAA,OAAA,OAAA,GAAA,YACnF,MAAM89B,QAAc8D,KACd6J,EAAiB,YAAY3N,aAAK,EAALA,EAAOthB,wBAEpC3M,QAAc6wB,KACd9pB,EAAO/G,aAAK,EAALA,EAAO3N,MAAMggC,QACxB,kBAAkBnU,EAASjP,sBAEvBlI,eAAAA,EAAMT,OAAO,CAAEjS,OAAQ,CAAEwpB,YAAa+d,WACtCvK,KAEN,MAAMsK,EAAiB/nB,SAAS5R,cAAc,GAAGi5B,mBACjD7H,EAAOuI,eAAAA,EAAgB9Q,WAAWqJ,MAAM,IACxCd,GAAOuI,aAAc,EAAdA,EAAgB9Q,UAAUnR,QAAQkiB,KAAmB,GAAGtH,WACzDrG,aAAK,EAALA,EAAOuE,eACPzrB,eAAAA,EAAMT,OAAO,CAAEjS,OAAQ,CAAEwpB,YAAa,KAC7C,MAEDyN,GAAM,IAAWn7B,OAAA,OAAA,OAAA,GAAA,YACf,MAAM6P,QAAc6wB,KACpB7wB,SAAAA,EAAO3N,MAAM+U,SAAexR,GAAKzF,OAAA,OAAA,OAAA,GAAA,kBACzByF,EAAE48B,QACT,YACKF,IACP,KAAC,GAEL,MAEDhH,GAAM,IAAWn7B,OAAA,OAAA,OAAA,GAAA,kBACTsiC,GAAmBjmB,UACnBmlB,IACP,KAAC,IAIJuB,EAAS,6BAA6B,KAMpCG,GAAO,IAAWljC,OAAA,OAAA,OAAA,GAAA,kBAChB,MAAM6P,QAAc4xB,GAAmB,YAAa,CAAE,EAAEplB,UAClDxM,aAAK,EAALA,EAAOsG,OAAO,CAAEjS,OAAQ,CAAE+d,OAAQ,CAAE1f,SAAS,MACvC,QAAZgjB,EAAA1V,aAAK,EAALA,EAAOuG,aAAK,IAAAmP,GAAAA,EAAErX,QAAO,SACf0yB,GAAM,IACb,MAED+B,GAAU1rB,SAAS8W,IACjB,IAAI+c,EAAM,GACV,OAAQ/c,GAEN,IAAK,QACH+c,EAAM,wBACN,MAIF,IAAK,UACHA,EAAM,2BACN,MAIF,QACEA,EAAM,2BAIV9H,EAAG,YAAYjV,KAAY,IAAW/tB,OAAA,OAAA,OAAA,GAAA,4BAC9B8gC,KACN,MAAMjxB,QAAc6wB,WACdiB,GAAoB9xB,EAAOke,SAC3BmT,UArCY,CAAO4J,GAAe9qC,OAAA,OAAA,OAAA,GAAA,YAC1CyT,EAAE,GAAGq3B,gBAAkB11B,QAAQ,eACzBwrB,GAAM,IACd,IAmCU8K,CAAcZ,SACd5J,KACN+B,EAAoB,QAAb1d,EAAA3d,KAAK+oB,gBAAQ,IAAApL,OAAA,EAAAA,EAAEuO,MAAMiQ,MAAM,GAClCd,EAAiC,QAA1B3L,EAAe,QAAfvN,EAAAniB,KAAK+oB,gBAAU,IAAA5G,OAAA,EAAAA,EAAArN,SAAS,UAAE,IAAA4a,OAAA,EAAAA,EAAEhpB,SAASq1B,QAC1C,kBAAkB5V,EAASjP,gBAE7BjP,SAAAA,EAAO3N,MAAM+U,SAASxR,GAAMA,EAAE48B,UAC/B,MAEDlH,GAAM,IAAWn7B,OAAA,OAAA,OAAA,GAAA,kBACTsiC,GAAmBjmB,GAC1B,KAAC,GACF,IAIJ0mB,EAAS,8BAA8B,KACrCG,GAAO,IAAWljC,OAAA,OAAA,OAAA,GAAA,kBAChB,MAAM6P,QAAc4xB,GAAmB,YAAa,CAAE,EAAEplB,UAClDxM,aAAK,EAALA,EAAOsG,OAAO,CAAEjS,OAAQ,CAAE+d,OAAQ,CAAE1f,SAAS,MACvC,QAAZgjB,EAAA1V,aAAK,EAALA,EAAOuG,aAAK,IAAAmP,GAAAA,EAAErX,QAAO,EACtB,MAEDy0B,GAAU1rB,SAAS8W,IACjBgV,EAAS,GAAGhV,UAAiB,KAC3BiV,EAAG,qCAAqC,IAAWhjC,OAAA,OAAA,OAAA,GAAA,kBACjD,MAAM6P,QAAe6wB,KACrBuC,EAAOpzB,aAAK,EAALA,EAAO3N,MAAM4xB,MAAMiQ,MAAM,SAE1BpC,GAAoB9xB,EAAOke,SAC3BmT,KACN,MAAMtqB,EAAO/G,aAAK,EAALA,EAAO3N,MAAMggC,QACxB,kBAAkBnU,EAASjP,gBAE7BmkB,EAAOpzB,aAAK,EAALA,EAAO3N,MAAM4xB,MAAMiQ,MAAM,iBAG1Bxe,EAAA1V,aAAA,EAAAA,EAAOuG,4BAAOqK,qBAAqB7J,SACnCsqB,KACN+B,EAAOpzB,aAAK,EAALA,EAAO3N,MAAM4xB,MAAMiQ,MAAM,EACjC,MAGc,cAAbhW,GACa,UAAbA,GACa,YAAbA,IAEAiV,EAAG,oCAAoC,IAAWhjC,OAAA,OAAA,OAAA,GAAA,sBAChD,MAAM6P,QAAc6wB,KACpBuC,EAAOpzB,aAAK,EAALA,EAAO3N,MAAM4xB,MAAMiQ,MAAM,SAE1BpC,GAAoB9xB,EAAO,mBAC3B8xB,GAAoB9xB,EAAOke,SAC3BmT,KACN+B,EAAOpzB,aAAK,EAALA,EAAO3N,MAAM4xB,MAAMiQ,MAAM,GAEhC,MAAMntB,EAAO/G,aAAK,EAALA,EAAO3N,MAAMggC,QACxB,kBAAkBnU,EAASjP,gBAEvBtB,EAAY3N,aAAA,EAAAA,EAAO3N,MAAMggC,QAAQ,4BACvCe,EAAOrsB,GAAM0sB,IAAIxc,UACjBmc,EAAOzlB,GAAW8lB,IAAIxc,gBAGJ,QAAZiD,EAAAla,eAAAA,EAAOuG,aAAK,IAAA2T,OAAA,EAAAA,EAAExM,oBAAoB3G,EAAM4G,SACxC0jB,mBAGA5J,EAAAznB,aAAA,EAAAA,EAAOuG,4BAAOqK,qBAAqB7J,SACnCsqB,KACN+B,EAAOpzB,aAAK,EAALA,EAAO3N,MAAM4xB,MAAMiQ,MAAM,GAChCd,EAAOzlB,aAAA,EAAAA,EAAWtZ,OAAOqV,QAAQ9I,QAAQszB,MAAM,iBAGzClM,EAAAhoB,aAAA,EAAAA,EAAOuG,4BAAOqK,qBAAqBjD,SACnC0jB,KACN+B,EAAOpzB,aAAK,EAALA,EAAO3N,MAAM4xB,MAAMiQ,MAAM,EACjC,MACDf,EAAG,8DAA8D,IAAWhjC,OAAA,OAAA,OAAA,GAAA,oBAC1E,MAAM6P,QAAc6wB,KACpBuC,EAAOpzB,aAAK,EAALA,EAAO3N,MAAM4xB,MAAMiQ,MAAM,SAE1BpC,GAAoB9xB,EAAO,mBAC3B8xB,GAAoB9xB,EAAOke,SAC3BmT,KACN+B,EAAOpzB,aAAK,EAALA,EAAO3N,MAAM4xB,MAAMiQ,MAAM,GAEhC,MAAMntB,EAAO/G,aAAK,EAALA,EAAO3N,MAAMggC,QACxB,kBAAkBnU,EAASjP,gBAEvBtB,EAAY3N,aAAA,EAAAA,EAAO3N,MAAMggC,QAAQ,4BACvCe,EAAOrsB,GAAM0sB,IAAIxc,UACjBmc,EAAOzlB,GAAW8lB,IAAIxc,UACtBmc,EAAOpzB,aAAK,EAALA,EAAO3N,MAAM4xB,MAAMiQ,MAAM,iBAG1BvB,EAAA3yB,aAAA,EAAAA,EAAOuG,4BAAOqK,qBAAqBjD,SACnC0jB,KACN+B,EAAOpzB,aAAK,EAALA,EAAO3N,MAAM4xB,MAAMiQ,MAAM,iBAE1BrB,EAAA7yB,aAAA,EAAAA,EAAOuG,4BAAOqK,qBAAqB7J,SACnCsqB,KACN+B,EAAOpzB,aAAK,EAALA,EAAO3N,MAAM4xB,MAAMiQ,MAAM,EACjC,MACF,IAGH5I,GAAM,IAAWn7B,OAAA,OAAA,OAAA,GAAA,kBACTsiC,GAAmBjmB,GAC1B,KAAC,GACF,IAGJ0mB,EAAS,oCAAoC,KAO3CG,GAAO,IAAWljC,OAAA,OAAA,OAAA,GAAA,kBAChB,MAAM6P,QAAc4xB,GAAmB,YAAa,CAAE,EAAEplB,UAClDslB,GAAoB9xB,EAAO,cAC3BqxB,KAEN,MAAMtqB,EAAO/G,aAAA,EAAAA,EAAO3N,MAAMwa,SAAS,GACnC9F,SAAAA,EAAMT,OAAO,CAAEjS,OAAQ,CAAEE,SAAU,CAAEpC,IAAK,EAAGvB,MAAO,YAC9CygC,KAEM,QAAZ3b,EAAA1V,aAAK,EAALA,EAAOuG,aAAK,IAAAmP,GAAAA,EAAErX,QAAO,SACf0yB,GAAM,IACb,MAGDoC,EAAG,sBAAsB,IAAWhjC,OAAA,OAAA,OAAA,GAAA,YAClC,MAAM6P,QAAc6wB,KACd9pB,EAAO/G,aAAA,EAAAA,EAAO3N,MAAMwa,SAAS,GACnCumB,EAAOrsB,aAAA,EAAAA,EAAM1S,OAAOE,SAAS3D,OAAOsjC,MAAM,SApBL/jC,OAAA,OAAA,OAAA,GAAA,YACrC,OAAAyT,EAAE,uCAAuC2B,QAAQ,QAAQ,UAqBnD8rB,KACN+B,EAAOrsB,aAAA,EAAAA,EAAM1S,OAAOE,SAAS3D,OAAOsjC,MAAM,EAC3C,MACDf,EAAG,sBAAsB,IAAWhjC,OAAA,OAAA,OAAA,GAAA,YAClC,MAAM6P,QAAc6wB,KACd9pB,EAAO/G,aAAA,EAAAA,EAAO3N,MAAMwa,SAAS,GACnCumB,EAAOrsB,aAAA,EAAAA,EAAM1S,OAAOE,SAAS3D,OAAOsjC,MAAM,SA/BJ/jC,OAAA,OAAA,OAAA,GAAA,YACtC,OAAAyT,EAAE,wCAAwC2B,QAAQ,QAAQ,UAgCpD8rB,KACN+B,EAAOrsB,aAAA,EAAAA,EAAM1S,OAAOE,SAAS3D,OAAOsjC,MAAM,EAC3C,MAED5I,GAAM,IAAWn7B,OAAA,OAAA,OAAA,GAAA,kBACTsiC,GAAmBjmB,GAC1B,KAAC,IAGJ0mB,EAAS,yBAAyB,KAChCG,GAAO,IAAWljC,OAAA,OAAA,OAAA,GAAA,kBAChB,MAAM6P,QAAc4xB,GAAmB,YAAa,CAAE,EAAEplB,UAClDxM,aAAK,EAALA,EAAOsG,OAAO,CAAEjS,OAAQ,CAAE+d,OAAQ,CAAE1f,SAAS,YAC7Co/B,GAAoB9xB,EAAO,eAC3BqxB,KACM,QAAZ3b,EAAA1V,aAAK,EAALA,EAAOuG,aAAK,IAAAmP,GAAAA,EAAErX,QAAO,EACtB,MAGD80B,EAAG,uDAAuD,IAAWhjC,OAAA,OAAA,OAAA,GAAA,YACnEyT,EAAE,0BAA0B0B,IAAI,SAC1B+rB,KAEN,MAAMrxB,QAAc6wB,KACd9pB,EAAO/G,aAAA,EAAAA,EAAO3N,MAAMwa,SAAS,GACnCumB,EAAOrsB,aAAI,EAAJA,EAAM1S,OAAOymB,MAAMoZ,MAAM,EACjC,MAGDf,EAAG,+DAA+D,IAAWhjC,OAAA,OAAA,OAAA,GAAA,YAC3EyT,EAAE,0BAA0B0B,IAAI,SAC1B+rB,KAEN,MAAMrxB,QAAc6wB,KACd9pB,EAAO/G,aAAA,EAAAA,EAAO3N,MAAMwa,SAAS,GACnCumB,EAAOrsB,aAAI,EAAJA,EAAM1S,OAAO6V,WAAWgqB,MAAM,EACtC,MAED5I,GAAM,IAAWn7B,OAAA,OAAA,OAAA,GAAA,kBACTsiC,GAAmBjmB,GAC1B,KAAC,IAIJ0mB,EAAS,uBAAuB,KAC9BG,GAAO,IAAWljC,OAAA,OAAA,OAAA,GAAA,kBAChB,MAAM6P,QAAc4xB,GAAmB,YAAa,CAAE,EAAEplB,UAClDxM,aAAK,EAALA,EAAOsG,OAAO,CAAEjS,OAAQ,CAAE+d,OAAQ,CAAE1f,SAAS,YAC7Co/B,GAAoB9xB,EAAO,eAC3BqxB,KACNrxB,SAAAA,EAAO3N,MAAMwa,SAAS,GAAGvG,OAAO,CAAEjS,OAAQ,CAAEymB,KAAM,EAAG5Q,UAAW,KACpD,QAAZwL,EAAA1V,aAAK,EAALA,EAAOuG,aAAK,IAAAmP,GAAAA,EAAErX,QAAO,EACtB,MAED80B,EAAG,qDAAqD,IAAWhjC,OAAA,OAAA,OAAA,GAAA,YACjE,MAAM6P,QAAc6wB,KAEpBjtB,EAAE,+BAA+B2B,QAAQ,eACnC8rB,KAEN+B,EAAOpzB,aAAK,EAALA,EAAO3N,MAAMwa,SAAS,GAAGxY,OAAOymB,MAAMoZ,MAC3Cl0B,aAAA,EAAAA,EAAO3N,MAAMwa,SAAS,GAAGxY,OAAO6V,UAEnC,MAEDohB,GAAM,IAAWn7B,OAAA,OAAA,OAAA,GAAA,kBACTsiC,GAAmBjmB,GAC1B,KAAC,IAKJ0mB,EAAS,wBAAwB,KAE/B,MAAM4I,EAAuBb,GAAe9qC,OAAA,OAAA,OAAA,GAAA,YAC1CyT,EAAE,iBAAiBq3B,kBAAoB11B,QAAQ,eACzCwrB,GAAM,IACd,IAEAsC,GAAO,IAAWljC,OAAA,OAAA,OAAA,GAAA,YAChB4H,KAAKI,SAASpG,IAAIgG,KAAK1D,OAAO2D,GAAI,wBAAwB,SACpDi5B,IACP,MAED8G,GAAU,IAAW5nC,OAAA,OAAA,OAAA,GAAA,kBACbsiC,GAAmBjmB,UACnBykB,IACP,MAEDkC,EAAG,uDAAuD,IAAWhjC,OAAA,OAAA,OAAA,GAAA,wBAEnEijC,EAAoB,QAAb1d,EAAA3d,KAAK+oB,gBAAQ,IAAApL,OAAA,EAAAA,EAAEuO,MAAMiQ,MAAM,GAGlC,MAAMl0B,QAAc4xB,GAAmB,UAAW,CAAE,EAAEplB,UAChDslB,GAAoB9xB,EAAO,gBAC3BqxB,WACArxB,eAAAA,EAAO3N,MAAMwa,SAAS,GAAGvG,OAAO,CACpCjS,OAAQ,CAAE8V,QAAS,CAAEvZ,MAAO,EAAGuB,IAAK,MAEtCihC,EAAOpzB,aAAK,EAALA,EAAO3N,MAAM4xB,MAAMiQ,MAAM,GACpB,QAAZha,EAAAla,aAAK,EAALA,EAAOuG,aAAK,IAAA2T,GAAAA,EAAE7b,QAAO,SACfgzB,WACAyK,EAAc,cAGpB1I,EAAoB,QAAb3L,EAAA1vB,KAAK+oB,gBAAQ,IAAA2G,OAAA,EAAAA,EAAExD,MAAMiQ,MAAM,GAClCd,UAAOpL,EAAAjwB,KAAK+oB,+BAAUjU,SAAS,GAAGpO,SAASq1B,QACzC,+CAEFV,EAAOpzB,aAAK,EAALA,EAAO3N,MAAMwa,SAAS,GAAGxY,OAAO8V,QAAQvZ,OAAOsjC,MAAM,EAC7D,MAEDf,EAAG,4CAA4C,IAAWhjC,OAAA,OAAA,OAAA,GAAA,wBAExDijC,EAAoB,QAAbT,EAAA56B,KAAK+oB,gBAAQ,IAAA6R,OAAA,EAAAA,EAAE1O,MAAMiQ,MAAM,GAGlC,MAAMl0B,QAAc4xB,GAAmB,YAAa,CAAE,EAAEplB,UAClDslB,GAAoB9xB,EAAO,gBAC3BqxB,KACN+B,EAAOpzB,aAAK,EAALA,EAAO3N,MAAM4xB,MAAMiQ,MAAM,GACpB,QAAZrB,EAAA7yB,aAAK,EAALA,EAAOuG,aAAK,IAAAssB,GAAAA,EAAEx0B,QAAO,SACfgzB,WACAyK,EAAc,aAIpB1I,EAAoB,QAAbkG,EAAAvhC,KAAK+oB,gBAAQ,IAAAwY,OAAA,EAAAA,EAAErV,MAAMiQ,MAAM,GAClCd,UAAOmG,EAAAxhC,KAAK+oB,+BAAUjU,SAAS,GAAGpO,SAASq1B,QACzC,8CAEH,MAEDX,EAAG,4CAA4C,IAAWhjC,OAAA,OAAA,OAAA,GAAA,wBAExDijC,EAAoB,QAAboG,EAAAzhC,KAAK+oB,gBAAQ,IAAA0Y,OAAA,EAAAA,EAAEvV,MAAMiQ,MAAM,GAGlC,MAAMl0B,QAAc4xB,GAAmB,YAAa,CAAE,EAAEplB,UAClDxM,aAAK,EAALA,EAAOsG,OAAO,CAAEjS,OAAQ,CAAE+d,OAAQ,CAAE1f,SAAS,YAC7Co/B,GAAoB9xB,EAAO,eAC3BqxB,KACN+B,EAAOpzB,aAAK,EAALA,EAAO3N,MAAM4xB,MAAMiQ,MAAM,GACpB,QAAZuF,EAAAz5B,aAAK,EAALA,EAAOuG,aAAK,IAAAkzB,GAAAA,EAAEp7B,QAAO,SACfgzB,WACAyK,EAAc,UAGpB1I,EAAoB,QAAbsG,EAAA3hC,KAAK+oB,gBAAQ,IAAA4Y,OAAA,EAAAA,EAAEzV,MAAMiQ,MAAM,GAClCd,UAAOuG,EAAA5hC,KAAK+oB,+BAAUjU,SAAS,GAAGpO,SAASq1B,QACzC,gCAEH,MAEDX,EAAG,2CAA2C,IAAWhjC,OAAA,OAAA,OAAA,GAAA,wBAEvDijC,EAAoB,QAAbwG,EAAA7hC,KAAK+oB,gBAAQ,IAAA8Y,OAAA,EAAAA,EAAE3V,MAAMiQ,MAAM,GAGlC,MAAMl0B,QAAc4xB,GAAmB,YAAa,CAAE,EAAEplB,UAClDxM,aAAK,EAALA,EAAOsG,OAAO,CAAEjS,OAAQ,CAAE+d,OAAQ,CAAE1f,SAAS,YAC7Co/B,GAAoB9xB,EAAO,iBAC3BqxB,KACN+B,EAAOpzB,aAAK,EAALA,EAAO3N,MAAM4xB,MAAMiQ,MAAM,SAC1Bl0B,aAAK,EAALA,EAAO3N,MAAMwa,SAAS,GAAGvG,OAAO,CAAEjS,OAAQ,CAAEmJ,KAAM,eAClD6zB,KACN+B,EAAOpzB,eAAAA,EAAO3N,MAAMwa,SAAS,GAAGxY,OAAOmJ,MAAM02B,MAAM,OACvC,QAAZ2F,EAAA75B,aAAK,EAALA,EAAOuG,aAAK,IAAAszB,GAAAA,EAAEx7B,QAAO,SACfgzB,WACAyK,EAAc,aAGpB1I,EAAoB,QAAbiH,EAAAtiC,KAAK+oB,gBAAQ,IAAAuZ,OAAA,EAAAA,EAAEpW,MAAMiQ,MAAM,GAClCd,UAAOkH,EAAAviC,KAAK+oB,+BAAUjU,SAAS,GAAGpO,SAASq1B,QACzC,uCAEH,MAEDX,EAAG,0DAA0D,IAAWhjC,OAAA,OAAA,OAAA,GAAA,sBAEtEijC,EAAoB,QAAbmH,EAAAxiC,KAAK+oB,gBAAQ,IAAAyZ,OAAA,EAAAA,EAAEtW,MAAMiQ,MAAM,GAGlC,MAAMl0B,QAAc4xB,GAAmB,YAAa,CAAE,EAAEplB,UAClDxM,aAAK,EAALA,EAAOsG,OAAO,CAAEjS,OAAQ,CAAE+d,OAAQ,CAAE1f,SAAS,YAC7Co/B,GAAoB9xB,EAAO,eAC3BqxB,KACN+B,EAAOpzB,aAAK,EAALA,EAAO3N,MAAM4xB,MAAMiQ,MAAM,GACpB,QAAZsG,EAAAx6B,aAAK,EAALA,EAAOuG,aAAK,IAAAi0B,GAAAA,EAAEn8B,QAAO,SACfgzB,WACAyK,EAAc,aAGpB1I,EAAoB,QAAbqH,EAAA1iC,KAAK+oB,gBAAQ,IAAA2Z,OAAA,EAAAA,EAAExW,MAAMiQ,MAAM,EACnC,MAED5I,GAAM,IAAWn7B,OAAA,OAAA,OAAA,GAAA,kBACTsiC,GAAmBjmB,UACnBykB,IACP,KAAC,IAIJiC,EAAS,oBAAoB,KAC3B,MAAM5W,EAAQ,CAAC,QAAS,OAAQ,YAAa,SAAU,SAEjDyf,EAAmBtxB,GAAgBta,OAAA,OAAA,OAAA,GAAA,YACvCyT,EAAE,gBAAgB6G,QAAWlF,QAAQ,eAC/BwrB,GAAM,IACd,IAEAmC,EAAS,sBAAsB,KAC7BG,GAAO,IAAWljC,OAAA,OAAA,OAAA,GAAA,kBAChB,MAAM6P,QAAc4xB,GAAmB,YAAa,CAAE,EAAEplB,kBAClDkJ,EAAA1V,aAAA,EAAAA,EAAOuG,4BAAOlI,QAAO,GAC3BtG,KAAKI,SAASpG,IAAIgG,KAAK1D,OAAO2D,GAAI,wBAAwB,SACpDi5B,WACAF,GAAM,IACb,MAEDzU,EAAMlV,SAASqD,IACb0oB,EAAG,GAAG1oB,UAAa,IAAWta,OAAA,OAAA,OAAA,GAAA,4BACtB8gC,WACAF,GAAM,KACZqC,EAAoB,QAAb1d,EAAA3d,KAAK+oB,gBAAQ,IAAApL,OAAA,EAAAA,EAAEuO,MAAMiQ,MAAM,SAC5B6H,EAAUtxB,GAChB2oB,EAAoB,QAAblZ,EAAAniB,KAAK+oB,gBAAQ,IAAA5G,OAAA,EAAAA,EAAE+J,MAAMiQ,MAAM,GAClCd,EAAsB,UAAfr7B,KAAK+oB,gBAAU,IAAA2G,OAAA,EAAAA,EAAA5a,SAAS,GAAGpO,SAASq1B,QACzC/7B,KAAKuI,KAAKC,OAAO,gBAAiB,CAChCkK,KAAM1S,KAAKuI,KAAKuB,SAAS,aAAa4I,YAG3C,KAAC,IAGJ6gB,GAAM,IAAWn7B,OAAA,OAAA,OAAA,GAAA,kBACTsiC,GAAmBjmB,UACnBykB,WACAF,GAAM,IACb,KAAC,IAGJmC,EAAS,oBAAoB,KAC3BG,GAAO,IAAWljC,OAAA,OAAA,OAAA,GAAA,kBAChB,MAAM6P,QAAc4xB,GAAmB,UAAW,CAAE,EAAEplB,kBAChDkJ,EAAA1V,aAAA,EAAAA,EAAOuG,4BAAOlI,QAAO,EAC5B,MAEDie,EAAMlV,SAASqD,IACb0oB,EAAG,GAAG1oB,UAAa,IAAWta,OAAA,OAAA,OAAA,GAAA,4BACtB8gC,WACAF,GAAM,KACZqC,EAAoB,QAAb1d,EAAA3d,KAAK+oB,gBAAQ,IAAApL,OAAA,EAAAA,EAAEuO,MAAMiQ,MAAM,SAC5B6H,EAAUtxB,GAChB2oB,EAAoB,QAAblZ,EAAAniB,KAAK+oB,gBAAQ,IAAA5G,OAAA,EAAAA,EAAE+J,MAAMiQ,MAAM,GAClCd,EAAsB,UAAfr7B,KAAK+oB,gBAAU,IAAA2G,OAAA,EAAAA,EAAA5a,SAAS,GAAGpO,SAASq1B,QACzC/7B,KAAKuI,KAAKC,OAAO,gBAAiB,CAChCkK,KAAM1S,KAAKuI,KAAKuB,SAAS,aAAa4I,YAG3C,KAAC,IAGJ6gB,GAAM,IAAWn7B,OAAA,OAAA,OAAA,GAAA,kBACTsiC,GAAmBjmB,UACnBykB,WACAF,GAAM,IACb,KAAC,GACF,IAIJmC,EAAS,sBAAsB,KAO7BG,GAAO,IAAWljC,OAAA,OAAA,OAAA,GAAA,kBAChB4H,KAAKI,SAASpG,IAAIgG,KAAK1D,OAAO2D,GAAI,wBAAwB,GAC1D,MAAMgI,QAAc4xB,GAAmB,YAAa,CAAE,EAAEplB,IAC5C,QAAZkJ,EAAA1V,aAAK,EAALA,EAAOuG,aAAK,IAAAmP,GAAAA,EAAErX,QAAO,SACf4yB,IACP,MAXyB,CAAC,QAAS,WAalB7pB,SAAS40B,IACzB7I,EAAG,mBAAmB6I,KAAe,IAAW7rC,OAAA,OAAA,OAAA,GAAA,sBAC9C,MAAM6P,QAAc6wB,KAdJ,IAAOlmB,EAevByoB,EAAoB,QAAb1d,EAAA3d,KAAK+oB,gBAAQ,IAAApL,OAAA,EAAAA,EAAEuO,MAAMiQ,MAAM,SAfXvpB,EAgBLqxB,EAhBuB7rC,OAAA,OAAA,OAAA,GAAA,YAC3CyT,EAAE,kBAAkB+G,QAAapF,QAAQ,eACnCwrB,GAAM,IACd,KAcIqC,EAAoB,QAAblZ,EAAAniB,KAAK+oB,gBAAQ,IAAA5G,OAAA,EAAAA,EAAE+J,MAAMiQ,MAAM,GAClCd,UAAO3L,EAAA1vB,KAAK+oB,+BAAUjU,SAAS,GAAGpO,SAASq1B,QACzC/7B,KAAKuI,KAAKC,OAAO,mBAAoB,CAAEuC,KAAM9C,aAAK,EAALA,EAAO8C,cAEhDmuB,IACP,KAAC,IAGJ3F,GAAM,IAAWn7B,OAAA,OAAA,OAAA,GAAA,kBACTsiC,GAAmBjmB,GAC1B,KAAC,IAMJ,MAcMyvB,EAA8B,CAClCC,EACA7pC,iBAEA+gC,EAAO/gC,EAAMyY,OAAO/D,MAAM0sB,IAAIxc,UAC9Bmc,EAA0B,QAAnB1d,EAAArjB,EAAMyY,OAAO/D,YAAM,IAAA2O,OAAA,EAAAA,EAAAkb,cAAcsD,MAAM,QAC9Cd,EAA0B,QAAnBlZ,EAAA7nB,EAAMyY,OAAO/D,YAAM,IAAAmT,OAAA,EAAAA,EAAApX,MAAMoxB,MAAMgI,GAGtC9I,EAAwB,QAAjB3L,EAAAp1B,EAAMyY,OAAO/D,YAAI,IAAA0gB,OAAA,EAAAA,EAAEpzB,OAAOmV,aAAa0qB,MAAM,IACpDd,EAA0B,QAAnBpL,EAAA31B,EAAM8M,OAAO4H,YAAM,IAAAihB,OAAA,EAAAA,EAAA3zB,OAAOqV,QAAQ9I,QAAQszB,MAAM,EAAE,EAGrDiI,EAA+B,CACnCC,EACA/pC,2BAGA+gC,EAA0B,QAAnB1d,EAAArjB,EAAM8M,OAAO4H,YAAM,IAAA2O,OAAA,EAAAA,EAAArhB,OAAOqV,QAAQ9I,QAAQszB,MAAM,GACvDd,EAAwB,QAAjBlZ,EAAA7nB,EAAM8M,OAAO4H,YAAI,IAAAmT,OAAA,EAAAA,EAAE7lB,OAAOqV,SAASoqB,QAAyB,QAAjBrM,EAAAp1B,EAAMyY,OAAO/D,YAAI,IAAA0gB,OAAA,EAAAA,EAAEzvB,IACrEo7B,EAAwB,QAAjBpL,EAAA31B,EAAMyY,OAAO/D,YAAI,IAAAihB,OAAA,EAAAA,EAAE3zB,OAAOmV,aAAa0qB,MAAuB,QAAjBvB,EAAAtgC,EAAM8M,OAAO4H,YAAI,IAAA4rB,OAAA,EAAAA,EAAE36B,IAGvE,MAAMy8B,EACwB,WAAX,QAAjB5B,EAAAxgC,EAAMyY,OAAO/D,YAAI,IAAA8rB,OAAA,EAAAA,EAAE/+B,gBACfzB,EAAMyY,OAAO/D,2BAAMjT,KACnB,GAAoB,QAAjBylC,EAAAlnC,EAAMyY,OAAO/D,YAAI,IAAAwyB,OAAA,EAAAA,EAAEzlC,QACtB0wB,EAAoB,eAAXiQ,EAA0B,EAAI,EAC7CrB,UAAOoG,EAAA4C,EAAUp8B,4BAAO3L,OAAOogC,GAAQ7zB,QAAQszB,MAAM1P,EAAO,EAI9D0O,EAAS,qCAAqC,KAI5CJ,GAAU1rB,SAAS8W,IAEjB,GAAiB,UAAbA,EAAsB,OAC1B,GAAiB,YAAbA,EAAwB,OAE5B,MAAMke,EAAgC,CAAA,EAChC/pC,EAAwB,CAC5ByY,OAAQ,CAAmB,EAC3B3L,OAAQ,CAAmB,GAG7Bk0B,GAAO,IAAWljC,OAAA,OAAA,OAAA,GAAA,YAChBisC,EAAUp8B,YAAc4xB,GAAmB,YAAa,CAAA,EAAIplB,KAG3Dna,EAAM8M,OAAO4H,YAAc+qB,GAC1BsK,EAAUp8B,MACV,YACA,kBAEH,MAEDmzB,EAAG,OAAOjV,kBAAyB,IAAW/tB,OAAA,OAAA,OAAA,GAAA,oBAxEpB,EAC5BisC,EACA/pC,eAGA+gC,EAAOgJ,EAAUp8B,OAAOyzB,IAAIxc,UAC5Bmc,EAAsB,QAAf1d,EAAA0mB,EAAUp8B,aAAK,IAAA0V,OAAA,EAAAA,EAAEkb,cAAcsD,MAAM,SAG5Cd,EAAO/gC,EAAM8M,OAAO4H,MAAM0sB,IAAIxc,UAC9Bmc,EAA0B,QAAnBlZ,EAAA7nB,EAAM8M,OAAO4H,YAAM,IAAAmT,OAAA,EAAAA,EAAA0W,cAAcsD,MAAM,QAC9Cd,EAA0B,QAAnB3L,EAAAp1B,EAAM8M,OAAO4H,YAAM,IAAA0gB,OAAA,EAAAA,EAAA3kB,MAAMoxB,MAAM,kBAAkB,EA8DpDmI,CAAsBD,EAAW/pC,IAGhCA,EAAMyY,OAAO/D,YAAc+qB,GAC1BsK,EAAUp8B,MACVke,GAIF,MAAMge,EAAiB,kBAAkBhe,EAASjP,eAClDgtB,EAA4BC,EAAgB7pC,SAId,QAAxB6nB,EAAiB,QAAjBxE,EAAA0mB,EAAUp8B,aAAO,IAAA0V,OAAA,EAAAA,EAAAnP,aAAO,IAAA2T,OAAA,EAAAA,EAAAxM,oBAC5Brb,EAAMyY,OAAO/D,KACb1U,EAAM8M,OAAO4H,MAIfo1B,EAA6BC,EAAW/pC,EACzC,MAEDi5B,GAAM,IAAWn7B,OAAA,OAAA,OAAA,GAAA,kBACTsiC,GAAmBjmB,GAC1B,KAAC,GACF,IAIJ0mB,EAAS,2CAA2C,KAIlDJ,GAAU1rB,SAAS8W,IAEjB,GAAiB,UAAbA,EAAsB,OAC1B,GAAiB,YAAbA,EAAwB,OAE5B,MAAMke,EAAgC,CAAA,EAChC/pC,EAAwB,CAC5ByY,OAAQ,CAAmB,EAC3B3L,OAAQ,CAAmB,GAG7Bk0B,GAAO,IAAWljC,OAAA,OAAA,OAAA,GAAA,oBAChBisC,EAAUp8B,YAAc4xB,GAAmB,YAAa,CAAA,EAAIplB,KAG3Dna,EAAM8M,OAAO4H,YAAc+qB,GAC1BsK,EAAUp8B,MACV,YACA,oBAID3N,EAAMyY,OAAO/D,YAAc+qB,GAC1BsK,EAAUp8B,MACVke,SAK4B,QAAxBhE,EAAiB,QAAjBxE,EAAA0mB,EAAUp8B,aAAO,IAAA0V,OAAA,EAAAA,EAAAnP,aAAO,IAAA2T,OAAA,EAAAA,EAAAxM,oBAC5Brb,EAAMyY,OAAO/D,KACb1U,EAAM8M,OAAO4H,KAEhB,MAEDosB,EAAG,UAAUjV,oBAA2B,IAAW/tB,OAAA,OAAA,OAAA,GAAA,oBAEjDgsC,EAA6BC,EAAW/pC,SAIV,QAAxB21B,EAAiB,QAAjBP,EAAA2U,EAAUp8B,aAAO,IAAAynB,OAAA,EAAAA,EAAAlhB,aAAO,IAAAyhB,OAAA,EAAAA,EAAAva,uBAC5Bpb,EAAMyY,OAAO/D,KACb1U,EAAM8M,OAAO4H,MAIf,MAAMm1B,EAAiB,kBAAkBhe,EAASjP,eAClDgtB,EAA4BC,EAAgB7pC,EAC7C,MAEDi5B,GAAM,IAAWn7B,OAAA,OAAA,OAAA,GAAA,kBACTsiC,GAAmBjmB,GAC1B,KAAC,GACF,IAIJ0mB,EAAS,mDAAmD,KAI1DJ,GAAU1rB,SAAS8W,IAEjB,GAAiB,UAAbA,EAAsB,OAC1B,GAAiB,YAAbA,EAAwB,OAE5B,MAAMke,EAAgC,CAAA,EAChC/pC,EAAwB,CAC5ByY,OAAQ,CAAmB,EAC3B3L,OAAQ,CAAmB,GAG7Bk0B,GAAO,IAAWljC,OAAA,OAAA,OAAA,GAAA,YAChBisC,EAAUp8B,YAAc4xB,GAAmB,YAAa,CAAA,EAAIplB,GAC7D,MAED2mB,EAAG,iBAAiBjV,cAAqB,IAAW/tB,OAAA,OAAA,OAAA,GAAA,sBAElDkC,EAAMyY,OAAO/D,WAAc8qB,GAAoB3T,GAC/C,MAAMge,EAAiB7pC,EAAMyY,OAAO/D,KAAKjE,MAAQ,aAGnB,UAAT,QAAf4S,EAAA0mB,EAAUp8B,aAAK,IAAA0V,OAAA,EAAAA,EAAEnP,aAAO,IAAA2T,OAAA,EAAAA,EAAAlN,kBAAkB,CAAC3a,EAAMyY,OAAO/D,OAG9D1U,EAAMyY,OAAO/D,KAAsB,UAAfq1B,EAAUp8B,aAAK,IAAAynB,OAAA,EAAAA,EAAEp1B,MAAMggC,QACzC6J,GAGF9I,EAAO/gC,EAAMyY,OAAO/D,MAAM0sB,IAAIxc,SAC/B,MAEDqU,GAAM,IAAWn7B,OAAA,OAAA,OAAA,GAAA,kBACTsiC,GAAmBjmB,GAC1B,KAAC,GACF,IAGJ0mB,EAAS,4BAA4B,KACnC,MAAMoJ,EAAiB,CAAC,SAAU,QAAS,SAAU,QAErDnJ,EAAG,8BAA8B,IAAWhjC,OAAA,OAAA,OAAA,GAAA,kBAC1C,MAAM6P,QAAc4xB,GAAmB,UAAW,CAAE,EAAEplB,IAE1C,QAAZkJ,EAAA1V,aAAA,EAAAA,EAAOuG,aAAK,IAAAmP,GAAAA,EAAEvG,wBACRkiB,KAEN,MAAMkL,EAAU9K,KAChB2B,EAAOmJ,EAAQ37B,QAAQszB,MAAM,GAE7BoI,EAAel1B,SAASiM,IACtB+f,EAAOmJ,EAAQ,GAAG5/B,KAAK8B,SAASq1B,QAAQ,kBAAkBzgB,KAAU,UAEhEkpB,EAAQ,GAAGl6B,OAClB,MAED8wB,EAAG,4BAA4B,IAAWhjC,OAAA,OAAA,OAAA,GAAA,kBACxC,MAAMqsC,EAAgB,CAAC,OAAQ,QAAS,SAClCx8B,QAAe4xB,GAAmB,UAAW,CAAE,EAAEplB,IAE3C,QAAZ0N,EAAAla,aAAK,EAALA,EAAOuG,aAAK,IAAA2T,GAAAA,EAAE/K,gBAAgBqtB,SACxBnL,KAEN,MAAMkL,EAAU9K,KAChB2B,EAAOmJ,EAAQ37B,QAAQszB,MAAM,GAE7BsI,EAAcp1B,SAASiM,IACrB+f,EAAOmJ,EAAQ,GAAG5/B,KAAK8B,SAASq1B,QAAQ,kBAAkBzgB,KAAU,UAEhEkpB,EAAQ,GAAGl6B,OAClB,MAED01B,GAAU,IAAW5nC,OAAA,OAAA,OAAA,GAAA,kBACbuhC,WACAe,GAAmBjmB,GAC1B,KAAC,IAIJ0mB,EAAS,sBAAsB,KAC7BJ,GAAU1rB,SAAS8W,IACjBiV,EAAG,cAAcjV,KAAY,IAAW/tB,OAAA,OAAA,OAAA,GAAA,kBACtC,MAAM6P,QAAc4xB,GAAmB,YAAa,CAAE,EAAEplB,UAClDxM,aAAK,EAALA,EAAOsG,OAAO,CAAEjS,OAAQ,CAAE+d,OAAQ,CAAE1f,SAAS,oBAC7CgjB,EAAA1V,aAAA,EAAAA,EAAOuG,4BAAOlI,QAAO,SACrB0yB,GAAM,KACZqC,EAAOpzB,aAAK,EAALA,EAAO3N,MAAM4xB,MAAMiQ,MAAM,GAEhCtwB,EAAE,kCAAkCsa,OAAc3Y,QAAQ,eACpD8rB,KAEN+B,EAAOpzB,aAAK,EAALA,EAAO3N,MAAM4xB,MAAMiQ,MAAM,EACjC,KAAC,IAGJ6D,GAAU,IAAW5nC,OAAA,OAAA,OAAA,GAAA,kBACbsiC,GAAmBjmB,GAC1B,KAAC,IAIJ0mB,EAAS,8BAA8B,KACrC,MAAMuJ,EAAiB,CAACjyB,EAA2BkyB,KACjDlyB,EAAQ5Z,MAAQ+rC,OAAO5yB,SAASS,EAAQ5Z,MAAO,IAAM8rC,GACrD,MAAM53B,EAAQ,IAAI83B,WAAW,UAC7BpyB,EAAQqyB,cAAc/3B,EAAM,EAG9BquB,EAAG,2BAA2B,IAAWhjC,OAAA,OAAA,OAAA,GAAA,kBACvC,MAAM6P,QAAc4xB,GAAmB,YAAa,CAAE,EAAEplB,IAC5C,QAAZkJ,EAAA1V,aAAK,EAALA,EAAOuG,aAAK,IAAAmP,GAAAA,EAAErX,QAAO,GACrB,MAAO0I,SAAe+qB,GACpB9xB,EACA,QAEF+G,EAAKT,OAAO,CAAEjS,OAAQ,CAAEE,SAAU,CAAE3D,MAAO,EAAGuB,IAAK,YAC7Ck/B,KAEN,MAAMyL,EAAkBlpB,SAAS5R,cAC/B,8BAA8B+E,EAAK/O,kCAGrCo7B,EAAOrsB,EAAK1S,OAAOE,SAAS3D,OAAOsjC,MAAM,GACzCuI,EAAeK,EAAiB,SAC1BzL,KACN+B,EAAOrsB,EAAK1S,OAAOE,SAAS3D,OAAOsjC,MAAM,EAC1C,MAEDf,EAAG,kCAAkC,IAAWhjC,OAAA,OAAA,OAAA,GAAA,kBAC9C,MAAM6P,QAAc4xB,GAAmB,YAAa,CAAE,EAAEplB,IAC5C,QAAZ0N,EAAAla,aAAK,EAALA,EAAOuG,aAAK,IAAA2T,GAAAA,EAAE7b,QAAO,GACrB,MAAO0I,SAAe+qB,GACpB9xB,EACA,QAEF+G,EAAKT,OAAO,CAAEjS,OAAQ,CAAEE,SAAU,CAAE3D,MAAO,EAAGuB,IAAK,YAC7Ck/B,KAEN,MAAMyL,EAAkBlpB,SAAS5R,cAC/B,8BAA8B+E,EAAK/O,kCAGrCo7B,EAAOrsB,EAAK1S,OAAOE,SAAS3D,OAAOsjC,MAAM,GACzCuI,EAAeK,GAAkB,SAC3BzL,KACN+B,EAAOrsB,EAAK1S,OAAOE,SAAS3D,OAAOsjC,MAAM,EAC1C,MAED6D,GAAU,IAAW5nC,OAAA,OAAA,OAAA,GAAA,kBACbsiC,GAAmBjmB,GAC1B,KAAC,IAIJ0mB,EAAS,yBAAyB,SAElCA,EAAS,oBAAoB,SAG7BA,EAAS,4BAA4B,KACnC,CAAC,YAAa,WAAW9rB,SAASgc,IAChC+P,EAAG,6BAA6B/P,KAAa,IAAWjzB,OAAA,OAAA,OAAA,GAAA,kBACtD,MAAM6P,QAAc4xB,GAAmB,YAAa,CAAE,EAAEplB,kBAClDkJ,EAAA1V,aAAA,EAAAA,EAAOuG,4BAAOlI,QAAO,SACrB0yB,GAAM,KAEZntB,EAAE,oBAAoB2B,QAAQ,eACxBwrB,GAAM,KAEZ,MAAMS,EAAUF,GAAY,gBAC5B8B,EAAO5B,EAAQ5wB,QAAQszB,MAAM,GAC7B1C,EAAQ,GAAGnvB,OACZ,KAAC,IAGJ01B,GAAU,IAAW5nC,OAAA,OAAA,OAAA,GAAA,kBACbsiC,GAAmBjmB,GAC1B,KAAC,IAIJ0mB,EAAS,uBAAuB,QAAS,ECjsCpC,MAAM1mB,GAAM,gCACN5Y,GAAU,CACrBm/B,YAAa,oCACbkF,aAAa,GAkCT8E,GAA0B1qC,GAAyBlC,OAAA,OAAA,OAAA,GAAA,oBACvD,MAAM6sC,EAAqB,IAAIC,UAAU,YAAa,CACpD7wB,aAAc,IAAI8wB,aAClBC,SAAS,EACTC,YAAY,YAEd1nB,EAAArjB,EAAMyY,OAAOuyB,4BAAaR,cAAcG,GAExC,MAAMM,EAAgB,IAAIL,UAAU,OAAQ,CAC1C7wB,aAAc4wB,EAAmB5wB,aACjC+wB,SAAS,EACTC,YAAY,YAEdljB,EAAA7nB,EAAM8M,OAAOk+B,4BAAaR,cAAcS,EAC1C,IAEA,IAAAC,GAAe,EACbrK,WACAC,KACAC,SACA9H,QACAyM,YACAyF,iBAEAtK,EAAS,uBAAuB,KAC9BC,EAAG,oCAAoC,IAAWhjC,OAAA,OAAA,OAAA,GAAA,kBAChD,MAAM6P,QAAe4xB,GACnB,YACA,CAAE,EACFplB,IAEF4mB,EAAOpzB,GAAOyzB,IAAIxc,gBAEC,QAAbvB,EAAA1V,EAAMuG,aAAO,IAAAmP,OAAA,EAAAA,EAAArX,QAAO,GAE1B,MAAO0I,SAAc+qB,GAAoB9xB,EAAO,UAChDozB,EAAOrsB,GAAM0sB,IAAIxc,gBACXoa,KAEN,MAAMgM,EAAczpB,SAAS5R,cAC3B,2CAA2C+E,eAAAA,EAAM/O,QAEnDo7B,EAAOiK,GAAa5J,IAAI2G,KAExB,MAAMt1B,EAtDQ,CAAC24B,IACnB,MAAMT,EAAqB,IAAIC,UAAU,YAAa,CACpD7wB,aAAc,IAAI8wB,aAClBC,SAAS,EACTC,YAAY,IAGd,OADAK,SAAAA,EAAeZ,cAAcG,GACtBA,CAAkB,EA+CPU,CAAYL,GACpBM,EAAa3qB,WAAW4qB,iBAAiB94B,GAC/CsuB,EAAO3/B,OAAO4mB,KAAKsjB,IAAa7J,QAAQ,OACzC,MAEDxI,GAAM,IAAWn7B,OAAA,OAAA,OAAA,GAAA,kBACTsiC,GAAmBjmB,GAC1B,KAAC,IAIJ0mB,EAAS,4BAA4B,SAErCA,EAAS,iEAAiE,KAKxE,MAqBMmJ,EAAwB,CAC5BD,EACA/pC,mBAGA+gC,EAAOgJ,EAAUp8B,OAAOyzB,IAAIxc,UAC5Bmc,EAAsB,QAAf1d,EAAA0mB,EAAUp8B,aAAK,IAAA0V,OAAA,EAAAA,EAAEkb,cAAcsD,MAAM,SAG5Cd,EAAOgJ,EAAUyB,YAAYpK,IAAIxc,UACjCmc,EAA2B,QAApBlZ,EAAAkiB,EAAUyB,kBAAU,IAAA3jB,OAAA,EAAAA,EAAE0W,cAAcsD,MAAM,QAGjDd,EAAO/gC,EAAM8M,OAAO4H,MAAM0sB,IAAIxc,UAC9Bmc,EAA0B,QAAnB3L,EAAAp1B,EAAM8M,OAAO4H,YAAM,IAAA0gB,OAAA,EAAAA,EAAAmJ,cAAcsD,MAAM,QAC9Cd,EAA0B,QAAnBpL,EAAA31B,EAAM8M,OAAO4H,YAAM,IAAAihB,OAAA,EAAAA,EAAAllB,MAAMoxB,MAAM,mBAGtCd,EAAO/gC,EAAM8M,OAAOk+B,aAAa5J,IAAI2G,KACrChH,EAA+B,QAAxBT,EAAAtgC,EAAM8M,OAAOk+B,mBAAW,IAAA1K,OAAA,EAAAA,EAAE1gC,YAAY6Q,MAAMoxB,MAAM,gBAAgB,EAGrE+H,EAA8B,CAClCC,EACA7pC,mBAEA+gC,EAAO/gC,EAAMyY,OAAO/D,MAAM0sB,IAAIxc,UAC9Bmc,EAA0B,QAAnB1d,EAAArjB,EAAMyY,OAAO/D,YAAM,IAAA2O,OAAA,EAAAA,EAAAkb,cAAcsD,MAAM,QAC9Cd,EAA0B,QAAnBlZ,EAAA7nB,EAAMyY,OAAO/D,YAAM,IAAAmT,OAAA,EAAAA,EAAApX,MAAMoxB,MAAMgI,GAEtC9I,EAAO/gC,EAAMyY,OAAOuyB,aAAa5J,IAAI2G,KACrChH,EAA+B,QAAxB3L,EAAAp1B,EAAMyY,OAAOuyB,mBAAW,IAAA5V,OAAA,EAAAA,EAAEx1B,YAAY6Q,MAAMoxB,MAAM,iBAGzDd,EAAwB,QAAjBpL,EAAA31B,EAAMyY,OAAO/D,YAAI,IAAAihB,OAAA,EAAAA,EAAE3zB,OAAOmV,aAAa0qB,MAAM,IACpDd,EAA0B,QAAnBT,EAAAtgC,EAAM8M,OAAO4H,YAAM,IAAA4rB,OAAA,EAAAA,EAAAt+B,OAAOqV,QAAQ9I,QAAQszB,MAAM,EAAE,EAGrDiI,EAA+B,CACnCC,EACA/pC,2BAGA+gC,EAA0B,QAAnB1d,EAAArjB,EAAM8M,OAAO4H,YAAM,IAAA2O,OAAA,EAAAA,EAAArhB,OAAOqV,QAAQ9I,QAAQszB,MAAM,GACvDd,EAAwB,QAAjBlZ,EAAA7nB,EAAM8M,OAAO4H,YAAI,IAAAmT,OAAA,EAAAA,EAAE7lB,OAAOqV,SAASoqB,QAAyB,QAAjBrM,EAAAp1B,EAAMyY,OAAO/D,YAAI,IAAA0gB,OAAA,EAAAA,EAAEzvB,IACrEo7B,EAAwB,QAAjBpL,EAAA31B,EAAMyY,OAAO/D,YAAI,IAAAihB,OAAA,EAAAA,EAAE3zB,OAAOmV,aAAa0qB,MAC3B,QAAjBvB,EAAAtgC,EAAM8M,OAAO4H,YAAI,IAAA4rB,OAAA,EAAAA,EAAE36B,IAIrB,MAAMy8B,EACwB,WAAX,QAAjB5B,EAAAxgC,EAAMyY,OAAO/D,YAAI,IAAA8rB,OAAA,EAAAA,EAAE/+B,gBACfzB,EAAMyY,OAAO/D,2BAAMjT,KACnB,GAAoB,QAAjBylC,EAAAlnC,EAAMyY,OAAO/D,YAAI,IAAAwyB,OAAA,EAAAA,EAAEzlC,QACtB0wB,EAAoB,eAAXiQ,EAA0B,EAAI,EAC7CrB,UAAOoG,EAAA4C,EAAUp8B,4BAAO3L,OAAOogC,GAAQ7zB,QAAQszB,MAAM1P,EAAO,EAO9D2O,EAAG,iFAAiF,IAAWhjC,OAAA,OAAA,OAAA,GAAA,wCAC7F,MAAMkC,EAAwB,CAC5ByY,OAAQ,CAAmB,EAC3B3L,OAAQ,CAAmB,GAIvBa,QAAc4xB,GAAmB,YAAa,CAAE,EAAEplB,KACvDna,EAAM8M,OAAO4H,YAAc+qB,GAC1B9xB,EACA,YACA,oBAED3N,EAAMyY,OAAO/D,YAAc+qB,GAAoB9xB,EAAO,UAG3C,QAAZka,EAAAla,aAAK,EAALA,EAAOuG,aAAK,IAAA2T,GAAAA,EAAE7b,QAAO,SACfgzB,KAGNh/B,EAAMyY,OAAOuyB,YAAczpB,SAAS5R,cAClC,2CAA+D,UAAR,QAAZylB,EAAAp1B,EAAMyY,cAAM,IAAA2c,OAAA,EAAAA,EAAE1gB,YAAM,IAAAihB,OAAA,EAAAA,EAAAhwB,QAEjE3F,EAAM8M,OAAOk+B,YAAczpB,SAAS5R,cAClC,2CAA+D,UAAR,QAAZ2wB,EAAAtgC,EAAM8M,cAAM,IAAAwzB,OAAA,EAAAA,EAAE5rB,YAAM,IAAA8rB,OAAA,EAAAA,EAAA76B,QAIjEikC,EAA4B,wBAAyB5pC,SAC/C0qC,GAAiB1qC,SACjBg/B,KAGN+B,EAA0B,QAAnBkG,EAAAjnC,EAAM8M,OAAO4H,YAAM,IAAAuyB,OAAA,EAAAA,EAAAjlC,OAAOqV,QAAQ9I,QAAQszB,MAAM,GACvDd,EAAwB,QAAjBmG,EAAAlnC,EAAM8M,OAAO4H,YAAI,IAAAwyB,OAAA,EAAAA,EAAEllC,OAAOqV,SAASoqB,QAAyB,QAAjB0F,EAAAnnC,EAAMyY,OAAO/D,YAAI,IAAAyyB,OAAA,EAAAA,EAAExhC,IACrEo7B,EAAwB,QAAjBqG,EAAApnC,EAAMyY,OAAO/D,YAAI,IAAA0yB,OAAA,EAAAA,EAAEplC,OAAOmV,aAAa0qB,MAC3B,QAAjBwF,EAAArnC,EAAM8M,OAAO4H,YAAI,IAAA2yB,OAAA,EAAAA,EAAE1hC,IAIrB3F,EAAMyY,OAAOuyB,YAAchrC,EAAM8M,OAAOk+B,YACxChrC,EAAMyY,OAAO/D,KAAO1U,EAAM8M,OAAO4H,WAG3Bg2B,GAAiB1qC,SACjBg/B,KAGN,MAAMyM,EAAelqB,SAAS5R,cAC5B,mDAA2C43B,EAAc,QAAdD,EAAAtnC,EAAM8M,cAAQ,IAAAw6B,OAAA,EAAAA,EAAA5yB,2BAAM/O,QAEjEo7B,EAAO0K,GAAcrK,IAAI2G,IAC1B,MAKDtH,GAAU1rB,SAAS8W,IAEjB,GAAiB,UAAbA,EAAsB,OAC1B,GAAiB,YAAbA,EAAwB,OAG5B,MAAMke,EAAgC,CAAA,EAChC/pC,EAAwB,CAC5ByY,OAAQ,CAAmB,EAC3B3L,OAAQ,CAAmB,GAG7B+zB,EAAS,gBAAgBhV,eAAsB,KAC7Csf,GAAW,IAAWrtC,OAAA,OAAA,OAAA,GAAA,wBAEpBisC,EAAUp8B,YAAc4xB,GAAmB,YAAa,CAAA,EAAIplB,IAC5D4vB,EAAUyB,gBA5Ja,CAC3B/pC,GAEE3D,OAAA,OAAA,OAAA,GAAA,YAEF,OAAA4tC,qBAAqBC,iBAAiB,CACpCpiC,MAAO,kBACPkH,KAAM,iBACNhP,OACAmqC,KAAM,GACNC,SAAS,EACTC,QAAS,aAiJsBC,CAAqB,SAGjD/rC,EAAM8M,OAAO4H,YAAc+qB,GAC1BsK,EAAUp8B,MACV,YACA,mBAIoB,QAAtBka,EAAe,QAAfxE,EAAA0mB,EAAUp8B,aAAK,IAAA0V,OAAA,EAAAA,EAAEnP,aAAK,IAAA2T,GAAAA,EAAE7b,QAAO,GACX,QAApBopB,EAAA2U,EAAUyB,kBAAU,IAAApW,GAAAA,EAAEppB,QAAO,SACvBgzB,KAGNh/B,EAAM8M,OAAOk+B,YAAczpB,SAAS5R,cAClC,qDAA2C3P,EAAM8M,OAAO4H,2BAAM/O,OAEjE,MAEDm7B,EAAG,QAAQjV,4DAAmE,IAAW/tB,OAAA,OAAA,OAAA,GAAA,kBACvFksC,EAAsBD,EAAW/pC,IAGhCA,EAAMyY,OAAO/D,YAAc+qB,GAC1BsK,EAAUp8B,MACVke,SAIImT,KAGNh/B,EAAMyY,OAAOuyB,YAAczpB,SAAS5R,cAClC,qDAA2C3P,EAAMyY,OAAO/D,2BAAM/O,QAIhE,MAAMkkC,EAAiB,kBAAkBhe,EAASjP,eAClDgtB,EAA4BC,EAAgB7pC,SAGtC0qC,GAAiB1qC,SACjBg/B,KAGN8K,EAA6BC,EAAW/pC,EACzC,MAED8gC,EAAG,QAAQjV,6DAAoE,IAAW/tB,OAAA,OAAA,OAAA,GAAA,sBACxFksC,EAAsBD,EAAW/pC,GAGjCA,EAAMyY,OAAO/D,WAAc8qB,GAAoB3T,SAGzCmT,KAGNh/B,EAAMyY,OAAOuyB,YAAczpB,SAAS5R,cAClC,sEAA4D3P,EAAMyY,OAAO/D,2BAAM/O,QAIjF,MAAMkkC,EAAiB,kBAAkBhe,EAASjP,eAClDgtB,EAA4BC,EAAgB7pC,SAGtC0qC,GAAiB1qC,SACjBg/B,KAGNh/B,EAAMyY,OAAO/D,KAAwB,QAAjBuyB,EAAA8C,EAAUp8B,aAAO,IAAAs5B,OAAA,EAAAA,EAAAjnC,MAAMggC,QACxB,QAAjBkH,EAAAlnC,EAAMyY,OAAO/D,YAAI,IAAAwyB,OAAA,EAAAA,EAAEz2B,MAIrBq5B,EAA6BC,EAAW/pC,EACzC,MAED8gC,EAAG,QAAQjV,2DAAkE,IAAW/tB,OAAA,OAAA,OAAA,GAAA,wBACtFksC,EAAsBD,EAAW/pC,GAGjC,MAAMgsC,QAAmBxM,GAAoB3T,GAC7C7rB,EAAMyY,OAAO/D,WAAmC,QAAtByyB,EAAA4C,EAAUyB,kBAAY,IAAArE,OAAA,EAAAA,EAAA8E,eAC9CD,SAIIhN,KAGNh/B,EAAMyY,OAAOuyB,YAAczpB,SAAS5R,cAClC,mDAAyC3P,EAAMyY,OAAO/D,2BAAM/O,QAI9D,MAAMkkC,EAAiB,kBAAkBhe,EAASjP,eAClDgtB,EAA4BC,EAAgB7pC,SAGtC0qC,GAAiB1qC,SACjBg/B,KAGNh/B,EAAMyY,OAAO/D,KAAwB,QAAjB2yB,EAAA0C,EAAUp8B,aAAO,IAAA05B,OAAA,EAAAA,EAAArnC,MAAMggC,QACxB,QAAjBsH,EAAAtnC,EAAMyY,OAAO/D,YAAI,IAAA4yB,OAAA,EAAAA,EAAE72B,MAIrBq5B,EAA6BC,EAAW/pC,EACzC,MAED0lC,GAAU,IAAW5nC,OAAA,OAAA,OAAA,GAAA,kBACbsiC,GAAmBjmB,oDA/P7B,OAAsC,QAAtCkJ,EAAA3d,KAAKitB,MAAMnzB,IAAI,+BAAuB,IAAA6jB,OAAA,EAAAA,EAAE6oB,4BAiQ9B7L,IACP,KAAC,GACF,GACF,GACF,ECvXG,MAAMlmB,GAAM,4BACN5Y,GAAU,CAAEm/B,YAAa,gCAEtC,IAAAyL,GAAe,EAAGtL,WAAUC,KAAIC,SAAQ9H,QAAOyM,gBAC7CzM,GAAM,IAAWn7B,OAAA,OAAA,OAAA,GAAA,kBACTsiC,GAAmBjmB,UACnBmlB,IACP,MAEDuB,EAAS,oBAAoB,KAC3BC,EAAG,oCAAoC,IAAWhjC,OAAA,OAAA,OAAA,GAAA,YAChD,MAAM6P,QAAc4xB,GAAmB,YAAa,CAAE,EAAEplB,IAClDjG,EAAQvG,aAAA,EAAAA,EAAOuG,MAErB6sB,EAAO7sB,EAAM3S,QAAQ8O,SAASoxB,QAAQ,OACtCV,EAAO7sB,EAAM3S,QAAQ8O,SAASoxB,QAAQ,SACtCV,EAAO7sB,EAAM3S,QAAQ8O,SAASoxB,QAAQ,SACtCV,EAAO7sB,EAAM3S,QAAQ8O,SAASoxB,QAAQ,aAEtCV,EAAO7sB,EAAM3S,QAAQqJ,UAAU62B,QAC7B,0CAEFV,EAAO7sB,EAAM3S,QAAQ+O,OAAOuxB,MAAM,KAClCd,EAAO7sB,EAAM3S,QAAQ6b,QAAQykB,MAAM,KACnCd,EAAO7sB,EAAM3S,QAAQ2b,WAAWilB,GAAGF,KAEnClB,EAAO7sB,EAAM3S,QAAQ2d,KAAK3Q,QAAQszB,MAAM,GACxCd,EAAO3/B,OAAO4mB,KAAK9T,EAAM3S,QAAQ2d,KAAK,KAAKuiB,QAAQ,eACnDV,EAAO7sB,EAAM3S,QAAQ2d,KAAK,GAAGC,aAAa0iB,MAAM,eAChDd,EAAO3/B,OAAO4mB,KAAK9T,EAAM3S,QAAQ2d,KAAK,KAAKuiB,QAAQ,mBACnDV,EAAO7sB,EAAM3S,QAAQ2d,KAAK,GAAGE,iBAAiByiB,MAAM,eACpDd,EAAO3/B,OAAO4mB,KAAK9T,EAAM3S,QAAQ2d,KAAK,KAAKuiB,QAAQ,WACnDV,EAAO7sB,EAAM3S,QAAQ2d,KAAK,GAAGG,SAASwiB,MAAM,cAE5Cd,EAAO7sB,EAAM3S,QAAQ+d,QAAQ/Q,QAAQszB,MAAM,GAC3Cd,EAAO7sB,EAAM3S,QAAQ+d,QAAQ,IAAIuiB,MAAM,aACxC,MAED5I,GAAM,IAAWn7B,OAAA,OAAA,OAAA,GAAA,kBACTsiC,GAAmBjmB,GAC1B,KAAC,IAIJ0mB,EAAS,uBAAuB,SAGhCA,EAAS,oBAAoB,KAC3B,MAAMx6B,EAAS,CACbC,IAAK,EACLC,IAAK,EACLC,IAAK,EACLC,IAAK,EACLC,IAAK,EACLC,IAAK,GAGPm6B,EAAG,iCAAiC,IAAWhjC,OAAA,OAAA,OAAA,GAAA,YAC7C,MAAM6P,QAAc4xB,GAAmB,YAAa,CAAE,EAAEplB,KAC1CxM,aAAA,EAAAA,EAAOuG,OAEfuM,uBACAue,KAEN,MAAMG,EAAUF,GAAY,WAC5B8B,EAAO5B,EAAQ5wB,QAAQszB,MAAM,EAC9B,MAEDf,EAAG,0CAA0C,IAAWhjC,OAAA,OAAA,OAAA,GAAA,YACtD,MAAM6P,QAAc4xB,GAAmB,YAAa,CAAE,EAAEplB,KAC1CxM,aAAA,EAAAA,EAAOuG,OAEfuM,uBACAie,GAAM,KAEZ,MAAMS,EAAUF,GAAY,WAC5B8B,EAAO5B,EAAQ5wB,QAAQszB,MAAM,GAE7BzgC,OAAO4mB,KAAK3hB,GAAQ0O,SAAezC,GAASxU,OAAA,OAAA,OAAA,GAAA,YAC1CyT,EAAE,4BAA4Be,oBAAwBY,QAAQ,eACxD8rB,KAEN,MAAMoN,EAAa7qB,SAAS5R,cAC1B,4BAA4B2C,0BAExB/T,MAAEA,GAAU6tC,EAClBrL,EAAOrpB,SAASnZ,EAAO,IAAM,GAAGsjC,OAAM,EACvC,KACF,MAGDf,EAAG,uCAAuC,IAAWhjC,OAAA,OAAA,OAAA,GAAA,YACnD,MAAM6P,QAAc4xB,GAAmB,YAAa,CAAE,EAAEplB,KAC1CxM,aAAA,EAAAA,EAAOuG,OAEfuM,uBACAie,GAAM,KAEZ,MAAMS,EAAUF,GAAY,WAC5B8B,EAAO5B,EAAQ5wB,QAAQszB,MAAM,GAE7BzgC,OAAO4mB,KAAK3hB,GAAQ0O,SAAezC,GAASxU,OAAA,OAAA,OAAA,GAAA,YAC1CyT,EAAE,4BAA4Be,oBAAwBY,QAAQ,eACxD8rB,KAEN,MAAMoN,EAAa7qB,SAAS5R,cAC1B,4BAA4B2C,0BAExB/T,MAAEA,GAAU6tC,EAClBrL,EAAOrpB,SAASnZ,EAAO,IAAM,GAAGsjC,OAAM,GACtCx7B,EAAOiM,GAASoF,SAASnZ,EAAO,GACjC,MAEDgT,EAAE,0BAA0B2B,QAAQ,gBAC9B8rB,KAEN+B,EAAOpzB,eAAAA,EAAO3L,OAAOqE,OAAOC,IAAI/H,OAAOsjC,MAAMx7B,EAAOC,KACpDy6B,EAAOpzB,eAAAA,EAAO3L,OAAOqE,OAAOG,IAAIjI,OAAOsjC,MAAMx7B,EAAOG,KACpDu6B,EAAOpzB,eAAAA,EAAO3L,OAAOqE,OAAOI,IAAIlI,OAAOsjC,MAAMx7B,EAAOI,KACpDs6B,EAAOpzB,eAAAA,EAAO3L,OAAOqE,OAAOE,IAAIhI,OAAOsjC,MAAMx7B,EAAOE,KACpDw6B,EAAOpzB,eAAAA,EAAO3L,OAAOqE,OAAOK,IAAInI,OAAOsjC,MAAMx7B,EAAOK,KACpDq6B,EAAOpzB,eAAAA,EAAO3L,OAAOqE,OAAOM,IAAIpI,OAAOsjC,MAAMx7B,EAAOM,IACrD,MAKD++B,GAAU,IAAW5nC,OAAA,OAAA,OAAA,GAAA,kBACb8gC,WACAwB,GAAmBjmB,IACT8kB,GAAY,WACpBlqB,SAASjL,GAAMA,EAAEkG,gBACnB0uB,GAAM,IACb,KAAC,IAGJmC,EAAS,aAAa,KACpBC,EAAG,6BAA6B,IAAWhjC,OAAA,OAAA,OAAA,GAAA,kBACzC,MAAM6P,QAAc4xB,GAAmB,YAAa,CAAE,EAAEplB,IAClD7P,QAAyB,QAAZ+Y,EAAA1V,aAAA,EAAAA,EAAOuG,aAAK,IAAAmP,OAAA,EAAAA,EAAE3S,UAEjCqwB,EAAO3/B,OAAO4mB,KAAK1d,IAAOm3B,QAAQ,qBAClCV,EAAO3/B,OAAO4mB,KAAK1d,IAAOm3B,QAAQ,iBAGlCV,EAAO3/B,OAAO4mB,KAAK1d,IAAOm3B,QAAQ,SAClCV,EAAO3/B,OAAO4mB,KAAK1d,aAAI,EAAJA,EAAMkV,QAAQiiB,QAAQ,WACzCV,EAAO3/B,OAAO4mB,KAAK1d,aAAI,EAAJA,EAAMkV,QAAQiiB,QAAQ,SACzCV,EAAO3/B,OAAO4mB,KAAK1d,aAAI,EAAJA,EAAMkV,QAAQiiB,QAAQ,cACzCV,EAAO3/B,OAAO4mB,KAAK1d,aAAI,EAAJA,EAAMkV,QAAQiiB,QAAQ,UACzCV,EAAO3/B,OAAO4mB,KAAK1d,aAAI,EAAJA,EAAMkV,QAAQiiB,QAAQ,aACzCV,EAAO3/B,OAAO4mB,KAAK1d,IAAOm3B,QAAQ,cAClCV,EAAO3/B,OAAO4mB,KAAK1d,IAAOm3B,QAAQ,aAClCV,EAAO3/B,OAAO4mB,KAAK1d,IAAOm3B,QAAQ,UAClCV,EAAO3/B,OAAO4mB,KAAK1d,IAAOm3B,QAAQ,SAClCV,EAAO3/B,OAAO4mB,KAAK1d,IAAOm3B,QAAQ,UAClCV,EAAO3/B,OAAO4mB,KAAK1d,aAAI,EAAJA,EAAMtI,SAASy/B,QAAQ,mBAC1CV,EAAO3/B,OAAO4mB,KAAK1d,aAAI,EAAJA,EAAMtI,SAASy/B,QAAQ,YAC1CV,EAAO3/B,OAAO4mB,KAAK1d,aAAI,EAAJA,EAAMtI,SAASy/B,QAAQ,aAC1CV,EAAO3/B,OAAO4mB,KAAK1d,aAAI,EAAJA,EAAMtI,SAASy/B,QAAQ,OAC3C,MAEDxI,GAAM,IAAWn7B,OAAA,OAAA,OAAA,GAAA,kBACTsiC,GAAmBjmB,GAC1B,KAAC,IAGJ0mB,EAAS,iBAAiB,KACxBC,EAAG,oBAAoB,IAAWhjC,OAAA,OAAA,OAAA,GAAA,kBAChC,MAAM6P,QAAc4xB,GAAmB,YAAa,CAAE,EAAEplB,IAE5C,QAAZkJ,EAAA1V,aAAA,EAAAA,EAAOuG,aAAK,IAAAmP,GAAAA,EAAEnC,oBACR8d,KAEN,MAAMkL,EAAU9K,KAChB2B,EAAOmJ,EAAQ37B,QAAQszB,MAAM,GAC7BqI,EAAQ,GAAGl6B,OACZ,MAEDipB,GAAM,IAAWn7B,OAAA,OAAA,OAAA,GAAA,kBACTsiC,GAAmBjmB,UACnBklB,WACAX,GAAM,IACb,KAAC,IAGJmC,EAAS,oBAAoB,KAC3B,MAAM1zB,EAAQ,YAEd2zB,EAAG,oBAAoB,IAAWhjC,OAAA,OAAA,OAAA,GAAA,kBAChC,MAAM6P,QAAc4xB,GAAmB,YAAa,CAAE,EAAEplB,IAE5C,QAAZkJ,EAAA1V,aAAK,EAALA,EAAOuG,aAAK,IAAAmP,GAAAA,EAAEpC,UAAU9T,SAClB6xB,KAEN,MAAMkL,EAAU9K,KAChB2B,EAAOmJ,EAAQ37B,QAAQszB,MAAM,GAC7BqI,EAAQ,GAAGl6B,OACZ,MAED8wB,EAAG,uBAAuB,IAAWhjC,OAAA,OAAA,OAAA,GAAA,kBACnC,MAAM6P,QAAc4xB,GAAmB,YAAa,CAAE,EAAEplB,IAE5C,QAAZ0N,EAAAla,aAAK,EAALA,EAAOuG,aAAK,IAAA2T,GAAAA,EAAE5G,UAAU9T,SAClBuxB,GAAM,KAEZntB,EAAE,aAAa2B,QAAQ,eACjBwrB,GAAM,KAEZ,MAAMwL,EAAU9K,KAChB2B,EAAOmJ,EAAQ37B,QAAQszB,MAAM,GAE7Bd,EAAOpzB,eAAAA,EAAO3L,OAAO2G,UAAUpK,MAAMgQ,QAAQszB,MAAM,GACnDd,EAAOpzB,eAAAA,EAAO3L,OAAO2G,UAAUpK,MAAM,IAAIsjC,MAAM,SAChD,MAED5I,GAAM,IAAWn7B,OAAA,OAAA,OAAA,GAAA,kBACTsiC,GAAmBjmB,UACnBklB,IACP,KAAC,IAGJwB,EAAS,yBAAyB,KAGhCC,EAAG,6BAA6B,IAAWhjC,OAAA,OAAA,OAAA,GAAA,kBACzC,MAAM6P,QAAc4xB,GAAmB,YAAa,CAAE,EAAEplB,UAClDxM,aAAA,EAAAA,EAAOsG,OAAO,CAAE,yBAA0B,CAAC,kBAC3C+qB,KAEN+B,EAAOpzB,eAAAA,EAAO3L,OAAO2G,UAAUpK,MAAMgQ,QAAQszB,MAAM,GACnDd,EAAOpzB,eAAAA,EAAO3L,OAAO2G,UAAUpK,MAAM,IAAIsjC,MAAM,UAGjC,QAAdxe,EAAA1V,aAAK,EAALA,EAAOuG,aAAO,IAAAmP,GAAAA,EAAAjC,SAXF,YAWkB,gBACxB4d,KAEN+B,EAAOpzB,eAAAA,EAAO3L,OAAO2G,UAAUpK,MAAMgQ,QAAQszB,MAAM,EACpD,MAED5I,GAAM,IAAWn7B,OAAA,OAAA,OAAA,GAAA,kBACTsiC,GAAmBjmB,GAC1B,KAAC,IAGJ0mB,EAAS,2BAA2B,KAClCC,EAAG,oBAAoB,IAAWhjC,OAAA,OAAA,OAAA,GAAA,kBAChC,MAAM6P,QAAc4xB,GAAmB,YAAa,CAAE,EAAEplB,UAClDxM,eAAAA,EAAOsG,OAAO,CAClBjS,OAAQ,CACNqE,OAAQ,CACNC,IAAK,CAAE/H,MAAO,IACdiI,IAAK,CAAEjI,MAAO,IACdgI,IAAK,CAAEhI,MAAO,IACdmI,IAAK,CAAEnI,MAAO,IACdkI,IAAK,CAAElI,MAAO,IACdoI,IAAK,CAAEpI,MAAO,QAIR,QAAZ8kB,EAAA1V,aAAK,EAALA,EAAOuG,aAAK,IAAAmP,GAAAA,EAAErX,QAAO,SACfgzB,KAENztB,EAAE,4CAA4C2B,QAAQ,eAChDwrB,GAAM,KAEZ,MAAMwL,EAAU9K,KAChB2B,EAAOmJ,EAAQ37B,QAAQszB,MAAM,EAC9B,MAED5I,GAAM,IAAWn7B,OAAA,OAAA,OAAA,GAAA,kBACTsiC,GAAmBjmB,UACnBklB,WACAX,GAAM,IACb,KAAC,IAGJmC,EAAS,sCAAsC,KAC7CC,EAAG,oBAAoB,IAAWhjC,OAAA,OAAA,OAAA,GAAA,kBAChC,MAAM6P,QAAc4xB,GAAmB,YAAa,CAAE,EAAEplB,UAClDxM,eAAAA,EAAOsG,OAAO,CAClBjS,OAAQ,CACNqE,OAAQ,CACNC,IAAK,CAAE/H,MAAO,IACdiI,IAAK,CAAEjI,MAAO,IACdgI,IAAK,CAAEhI,MAAO,IACdmI,IAAK,CAAEnI,MAAO,IACdkI,IAAK,CAAElI,MAAO,IACdoI,IAAK,CAAEpI,MAAO,QAIR,QAAZ8kB,EAAA1V,aAAK,EAALA,EAAOuG,aAAK,IAAAmP,GAAAA,EAAErX,QAAO,SACfgzB,KAENztB,EAAE,0CAA0C2B,QAAQ,eAC9CwrB,GAAM,KAEZ,MAAMwL,EAAU9K,KAChB2B,EAAOmJ,EAAQ37B,QAAQszB,MAAM,EAC9B,MAED5I,GAAM,IAAWn7B,OAAA,OAAA,OAAA,GAAA,kBACTsiC,GAAmBjmB,UACnBklB,WACAX,GAAM,IACb,KAAC,IAIJmC,EAAS,6BAA6B,QAAS,ECtT1C,MAAM1mB,GAAM,0BACN5Y,GAAU,CAAEm/B,YAAa,8BAEtC,IAAA2L,GAAe,EAAGxL,WAAUC,KAAIC,SAAQ9H,QAAO+H,aAC7C,MAAMsL,EAAqB5mC,KAAKI,SAAStG,IACvCkG,KAAK1D,OAAO2D,GACZ,wBAGFszB,GAAM,IAAWn7B,OAAA,OAAA,OAAA,GAAA,kBACT4H,KAAKI,SAASpG,IAClBgG,KAAK1D,OAAO2D,GACZ,uBACA2mC,SAEIlM,GAAmBjmB,UACnBmlB,IACP,MAEDuB,EAAS,oBAAoB,KAC3BC,EAAG,oCAAoC,IAAWhjC,OAAA,OAAA,OAAA,GAAA,YAChD,MAAM6P,QAAc4xB,GAAmB,UAAW,CAAE,EAAEplB,IAChDjG,EAAQvG,aAAA,EAAAA,EAAOuG,MAErB6sB,EAAO7sB,EAAM3S,QAAQ8O,SAASoxB,QAAQ,OACtCV,EAAO7sB,EAAM3S,QAAQ8O,SAASoxB,QAAQ,SACtCV,EAAO7sB,EAAM3S,QAAQ8O,SAASoxB,QAAQ,SACtCV,EAAO7sB,EAAM3S,QAAQ8O,SAASoxB,QAAQ,WAEtCV,EAAO7sB,EAAM3S,QAAQqJ,UAAU62B,QAC7B,wCAEFV,EAAO7sB,EAAM3S,QAAQ+O,OAAOuxB,MAAM,KAClCd,EAAO7sB,EAAM3S,QAAQ6b,QAAQykB,MAAM,KACnCd,EAAO7sB,EAAM3S,QAAQ2b,WAAWilB,GAAGF,KAEnClB,EAAO7sB,EAAM3S,QAAQ2d,KAAK3Q,QAAQszB,MAAM,GACxCd,EAAO3/B,OAAO4mB,KAAK9T,EAAM3S,QAAQ2d,KAAK,KAAKuiB,QAAQ,eACnDV,EAAO7sB,EAAM3S,QAAQ2d,KAAK,GAAGC,aAAa0iB,MAAM,SAChDd,EAAO3/B,OAAO4mB,KAAK9T,EAAM3S,QAAQ2d,KAAK,KAAKuiB,QAAQ,mBACnDV,EAAO7sB,EAAM3S,QAAQ2d,KAAK,GAAGE,iBAAiByiB,MAAM,eACpDd,EAAO3/B,OAAO4mB,KAAK9T,EAAM3S,QAAQ2d,KAAK,KAAKuiB,QAAQ,WACnDV,EAAO7sB,EAAM3S,QAAQ2d,KAAK,GAAGG,SAASwiB,MAAM,aAC7C,MAED5I,GAAM,IAAWn7B,OAAA,OAAA,OAAA,GAAA,kBACTsiC,GAAmBjmB,GAC1B,KAAC,IAIJ0mB,EAAS,uBAAuB,SAEhCA,EAAS,aAAa,KACpBC,EAAG,6BAA6B,IAAWhjC,OAAA,OAAA,OAAA,GAAA,kBACzC,MAAM6P,QAAc4xB,GAAmB,UAAW,CAAE,EAAEplB,IAChD7P,QAAyB,QAAZ+Y,EAAA1V,aAAA,EAAAA,EAAOuG,aAAK,IAAAmP,OAAA,EAAAA,EAAE3S,UAGjCqwB,EAAO3/B,OAAO4mB,KAAK1d,IAAOm3B,QAAQ,SAClCV,EAAO3/B,OAAO4mB,KAAK1d,aAAI,EAAJA,EAAMkV,QAAQiiB,QAAQ,WACzCV,EAAO3/B,OAAO4mB,KAAK1d,aAAI,EAAJA,EAAMkV,QAAQiiB,QAAQ,SACzCV,EAAO3/B,OAAO4mB,KAAK1d,aAAI,EAAJA,EAAMkV,QAAQiiB,QAAQ,cACzCV,EAAO3/B,OAAO4mB,KAAK1d,aAAI,EAAJA,EAAMkV,QAAQiiB,QAAQ,UACzCV,EAAO3/B,OAAO4mB,KAAK1d,aAAI,EAAJA,EAAMkV,QAAQiiB,QAAQ,aACzCV,EAAO3/B,OAAO4mB,KAAK1d,IAAOm3B,QAAQ,kBAClCV,EAAO3/B,OAAO4mB,KAAK1d,IAAOm3B,QAAQ,UAClCV,EAAO3/B,OAAO4mB,KAAK1d,IAAOm3B,QAAQ,SAElCV,EAAOz2B,aAAA,EAAAA,EAAMU,OAAOmmB,QAAQ0Q,MAC1Bn8B,KAAKI,SAAStG,IAAIkG,KAAK1D,OAAO2D,GAAI,WAEpCo7B,EAAO3/B,OAAO4mB,KAAK1d,IAAOm3B,QAAQ,UAClCV,EAAO3/B,OAAO4mB,KAAK1d,aAAI,EAAJA,EAAMtI,SAASy/B,QAAQ,WAC1CV,EAAO3/B,OAAO4mB,KAAK1d,aAAA,EAAAA,EAAMtI,OAAOqL,UAAUo0B,QAAQ,YAClDV,EAAO3/B,OAAO4mB,KAAK1d,aAAI,EAAJA,EAAMtI,OAAOqL,QAAQpL,WAAWw/B,QAAQ,OAC5D,MAEDxI,GAAM,IAAWn7B,OAAA,OAAA,OAAA,GAAA,kBACTsiC,GAAmBjmB,GAC1B,KAAC,IAGJ0mB,EAAS,kBAAkB,KACzBC,EAAG,oBAAoB,IAAWhjC,OAAA,OAAA,OAAA,GAAA,kBAChC,MAAM6P,QAAc4xB,GAAmB,UAAW,CAAE,EAAEplB,IAC1C,QAAZkJ,EAAA1V,aAAA,EAAAA,EAAOuG,aAAK,IAAAmP,GAAAA,EAAEuN,qBACRoO,KAEN,MAAMkL,EAAU9K,KAChB2B,EAAOmJ,EAAQ37B,QAAQszB,MAAM,GAC7BqI,EAAQ,GAAGl6B,OACZ,MAEDipB,GAAM,IAAWn7B,OAAA,OAAA,OAAA,GAAA,kBACTsiC,GAAmBjmB,UACnBklB,WACAX,GAAM,IACb,KAAC,IAGJmC,EAAS,kBAAkB,KAIzB5H,GAAM,IAAWn7B,OAAA,OAAA,OAAA,GAAA,wBACTsiC,GAAmBjmB,IACd,QAAXkJ,EAAA3d,KAAKy1B,cAAM,IAAA9X,GAAAA,EACPhV,QAAQk+B,GAAmB,mBAAZA,EAAG97B,OACnBsE,SAASw3B,GAAOA,EAAGpM,UACvB,MAEDW,EAAG,yCAAyC,IAAWhjC,OAAA,OAAA,OAAA,GAAA,oBACrD,MAAM6P,QAAc4xB,GAAmB,UAAW,CAAE,EAAEplB,IAChDqyB,QAXN1uC,OAAA,OAAA,OAAA,GAAA,YAAA,OAAA2uC,UAAUjgC,OAAO,CAAEiE,KAAM,kBAAmB,IAYhC,QAAZoX,EAAAla,aAAK,EAALA,EAAOuG,aAAK,IAAA2T,GAAAA,EAAE7b,QAAO,SACf0yB,GAAM,KAGZ,MAAMgO,EAAcnrB,SAAS5R,cAC3B,4BAA4B68B,eAAAA,EAAW7mC,OAEnCgnC,EAAcprB,SAAS5R,cAAc,4BAG3CoxB,EAAO2L,GAAatL,IAAI2G,KACxBhH,EAAO4L,GAAavL,IAAI2G,KAGxB,MAAM4C,EAAqB,IAAIC,UAAU,YAAa,CACpD7wB,aAAc,IAAI8wB,aAClBC,SAAS,EACTC,YAAY,IAEd2B,SAAAA,EAAalC,cAAcG,GAIf,QAAZvV,EAAAznB,aAAK,EAALA,EAAOuG,aAAK,IAAAkhB,GAAAA,EAAE3C,QAAQkY,SAChB3L,KAGN+B,EAAOpzB,aAAA,EAAAA,EAAO3L,OAAOqL,QAAQpL,SAASkL,OAAO00B,MAC3C,mBAAmB2K,aAAA,EAAAA,EAAW7mC,MAEjC,KAAC,IAGJk7B,EAAS,wBAAwB,KAC/BC,EAAG,6BAA6B,IAAWhjC,OAAA,OAAA,OAAA,GAAA,kBACzC,MAAM6P,QAAc4xB,GAAmB,UAAW,CAAE,EAAEplB,IAC1C,QAAZkJ,EAAA1V,aAAK,EAALA,EAAOuG,aAAK,IAAAmP,GAAAA,EAAErX,QAAO,GACrB,MAAO0I,SAAc+qB,GAAoB9xB,EAAO,UAChD+G,EAAKT,OAAO,CACVjS,OAAQ,CACN8V,QAAS,CACPhY,IAAK,EACLvB,MAAO,YAIPmgC,GAAM,KAEZqC,EAAOrsB,EAAK1S,OAAO8V,QAAQvZ,OAAOsjC,MAAM,GAGxCtwB,EAAE,eAAe2B,QAAQ,eACnB8rB,KAEN+B,EAAOrsB,EAAK1S,OAAO8V,QAAQvZ,OAAOsjC,MAAM,EACzC,MAED5I,GAAM,IAAWn7B,OAAA,OAAA,OAAA,GAAA,kBACTsiC,GAAmBjmB,GAC1B,KAAC,IAGJ0mB,EAAS,+BAA+B,KACtCG,GAAO,KACLt7B,KAAKI,SAASpG,IAAIgG,KAAK1D,OAAO2D,GAAI,wBAAwB,EAAK,IAGjEm7B,EAAG,gCAAgC,IAAWhjC,OAAA,OAAA,OAAA,GAAA,kBAC5C,MAAM6P,QAAc4xB,GAAmB,UAAW,CAAE,EAAEplB,IAC1C,QAAZkJ,EAAA1V,aAAK,EAALA,EAAOuG,aAAK,IAAAmP,GAAAA,EAAErX,QAAO,GACrB,MAAO0I,SAAc+qB,GAAoB9xB,EAAO,UAChD+G,EAAKT,OAAO,CACVjS,OAAQ,CACN8V,QAAS,CACPhY,IAAK,EACLvB,MAAO,YAIPmgC,GAAM,KAEZqC,EAAOrsB,EAAK1S,OAAO8V,QAAQvZ,OAAOsjC,MAAM,GAGxCtwB,EAAE,4BAA4BmD,EAAK/O,oBAAoBuN,QAAQ,eACzD8rB,KAEN+B,EAAOrsB,EAAK1S,OAAO8V,QAAQvZ,OAAOsjC,MAAM,EACzC,MAED5I,GAAM,IAAWn7B,OAAA,OAAA,OAAA,GAAA,kBACTsiC,GAAmBjmB,GAC1B,KAAC,IAGJ0mB,EAAS,+BAA+B,KACtC,MAAM14B,EAAS/G,OAAO4mB,KAAKxe,OAAOjE,IAAI4C,QACtCA,EAAO+C,KAAK,eAEZ81B,GAAO,IAAWljC,OAAA,OAAA,OAAA,GAAA,kBAChB,MAAM6P,QAAc4xB,GAAmB,UAAW,CAAE,EAAEplB,IAC1C,QAAZkJ,EAAA1V,aAAK,EAALA,EAAOuG,aAAK,IAAAmP,GAAAA,EAAErX,QAAO,SACfyzB,GAAoB9xB,EAAO,gBAC3B+wB,GAAM,IACb,MAEDmC,EAAS,kCAAkC,KACzC14B,EAAO4M,SAASwkB,IACduH,EAAG,mBAAmBvH,KAAS,IAAWz7B,OAAA,OAAA,OAAA,GAAA,YACxC,MAAM6P,QAAcoyB,GAAgB5lB,IAC9BzF,EAAO/G,aAAA,EAAAA,EAAO3N,MAAMwa,SAAS,GAC7BoyB,EAAiBl4B,aAAA,EAAAA,EAAM1S,OAAO8oB,QAEpCiW,EAAO6L,GAAgBxL,IAAIxc,UAC3B,MAAMioB,EAAe1kC,EAAOkf,QAAQulB,GAC9BE,EACJD,EAAe,IAAM1kC,EAAOoG,OAAS,EAAIs+B,EAAe,EAG1Dt7B,EAAE,iBAAiB2B,QAAQ,eACrBwrB,GAAM,KAGZqC,EAAOrsB,aAAA,EAAAA,EAAM1S,OAAO8oB,SAAS+W,MAAM15B,EAAO2kC,GAC3C,KAAC,GACF,IAGJ7T,GAAM,IAAWn7B,OAAA,OAAA,OAAA,GAAA,kBACTsiC,GAAmBjmB,GAC1B,KAAC,GACF,EC3PG,MAAMA,GAAM,6CACN5Y,GAAU,CACrBm/B,YAAa,iDAGTC,GAAkB,CAAOl/B,EAAc6I,EAAe,CAAE,IAAIxM,OAAA,OAAA,OAAA,GAAA,YAChE,OAAAyhC,GAAmB99B,EAAM6I,EAAM6P,GAAI,IAErC,IAAA4yB,GAAe,EAAGlM,WAAUC,KAAIC,SAAQ+E,SAAQ7M,YAC9C4H,EAAS,oBAAoB,KAC3BC,EAAG,oCAAoC,KACrC,MAAM5sB,EAAQ,IAAIc,EAClB+rB,EAAO7sB,EAAM3S,QAAQoE,IAAIk8B,MAAM,mBAC/Bd,EAAO7sB,EAAM3S,QAAQ8O,SAASoxB,QAAQ,OACtCV,EAAO7sB,EAAM3S,QAAQ8O,SAASoxB,QAAQ,UACtCV,EAAO7sB,EAAM3S,QAAQ8O,SAASoxB,QAAQ,aACtCV,EAAO7sB,EAAM3S,QAAQqJ,UAAU62B,QAC7B,mDAEFV,EAAO7sB,EAAM3S,QAAQ+O,OAAOuxB,MAAM,IAAI,GACtC,IAGJhB,EAAS,WAAW,KAClBC,EAAG,yCAAyC,IAAWhjC,OAAA,OAAA,OAAA,GAAA,kBACrD,MAAM6P,QAAcgzB,GAAgB,aACtB,IAAI3rB,EAAsBrH,GAClC3B,QAAO,SACPgzB,KACN,MAAMgO,EAEH,QAFiB3pB,EAAA9B,SAAS5R,cAC3B,sCACC,IAAA0T,OAAA,EAAAA,EAAAmV,UACHuI,SAAciM,GAAanL,MAAM,UACjC,MAAMqI,EAAUjL,GAAY,aAC5B8B,EAAOmJ,EAAQ37B,QAAQszB,MAAM,SACvBqI,EAAQ,GAAGl6B,QACjB+wB,EAAO9B,GAAY,aAAa1wB,QAAQszB,MAAM,EAC/C,KAAC,IAGJhB,EAAS,aAAa,KACpBC,EAAG,uBAAuB,IAAWhjC,OAAA,OAAA,OAAA,GAAA,YACnC,MAAM6P,QAAcgzB,GAAgB,aAE9Br2B,EADQ,IAAI0K,EAAsBrH,GACrB+C,UACbsX,EAAO5mB,OAAO4mB,KAAK1d,GACzBw7B,EAAO9d,EAAKzZ,OAAS,GACrBwyB,EAAO/Y,GAAMyZ,QAAQ,OACtB,KAAC,IAGJxI,GAAM,IAAWn7B,OAAA,OAAA,OAAA,GAAA,kBACTsiC,GAAmBjmB,GAC1B,KAAC,ECrDG,MAAMA,GAAM,uCACN5Y,GAAU,CACrBm/B,YAAa,2CAGTC,GAAkB,CAAOl/B,EAAc6I,EAAe,CAAE,IAAIxM,OAAA,OAAA,OAAA,GAAA,YAChE,OAAAyhC,GAAmB99B,EAAM6I,EAAM6P,GAAI,IAErC,IAAA8yB,GAAe,EAAGpM,WAAUC,KAAIC,SAAQ+E,SAAQ7M,YAC9C4H,EAAS,oBAAoB,KAC3BC,EAAG,oCAAoC,KACrC,MAAMoM,EAAe,IAAI93B,EACzB2rB,EAAOmM,EAAa3rC,QAAQoE,IAAIk8B,MAAM,gBACtCd,EAAOmM,EAAa3rC,QAAQ8O,SAASoxB,QAAQ,gBAC7CV,EAAOmM,EAAa3rC,QAAQqJ,UAAU62B,QACpC,gDAEFV,EAAOmM,EAAa3rC,QAAQ+O,OAAOuxB,MAAM,IAAI,GAC7C,IAGJhB,EAAS,WAAW,KAClBC,EAAG,yCAAyC,IAAWhjC,OAAA,OAAA,OAAA,GAAA,kBACrD,MAAM6P,QAAcgzB,GAAgB,aACf,IAAIvrB,EAAgBzH,GAC5B3B,QAAO,SACdgzB,KACN,MAAMgO,EAEH,QAFiB3pB,EAAA9B,SAAS5R,cAC3B,yCACC,IAAA0T,OAAA,EAAAA,EAAAmV,UACHuI,SAAciM,GAAanL,MAAM,UACjC,MAAMqI,EAAUjL,GAAY,gBAC5B8B,EAAOmJ,EAAQ37B,QAAQszB,MAAM,SACvBqI,EAAQ,GAAGl6B,QACjB+wB,EAAO9B,GAAY,gBAAgB1wB,QAAQszB,MAAM,EAClD,KAAC,IAGJhB,EAAS,aAAa,KACpBC,EAAG,uBAAuB,IAAWhjC,OAAA,OAAA,OAAA,GAAA,YACnC,MAAM6P,QAAcgzB,GAAgB,aAE9Br2B,EADe,IAAI8K,EAAgBzH,GACf+C,UACpBsX,EAAO5mB,OAAO4mB,KAAK1d,GACzBw7B,EAAO9d,EAAKzZ,QAAU,GACtBwyB,EAAO/Y,GAAMyZ,QAAQ,UACrBV,EAAO/Y,GAAMyZ,QAAQ,QACrBqE,EAAOx7B,EAAK+K,YACb,KAAC,IAIJwrB,EAAS,kCAAkC,SAE3C5H,GAAM,IAAWn7B,OAAA,OAAA,OAAA,GAAA,kBACTsiC,GAAmBjmB,GAC1B,KAAC,EC9DG,MACM5Y,GAAU,CAAEm/B,YAAa,kCAEtC,IAAeyM,GAAA,EAAGtM,WAAUC,KAAIC,aAC9BF,EAAS,cAAc,KACrB,MAAM3V,EAAU,IAAIqI,GACpBuN,EAAG,iCAAiC,KAClCC,EAAO7V,EAAQuI,WAAWllB,QAAQszB,MAAM,EAAE,IAG5Cf,EAAG,gCAAgC,KACjC5V,EAAQtiB,KAAO,CAAC,CAAE2B,MAAO,QAAShM,MAAO,UACzCwiC,EAAO7V,EAAQtiB,KAAK2F,QAAQszB,MAAM,GAClCd,EAAO3/B,OAAO4mB,KAAKkD,EAAQtiB,KAAK,IAAI2F,QAAQszB,MAAM,GAClDd,EAAO7V,EAAQtiB,KAAK,GAAG2B,OAAOs3B,MAAM,SACpCd,EAAO7V,EAAQtiB,KAAK,GAAGrK,OAAOsjC,MAAM,SACpCd,EAAO7V,EAAQtiB,KAAK,GAAGW,OAAO44B,GAAGvd,SAAS,IAG5Ckc,EAAG,qBAAqB,KACtBC,EAAO7V,EAAQuI,WAAWllB,QAAQszB,MAAM,GACxCd,EAAO7V,EAAQuI,WAAW,GAAGlpB,OAAOs3B,MAAM,SAC1Cd,EAAO7V,EAAQuI,WAAW,GAAGl1B,OAAOsjC,MAAM,SAC1Cd,EAAO7V,EAAQtiB,KAAK,GAAGW,OAAO44B,GAAGvd,SAAS,GAC1C,IAGJic,EAAS,YAAY,KACnB,MAAM3V,EAAU,IAAIqI,GACpBuN,EAAG,+BAA+B,KAChCC,EAAO7V,EAAQmB,SAAS9d,QAAQszB,MAAM,GACtCd,EAAO3/B,OAAO4mB,KAAKkD,EAAQmB,SAAS,IAAI9d,QAAQszB,MAAM,EAAE,IAG1Df,EAAG,iCAAiC,KAClCC,EAAO7V,EAAQmB,SAAS,GAAG9iB,OAAOs4B,MAAM,GAAG,IAG7Cf,EAAG,iCAAiC,KAClCC,EAAO7V,EAAQmB,SAAS,GAAG3iB,MAAMy4B,GAAGvd,SAAS,IAG/Ckc,EAAG,gCAAgC,KACjC5V,EAAQ6B,aAAe,kBACvBgU,EAAO7V,EAAQmB,SAAS9d,QAAQszB,MAAM,GACtCd,EAAO3/B,OAAO4mB,KAAKkD,EAAQmB,SAAS,IAAI9d,QAAQszB,MAAM,GACtDd,EAAO7V,EAAQmB,SAAS,GAAG9iB,OAAOs4B,MAAM,cACxCd,EAAO3/B,OAAO4mB,KAAKkD,EAAQmB,SAAS,IAAI9d,QAAQszB,MAAM,GACtDd,EAAO7V,EAAQmB,SAAS,GAAG9iB,OAAOs4B,MAAM,OAAO,IAGjDf,EAAG,wBAAwB,KACzB5V,EAAQ9S,KAAO,QACf2oB,EAAO7V,EAAQmB,SAAS9d,QAAQszB,MAAM,GACtCd,EAAO3/B,OAAO4mB,KAAKkD,EAAQmB,SAAS,IAAI9d,QAAQszB,MAAM,GACtDd,EAAO7V,EAAQmB,SAAS,GAAG9iB,OAAOs4B,MAChCn8B,KAAKuI,KAAKuB,SAAS,yBAErBuxB,EAAO7V,EAAQmB,SAAS,GAAG3iB,MAAMm4B,MAAM,WAAW,IAGpDf,EAAG,wBAAwB,KACzB5V,EAAQ/f,KAAO,SACf41B,EAAO7V,EAAQmB,SAAS9d,QAAQszB,MAAM,GACtCd,EAAO3/B,OAAO4mB,KAAKkD,EAAQmB,SAAS,IAAI9d,QAAQszB,MAAM,GACtDd,EAAO7V,EAAQmB,SAAS,GAAG9iB,OAAOs4B,MAChC,GAAGn8B,KAAKuI,KAAKuB,SAAS,yCACvB,GACD,GACF,ECrEG,MACMjO,GAAU,CAAEm/B,YAAa,gCAEtC,IAAe0M,GAAA,EAAGvM,WAAUC,KAAIC,aAC9BF,EAAS,cAAc,KACrB,MAAMwM,EAAY3Z,GAAkBC,WAEpCmN,EAAG,qBAAqB,KACtBC,EAAO3/B,OAAO4mB,KAAKqlB,GAAW9+B,QAAQszB,MAAM,EAAE,IAEhDf,EAAG,iBAAiB,KAClBC,EAAOsM,EAAU7qC,WAAWq/B,MAAM,sBAAsB,IAE1Df,EAAG,aAAa,KACdC,EAAOsM,EAAU5qC,OAAOo/B,MAAM,kBAAkB,IAElDf,EAAG,aAAa,KACdC,EAAOsM,EAAU3qC,OAAOm/B,MAAM,kBAAkB,IAElDf,EAAG,cAAc,KACfC,EAAOsM,EAAUvlC,QAAQ+5B,MAAM,mBAAmB,GAClD,IAGJhB,EAAS,cAAc,KACrB,MAAMnsB,EAAO,IAAIgf,GAEjBoN,EAAG,iCAAiC,KAClCC,EAAOrsB,EAAK+e,WAAWllB,QAAQszB,MAAM,EAAE,IAGzCf,EAAG,gCAAgC,KACjCpsB,EAAK9L,KAAO,CAAC,CAAE2B,MAAO,QAAShM,MAAO,UACtCwiC,EAAOrsB,EAAK9L,KAAK2F,QAAQszB,MAAM,GAC/Bd,EAAO3/B,OAAO4mB,KAAKtT,EAAK9L,KAAK,IAAI2F,QAAQszB,MAAM,GAC/Cd,EAAOrsB,EAAK9L,KAAK,GAAG2B,OAAOs3B,MAAM,SACjCd,EAAOrsB,EAAK9L,KAAK,GAAGrK,OAAOsjC,MAAM,SACjCd,EAAOrsB,EAAK9L,KAAK,GAAGW,OAAO44B,GAAGvd,SAAS,IAGzCkc,EAAG,qBAAqB,KACtBC,EAAOrsB,EAAK+e,WAAWllB,QAAQszB,MAAM,GACrCd,EAAO3/B,OAAO4mB,KAAKtT,EAAK9L,KAAK,IAAI2F,QAAQszB,MAAM,GAC/Cd,EAAOrsB,EAAK+e,WAAW,GAAGlpB,OAAOs3B,MAAM,SACvCd,EAAOrsB,EAAK+e,WAAW,GAAGl1B,OAAOsjC,MAAM,SACvCd,EAAOrsB,EAAK+e,WAAW,GAAGlqB,OAAOs4B,MAAM,QAAQ,GAC/C,IAGJhB,EAAS,YAAY,KACnB,MAAMnsB,EAAO,IAAIgf,GAEjBoN,EAAG,+BAA+B,KAChCC,EAAOrsB,EAAK2X,SAAS9d,QAAQszB,MAAM,GACnCd,EAAO3/B,OAAO4mB,KAAKtT,EAAK2X,SAAS,IAAI9d,QAAQszB,MAAM,EAAE,IAEvDf,EAAG,iCAAiC,KAClCC,EAAOrsB,EAAK2X,SAAS,GAAG9iB,OAAOs4B,MAAM,kBAAkB,IAEzDf,EAAG,iCAAiC,KAClCC,EAAOrsB,EAAK2X,SAAS,GAAG3iB,MAAMm4B,MAAM,YAAY,GAChD,GACF,EC9DG,MACMtgC,GAAU,CAAEm/B,YAAa,oCAEtC,IAAe4M,GAAA,EAAGzM,WAAUC,KAAIC,aAC9BF,EAAS,cAAc,KACrBC,EAAG,0CAA0C,KAC3C,MAAMxlB,EAAY,IAAIyY,GACtBgN,EAAOzlB,EAAUd,UAAU2nB,GAAG4F,IAAI,GAClC,IAGJlH,EAAS,iBAAiB,KACxBC,EAAG,2BAA2B,KAC5B,MAAMxlB,EAAY,IAAIyY,GACtBgN,EAAOzlB,EAAU0Y,aAAa6N,MAAM,EAAE,GACtC,IAGJhB,EAAS,gBAAgB,KACvB,MAAMvlB,EAAY,IAAIyY,GACtB+M,EAAG,iCAAiC,KAClCC,EAAOzlB,EAAUmY,WAAWllB,QAAQszB,MAAM,EAAE,IAG9Cf,EAAG,gCAAgC,KACjCxlB,EAAU1S,KAAO,CAAC,CAAErK,MAAO,QAASgM,MAAO,UAC3Cw2B,EAAOzlB,EAAU1S,KAAK2F,QAAQszB,MAAM,GACpCd,EAAO3/B,OAAO4mB,KAAK1M,EAAU1S,KAAK,IAAI2F,QAAQszB,MAAM,GACpDd,EAAOzlB,EAAU1S,KAAK,GAAG2B,OAAOs3B,MAAM,SACtCd,EAAOzlB,EAAU1S,KAAK,GAAGrK,OAAOsjC,MAAM,SACtCd,EAAOzlB,EAAU1S,KAAK,GAAGW,OAAO44B,GAAGvd,SAAS,IAG9Ckc,EAAG,qBAAqB,KACtBC,EAAOzlB,EAAUmY,WAAWllB,QAAQszB,MAAM,GAC1Cd,EAAOzlB,EAAUmY,WAAW,GAAGlpB,OAAOs3B,MAAM,SAC5Cd,EAAOzlB,EAAUmY,WAAW,GAAGl1B,OAAOsjC,MAAM,SAC5Cd,EAAOzlB,EAAU1S,KAAK,GAAGW,OAAO44B,GAAGvd,SAAS,GAC5C,IAGJic,EAAS,cAAc,KACrB,MAAMvlB,EAAY,IAAIyY,GACtB+M,EAAG,kCAAkC,KACnCC,EAAOzlB,EAAU+Q,SAAS9d,QAAQszB,MAAM,EAAE,IAG5Cf,EAAG,uBAAuB,KACxBxlB,EAAU1S,KAAO,CAAC,CAAErK,MAAOiL,OAAOjE,IAAIqD,KAAKK,QAC3C83B,EAAOzlB,EAAU1S,KAAK2F,QAAQszB,MAAM,GACpCd,EAAOzlB,EAAU+Q,SAAS,GAAG9iB,OAAOs4B,MAAMr4B,OAAOjE,IAAIqD,KAAKK,OAC1D83B,EAAOzlB,EAAU+Q,SAAS,GAAG3iB,MAAMm4B,MAAM,mBACzCd,EAAOzlB,EAAU+Q,SAAS,GAAG5iB,OAAOo4B,MAClC,GAAGr4B,OAAOjE,IAAIK,uBACf,GACD,GACF,ECxDG,MACMrE,GAAU,CAAEm/B,YAAa,+BAEtC,IAAe6M,GAAA,EAAG1M,WAAUC,KAAIC,aAC9BF,EAAS,gBAAgB,KACvB,MAAM2M,EAAW,IAAIvZ,GACrB6M,EAAG,iCAAiC,KAClCC,EAAOyM,EAAS/Z,WAAWllB,QAAQszB,MAAM,EAAE,IAG7Cf,EAAG,gCAAgC,KACjC0M,EAAS5kC,KAAO,CAAC,CAAE2B,MAAO,QAAShM,MAAO,UAC1CwiC,EAAOyM,EAAS5kC,KAAK2F,QAAQszB,MAAM,GACnCd,EAAO3/B,OAAO4mB,KAAKwlB,EAAS5kC,KAAK,IAAI2F,QAAQszB,MAAM,GACnDd,EAAOyM,EAAS5kC,KAAK,GAAG2B,OAAOs3B,MAAM,SACrCd,EAAOyM,EAAS5kC,KAAK,GAAGrK,OAAOsjC,MAAM,SACrCd,EAAOyM,EAAS5kC,KAAK,GAAGW,OAAO44B,GAAGvd,SAAS,IAG7Ckc,EAAG,qBAAqB,KACtBC,EAAOyM,EAAS/Z,WAAWllB,QAAQszB,MAAM,GACzCd,EAAOyM,EAAS/Z,WAAW,GAAGlpB,OAAOs3B,MAAM,SAC3Cd,EAAOyM,EAAS/Z,WAAW,GAAGl1B,OAAOsjC,MAAM,SAC3Cd,EAAOyM,EAAS5kC,KAAK,GAAGW,OAAO44B,GAAGvd,SAAS,GAC3C,IAGJic,EAAS,cAAc,KACrB,MAAM2M,EAAW,IAAIvZ,GACrB6M,EAAG,kCAAkC,KACnCC,EAAOyM,EAASnhB,SAAS9d,QAAQszB,MAAM,EAAE,IAG3Cf,EAAG,uBAAuB,KACxB0M,EAAS5kC,KAAO,CAAC,CAAErK,MAAOiL,OAAOjE,IAAIqD,KAAKK,QAC1C83B,EAAOyM,EAAS5kC,KAAK2F,QAAQszB,MAAM,GACnCd,EAAOyM,EAASnhB,SAAS,GAAG9iB,OAAOs4B,MAAMr4B,OAAOjE,IAAIqD,KAAKK,OACzD83B,EAAOyM,EAASnhB,SAAS,GAAG3iB,MAAMm4B,MAAM,mBACxCd,EAAOyM,EAASnhB,SAAS,GAAG5iB,OAAOo4B,MACjC,GAAGr4B,OAAOjE,IAAIK,uBACf,GACD,GACF,EC1CG,MACMrE,GAAU,CAAEm/B,YAAa,gCAEtC,IAAe+M,GAAA,EAAG5M,WAAUC,KAAIC,aAC9BF,EAAS,gBAAgB,KACvB,MAAMl5B,EAAQ,IAAI0sB,GAClByM,EAAG,iCAAiC,KAClCC,EAAOp5B,EAAM8rB,WAAWllB,QAAQszB,MAAM,EAAE,IAG1Cf,EAAG,gCAAgC,KACjCn5B,EAAMiB,KAAO,CAAC,CAAE2B,MAAO,QAAShM,MAAO,UACvCwiC,EAAOp5B,EAAMiB,KAAK2F,QAAQszB,MAAM,GAChCd,EAAO3/B,OAAO4mB,KAAKrgB,EAAMiB,KAAK,IAAI2F,QAAQszB,MAAM,GAChDd,EAAOp5B,EAAMiB,KAAK,GAAG2B,OAAOs3B,MAAM,SAClCd,EAAOp5B,EAAMiB,KAAK,GAAGrK,OAAOsjC,MAAM,SAClCd,EAAOp5B,EAAMiB,KAAK,GAAGW,OAAO44B,GAAGvd,SAAS,IAG1Ckc,EAAG,qBAAqB,KACtBC,EAAOp5B,EAAM8rB,WAAWllB,QAAQszB,MAAM,GACtCd,EAAOp5B,EAAM8rB,WAAW,GAAGlpB,OAAOs3B,MAAM,SACxCd,EAAOp5B,EAAM8rB,WAAW,GAAGl1B,OAAOsjC,MAAM,SACxCd,EAAOp5B,EAAMiB,KAAK,GAAGW,OAAO44B,GAAGvd,SAAS,GACxC,IAGJic,EAAS,cAAc,KACrB,MAAMl5B,EAAQ,IAAI0sB,GAClByM,EAAG,iCAAiC,KAClCC,EAAOp5B,EAAM0kB,SAAS9d,QAAQszB,MAAM,GACpCl6B,EAAM0kB,SAAStX,SAASmS,IACtB6Z,EAAO7Z,GAAGka,IAAI2G,KACdhH,EAAO7Z,eAAAA,EAAG3d,OAAOs4B,MAAM,GAAG,GAC1B,IAGJf,EAAG,wBAAwB,KACzBn5B,EAAMyQ,KAAO,QACb2oB,EAAOp5B,EAAM0kB,SAAS9d,QAAQszB,MAAM,GACpCd,EAAO3/B,OAAO4mB,KAAKrgB,EAAM0kB,SAAS,IAAI9d,QAAQszB,MAAM,GACpDd,EAAOp5B,EAAM0kB,SAAS,GAAG9iB,OAAOs4B,MAC9Bn8B,KAAKuI,KAAKuB,SAAS,yBAErBuxB,EAAOp5B,EAAM0kB,SAAS,GAAG3iB,MAAMm4B,MAAM,WAAW,IAGlDf,EAAG,wBAAwB,KACzBn5B,EAAMwD,KAAO,SACb41B,EAAOp5B,EAAM0kB,SAAS9d,QAAQszB,MAAM,GACpCd,EAAO3/B,OAAO4mB,KAAKrgB,EAAM0kB,SAAS,IAAI9d,QAAQszB,MAAM,GACpDd,EAAOp5B,EAAM0kB,SAAS,GAAG9iB,OAAOs4B,MAC9B,GAAGn8B,KAAKuI,KAAKuB,SAAS,2BACvB,GACD,GACF,ECvDG,MACMjO,GAAU,CAAEm/B,YAAa,iCAEtC,IAAegN,GAAA,EAAG7M,WAAUC,KAAIC,aAC9BF,EAAS,gBAAgB,KACvB,MAAMnsB,EAAO,IAAI4f,GACjBwM,EAAG,iCAAiC,KAClCC,EAAOrsB,EAAK+e,WAAWllB,QAAQszB,MAAM,EAAE,IAGzCf,EAAG,gCAAgC,KACjCpsB,EAAK9L,KAAO,CAAC,CAAE2B,MAAO,QAAShM,MAAO,UACtCwiC,EAAOrsB,EAAK9L,KAAK2F,QAAQszB,MAAM,GAC/Bd,EAAO3/B,OAAO4mB,KAAKtT,EAAK9L,KAAK,IAAI2F,QAAQszB,MAAM,GAC/Cd,EAAOrsB,EAAK9L,KAAK,GAAG2B,OAAOs3B,MAAM,SACjCd,EAAOrsB,EAAK9L,KAAK,GAAGrK,OAAOsjC,MAAM,SACjCd,EAAOrsB,EAAK9L,KAAK,GAAGW,OAAO44B,GAAGvd,SAAS,IAGzCkc,EAAG,qBAAqB,KACtBC,EAAOrsB,EAAK+e,WAAWllB,QAAQszB,MAAM,GACrCd,EAAO3/B,OAAO4mB,KAAKtT,EAAK9L,KAAK,IAAI2F,QAAQszB,MAAM,GAC/Cd,EAAOrsB,EAAK+e,WAAW,GAAGlpB,OAAOs3B,MAAM,SACvCd,EAAOrsB,EAAK+e,WAAW,GAAGl1B,OAAOsjC,MAAM,SACvCd,EAAOrsB,EAAK+e,WAAW,GAAGlqB,OAAO44B,GAAGvd,SAAS,GAC7C,IAEJic,EAAS,eAAe,KACtBC,EAAG,qCAAqC,KACtC,MAAMpsB,EAAO,IAAI4f,GACjByM,EAAOrsB,EAAKggB,UAAUnmB,QAAQszB,MAAM,EAAE,IAGxCf,EAAG,+DAA+D,KAChE,MAAMpsB,EAAO,IAAI4f,GACjB5f,EAAK9L,KAAO,CAAC,CAAErK,MAAO,OAAQgL,MAAO,SACrCw3B,EAAOrsB,EAAKggB,UAAUnmB,QAAQszB,MAAM,GACpCd,EAAO3/B,OAAO4mB,KAAKtT,EAAKggB,UAAU,IAAInmB,QAAQszB,MAAM,GACpDd,EAAOrsB,EAAKggB,UAAU,GAAGnrB,OAAOs4B,MAAMntB,EAAK+e,WAAW,GAAGlqB,OACzDw3B,EAAOrsB,EAAKggB,UAAU,GAAGn2B,OAAOsjC,MAAMntB,EAAK+e,WAAW,GAAGl1B,MAAM,IAGjEuiC,EAAG,gEAAgE,KACjE,MAAMpsB,EAAO,IAAI4f,GACjB5f,EAAK3L,MAAO,EACZg4B,EAAOrsB,EAAKggB,UAAUnmB,QAAQszB,MAAM,GACpCd,EAAO3/B,OAAO4mB,KAAKtT,EAAKggB,UAAU,IAAInmB,QAAQszB,MAAM,GACpDd,EAAOrsB,EAAKggB,UAAU,GAAGnrB,OAAOs4B,MAAM,QACtCd,EAAOrsB,EAAKggB,UAAU,GAAGnqB,OAAOs3B,MAAM,QACtCd,EAAOrsB,EAAKggB,UAAU,GAAGhrB,MAAMm4B,MAAM,qBACrCd,EAAOrsB,EAAKggB,UAAU,GAAGjrB,OAAOg4B,QAAQ,kBAAkB,GAC1D,IAGJZ,EAAS,cAAc,KACrBC,EAAG,uDAAuD,KACxD,MAAMpsB,EAAO,IAAI4f,GACjByM,EAAOrsB,EAAK2X,SAAS9d,QAAQszB,MAAM,GACnCd,EAAO3/B,OAAO4mB,KAAKtT,EAAK2X,SAAS,IAAI9d,QAAQszB,MAAM,GACnDd,EAAOrsB,EAAK2X,SAAS,GAAG3iB,MAAMm4B,MAAM,WACpCd,EAAOrsB,EAAK2X,SAAS,GAAG9iB,OAAOs4B,MAAM,GAAG,IAG1Cf,EAAG,wCAAwC,KACzC,MAAMpsB,EAAO,IAAI4f,GACjB5f,EAAKiY,OAAS,OACdoU,EAAOrsB,EAAK2X,SAAS9d,QAAQszB,MAAM,GACnCd,EAAO3/B,OAAO4mB,KAAKtT,EAAK2X,SAAS,IAAI9d,QAAQszB,MAAM,GACnDd,EAAOrsB,EAAK2X,SAAS,GAAG3iB,MAAMm4B,MAAM,WACpCd,EAAOrsB,EAAK2X,SAAS,GAAG9iB,OAAOs4B,MAAM,OAAO,IAG9Cf,EAAG,uCAAuC,KACxC,MAAMpsB,EAAO,IAAI4f,GACjB5f,EAAK7L,OAAQ,EACbk4B,EAAOrsB,EAAK2X,SAAS9d,QAAQszB,MAAM,GACnCd,EAAO3/B,OAAO4mB,KAAKtT,EAAK2X,SAAS,IAAI9d,QAAQszB,MAAM,GACnDd,EAAOrsB,EAAK2X,SAAS,GAAG3iB,MAAMm4B,MAAM,WACpCd,EAAOrsB,EAAK2X,SAAS,GAAG9iB,OAAOs4B,MAAM,IACrCd,EAAO3/B,OAAO4mB,KAAKtT,EAAK2X,SAAS,IAAI9d,QAAQszB,MAAM,GACnDd,EAAOrsB,EAAK2X,SAAS,GAAG9iB,OAAOs4B,MAAM,SACrCd,EAAOrsB,EAAK2X,SAAS,GAAG3iB,MAAMm4B,MAAM,YACpCd,EAAOrsB,EAAK2X,SAAS,GAAG5iB,OAAOg4B,QAAQ,mBAAmB,IAG5DX,EAAG,yCAAyC,KAC1C,MAAMpsB,EAAO,IAAI4f,GACjB5f,EAAK5L,SAAU,EACfi4B,EAAOrsB,EAAK2X,SAAS9d,QAAQszB,MAAM,GACnCd,EAAO3/B,OAAO4mB,KAAKtT,EAAK2X,SAAS,IAAI9d,QAAQszB,MAAM,GACnDd,EAAOrsB,EAAK2X,SAAS,GAAG3iB,MAAMm4B,MAAM,WACpCd,EAAOrsB,EAAK2X,SAAS,GAAG9iB,OAAOs4B,MAAM,IACrCd,EAAO3/B,OAAO4mB,KAAKtT,EAAK2X,SAAS,IAAI9d,QAAQszB,MAAM,GACnDd,EAAOrsB,EAAK2X,SAAS,GAAG9iB,OAAOs4B,MAAM,WACrCd,EAAOrsB,EAAK2X,SAAS,GAAG3iB,MAAMm4B,MAAM,gBACpCd,EAAOrsB,EAAK2X,SAAS,GAAG5iB,OAAOg4B,QAAQ,sBACvCV,EAAO3/B,OAAO4mB,KAAKtT,EAAK2X,SAAS,IAAI9d,QAAQszB,MAAM,GACnDd,EAAOrsB,EAAK2X,SAAS,GAAG9iB,OAAOs4B,MAAM,SACrCd,EAAOrsB,EAAK2X,SAAS,GAAG3iB,MAAMm4B,MAAM,cAAc,IAGpDf,EAAG,qDAAqD,KACtD,MAAMpsB,EAAO,IAAI4f,GACjB5f,EAAK5L,SAAU,EACf4L,EAAKqX,MAAMa,MAAQ,GACnBlY,EAAKqX,MAAMc,OAAS,GACpBnY,EAAKqX,MAAMe,KAAO,GAClBiU,EAAOrsB,EAAK2X,SAAS9d,QAAQszB,MAAM,GACnCd,EAAO3/B,OAAO4mB,KAAKtT,EAAK2X,SAAS,IAAI9d,QAAQszB,MAAM,GACnDd,EAAOrsB,EAAK2X,SAAS,GAAG3iB,MAAMm4B,MAAM,WACpCd,EAAOrsB,EAAK2X,SAAS,GAAG9iB,OAAOs4B,MAAM,IACrCd,EAAO3/B,OAAO4mB,KAAKtT,EAAK2X,SAAS,IAAI9d,QAAQszB,MAAM,GACnDd,EAAOrsB,EAAK2X,SAAS,GAAG9iB,OAAOs4B,MAAM,WACrCd,EAAOrsB,EAAK2X,SAAS,GAAG3iB,MAAMm4B,MAAM,gBACpCd,EAAOrsB,EAAK2X,SAAS,GAAG5iB,OAAOg4B,QAAQ,sBACvCV,EAAO3/B,OAAO4mB,KAAKtT,EAAK2X,SAAS,IAAI9d,QAAQszB,MAAM,GACnDd,EAAOrsB,EAAK2X,SAAS,GAAG9iB,OAAOs4B,MAAM,YACrCd,EAAOrsB,EAAK2X,SAAS,GAAG3iB,MAAMm4B,MAAM,cAAc,IAGpDf,EAAG,sCAAsC,KACvC,MAAMpsB,EAAO,IAAI4f,GACjB5f,EAAK3L,MAAO,EACZg4B,EAAOrsB,EAAK2X,SAAS9d,QAAQszB,MAAM,GACnCd,EAAO3/B,OAAO4mB,KAAKtT,EAAK2X,SAAS,IAAI9d,QAAQszB,MAAM,GACnDd,EAAOrsB,EAAK2X,SAAS,GAAG3iB,MAAMm4B,MAAM,WACpCd,EAAOrsB,EAAK2X,SAAS,GAAG9iB,OAAOs4B,MAAM,IACrCd,EAAO3/B,OAAO4mB,KAAKtT,EAAK2X,SAAS,IAAI9d,QAAQszB,MAAM,GACnDd,EAAOrsB,EAAK2X,SAAS,GAAG9iB,OAAOs4B,MAAM,QACrCd,EAAOrsB,EAAK2X,SAAS,GAAG3iB,MAAMm4B,MAAM,qBACpCd,EAAOrsB,EAAK2X,SAAS,GAAG5iB,OAAOg4B,QAAQ,kBAAkB,IAG3DX,EAAG,sCAAsC,KACvC,MAAMpsB,EAAO,IAAI4f,GACjB5f,EAAK0D,KAAO,QACZ2oB,EAAOrsB,EAAK2X,SAAS9d,QAAQszB,MAAM,GACnCd,EAAO3/B,OAAO4mB,KAAKtT,EAAK2X,SAAS,IAAI9d,QAAQszB,MAAM,GACnDd,EAAOrsB,EAAK2X,SAAS,GAAG3iB,MAAMm4B,MAAM,WACpCd,EAAOrsB,EAAK2X,SAAS,GAAG9iB,OAAOs4B,MAAM,IACrCd,EAAO3/B,OAAO4mB,KAAKtT,EAAK2X,SAAS,IAAI9d,QAAQszB,MAAM,GACnDd,EAAOrsB,EAAK2X,SAAS,GAAG9iB,OAAOs4B,MAC7Bn8B,KAAKuI,KAAKuB,SAAS,yBAErBuxB,EAAOrsB,EAAK2X,SAAS,GAAG3iB,MAAMm4B,MAAM,WAAW,GAC/C,GACF,ECxIG,MACMtgC,GAAU,CAAEm/B,YAAa,qBAEhCC,GAAkB,CAAOr2B,EAAe,CAAE,IAC9CxM,OAAA,OAAA,OAAA,GAAA,YAAA,OAAAyhC,GAAmB,YAAaj1B,EAJf,kBAIyB,IAE5C,IAAAqjC,GAAe,EACb9M,WACAC,KACAC,SACA9H,QACAkS,aACArF,aAEA,MAAMrF,EAAY,IAAI3rB,IAAI,CACxB,QACA,UACA,QACA,SACA,OACA,eAGImW,aAAEA,GAAiBD,GAEzBiO,GAAM,IAAWn7B,OAAA,OAAA,OAAA,GAAA,YACfuiC,IACD,MAEDQ,EAAS,kBAAkB,KACzBC,EAAG,6BAA6B,IAC9BC,EAAO3/B,OAAO4mB,KAAKiD,GAAc1c,QAAQszB,MAAM,KAEjDpB,EAAU1rB,SAAStT,IACjBq/B,EAAG,OAAOr/B,UAAa,IAAMs/B,EAAO9V,EAAaxpB,IAAO0gC,GAAGf,IAAIxc,WAAU,IAG3Ekc,EAAG,sCAAsC,IACvCC,EAAO9V,EAAa2iB,cAAczL,GAAGvd,WAAU,IAGnDic,EAAS,YAAY,KACnB,MAAMgN,EAAwBpsC,GAAgB3D,OAAA,OAAA,OAAA,GAAA,kBAC5C,MAAM4W,QAAa8qB,GAAoB/9B,GACvCs/B,EAAOrsB,GAAMytB,GAAGf,IAAIxc,UACpBmc,EAAOrsB,aAAI,EAAJA,EAAMd,KAAKk6B,OAAO7iB,EAAaxpB,IACtC,MAAM26B,EAAW1nB,aAAA,EAAAA,EAAMjE,WACjBiE,aAAI,EAAJA,EAAMyrB,SACZY,UAAO1d,EAAA3d,KAAK1F,4BAAOiS,MAAMqF,GAAMA,EAAE7G,OAAS2rB,KAAW+F,GAAGvd,SAC1D,IAEAkc,EAAG,6BAA6B,IAAWhjC,OAAA,OAAA,OAAA,GAAA,kBACnC+vC,EAAe,SACtB,MACD/M,EAAG,4BAA4B,IAAWhjC,OAAA,OAAA,OAAA,GAAA,kBAClC+vC,EAAe,QACtB,MACD/M,EAAG,2BAA2B,IAAWhjC,OAAA,OAAA,OAAA,GAAA,kBACjC+vC,EAAe,OACtB,MACD/M,EAAG,4BAA4B,IAAWhjC,OAAA,OAAA,OAAA,GAAA,kBAClC+vC,EAAe,QACtB,MACD/M,EAAG,8BAA8B,IAAWhjC,OAAA,OAAA,OAAA,GAAA,kBACpC+vC,EAAe,UACtB,MACD/M,EAAG,gCAAgC,IAAWhjC,OAAA,OAAA,OAAA,GAAA,kBACtC+vC,EAAe,YACtB,KAAC,IAuBJhN,EAAS,iBAAiB,SAE1BA,EAAS,wBAAwB,KAC/BC,EAAG,2BAA2B,IAAWhjC,OAAA,OAAA,OAAA,GAAA,YACvC,MAAM4W,QAAc8qB,GAAoB/9B,MACxCs/B,EAAOrsB,eAAAA,EAAM1S,OAAOupB,qBAAqB6V,IAAIxc,gBACvClQ,aAAI,EAAJA,EAAMyrB,QACb,KAAC,IAIJU,EAAS,uBAAuB,KAC9BC,EAAG,gDAAgD,SACnDA,EAAG,uDAAuD,QAAS,IAIrED,EAAS,4BAA4B,KACnCC,EAAG,+DAA+D,SAClEA,EAAG,4EAA4E,SAC/EA,EAAG,6DAA6D,SAChEA,EAAG,6BAA6B,QAAS,IAG3CD,EAAS,uBAAuB,KAC9BC,EAAG,oDAAoD,IAAWhjC,OAAA,OAAA,OAAA,GAAA,YAChE,MAAM6P,QAAwBgzB,WACxBlB,GAAoB9xB,EAAO,UACjC,MAAMwd,EAAkBxd,aAAA,EAAAA,EAAO3N,MAAMwa,SAAS,SACxC2Q,aAAM,EAANA,EAAQlX,OAAO,CAAEjS,OAAQ,CAAE6G,OAAO,EAAMC,SAAS,KACvD,MAAMlK,EAASusB,EAAOpT,mBAChBinB,WACArxB,EAAMwyB,SACZY,EAAO3B,KAAc7wB,QAAQszB,MAAM,GACnCiE,EAAOlnC,SACDygC,WACAL,WACAA,WACAA,KACN+B,EAAO3B,KAAc7wB,QAAQszB,MAAM,EACpC,MAEDf,EAAG,2BAA2B,IAAWhjC,OAAA,OAAA,OAAA,GAAA,YACvC,MAAM6P,QAAwBgzB,WACxBlB,GAAoB9xB,EAAO,UACjC,MAAMwd,EAAkBxd,aAAA,EAAAA,EAAO3N,MAAMwa,SAAS,SACxC2Q,aAAM,EAANA,EAAQlX,OAAO,CAAEjS,OAAQ,CAAE8G,SAAS,EAAMD,OAAO,KACvD,MAAMjK,EAASusB,EAAOpT,mBAChBpK,EAAMwyB,SACZ2F,EAAOlnC,EACR,KAAC,IAGJiiC,EAAS,wBAAwB,KAC/BC,EAAG,yCAAyC,IAAWhjC,OAAA,OAAA,OAAA,GAAA,YACrD,MAAM4W,QAAsB8qB,GAAoB,QAChD,UACQ9qB,EAAKuD,aAGZ,CAFC,MAAOvJ,GACPqyB,EAAOryB,EAAM+B,MAAMoxB,MAAM,QAC1B,CACF,MACDf,EAAG,oCAAoC,IAAWhjC,OAAA,OAAA,OAAA,GAAA,YAChD,MAAM4W,QAAsB8qB,GAAoB,eAC1C9qB,EAAKT,OAAO,CAAEjS,OAAQ,CAAEmJ,KAAM,mBAC9BuJ,EAAKuD,oBACL+mB,WACAA,WACAA,KACN+B,EAAO3B,KAAc7wB,QAAQszB,MAAM,SAC7BxC,WACAT,IACP,MACDkC,EAAG,0CAA0C,IAAWhjC,OAAA,OAAA,OAAA,GAAA,YACtD,MAAM4W,QAAsB8qB,GAAoB,eAC1C9qB,EAAKT,OAAO,CAAEjS,OAAQ,CAAEmJ,KAAM,aACpC,MAAMvM,QAAoB8V,EAAKuD,cAC/B6tB,EAAOlnC,aAAkBwM,KAC1B,KAAC,IAGJy1B,EAAS,gBAAgB,KACvBC,EAAG,gDAAgD,IAAWhjC,OAAA,OAAA,OAAA,GAAA,YAC5D,MAAM4W,QAAsB8qB,GAAoB,UAChD,UACQ9qB,EAAKsD,YAGZ,CAFC,MAAOtJ,GACPqyB,EAAOryB,EAAM+B,MAAMoxB,MAAM,QAC1B,CACF,MACDf,EAAG,oDAAoD,IAAWhjC,OAAA,OAAA,OAAA,GAAA,kBAChE,MAAM4W,QAAsB8qB,GAAoB,eAE1C9qB,EAAKT,OAAO,CAAEjS,OAAQ,CAAEymB,KADD,WAEvB/T,EAAKsD,aACX+oB,UAAO1d,EAAA3O,aAAI,EAAJA,EAAM1S,6BAAQymB,MAAMoZ,MAAMkM,EAClC,KAAC,IAGJlN,EAAS,qBAAqB,KAC5BC,EAAG,iDAAiD,IAAWhjC,OAAA,OAAA,OAAA,GAAA,YAC7D,MAEMutB,SAFsBmU,GAAoB,WAE/BjT,YAAY,CAAE,GAC/BwU,EAAO1V,GAAK0W,GAAGC,GAAGpd,SACnB,MACDkc,EAAG,qDAAqD,IAAWhjC,OAAA,OAAA,OAAA,GAAA,YACjE,MAEMutB,SAFsBmU,GAAoB,WAE/BjT,YAAY,CAAEphB,KAAM,WACrC41B,EAAO1V,GAAK+V,IAAIW,GAAGC,GAAGpd,UACtBmc,EAAO1V,eAAAA,EAAK9hB,OAAOs4B,MAAM,cAC1B,KAAC,IAGJhB,EAAS,qBAAqB,KAC5BC,EAAG,iDAAiD,IAAWhjC,OAAA,OAAA,OAAA,GAAA,YAC7D,MAEMutB,SAFsBmU,GAAoB,WAE/BhT,YAAY,CAAE,GAC/BuU,EAAO1V,GAAK0W,GAAGC,GAAGpd,SACnB,MACDkc,EAAG,mDAAmD,IAAWhjC,OAAA,OAAA,OAAA,GAAA,YAC/D,MAEMutB,SAFsBmU,GAAoB,WAE/BhT,YAAY,CAAEpU,KAAM,UACrC2oB,EAAO1V,GAAK+V,IAAIW,GAAGC,GAAGpd,UACtBmc,EAAO1V,eAAAA,EAAK9hB,OAAOs4B,MAAM,gBACzBd,EAAO1V,eAAAA,EAAK3hB,MAAMm4B,MAAM,WACzB,KAAC,IAGJhB,EAAS,yBAAyB,KAChC,MAAMmN,EAAoB,CACxBt5B,EACA2W,EACA4iB,IAEEnwC,OAAA,OAAA,OAAA,GAAA,wBACFijC,UAAO1d,EAAA3O,aAAI,EAAJA,EAAM1S,6BAAQ4G,KAAK2F,QAAQszB,MAAM,SAClCntB,eAAAA,EAAMyY,cAAc,CAAC9B,IAC3B0V,UAAOlZ,EAAAnT,aAAI,EAAJA,EAAM1S,6BAAQ4G,KAAK2F,QAAQszB,MAAM,GACxC,MAAMqM,EAA8B,QAApBvY,EAAc,QAAdP,EAAA1gB,aAAI,EAAJA,EAAM1S,cAAQ,IAAAozB,OAAA,EAAAA,EAAAxsB,YAAM,IAAA+sB,OAAA,EAAAA,EAAA9Z,MACpCklB,EAAOmN,EAAQ3kC,OAAOs4B,MAAMoM,EAAY1kC,OACxCw3B,EAAOmN,EAAQ3jC,OAAOs3B,MAAMoM,EAAY1jC,OACxCw2B,EAAOmN,EAAQ3vC,OAAOsjC,MAAMoM,EAAY1vC,MAC1C,IAQM4vC,EAAqB,CACzBz5B,EACAvG,KAEA4yB,EAAOrsB,EAAK1S,OAAO6G,OAAOg5B,MAAM1zB,EAAMtF,OACtCk4B,EAAOrsB,EAAK1S,OAAO+G,MAAM84B,MAAM1zB,EAAMpF,MACrCg4B,EAAOrsB,EAAK1S,OAAO8G,SAAS+4B,MAAM1zB,EAAMrF,QAAQ,EAGlDg4B,EAAG,oDAAoD,IAAWhjC,OAAA,OAAA,OAAA,GAAA,YAChE,MAAM4W,QAAsB8qB,GAAoB,gBAC1CwO,EAAkBt5B,EAAM,OAAQ,CACpCnL,MAAO,OACPgB,MAAO,OACPhM,MAAO,SAETmW,EAAKyrB,QACN,MACDW,EAAG,+DAA+D,IAAWhjC,OAAA,OAAA,OAAA,GAAA,YAC3E,MAAM4W,QAAsB8qB,GAAoB,gBAC1CwO,EAAkBt5B,EAAM,eAAgB,CAC5CnL,MAAO,OACPgB,MAAO,QACPhM,MAAO,SAETmW,EAAKyrB,QACN,MAGDW,EAAG,mCAAmC,IAAWhjC,OAAA,OAAA,OAAA,GAAA,YAC/C,MAAM4W,QAAsB8qB,GAAoB,UAChD2O,EAAmBz5B,EAAM,CAAE7L,OAAO,EAAME,MAAM,EAAOD,SAAS,UACxD4L,aAAI,EAAJA,EAAMyrB,QACb,MAGmB,IAAIrrB,IAAI,CAC1BtL,OAAOjE,IAAIqD,KAAKC,MAChBW,OAAOjE,IAAIqD,KAAKG,KAChBS,OAAOjE,IAAIqD,KAAKE,UAGNiM,SAASmS,IACnB4Z,EAAG,IAAI5Z,8CAA8C,IAAWppB,OAAA,OAAA,OAAA,GAAA,YAC9D,MAAM4W,QAAsB8qB,GAAoB,eAjD9B,EAAO9qB,EAAe2W,IAAevtB,OAAA,OAAA,OAAA,GAAA,kBACzDijC,UAAOT,EAAA5rB,aAAI,EAAJA,EAAM1S,6BAAQ4G,KAAK2F,QAAQszB,MAAM,SAClCntB,eAAAA,EAAMyY,cAAc,CAAC9B,GAC7B,IA+CU8B,CAAczY,EAAMwS,GAC1BinB,EAAmBz5B,EAAM,CACvB7L,OAAO,EACPE,KAAMme,IAAM1d,OAAOjE,IAAIqD,KAAKG,KAC5BD,QAASoe,IAAM1d,OAAOjE,IAAIqD,KAAKE,UAEjC4L,EAAKyrB,QACN,MACDW,EAAG,UAAU5Z,iDAAiD,IAAWppB,OAAA,OAAA,OAAA,GAAA,YACvE,MAAM4W,QAAsB8qB,GAAoB,gBAC1CwO,EAAkBt5B,EAAM,SAASwS,KAAM,CAC3C3d,MAAO,OACPgB,MAAO2c,EACP3oB,MAAO,SAET4vC,EAAmBz5B,EAAM,CACvB7L,OAAO,EACPE,KAAMme,IAAM1d,OAAOjE,IAAIqD,KAAKG,KAC5BD,QAASoe,IAAM1d,OAAOjE,IAAIqD,KAAKE,UAEjC4L,EAAKyrB,QACN,KAAC,GACF,IAGJU,EAAS,uBAAuB,KAC9BC,EAAG,6CAA6C,IAAWhjC,OAAA,OAAA,OAAA,GAAA,YACzD,MAAM4W,QAAsB8qB,GAAoB,UAChDuB,EAAOrsB,EAAK1S,OAAO4G,KAAK2F,QAAQszB,MAAM,GACtC,MAAMuM,QAAkB15B,EAAKgZ,aAAa,QAC1CqT,EAAOqN,GAAWvM,WAAMjd,EACzB,MACDkc,EAAG,+DAA+D,IAAWhjC,OAAA,OAAA,OAAA,GAAA,YAC3E,MAAM4W,QAAsB8qB,GAAoB,UAChDuB,EAAOrsB,EAAK1S,OAAO4G,KAAK2F,QAAQszB,MAAM,SAEhCntB,EAAKyY,cAAc,CAAC,OAAQ,UAClC4T,EAAOrsB,EAAK1S,OAAO4G,KAAK2F,QAAQszB,MAAM,SAEhCntB,EAAKgZ,aAAa,QACxBqT,EAAOrsB,EAAK1S,OAAO4G,KAAK2F,QAAQszB,MAAM,GACtCd,EAAOrsB,EAAK1S,OAAO4G,KAAKiT,MAAMtR,OAAOs3B,MAAM,QAC5C,KAAC,IAGJhB,EAAS,oBAAoB,KAC3BC,EAAG,0BAA0B,IAAWhjC,OAAA,OAAA,OAAA,GAAA,YACtC,MAAM4W,QAAsB8qB,GAAoB,aAC1C9S,EAAUhY,EAAK+X,iBACrBsU,EAAOrU,EAAQne,QAAQszB,MAAM,GAC7BntB,EAAKyrB,QACN,MACDW,EAAG,qBAAqB,IAAWhjC,OAAA,OAAA,OAAA,GAAA,YACjC,MAAM4W,QAAsB8qB,GAAoB,QAC1C9S,EAAUhY,EAAK+X,iBACrBsU,EAAOrU,EAAQne,QAAQszB,MAAM,GAC7BntB,EAAKyrB,QACN,MACDW,EAAG,mCAAmC,IAAWhjC,OAAA,OAAA,OAAA,GAAA,YAC/C,MAAM4W,QAAsB8qB,GAAoB,UAC1C9S,EAAUhY,EAAK+X,iBACrBsU,EAAOrU,EAAQne,QAAQszB,MAAM,GAC7Bd,EAAOrU,EAAQ,GAAGhjB,MAAMm4B,MAAM,WAC9Bd,EAAOrU,EAAQ,GAAGnjB,OAAOs4B,MAAM,OAC/BntB,EAAKyrB,QACN,MACDW,EAAG,qCAAqC,IAAWhjC,OAAA,OAAA,OAAA,GAAA,YACjD,MAAM4W,QAAsB8qB,GAAoB,gBAC1C9qB,EAAKyY,cAAc,CAAC3jB,OAAOjE,IAAIqD,KAAKE,UAC1Cg9B,EAAOpxB,EAAK1S,OAAO8G,SACnB,MAAM4jB,EAAUhY,EAAK+X,iBACrBsU,EAAOrU,EAAQne,QAAQszB,MAAM,GAC7Bd,EAAOrU,EAAQ,GAAGhjB,MAAMm4B,MAAM,WAC9Bd,EAAOrU,EAAQ,GAAGnjB,OAAOs4B,MAAM,OAC/Bd,EAAOrU,EAAQ,GAAGhjB,MAAMm4B,MAAM,eAC9Bd,EAAOrU,EAAQ,GAAGnjB,OAAOs4B,MAAM,SAC/BntB,EAAKyrB,QACN,MACDW,EAAG,kCAAkC,IAAWhjC,OAAA,OAAA,OAAA,GAAA,YAC9C,MAAM4W,QAAsB8qB,GAAoB,gBAC1C9qB,EAAKyY,cAAc,CAAC,SAC1B,MAAMT,EAAUhY,EAAK+X,iBACrBsU,EAAOrU,EAAQne,QAAQszB,MAAM,GAC7Bd,EAAOrU,EAAQ,GAAGhjB,MAAMm4B,MAAM,WAC9Bd,EAAOrU,EAAQ,GAAGnjB,OAAOs4B,MAAM,OAC/Bd,EAAOrU,EAAQ,GAAGnjB,OAAOs4B,MAAM,QAC/BntB,EAAKyrB,QACN,MACDW,EAAG,wCAAwC,IAAWhjC,OAAA,OAAA,OAAA,GAAA,YACpD,MAAM4W,QAAsB8qB,GAAoB,SAC1C9S,EAAUhY,EAAK+X,iBACrBsU,EAAOrU,EAAQne,QAAQszB,MAAM,GAC7Bd,EAAOrU,EAAQ,GAAGhjB,MAAMm4B,MAAM,aAC9Bd,EAAOrU,EAAQ,GAAGnjB,OAAOs4B,MAAM,SAC/BntB,EAAKyrB,QACN,MACDW,EAAG,sCAAsC,IAAWhjC,OAAA,OAAA,OAAA,GAAA,YAClD,MAAM4W,QAAsB8qB,GAAoB,eAC1C9qB,EAAKT,OAAO,CAAEjS,OAAQ,CAAEP,KAAM,WACpC,MAAMirB,EAAUhY,EAAK+X,iBACrBsU,EAAOrU,EAAQne,QAAQszB,MAAM,GAC7Bd,EAAOrU,EAAQ,GAAGhjB,MAAMm4B,MAAM,aAC9Bd,EAAOrU,EAAQ,GAAGnjB,OAAOs4B,MAAM,SAC/BntB,EAAKyrB,QACN,MACDW,EAAG,kDAAkD,IAAWhjC,OAAA,OAAA,OAAA,GAAA,YAC9D,MAAM4W,QAAsB8qB,GAAoB,SAC1C9S,EAAUhY,EAAK+X,iBACrBsU,EAAOrU,EAAQne,QAAQszB,MAAM,GAC7Bd,EAAOrU,EAAQ,GAAGnjB,OAAOs4B,MAAM,cAC/Bd,EAAOrU,EAAQ,GAAGnjB,OAAOs4B,MAAM,IAC/Bd,EAAOrU,EAAQ,GAAGnjB,OAAOs4B,MAAM,IAC/BntB,EAAKyrB,QACN,MACDW,EAAG,uCAAuC,IAAWhjC,OAAA,OAAA,OAAA,GAAA,YACnD,MAAM4W,QAAsB8qB,GAAoB,iBAC1C9qB,EAAKT,OAAO,CAAEjS,OAAQ,CAAE+qB,aAAc,eAC5C,MAAML,EAAUhY,EAAK+X,iBACrBsU,EAAOrU,EAAQne,QAAQszB,MAAM,GAC7Bd,EAAOrU,EAAQ,GAAGnjB,OAAOs4B,MAAM,SAC/Bd,EAAOrU,EAAQ,GAAGnjB,OAAOs4B,MAAM,OAC/BntB,EAAKyrB,QACN,MACDW,EAAG,oCAAoC,IAAWhjC,OAAA,OAAA,OAAA,GAAA,YAChD,MAAM4W,QAAsB8qB,GAAoB,eAC1C9qB,EAAKT,OAAO,CAAEjS,OAAQ,CAAEmJ,KAAM,aACpC,MAAMuhB,EAAUhY,EAAK+X,iBACrBsU,EAAOrU,EAAQne,QAAQszB,MAAM,GAC7Bd,EAAOrU,EAAQ,GAAGnjB,OAAOs4B,MAAM,gBAC/BntB,EAAKyrB,QACN,MACDW,EAAG,oCAAoC,IAAWhjC,OAAA,OAAA,OAAA,GAAA,YAChD,MAAM4W,QAAsB8qB,GAAoB,eAC1C9qB,EAAKT,OAAO,CAAEjS,OAAQ,CAAEoW,KAAM,WACpC,MAAMsU,EAAUhY,EAAK+X,iBACrBsU,EAAOrU,EAAQne,QAAQszB,MAAM,GAC7Bd,EAAOrU,EAAQ,GAAGnjB,OAAOs4B,MAAM,gBAC/Bd,EAAOrU,EAAQ,GAAGhjB,MAAMm4B,MAAM,YAC9BntB,EAAKyrB,QACN,KAAC,IAIJU,EAAS,iBAAiB,KACxBC,EAAG,4CAA4C,IAAahjC,OAAA,OAAA,OAAA,GAAA,YAAC,MAC7DgjC,EAAG,2CAA2C,SAC9CA,EAAG,oFAAoF,SACvFA,EAAG,0EAA0E,SAC7EA,EAAG,qCAAqC,SACxCA,EAAG,sCAAsC,QAAS,IAGpDD,EAAS,UAAU,KACjBsK,GAAW,IAAWrtC,OAAA,OAAA,OAAA,GAAA,kBACd8gC,IACP,MAED3F,GAAM,IAAWn7B,OAAA,OAAA,OAAA,GAAA,kBACL,QAAVulB,EAAA3d,KAAK1F,aAAK,IAAAqjB,GAAAA,EACNhV,QAAQiJ,IAAK,IAAA+L,EAAC,OAAO,QAAPA,EAAA/L,eAAAA,EAAG7G,YAAI,IAAA4S,OAAA,EAAAA,EAAEgE,QAAQ,uBAAwB,IAAK,CAAK,IAClEtS,SAAexR,GAAKzF,OAAA,OAAA,OAAA,GAAA,YAAC,OAAAyF,EAAE48B,QAAQ,YAC5BvB,IACP,MAGD,MAAMyP,EAAyB9iC,GAAoBzN,OAAA,OAAA,OAAA,GAAA,0BACjDgoC,EACE,CAAC,aAAc,SAAU,YAAa,YAAY7iC,SAASsI,IAE7Dw1B,EAAoB,QAAblZ,EAAAniB,KAAK+oB,gBAAQ,IAAA5G,OAAA,EAAAA,EAAE+J,MAAMiQ,MAAM,GAClCn8B,KAAKI,SAASpG,IAAI,OAAQ,WAAY6L,GACtCw1B,EAAOr7B,KAAKI,SAAStG,IAAI,OAAQ,aAAaqiC,MAAMt2B,GACpD,MAAMmJ,QAAsB8qB,GAAoB,gBAC1C9qB,aAAI,EAAJA,EAAMuC,OACZ8pB,EAAoB,QAAb3L,EAAA1vB,KAAK+oB,gBAAQ,IAAA2G,OAAA,EAAAA,EAAExD,MAAMiQ,MAAM,GAClC,MAAMl3B,EAA2B,QAAbgrB,EAAAjwB,KAAK+oB,gBAAQ,IAAAkH,OAAA,EAAAA,EAAEnb,SAASqB,MAC5CklB,EAAOp2B,aAAW,EAAXA,EAAamB,OAAO+1B,MAAmB,cAAbt2B,GACjCw1B,EAAOp2B,eAAAA,EAAalJ,MAAMogC,MAAM,GACf,eAAbt2B,EACFw1B,EAA2B,QAApBT,EAAA31B,eAAAA,EAAae,eAAO,IAAA40B,OAAA,EAAAA,EAAE/xB,QAAQszB,MAAM,GAEvB,QAApBrB,EAAA71B,aAAW,EAAXA,EAAae,eAAO,IAAA80B,GAAAA,EAAEzrB,SAASuC,YAE7BwuB,EAAiD,UAAhC,QAAVziB,EAAA3d,KAAK4oC,aAAK,IAAAjrB,OAAA,EAAAA,EAAEpR,MAAMs8B,GAAYA,EAAE1iC,MAAQyL,WAAE,IAAAuQ,OAAA,EAAAA,EAAEpc,KAAK,UAGtDiJ,aAAI,EAAJA,EAAMyrB,QACd,IAEAW,EAAG,+CAA+C,IAAWhjC,OAAA,OAAA,OAAA,GAAA,kBACrDuwC,EAAgB,SACvB,MAEDvN,EAAG,sDAAsD,IAAWhjC,OAAA,OAAA,OAAA,GAAA,kBAC5DuwC,EAAgB,YACvB,MAEDvN,EAAG,0CAA0C,IAAWhjC,OAAA,OAAA,OAAA,GAAA,kBAChDuwC,EAAgB,WACvB,MACDvN,EAAG,qDAAqD,IAAWhjC,OAAA,OAAA,OAAA,GAAA,kBAC3DuwC,EAAgB,aACvB,KAAC,IAIJxN,EAAS,mCAAmC,SAC5CA,EAAS,4BAA4B,SAGrCA,EAAS,2BAA2B,KAClCC,EAAG,4CAA4C,SAC/CA,EAAG,4CAA4C,SAC/CA,EAAG,+DAA+D,QAAS,IAI7ED,EAAS,6BAA6B,QAAS,ECrgB1C,MACMt/B,GAAU,CAAEm/B,YAAa,oBAEtC,IAAA8N,GAAe,EAAG3N,WAAUC,KAAIC,SAAQ9H,QAAO6M,aAC7C7M,GAAM,KACJoH,IAAmB,IAGrBQ,EAAS,qBAAqB,KAC5BC,EAAG,oCAAoC,IAAWhjC,OAAA,OAAA,OAAA,GAAA,YAChD,MAAM4W,QAAa8qB,GAAoB,QACjCtrB,EAAQQ,aAAA,EAAAA,EAAMR,MACpB6sB,EAAO7sB,GAAOiuB,GAAGf,IAAIxc,UACrBmc,EAAO7sB,aAAA,EAAAA,EAAO3S,QAAQ8O,QAAQ9B,QAAQszB,MAAM,GAC5Cd,EAAO7sB,aAAK,EAALA,EAAO3S,QAAQ8O,SAASoxB,QAAQ,OACvCV,EAAO7sB,aAAK,EAALA,EAAO3S,QAAQ8O,SAASoxB,QAAQ,SACvCV,EAAO7sB,aAAK,EAALA,EAAO3S,QAAQ8O,SAASoxB,QAAQ,QACvCV,EAAO7sB,aAAK,EAALA,EAAO3S,QAAQ+O,OAAOuxB,MAAM,KACnCd,EAAO7sB,aAAK,EAALA,EAAO3S,QAAQ6b,QAAQykB,MAAM,KACpCiE,IAAQ5xB,aAAK,EAALA,EAAO3S,QAAQ2b,YACvB6jB,EAAO7sB,aAAA,EAAAA,EAAO3S,QAAQ2d,KAAK3Q,QAAQszB,MAAM,GACzCd,EAAO3/B,OAAO4mB,KAAK9T,aAAK,EAALA,EAAO3S,QAAQ2d,KAAK,IAAI3Q,QAAQszB,MAAM,GACzDd,EAAO3/B,OAAO4mB,KAAK9T,aAAA,EAAAA,EAAO3S,QAAQ2d,KAAK,KAAKuiB,QAAQ,YACpDV,SAAc7sB,aAAK,EAALA,EAAO3S,QAAQ2d,KAAK,GAAGzP,WAAUoyB,MAAM,YACrDd,EAAO7sB,eAAAA,EAAO3S,QAAQ2d,KAAK,GAAGzP,SAASgB,MAAMgxB,QAAQ,gBACrDV,EAAO3/B,OAAO4mB,KAAK9T,aAAA,EAAAA,EAAO3S,QAAQ2d,KAAK,KAAKuiB,QAAQ,eACpDV,EAAO7sB,eAAAA,EAAO3S,QAAQ2d,KAAK,GAAGC,aAAa0iB,MAAM,SACjDd,EAAO3/B,OAAO4mB,KAAK9T,aAAA,EAAAA,EAAO3S,QAAQ2d,KAAK,KAAKuiB,QAAQ,mBACpDV,EAAO7sB,eAAAA,EAAO3S,QAAQ2d,KAAK,GAAGE,iBAAiByiB,MAAM,eACrDd,EAAO3/B,OAAO4mB,KAAK9T,aAAA,EAAAA,EAAO3S,QAAQ2d,KAAK,KAAKuiB,QAAQ,WACpDV,EAAO7sB,eAAAA,EAAO3S,QAAQ2d,KAAK,GAAGG,SAASwiB,MAAM,cAC9C,KAAC,IAGJhB,EAAS,cAAc,KACrBC,EAAG,qBAAqB,IAAWhjC,OAAA,OAAA,OAAA,GAAA,YACjC,MAAM4W,QAAa8qB,GAAoB,QACjCtrB,EAAQQ,aAAA,EAAAA,EAAMR,MACpB6sB,EAAO7sB,GAAOiuB,GAAGf,IAAIxc,UACrBmc,EAAO7sB,eAAAA,EAAOtJ,UAAU62B,QAAQ,mBAChCV,EAAO7sB,eAAAA,EAAOtJ,UAAU62B,QAAQ,cACjC,KAAC,IAGJZ,EAAS,aAAa,KACpBC,EAAG,gBAAgB,IAAWhjC,OAAA,OAAA,OAAA,GAAA,YAC5B,MAAM4W,QAAa8qB,GAAoB,QACjCtrB,EAAQQ,aAAA,EAAAA,EAAMR,MACpB6sB,EAAO7sB,GAAOiuB,GAAGf,IAAIxc,UACrB,MAAMta,QAAa4J,aAAK,EAALA,EAAOxD,UAC1BqwB,EAAO3/B,OAAO4mB,KAAK1d,IAAOm3B,QAAQ,OAClCV,EAAO3/B,OAAO4mB,KAAK1d,IAAOm3B,QAAQ,YAClCV,EAAO3/B,OAAO4mB,KAAK1d,IAAOm3B,QAAQ,UAClCV,EAAO3/B,OAAO4mB,KAAK1d,IAAOm3B,QAAQ,WACnC,KAAC,GACF,ECrDG,MAAMtnB,GAAM,mBACN5Y,GAAU,CAAEm/B,YAAa,sBAKtC,IAAA+N,GAAe,EAAG5N,WAAUC,KAAIC,SAAQ+E,SAAQ7M,YAC9C4H,EAAS,kBAAkB,KACzBC,EAAG,qCAAqC,IAAWhjC,OAAA,OAAA,OAAA,GAAA,kBACjD,MAAM6P,OANY,EAAOlM,EAAc6I,EAAe,CAAE,IAAIxM,OAAA,OAAA,OAAA,GAAA,YAChE,OAAAyhC,GAAmB99B,EAAM6I,EAAM6P,GAAI,IAKXwmB,CAAgB,aAC9BlD,EAAa,IAAIC,GAEjBgR,QAAuBjR,EAAWW,iBAAiBzwB,GACzDozB,EAAO2N,GAAgBvM,GAAGvd,UAC1BkhB,EAAOn4B,aAAA,EAAAA,EAAOipB,QAAQlxB,KAAK1D,OAAO2D,GAAI,UAEtC,MAAMi3B,EAAQH,GACRkS,EAA6B,QAAbtrB,EAAA3d,KAAK4pB,cAAQ,IAAAjM,OAAA,EAAAA,EAAAhV,QAChCiJ,IAAM,IAAA+L,EAAA,OAAyB,QAAzBA,EAAA/L,EAAEnJ,MAAMzI,KAAK1D,OAAO2D,WAAK,IAAA0d,OAAA,EAAAA,EAAAuZ,KAAK,IAEvCmE,EAAOnE,EAAMF,aAAanuB,QAAQszB,MAAM8M,aAAa,EAAbA,EAAepgC,cACjDZ,aAAK,EAALA,EAAOwyB,QACd,KAAC,IAGJlH,GAAM,IAAWn7B,OAAA,OAAA,OAAA,GAAA,kBACTsiC,GAAmBjmB,GAC1B,KAAC,ECvBG,MAAMA,GAAM,kBACN5Y,GAAU,CAAEm/B,YAAa,qBAEhCC,GAAkB,CAAOl/B,EAAc6I,EAAe,CAAE,IAAIxM,OAAA,OAAA,OAAA,GAAA,YAChE,OAAAyhC,GAAmB99B,EAAM6I,EAAM6P,GAAI,IAErC,IAAAy0B,GAAe,EAAG/N,WAAUC,KAAIC,SAAQ+E,SAAQ7M,YAC9C4H,EAAS,oBAAoB,KAC3BC,EAAG,oCAAoC,KACrC,MAAMrD,EAAa,IAAIC,GACvBqD,EAAOtD,EAAWl8B,QAAQ8O,SAASoxB,QAAQ,OAC3CV,EAAOtD,EAAWl8B,QAAQ8O,SAASoxB,QAAQ,UAC3CV,EAAOtD,EAAWl8B,QAAQ8O,SAASoxB,QAAQ,eAC3CV,EAAOtD,EAAWl8B,QAAQqJ,UAAU62B,QAClC,oCAEFV,EAAOtD,EAAWl8B,QAAQ+O,OAAOuxB,MAAM,KACvCd,EAAOtD,EAAWl8B,QAAQ6b,QAAQykB,MAAM,KACxCiE,EAAOrI,EAAWl8B,QAAQ2b,WAC1B6jB,EAAOtD,EAAWl8B,QAAQo8B,SAAS,GAAGC,cAAciE,MAClD,sBAEFd,EAAOtD,EAAWl8B,QAAQo8B,SAAS,GAAGE,cAAcgE,MAClD,kBAEFiE,GAAQrI,EAAWl8B,QAAQu7B,cAAc,GACzC,IAIJ+D,EAAS,UAAU,SAEnBA,EAAS,gCAAgC,KACvCC,EAAG,0BAA0B,IAAWhjC,OAAA,OAAA,OAAA,GAAA,YACtC4/B,GAAcmR,uBACR7P,KACN,MAAMkL,EAAUjL,GAAY,eAC5B8B,EAAOmJ,EAAQ37B,QAAQszB,MAAM,GAC7Bd,EAAOmJ,EAAQ,GAAG3oC,QAAQ8O,SAASoxB,QAAQ,qBACrCyI,EAAQ,GAAGl6B,QACjB+wB,EAAO9B,GAAY,eAAe1wB,QAAQszB,MAAM,EACjD,KAAC,IAGJhB,EAAS,gBAAgB,KACvBC,EAAG,wBAAwB,KACzB,MAAMrD,WAAEA,GAAeC,GACvBqD,EAAOtD,GAAY0E,GAAGf,IAAIxc,UAC1Bmc,EAAOtD,aAAU,EAAVA,EAAYl8B,QAAQ8O,SAASoxB,QAAQ,cAAc,GAC1D,IAGJZ,EAAS,WAAW,KAClBC,EAAG,yCAAyC,IAAWhjC,OAAA,OAAA,OAAA,GAAA,kBACrD4/B,GAAcmR,uBACR7P,KACN,MAAMgO,EAEH,QAFiB3pB,EAAA9B,SAAS5R,cAC3B,wCACC,IAAA0T,OAAA,EAAAA,EAAAmV,UACHuI,SAAciM,GAAanL,MAAM,UACjC,MAAMqI,EAAUjL,GAAY,eAC5B8B,EAAOmJ,EAAQ37B,QAAQszB,MAAM,SACvBqI,EAAQ,GAAGl6B,QACjB+wB,EAAO9B,GAAY,eAAe1wB,QAAQszB,MAAM,EACjD,KAAC,IAGJhB,EAAS,aAAa,KACpBC,EAAG,uBAAuB,KACxB,MACMx2B,GADQ,IAAIozB,IACChtB,UACbsX,EAAO5mB,OAAO4mB,KAAK1d,GACzBy2B,EAAO/Y,EAAKzZ,QAAQszB,MAAM,GAC1Bd,EAAO/Y,GAAMyZ,QAAQ,eACrBV,EAAO/Y,GAAMyZ,QAAQ,UACrBV,EAAO/Y,GAAMyZ,QAAQ,QACrBV,EAAO/Y,GAAMyZ,QAAQ,WAAW,GAChC,IAGJZ,EAAS,2BAA2B,KAClCC,EAAG,6BAA6B,IAAWhjC,OAAA,OAAA,OAAA,GAAA,YACzC,MAAM6P,QAAcgzB,GAAgB,WAC9BlD,EAAa,IAAIC,GAEjBgR,QAAuBjR,EAAWW,iBAAiBzwB,GACzDozB,EAAO2N,GAAgBvM,GAAGvd,gBACpBjX,EAAMwyB,QACb,MAEDW,EAAG,wCAAwC,IAAWhjC,OAAA,OAAA,OAAA,GAAA,YACpD,MAAM6P,QAAcgzB,GAAgB,aAC9BlD,EAAa,IAAIC,GAEjBgR,QAAuBjR,EAAWW,iBAAiBzwB,GACzDozB,EAAO2N,GAAgBvM,GAAGvd,UAC1BkhB,EAAOn4B,aAAA,EAAAA,EAAOipB,QAAQlxB,KAAK1D,OAAO2D,GAAI,gBAChCgI,EAAMwyB,QACb,KAAC,IAGJU,EAAS,gCAAgC,IAAW/iC,OAAA,OAAA,OAAA,GAAA,YAClDgjC,EAAG,gDAAgD,IAAWhjC,OAAA,OAAA,OAAA,GAAA,YAC5D,MAAM6P,QAAcgzB,GAAgB,aAC9BlD,EAAa,IAAIC,GAEjBoR,QAA0BrR,EAAWW,iBAAiBzwB,GAC5DozB,EAAO+N,GAAmB3M,GAAGvd,UAC7BkhB,EAAOn4B,aAAA,EAAAA,EAAOipB,QAAQlxB,KAAK1D,OAAO2D,GAAI,UAEtC,MAAMopC,QAA6BtR,EAAWgB,sBAAsB9wB,GACpEozB,EAAOgO,GAAsB5M,GAAGvd,UAChCkhB,IAAQn4B,aAAK,EAALA,EAAOipB,QAAQlxB,KAAK1D,OAAO2D,GAAI,iBACjCgI,EAAMwyB,QACb,KACF,MAGDU,EAAS,kBAAkB,SAE3BA,EAAS,6BAA6B,KAEpCC,EAAG,6CAA6C,IAAWhjC,OAAA,OAAA,OAAA,GAAA,YACzD,MAAM2/B,EAAa,IAAIC,GAEjBsR,QAAyBvR,EAAWQ,aAJ9B,GAIkD,CAC5Dx8B,KAAM,cAERs/B,EAAOiO,GAAkB7M,GAAGvd,SAC7B,MAEDkc,EAAG,4CAA4C,IAAWhjC,OAAA,OAAA,OAAA,GAAA,YACxD,MAAM6P,QAAcgzB,GAAgB,aAC9Br2B,EAAO,CACX7I,KAAMkM,aAAA,EAAAA,EAAO4wB,aACbjkB,KAAM3M,aAAA,EAAAA,EAAO2M,MAETmjB,EAAa,IAAIC,GAEjBgR,QAAuBjR,EAAWQ,aAlB5B,GAkBgD3zB,SACtD00B,KACN+B,EAAO2N,GAAgBvM,GAAGvd,UAC1BkhB,EAAOn4B,aAAA,EAAAA,EAAOipB,QAAQlxB,KAAK1D,OAAO2D,GAAI,gBAChCgI,aAAK,EAALA,EAAOwyB,QACd,KAAC,IAGJU,EAAS,+BAA+B,KACtCC,EAAG,wCAAwC,IAAWhjC,OAAA,OAAA,OAAA,GAAA,YACpD,MAAM2/B,EAAa,IAAIC,GACjBtjB,QAAe60B,OAAOziC,OAAO,CACjCiE,KAAM,eAAe0J,KACrB1Y,KAAM,UAEFkM,QAAcgzB,GAAgB,mBAE9BhzB,eAAAA,EAAOsG,OAAO,CAAEmG,OAAQA,aAAA,EAAAA,EAAQvO,MACtCk1B,EAAOpzB,eAAAA,EAAOyM,QAAQynB,MAAMznB,GAE5BqjB,EAAWY,oBAAoBjkB,SACzB4kB,KACN8G,EAAOn4B,aAAA,EAAAA,EAAOipB,QAAQlxB,KAAK1D,OAAO2D,GAAI,gBAChCgI,aAAK,EAALA,EAAOwyB,eACP/lB,aAAM,EAANA,EAAQ+lB,QACf,MAEDW,EAAG,yDAAyD,IAAWhjC,OAAA,OAAA,OAAA,GAAA,YACrE,MAAM2/B,EAAa,IAAIC,GACjBtjB,QAAe60B,OAAOziC,OAAO,CACjCiE,KAAM,eAAe0J,KACrB1Y,KAAM,UAEFytC,QAAkBD,OAAOziC,OAAO,CACpCiE,KAAM,eAAe0J,eACrB1Y,KAAM,QACN2Y,OAAQA,EAAOvO,MAEX8B,QAAcgzB,GAAgB,mBAE9BhzB,eAAAA,EAAOsG,OAAO,CAAEmG,OAAQ80B,aAAA,EAAAA,EAAWrjC,MACzCk1B,EAAOpzB,eAAAA,EAAOyM,QAAQynB,MAAMqN,GAE5BzR,EAAWY,oBAAoBjkB,SACzB4kB,KACN8G,EAAOn4B,aAAA,EAAAA,EAAOipB,QAAQlxB,KAAK1D,OAAO2D,GAAI,gBAChCgI,aAAK,EAALA,EAAOwyB,QACd,KAAC,IAGJU,EAAS,8BAA8B,KACrCC,EAAG,kEAAkE,IAAWhjC,OAAA,OAAA,OAAA,GAAA,YAC9E,MAGM2/B,EAAa,IAAIC,GACjByR,QAAiB1R,EAAWS,cAAc,GAJ/B,CACfK,aAAc,cAIhBwC,EAAOoO,GAAUhN,GAAGvd,SACrB,MAEDkc,EAAG,8DAA8D,IAAWhjC,OAAA,OAAA,OAAA,GAAA,YAC1E,MAAM2/B,EAAa,IAAIC,GACjBtjB,QAAe60B,OAAOziC,OAAO,CACjCiE,KAAM,eAAe0J,KACrB1Y,KAAM,UAEFkM,QAAcgzB,GAAgB,mBAE9BhzB,eAAAA,EAAOsG,OAAO,CAAEmG,OAAQA,aAAA,EAAAA,EAAQvO,MACtCk1B,EAAOpzB,eAAAA,EAAOyM,QAAQynB,MAAMznB,SAEtBqjB,EAAWS,cAAc,GAAI9jB,SAC7B4kB,KACN8G,EAAOn4B,aAAA,EAAAA,EAAOipB,QAAQlxB,KAAK1D,OAAO2D,GAAI,gBAChCgI,aAAK,EAALA,EAAOwyB,eACP/lB,aAAM,EAANA,EAAQ+lB,QACf,KAAC,IAIJU,EAAS,uBAAuB,SAGhCA,EAAS,kBAAkB,SAE3B5H,GAAM,IAAWn7B,OAAA,OAAA,OAAA,GAAA,sBACfsiC,GAAmBjmB,YACnBib,EACI,UADQ,QAAZ/R,EAAA3d,KAAK0pC,eAAO,IAAA/rB,OAAA,EAAAA,EAAE7I,gBACV,IAAAqN,OAAA,EAAAA,EAAAxZ,QAAQmS,IAAK,IAAA6C,EAAC,OAAM,QAANA,EAAA7C,EAAE/P,YAAI,IAAA4S,OAAA,EAAAA,EAAEpgB,SAAS,eAAekX,KAAM,oBACpDpF,SAASyL,GAAMA,EAAE2f,UACtB,KAAC,EC1OG,MACM5+B,GAAU,CAAEm/B,YAAa,wBAEtC,IAAe2O,GAAA,EAAGxO,WAAUC,KAAIC,SAAQ+E,aACtCjF,EAAS,oBAAoB,KAC3BC,EAAG,oCAAoC,KACrC,MAAMwO,EAAU,IAAIzS,GACpBkE,EAAOuO,EAAQ/tC,QAAQ8O,SAASoxB,QAAQ,OACxCV,EAAOuO,EAAQ/tC,QAAQ8O,SAASoxB,QAAQ,UACxCV,EAAOuO,EAAQ/tC,QAAQ8O,SAASoxB,QAAQ,YACxCV,EAAOuO,EAAQ/tC,QAAQqJ,UAAU62B,QAAQ,iCACzCV,EAAOuO,EAAQ/tC,QAAQ+O,OAAOuxB,MAAM,KACpCd,EAAOuO,EAAQ/tC,QAAQ6b,QAAQykB,MAAM,QACrCiE,GAAQwJ,EAAQ/tC,QAAQ2b,WACxB4oB,EAAOwJ,EAAQ/tC,QAAQu7B,cAAc,GACrC,IAGJ+D,EAAS,WAAW,KAClBC,EAAG,yCAAyC,IAAWhjC,OAAA,OAAA,OAAA,GAAA,mBACrC,IAAI++B,IACZ7wB,QAAO,SACTgzB,KACN,MAAMgO,EAEH,QAFiB3pB,EAAA9B,SAAS5R,cAC3B,qCACC,IAAA0T,OAAA,EAAAA,EAAAmV,UACHuI,SAAciM,GAAanL,MAAM,UACjC,MAAMqI,EAAUjL,GAAY,YAC5B8B,EAAOmJ,EAAQ37B,QAAQszB,MAAM,SACvBqI,EAAQ,GAAGl6B,QACjB+wB,EAAO9B,GAAY,YAAY1wB,QAAQszB,MAAM,EAC9C,KAAC,IAGJhB,EAAS,aAAa,KACpBC,EAAG,uBAAuB,KACxB,MACMx2B,GADQ,IAAIuyB,IACCnsB,UACbsX,EAAO5mB,OAAO4mB,KAAK1d,GACzBy2B,EAAO/Y,EAAKzZ,QAAQszB,MAAM,GAC1Bd,EAAO/Y,GAAMyZ,QAAQ,UACrBV,EAAO/Y,GAAMyZ,QAAQ,QACrBV,EAAO/Y,GAAMyZ,QAAQ,UACrBV,EAAO/Y,GAAMyZ,QAAQ,QACrBV,EAAO/Y,GAAMyZ,QAAQ,WAAW,GAChC,IAIJZ,EAAS,kBAAkB,SAC3BA,EAAS,wBAAwB,SACjCA,EAAS,qBAAqB,SAC9BA,EAAS,kBAAkB,QAAS,ECrD/B,MACMt/B,GAAU,CACrBm/B,YAAa,2BAGf,IAAA6O,GAAe,EAAG1O,WAAUC,KAAIE,SAAQ/H,QAAO6M,aAC7CjF,EAAS,8BAA8B,KACrC,MAAM2O,EAAkB9pC,KAAKI,SAAStG,IACpCkG,KAAK1D,OAAO2D,GACZ,wBAGFk7B,EAAS,wCAAwC,KAC/CG,GAAO,IAAWljC,OAAA,OAAA,OAAA,GAAA,kBACV4H,KAAKI,SAASpG,IAAIgG,KAAK1D,OAAO2D,GAAI,wBAAwB,EACjE,MAEDm7B,EAAG,oBAAoB,IAAWhjC,OAAA,OAAA,OAAA,GAAA,YAChC,MAAM2xC,QAAgB/pC,KAAKI,SAAStG,IAClCkG,KAAK1D,OAAO2D,GACZ,wBAEFmgC,GAAQ2J,EACT,MAED3O,EAAG,2CAA2C,KAC5C,MAAMruB,EAAQ,IAAIi9B,cAAc,UAAW,CAAEx6B,SAAS,IACtD4wB,GAAQ7wB,EAAoBxC,GAAO,IAGrCquB,EAAG,2CAA2C,KAC5C,MAAMruB,EAAQ,IAAIi9B,cAAc,UAAW,CAAEv6B,SAAS,IACtD2wB,GAAQ7wB,EAAoBxC,GAAO,IAGrCquB,EAAG,uCAAuC,KACxC,MAAMruB,EAAQ,IAAIi9B,cAAc,UAAW,CAAEx6B,SAAS,IACtD4wB,EAAO7wB,EAAoBxC,GAAO,IAGpCquB,EAAG,uCAAuC,KACxC,MAAMruB,EAAQ,IAAIi9B,cAAc,UAAW,CAAEv6B,SAAS,IACtD2wB,EAAO7wB,EAAoBxC,GAAO,GAClC,IAGJouB,EAAS,uCAAuC,KAC9CG,GAAO,IAAWljC,OAAA,OAAA,OAAA,GAAA,kBACV4H,KAAKI,SAASpG,IAAIgG,KAAK1D,OAAO2D,GAAI,wBAAwB,EACjE,MAEDm7B,EAAG,oBAAoB,IAAWhjC,OAAA,OAAA,OAAA,GAAA,YAChC,MAAM2xC,QAAgB/pC,KAAKI,SAAStG,IAClCkG,KAAK1D,OAAO2D,GACZ,wBAEFmgC,EAAO2J,EACR,MAED3O,EAAG,uCAAuC,KACxC,MAAMruB,EAAQ,IAAIi9B,cAAc,UAAW,CAAEx6B,SAAS,IACtD4wB,EAAO7wB,EAAoBxC,GAAO,IAGpCquB,EAAG,uCAAuC,KACxC,MAAMruB,EAAQ,IAAIi9B,cAAc,UAAW,CAAEx6B,SAAS,IACtD4wB,EAAO7wB,EAAoBxC,GAAO,IAGpCquB,EAAG,uCAAuC,KACxC,MAAMruB,EAAQ,IAAIi9B,cAAc,UAAW,CAAEx6B,SAAS,IACtD4wB,GAAQ7wB,EAAoBxC,GAAO,IAGrCquB,EAAG,uCAAuC,KACxC,MAAMruB,EAAQ,IAAIi9B,cAAc,UAAW,CAAEv6B,SAAS,IACtD2wB,GAAQ7wB,EAAoBxC,GAAO,GACnC,IAGJwmB,GAAM,IAAWn7B,OAAA,OAAA,OAAA,GAAA,kBACT4H,KAAKI,SAASpG,IAClBgG,KAAK1D,OAAO2D,GACZ,uBACA6pC,EAEH,KAAC,GACF,ECjFG,MACMjuC,GAAU,CACrBm/B,YAAa,sBAGf,IAAAiP,GAAe,EAAG9O,WAAUC,KAAIE,SAAQ/H,QAAO8H,aAE7CF,EAAS,yCAAyC,SAClDA,EAAS,4CAA4C,SACrDA,EAAS,oCAAoC,QAAS,ECdjD,MACMt/B,GAAU,CACrBm/B,YAAa,sBAGTkP,GAAiB,CACrB9iC,EACA+iC,EAAsC,CAAC/iC,MAEvC,MAAMI,EAAyB,GAI/B,OAHA2iC,EAAY96B,SAAS9I,IACnBiB,EAAQhC,KAAK,CAAEtM,OAAQqN,GAAI,IAEtB,CACLgB,MAAO,CAAC,CAAEC,YACVH,MAAOD,EACR,EAGH,IAAAgjC,GAAe,EACbjP,WACAC,KACA7H,QACAyM,YACA1E,SACAD,aAEA,MAAMgP,EAAYrqC,KAAKI,SAAStG,IAAIkG,KAAK1D,OAAO2D,GAAI,eAEpDq7B,GAAO,IAAWljC,OAAA,OAAA,OAAA,GAAA,wBACQ,UAAlB0Q,GAAGC,qBAAe,IAAA4U,OAAA,EAAAA,EAAArT,OACzB,MAEDipB,GAAM,IAAWn7B,OAAA,OAAA,OAAA,GAAA,kBACf4H,KAAKI,SAASpG,IAAIgG,KAAK1D,OAAO2D,GAAI,cAAeoqC,SACzB,QAAlBloB,EAAArZ,GAAGC,qBAAe,IAAAoZ,OAAA,EAAAA,EAAA7b,QAAO,EAChC,MAED60B,EAAS,oEAAoE,KAC3EG,GAAO,IAAWljC,OAAA,OAAA,OAAA,GAAA,kBACV8gC,IACP,MAEDkC,EAAG,6BAA6B,IAAWhjC,OAAA,OAAA,OAAA,GAAA,kBACzC,MAAM6O,QAAaxC,EAAQkF,SAAS,CAClChF,MAAO,CAAC,QACRC,KAAM,CAAEa,KAAM,CAAEK,WAAW,YAEvBwzB,WACAA,KACN,MAAMgR,EAEH,QAFc3sB,EAAA9B,SAAS5R,cACxB,sCACC,IAAA0T,OAAA,EAAAA,EAAAmV,UACHuI,EAAO3/B,OAAO4mB,KAAKrb,IAAO80B,QAAQ,cAClCV,EAAOp0B,EAAKsjC,YAAYpO,OAAM,GAC9Bd,EAAO3/B,OAAO4mB,KAAKrb,IAAO80B,QAAQ,YAClCV,EAAOp0B,EAAKujC,UAAUrO,MAAM,QAC5Bd,EAAOiP,GAAUnO,MAAM,OACxB,MAEDf,EAAG,gCAAgC,IAAWhjC,OAAA,OAAA,OAAA,GAAA,kBAC5C,MAAM6O,QAAaxC,EAAQkF,SAAS,CAClChF,MAAO,CAAC,OAAQ,QAChBC,KAAM,CAAEa,KAAM,CAAEK,WAAW,YAEvBwzB,WACAA,KACN,MAAMgR,EAEH,QAFcnoB,EAAAtG,SAAS5R,cACxB,sCACC,IAAAkY,OAAA,EAAAA,EAAA2Q,UACHuI,EAAO3/B,OAAO4mB,KAAKrb,IAAO80B,QAAQ,cAClCV,EAAOp0B,EAAKsjC,YAAYpO,OAAM,GAC9Bd,EAAO3/B,OAAO4mB,KAAKrb,IAAO80B,QAAQ,YAClCV,EAAOp0B,EAAKujC,UAAUrO,MAAM,eAC5Bd,EAAOiP,GAAUnO,MAAM,cACxB,MAED6D,GAAU,IAAW5nC,OAAA,OAAA,OAAA,GAAA,kBACb8gC,IACP,KAAC,IAGJiC,EAAS,4BAA4B,KAEnC,MAAMsP,EAAiB,CACrB1uC,EACAqL,EACAS,EAAgB,KACZ,CACJpC,KAAM,CAAE1J,OAAMqL,SAAQS,WAExBszB,EAAS,eAAe,KACtB,MAAMv2B,EAAO6lC,EAAe,SAAU,IACtCrP,EAAG,kCAAkC,KACnC,MAAM31B,EAAOykC,GAAe,IAC5B7O,EAAO52B,EAAQ4B,aAAazB,EAAMa,GAAMyB,WAAWi1B,OAAM,GACzDd,EAAO52B,EAAQ4B,aAAazB,EAAMa,GAAM0B,WAAWg1B,OAAM,EAAM,IAGjEf,EAAG,2BAA2B,KAC5B,MAAM31B,EAAOykC,GAAe,GAC5B7O,EAAO52B,EAAQ4B,aAAazB,EAAMa,GAAMyB,WAAWi1B,OAAM,GACzDd,EAAO52B,EAAQ4B,aAAazB,EAAMa,GAAM0B,WAAWg1B,OAAM,EAAK,IAGhEf,EAAG,0BAA0B,KAC3B,MAAM31B,EAAOykC,GAAe,IAC5B7O,EAAO52B,EAAQ4B,aAAazB,EAAMa,GAAMyB,WAAWi1B,OAAM,GACzDd,EAAO52B,EAAQ4B,aAAazB,EAAMa,GAAM0B,WAAWg1B,OAAM,EAAK,GAC9D,IAGJhB,EAAS,cAAc,KACrB,MAAMv2B,EAAO6lC,EAAe,QAAS,IACrCrP,EAAG,kCAAkC,KACnC,MAAM31B,EAAOykC,GAAe,IAC5B7O,EAAO52B,EAAQ4B,aAAazB,EAAMa,GAAMyB,WAAWi1B,OAAM,GACzDd,EAAO52B,EAAQ4B,aAAazB,EAAMa,GAAM0B,WAAWg1B,OAAM,EAAM,IAGjEf,EAAG,2BAA2B,KAC5B,MAAM31B,EAAOykC,GAAe,GAC5B7O,EAAO52B,EAAQ4B,aAAazB,EAAMa,GAAMyB,WAAWi1B,OAAM,GACzDd,EAAO52B,EAAQ4B,aAAazB,EAAMa,GAAM0B,WAAWg1B,OAAM,EAAK,IAGhEf,EAAG,wBAAwB,KACzB,MAAM31B,EAAOykC,GAAe,IAC5B7O,EAAO52B,EAAQ4B,aAAazB,EAAMa,GAAMyB,WAAWi1B,OAAM,GACzDd,EAAO52B,EAAQ4B,aAAazB,EAAMa,GAAM0B,WAAWg1B,OAAM,EAAM,GAC/D,IAGJhB,EAAS,cAAc,KACrB,MAAMv2B,EAAO6lC,EAAe,QAAS,IACrCrP,EAAG,kCAAkC,KACnC,MAAM31B,EAAOykC,GAAe,IAC5B7O,EAAO52B,EAAQ4B,aAAazB,EAAMa,GAAMyB,WAAWi1B,OAAM,GACzDd,EAAO52B,EAAQ4B,aAAazB,EAAMa,GAAM0B,WAAWg1B,OAAM,EAAM,IAGjEf,EAAG,yBAAyB,KAC1B,MAAM31B,EAAOykC,GAAe,GAC5B7O,EAAO52B,EAAQ4B,aAAazB,EAAMa,GAAMyB,WAAWi1B,OAAM,GACzDd,EAAO52B,EAAQ4B,aAAazB,EAAMa,GAAM0B,WAAWg1B,OAAM,EAAM,IAGjEf,EAAG,0BAA0B,KAC3B,MAAM31B,EAAOykC,GAAe,IAC5B7O,EAAO52B,EAAQ4B,aAAazB,EAAMa,GAAMyB,WAAWi1B,OAAM,GACzDd,EAAO52B,EAAQ4B,aAAazB,EAAMa,GAAM0B,WAAWg1B,OAAM,EAAK,GAC9D,IAGJhB,EAAS,cAAc,KACrB,MAAMv2B,EAAO6lC,EAAe,QAAS,IACrCrP,EAAG,8BAA8B,KAC/B,MAAM31B,EAAOykC,GAAe,GAC5B7O,EAAO52B,EAAQ4B,aAAazB,EAAMa,GAAMyB,WAAWi1B,OAAM,GACzDd,EAAO52B,EAAQ4B,aAAazB,EAAMa,GAAM0B,WAAWg1B,OAAM,EAAM,IAGjEf,EAAG,iCAAiC,KAClC,MAAMsP,EAAYD,EAAe,QAAS,IACpChlC,EAAOykC,GAAe,IAC5B7O,EAAO52B,EAAQ4B,aAAaqkC,EAAWjlC,GAAMyB,WAAWi1B,OAAM,GAC9Dd,EAAO52B,EAAQ4B,aAAaqkC,EAAWjlC,GAAM0B,WAAWg1B,OAAM,EAAK,IAGrEf,EAAG,kCAAkC,KACnC,MAAM31B,EAAOykC,GAAe,IAC5B7O,EAAO52B,EAAQ4B,aAAazB,EAAMa,GAAMyB,WAAWi1B,OAAM,GACzDd,EAAO52B,EAAQ4B,aAAazB,EAAMa,GAAM0B,WAAWg1B,OAAM,EAAM,IAGjEf,EAAG,yBAAyB,KAC1B,MAAM31B,EAAOykC,GAAe,GAC5B7O,EAAO52B,EAAQ4B,aAAazB,EAAMa,GAAMyB,WAAWi1B,OAAM,GACzDd,EAAO52B,EAAQ4B,aAAazB,EAAMa,GAAM0B,WAAWg1B,OAAM,EAAM,IAGjEf,EAAG,0BAA0B,KAC3B,MAAM31B,EAAOykC,GAAe,IAC5B7O,EAAO52B,EAAQ4B,aAAazB,EAAMa,GAAMyB,WAAWi1B,OAAM,GACzDd,EAAO52B,EAAQ4B,aAAazB,EAAMa,GAAM0B,WAAWg1B,OAAM,EAAK,GAC9D,IAGJhB,EAAS,cAAc,KACrB,MAAMv2B,EAAO,CACXa,KAAM,CACJ1J,KAAM,QACNqL,OAAQ,GACRK,MAAO,CACL,EAAG,UACH,GAAI,aAKV2zB,EAAG,kCAAkC,KACnC,MAAM31B,EAAOykC,GAAe,GAC5B7O,EAAO52B,EAAQ4B,aAAazB,EAAMa,GAAMyB,WAAWi1B,OAAM,GACzDd,EAAO52B,EAAQ4B,aAAazB,EAAMa,GAAMyB,WAAWi1B,OAAM,GACzDd,EAAO52B,EAAQ4B,aAAazB,EAAMa,GAAMkC,SAASw0B,MAAM,UAAU,IAGnEf,EAAG,yBAAyB,KAC1B,MAAM31B,EAAOykC,GAAe,IAC5B7O,EAAO52B,EAAQ4B,aAAazB,EAAMa,GAAMyB,WAAWi1B,OAAM,GACzDd,EAAO52B,EAAQ4B,aAAazB,EAAMa,GAAMyB,WAAWi1B,OAAM,GACzDd,EAAO52B,EAAQ4B,aAAazB,EAAMa,GAAMkC,SAASw0B,MAAM,UAAU,GACjE,IAGJhB,EAAS,gBAAgB,KACvB,MAAMv2B,EAAO6lC,EAAe,UAAW,IACvCrP,EAAG,0BAA0B,KAC3B,MAAM31B,EAAOykC,GAAe,GAC5B7O,EAAO52B,EAAQ4B,aAAazB,EAAMa,GAAMyB,WAAWi1B,OAAM,GACzDd,EAAO52B,EAAQ4B,aAAazB,EAAMa,GAAMyB,WAAWi1B,OAAM,GACzDd,EAAO52B,EAAQ4B,aAAazB,EAAMa,GAAM2B,QAAQ+0B,MAAM,IACtDd,EAAO52B,EAAQ4B,aAAazB,EAAMa,GAAM4B,OAAO80B,MAAM,EAAE,GACvD,GACF,IAGJhB,EAAS,wCAAwC,KAC/CA,EAAS,gBAAgB,KACvBG,GAAO,IAAWljC,OAAA,OAAA,OAAA,GAAA,kBACV4H,KAAKI,SAASpG,IAAIgG,KAAK1D,OAAO2D,GAAI,eAAe,EACxD,MAEDm7B,EAAG,0BAA0B,KAC3B,MAAMuP,EAAgBT,GAAe,EAAG,CAAC,IACzC7O,EAAO52B,EAAQmD,gBAAgB+iC,EAAe,IAAK,IAAIxO,OAAM,GAC7D,MAAMyO,EAAmBV,GAAe,GAAI,CAAC,IAC7C7O,EAAO52B,EAAQmD,gBAAgBgjC,EAAkB,IAAK,IAAIzO,OAAM,EAAM,IAGxEf,EAAG,8BAA8B,KAC/B,MAAMuP,EAAgBT,GAAe,EAAG,CAAC,KACzC7O,EAAO52B,EAAQmD,gBAAgB+iC,EAAe,EAAG,MAAMxO,OAAM,GAC7D,MAAMyO,EAAmBV,GAAe,GAAI,CAAC,KAC7C7O,EAAO52B,EAAQmD,gBAAgBgjC,EAAkB,EAAG,MAAMzO,OAAM,EAAK,IAGvEf,EAAG,2CAA2C,KAC5C,MAAM31B,EAAOykC,GAAe,IAG5B7O,EAAO52B,EAAQmD,gBAAgBnC,EAFhB,GACD,KACuC02B,OAAM,EAAK,IAGlEf,EAAG,2CAA2C,KAC5C,MAAM31B,EAAOykC,GAAe,IAG5B7O,EAAO52B,EAAQmD,gBAAgBnC,EAFhB,GACD,KACuC02B,OAAM,EAAK,IAGlEf,EAAG,6CAA6C,KAC9C,MAAM31B,EAAOykC,GAAe,IAG5B7O,EAAO52B,EAAQmD,gBAAgBnC,EAFhB,GACD,KACuC02B,OAAM,EAAM,GACjE,IAGJhB,EAAS,iBAAiB,KACxBG,GAAO,IAAWljC,OAAA,OAAA,OAAA,GAAA,kBACV4H,KAAKI,SAASpG,IAAIgG,KAAK1D,OAAO2D,GAAI,eAAe,EACxD,MAEDm7B,EAAG,0BAA0B,KAC3B,MAAMuP,EAAgBT,GAAe,EAAG,CAAC,IACzC7O,EAAO52B,EAAQmD,gBAAgB+iC,EAAe,IAAK,IAAIxO,OAAM,GAC7D,MAAMyO,EAAmBV,GAAe,GAAI,CAAC,IAC7C7O,EAAO52B,EAAQmD,gBAAgBgjC,EAAkB,IAAK,IAAIzO,OAAM,EAAM,IAGxEf,EAAG,8BAA8B,KAC/B,MAAMuP,EAAgBT,GAAe,EAAG,CAAC,KACzC7O,EAAO52B,EAAQmD,gBAAgB+iC,EAAe,EAAG,MAAMxO,OAAM,GAC7D,MAAMyO,EAAmBV,GAAe,GAAI,CAAC,KAC7C7O,EAAO52B,EAAQmD,gBAAgBgjC,EAAkB,EAAG,MAAMzO,OAAM,EAAK,IAGvEf,EAAG,uCAAuC,KACxC,MAAM31B,EAAOykC,GAAe,IAG5B7O,EAAO52B,EAAQmD,gBAAgBnC,EAFjB,GACH,KACsC02B,OAAM,EAAK,IAG9Df,EAAG,uCAAuC,KACxC,MAAM31B,EAAOykC,GAAe,IAG5B7O,EAAO52B,EAAQmD,gBAAgBnC,EAFjB,GACH,KACsC02B,OAAM,EAAK,IAG9Df,EAAG,yCAAyC,KAC1C,MAAM31B,EAAOykC,GAAe,IAG5B7O,EAAO52B,EAAQmD,gBAAgBnC,EAFjB,GACH,KACsC02B,OAAM,EAAM,GAC7D,GACF,IAGJhB,EAAS,kCAAkC,KACzC,MAAMv2B,EAAO,CACXa,KAAM,CACJoC,MAAO,GACPT,OAAQ,CACNa,MAAO,CACL3L,OAAQ,CACNwL,GAAI,CAAEjP,MAAO,GACbuP,IAAK,CAAEvP,MAAO,QAOxBsiC,EAAS,gBAAgB,KACvBG,GAAO,IAAWljC,OAAA,OAAA,OAAA,GAAA,kBACV4H,KAAKI,SAASpG,IAAIgG,KAAK1D,OAAO2D,GAAI,eAAe,EACxD,MAEDm7B,EAAG,mCAAmC,IAAWhjC,OAAA,OAAA,OAAA,GAAA,YAC/CijC,EAAOr7B,KAAKI,SAAStG,IAAIkG,KAAK1D,OAAO2D,GAAI,gBAAgBk8B,OAAM,GAC/D,MAAMwO,EAAgBT,GAAe,EAAG,CAAC,IACzC7O,EAAO52B,EAAQsD,mBAAmBnD,EAAM+lC,GAAezjC,WAAWi1B,OAChE,GAEFd,EAAO52B,EAAQsD,mBAAmBnD,EAAM+lC,GAAexjC,WAAWg1B,OAChE,GAEF,MAAMyO,EAAmBV,GAAe,GAAI,CAAC,IAC7C7O,EACE52B,EAAQsD,mBAAmBnD,EAAMgmC,GAAkB1jC,WACnDi1B,OAAM,GACRd,EACE52B,EAAQsD,mBAAmBnD,EAAMgmC,GAAkBzjC,WACnDg1B,OAAM,EACT,MAEDf,EAAG,iGAAiG,KAClG,MACMjoB,EAAa,CACjB1N,KAAM,CACJoC,MAAO,GACPT,OAAQ,CACNa,MAAO,CACL3L,OAAQ,CACNwL,GAAI,CAAEjP,MAAO,GACbuP,IAAK,CAAEvP,MAAO,QAOlB4M,EAAOykC,GAAe,EAAG,CAAC,GAfX,IAgBrB7O,EAAO52B,EAAQsD,mBAAmBoL,EAAY1N,GAAMyB,WAAWi1B,OAC7D,GAEFd,EAAO52B,EAAQsD,mBAAmBoL,EAAY1N,GAAM0B,WAAWg1B,OAC7D,EACD,IAGHf,EAAG,wCAAwC,KACzC,MAAM9yB,EAAc,GAAK1D,EAAKa,KAAKoC,MAC7BpC,EAAOykC,GACXtlC,EAAKa,KAAK2B,OAAOa,MAAM3L,OAAO8L,IAAIvP,MAAQyP,EAAc,GAE1D+yB,EAAO52B,EAAQsD,mBAAmBnD,EAAMa,GAAMyB,WAAWi1B,OAAM,GAC/Dd,EAAO52B,EAAQsD,mBAAmBnD,EAAMa,GAAM0B,WAAWg1B,OAAM,EAAK,IAGtEf,EAAG,sCAAsC,KACvC,MAAM9yB,EAAc,GAAK1D,EAAKa,KAAKoC,MAC7BpC,EAAOykC,GACXtlC,EAAKa,KAAK2B,OAAOa,MAAM3L,OAAO8L,IAAIvP,MAAQyP,GAE5C+yB,EAAO52B,EAAQsD,mBAAmBnD,EAAMa,GAAMyB,WAAWi1B,OAAM,GAC/Dd,EAAO52B,EAAQsD,mBAAmBnD,EAAMa,GAAM0B,WAAWg1B,OAAM,EAAM,IAGvEf,EAAG,uCAAuC,KACxC,MAAM9yB,EAAc,GAAK1D,EAAKa,KAAKoC,MAC7BpC,EAAOykC,GACXtlC,EAAKa,KAAK2B,OAAOa,MAAM3L,OAAO8L,IAAIvP,MAAQyP,EAAc,GAE1D+yB,EAAO52B,EAAQsD,mBAAmBnD,EAAMa,GAAMyB,WAAWi1B,OAAM,GAC/Dd,EAAO52B,EAAQsD,mBAAmBnD,EAAMa,GAAM0B,WAAWg1B,OAAM,EAAM,IAGvEf,EAAG,qGAAqG,KACtG,MACMjoB,EAAa,CACjB1N,KAAM,CACJoC,MAAO,GACPT,OAAQ,CACNa,MAAO,CACL3L,OAAQ,CACNwL,GAAI,CAAEjP,MAAO,GACbuP,IAAK,CAAEvP,MAAO,SAOlB4M,EAAOykC,GAAe,GAAI,CAAC,GAfb,IAgBpB7O,EAAO52B,EAAQsD,mBAAmBoL,EAAY1N,GAAMyB,WAAWi1B,OAC7D,GAEFd,EAAO52B,EAAQsD,mBAAmBoL,EAAY1N,GAAM0B,WAAWg1B,OAC7D,EACD,IAGHf,EAAG,4BAA4B,KAC7B,MAAMuP,EAAgBT,GAAe,EAAG,CAAC,KACzC7O,EAAO52B,EAAQsD,mBAAmBnD,EAAM+lC,GAAezjC,WAAWi1B,OAChE,GAEFd,EAAO52B,EAAQsD,mBAAmBnD,EAAM+lC,GAAexjC,WAAWg1B,OAChE,GAEF,MAAMyO,EAAmBV,GAAe,GAAI,CAAC,KAC7C7O,EACE52B,EAAQsD,mBAAmBnD,EAAMgmC,GAAkB1jC,WACnDi1B,OAAM,GACRd,EACE52B,EAAQsD,mBAAmBnD,EAAMgmC,GAAkBzjC,WACnDg1B,OAAM,EAAM,GACd,IAGJhB,EAAS,uBAAuB,KAC9BG,GAAO,IAAWljC,OAAA,OAAA,OAAA,GAAA,kBACV4H,KAAKI,SAASpG,IAAIgG,KAAK1D,OAAO2D,GAAI,eAAe,EACxD,MAEDm7B,EAAG,mCAAmC,IAAWhjC,OAAA,OAAA,OAAA,GAAA,YAC/CijC,EAAOr7B,KAAKI,SAAStG,IAAIkG,KAAK1D,OAAO2D,GAAI,gBAAgBk8B,OAAM,GAC/D,MAAMwO,EAAgBT,GAAe,EAAG,CAAC,IACzC7O,EAAO52B,EAAQsD,mBAAmBnD,EAAM+lC,GAAezjC,WAAWi1B,OAChE,GAEFd,EAAO52B,EAAQsD,mBAAmBnD,EAAM+lC,GAAexjC,WAAWg1B,OAChE,GAEF,MAAMyO,EAAmBV,GAAe,GAAI,CAAC,IAC7C7O,EACE52B,EAAQsD,mBAAmBnD,EAAMgmC,GAAkB1jC,WACnDi1B,OAAM,GACRd,EACE52B,EAAQsD,mBAAmBnD,EAAMgmC,GAAkBzjC,WACnDg1B,OAAM,EACT,MAEDf,EAAG,oCAAoC,KACrC,MAAM31B,EAAOykC,GAAetlC,EAAKa,KAAKoC,MAAQ,GAC9CwzB,EAAO52B,EAAQsD,mBAAmBnD,EAAMa,GAAMyB,WAAWi1B,OAAM,GAC/Dd,EAAO52B,EAAQsD,mBAAmBnD,EAAMa,GAAM0B,WAAWg1B,OAAM,EAAK,IAGtEf,EAAG,gCAAgC,KACjC,MAAM31B,EAAOykC,GAAetlC,EAAKa,KAAKoC,OACtCwzB,EAAO52B,EAAQsD,mBAAmBnD,EAAMa,GAAMyB,WAAWi1B,OAAM,GAC/Dd,EAAO52B,EAAQsD,mBAAmBnD,EAAMa,GAAM0B,WAAWg1B,OAAM,EAAM,IAGvEf,EAAG,mCAAmC,KACpC,MAAM31B,EAAOykC,GAAetlC,EAAKa,KAAKoC,MAAQ,GAC9CwzB,EAAO52B,EAAQsD,mBAAmBnD,EAAMa,GAAMyB,WAAWi1B,OAAM,GAC/Dd,EAAO52B,EAAQsD,mBAAmBnD,EAAMa,GAAM0B,WAAWg1B,OAAM,EAAM,IAGvEf,EAAG,4BAA4B,KAC7B,MAAMuP,EAAgBT,GAAe,EAAG,CAAC,KACzC7O,EAAO52B,EAAQsD,mBAAmBnD,EAAM+lC,GAAezjC,WAAWi1B,OAChE,GAEFd,EAAO52B,EAAQsD,mBAAmBnD,EAAM+lC,GAAexjC,WAAWg1B,OAChE,GAEF,MAAMyO,EAAmBV,GAAe,GAAI,CAAC,KAC7C7O,EACE52B,EAAQsD,mBAAmBnD,EAAMgmC,GAAkB1jC,WACnDi1B,OAAM,GACRd,EACE52B,EAAQsD,mBAAmBnD,EAAMgmC,GAAkBzjC,WACnDg1B,OAAM,EAAM,GACd,GACF,IAGJhB,EAAS,oEAAoE,KAgB3EG,GAAO,IAAWljC,OAAA,OAAA,OAAA,GAAA,kBACV8gC,WACAl5B,KAAKI,SAASpG,IAAIgG,KAAK1D,OAAO2D,GAAI,eAAe,EACxD,MAEDm7B,EAAG,uCAAuC,IAAWhjC,OAAA,OAAA,OAAA,GAAA,sBACjC,QAAlBulB,EAAA7U,GAAGC,qBAAe,IAAA4U,GAAAA,EAAArT,QAClB,MAAMZ,EArB4B,CAClC/E,MAAO,CAAC,OAAQ,IAAK,IAAK,KAC1BC,KAAM,CACJa,KAAM,CACJ1J,KAAM,QACN2M,IAAK,CAAC,OACNb,MAAO,GACPT,OAAQ,CACNa,MAAO,CAAE3L,OAAQ,CAAEwL,GAAI,CAAEjP,MAAO,GAAKuP,IAAK,CAAEvP,MAAO,SAczD6Q,EAAS9E,KAAKa,KAAKiD,IAAM,SACnBjE,EAAQ8F,eAAeb,SACvB4vB,KACN,MAAMuR,EAA+B,QAAhB1oB,EAAArZ,GAAGC,qBAAa,IAAAoZ,OAAA,EAAAA,EAAE2oB,MAAM30B,MAC7CklB,EAAyB,QAAlB3L,EAAA5mB,GAAGC,qBAAe,IAAA2mB,OAAA,EAAAA,EAAAob,MAAMjiC,QAAQszB,MAAM,GAC7Cd,EAAOwP,eAAAA,EAAc/hB,SAASqT,MAC5B,sEAEH,MAEDf,EAAG,gDAAgD,IAAWhjC,OAAA,OAAA,OAAA,GAAA,oBAC5D,MAAMsR,EAjC4B,CAClC/E,MAAO,CAAC,OAAQ,IAAK,IAAK,KAC1BC,KAAM,CACJa,KAAM,CACJ1J,KAAM,QACN2M,IAAK,CAAC,OACNb,MAAO,GACPT,OAAQ,CACNa,MAAO,CAAE3L,OAAQ,CAAEwL,GAAI,CAAEjP,MAAO,GAAKuP,IAAK,CAAEvP,MAAO,eA0BnD4L,EAAQ8F,eAAeb,SACvB4vB,WACAA,WACAA,WACAA,KACN,MAAMyR,EACqC,QAAzC9a,EAAApU,SAAS5R,cAAc,wBAAkB,IAAAgmB,OAAA,EAAAA,EAAA6C,UAC3CuI,EAAO0P,GAAkB5O,MAAM,oBAC/B,MAAM6O,EAEH,QAFsBpQ,EAAA/e,SAAS5R,cAChC,qCACC,IAAA2wB,OAAA,EAAAA,EAAA9H,UACHuI,EAAO2P,GAAkB7O,MAAM,MAChC,MACD6D,GAAU,IAAW5nC,OAAA,OAAA,OAAA,GAAA,kBACb8gC,IACP,KAAC,IAGJiC,EAAS,0EAA0E,KACjFA,EAAS,mBAAmB,KAE1BC,EAAG,gCAAgC,IAAWhjC,OAAA,OAAA,OAAA,GAAA,kBACtCqM,EAAQ6mB,SAAS,CACrB3mB,MAAO,CAAC,QACRyE,WAJe,KAKfxE,KAAM,CAAEa,KAAM,CAAEK,WAAW,YAEvBwzB,KACN+B,EAAOr7B,KAAK+oB,SAASmD,MAAMiQ,MAAM,GACjCd,EAAOxf,SAAS5R,cAAc,iBAAiByxB,IAAIxc,SACpD,KAAC,IAGJic,EAAS,uBAAuB,KAC9BC,EAAG,qBAAqB,IAAWhjC,OAAA,OAAA,OAAA,GAAA,YACjCqM,EAAQ6mB,SAAS,CACf3mB,MAAO,CAAC,QACRC,KAAM,CAAEa,KAAM,CAAEK,WAAW,YAEvBwzB,KACN,MAAM2R,EAASpvB,SAAS5R,cAAc,WACtCoxB,EAAO4P,aAAM,EAANA,EAAQhhC,cAAc,QAAQyxB,IAAI2G,KACzChH,EAAO4P,aAAM,EAANA,EAAQhhC,cAAc,WAAWyxB,IAAI2G,KAC5ChH,EAAO4P,aAAM,EAANA,EAAQhhC,cAAc,YAAYyxB,IAAI2G,WACvC1I,IACP,KAAC,IAGJqG,GAAU,IAAW5nC,OAAA,OAAA,OAAA,GAAA,kBACb8gC,WACAS,IACP,KAAC,IAGJwB,EAAS,6EAA6E,KACpFA,EAAS,mBAAmB,KAE1BC,EAAG,gCAAgC,IAAWhjC,OAAA,OAAA,OAAA,GAAA,kBACtCqM,EAAQiB,KAAK,CACjBf,MAAO,CAAC,QACRyE,WAJe,KAKfxE,KAAM,CAAEa,KAAM,CAAEK,WAAW,YAEvBwzB,KACN+B,EAAOr7B,KAAK+oB,SAASmD,MAAMiQ,MAAM,GACjCd,EAAOxf,SAAS5R,cAAc,iBAAiByxB,IAAIxc,SACpD,KAAC,IAGJic,EAAS,uBAAuB,KAC9BC,EAAG,qBAAqB,IAAWhjC,OAAA,OAAA,OAAA,GAAA,YACjCqM,EAAQiB,KAAK,CACXf,MAAO,CAAC,QACRC,KAAM,CAAEa,KAAM,CAAEK,WAAW,YAEvBwzB,KACN,MAAM2R,EAASpvB,SAAS5R,cAAc,WACtCoxB,EAAO4P,aAAM,EAANA,EAAQhhC,cAAc,QAAQyxB,IAAI2G,KACzChH,EAAO4P,aAAM,EAANA,EAAQhhC,cAAc,WAAWwyB,GAAG4F,KAC3ChH,EAAO4P,aAAM,EAANA,EAAQhhC,cAAc,YAAYyxB,IAAI2G,WACvC1I,IACP,KAAC,IAGJqG,GAAU,IAAW5nC,OAAA,OAAA,OAAA,GAAA,kBACb8gC,WACAS,WACAL,IACP,KAAC,GACF,ECvnBG,MACMz9B,GAAU,CACrBm/B,YAAa,4BAGf,IAAekQ,GAAA,EAAG/P,WAAUC,KAAIC,aAC9BF,EAAS,qBAAqB,KAC5BA,EAAS,aAAa,KAEpBC,EAAG,iBAAiB,KAClBC,EAAO3/B,OAAO4mB,KAAK6oB,WAAWC,UAAUrP,QAF3B,KAE0C,IAGzDX,EAAG,iBAAiB,KAClBC,EAAO8P,WAAWC,QAAQ9X,GAAG,EAAG,IAAI6I,OAAM,GAC1Cd,EAAO8P,WAAWC,QAAQ9X,GAAG,OAAQ,SAAS6I,OAAM,GACpDd,EAAO8P,WAAWC,QAAQ9X,GAAG,EAAG,IAAI6I,OAAM,GAC1Cd,EAAO8P,WAAWC,QAAQ9X,GAAG,OAAQ,IAAI6I,OAAM,GAC/Cd,EAAO8P,WAAWC,QAAQ9X,GAAG,GAAI,KAAK6I,OAAM,EAAM,GAClD,IAGJhB,EAAS,cAAc,KAErBC,EAAG,iBAAiB,KAClBC,EAAO3/B,OAAO4mB,KAAK6oB,WAAWC,UAAUrP,QAF3B,MAE0C,IAGzDX,EAAG,iBAAiB,KAClBC,EAAO8P,WAAWC,QAAQzuB,IAAI,IAAIwf,MAAM,KACxCd,EAAO8P,WAAWC,QAAQzuB,IAAI,IAAIwf,MAAM,MACxCd,EAAO8P,WAAWC,QAAQzuB,KAAK,IAAIwf,MAAM,MACzCd,EAAO8P,WAAWC,QAAQzuB,IAAI,MAAMwf,MAAM,MAC1Cd,EAAO8P,WAAWC,QAAQzuB,IAAI,OAAOwf,MAAM,MAC3Cd,EAAO8P,WAAWC,QAAQzuB,IAAI,MAAMwf,MAAM,IAAI,GAC9C,IAGJhB,EAAS,cAAc,KAErBC,EAAG,iBAAiB,KAClBC,EAAO3/B,OAAO4mB,KAAK6oB,WAAWC,UAAUrP,QAF3B,MAE0C,IAGzDX,EAAG,iBAAiB,KAClBC,EAAO8P,WAAWC,QAAQxV,IAAI,EAAG,IAAIuG,MAAM,GAC3Cd,EAAO8P,WAAWC,QAAQxV,IAAI,GAAI,IAAIuG,OAAO,GAC7Cd,EAAO8P,WAAWC,QAAQxV,IAAI,IAAK,MAAMuG,MAAM,GAC/Cd,EAAO8P,WAAWC,QAAQxV,IAAI,IAAK,OAAOuG,OAAO,EAAE,GACnD,IAGJhB,EAAS,mBAAmB,KAE1BC,EAAG,iBAAiB,KAClBC,EAAO3/B,OAAO4mB,KAAK6oB,WAAWC,UAAUrP,QAF3B,WAE0C,IAGzDX,EAAG,iBAAiB,KAClBC,EAAO8P,WAAWC,QAAQC,SAAS,EAAG,IAAIlP,OAAO,GACjDd,EAAO8P,WAAWC,QAAQC,SAAS,GAAI,IAAIlP,MAAM,GACjDd,EAAO8P,WAAWC,QAAQC,SAAS,IAAK,MAAMlP,OAAO,GACrDd,EAAO8P,WAAWC,QAAQC,SAAS,IAAK,OAAOlP,MAAM,EAAE,GACvD,IAGJhB,EAAS,iBAAiB,KAExBC,EAAG,iBAAiB,KAClBC,EAAO3/B,OAAO4mB,KAAK6oB,WAAWC,UAAUrP,QAF3B,SAE0C,IAGzDX,EAAG,iBAAiB,KAClBC,EAAO8P,WAAWC,QAAQE,OAAO,EAAG,IAAInP,MAAM,GAC9Cd,EAAO8P,WAAWC,QAAQE,OAAO,GAAI,IAAInP,OAAO,GAChDd,EAAO8P,WAAWC,QAAQE,OAAO,GAAI,IAAInP,MAAM,GAC/Cd,EAAO8P,WAAWC,QAAQE,OAAO,KAAM,MAAMnP,MAAM,GACnDd,EAAO8P,WAAWC,QAAQE,OAAO,KAAM,OAAOnP,OAAO,EAAE,GACvD,IAGJhB,EAAS,eAAe,KAEtBC,EAAG,iBAAiB,KAClBC,EAAO3/B,OAAO4mB,KAAK6oB,WAAWC,UAAUrP,QAF3B,OAE0C,IAGzDX,EAAG,iBAAiB,KAClBC,EAAO8P,WAAWC,QAAQG,KAAK,EAAG,IAAIpP,MAAM,GAC5Cd,EAAO8P,WAAWC,QAAQG,KAAK,GAAI,IAAIpP,OAAO,GAC9Cd,EAAO8P,WAAWC,QAAQG,KAAK,GAAI,IAAIpP,MAAM,IAC7Cd,EAAO8P,WAAWC,QAAQG,KAAK,KAAM,MAAMpP,MAAM,IACjDd,EAAO8P,WAAWC,QAAQG,KAAK,KAAM,OAAOpP,OAAO,IACnDd,EAAO8P,WAAWC,QAAQG,KAAK,GAAK,IAAIpP,MAAM,IAC9Cd,EAAO8P,WAAWC,QAAQG,KAAK,IAAM,IAAIpP,MAAM,KAC/Cd,EAAO8P,WAAWC,QAAQG,KAAK,KAAO,IAAIpP,MAAM,EAAE,GAClD,IAGJhB,EAAS,sBAAsB,KAE7BC,EAAG,iBAAiB,KAClBC,EAAO3/B,OAAO4mB,KAAK6oB,WAAWC,UAAUrP,QAF3B,cAE0C,IAGzDX,EAAG,iBAAiB,KAClBC,EAAO8P,WAAWC,QAAQI,YAAY,OAAOrP,MAAM,GACnDd,EAAO8P,WAAWC,QAAQI,YAAY,QAAQrP,MAAM,IACpDd,EAAO8P,WAAWC,QAAQI,YAAY,SAASrP,MAAM,EAAE,GACvD,IAGJhB,EAAS,qBAAqB,KAE5BC,EAAG,iBAAiB,KAClBC,EAAO3/B,OAAO4mB,KAAK6oB,WAAWC,UAAUrP,QAF3B,aAE0C,IAGzDZ,EAAS,iBAAiB,KACXz/B,OAAO4mB,KAAKxe,OAAOjE,IAAIqD,MAC/BmM,SAASsW,IACZyV,EAAG,OAAOzV,SAAW,IAAWvtB,OAAA,OAAA,OAAA,GAAA,YAC9BijC,EAAO8P,WAAWC,QAAQK,WAAW3nC,OAAOjE,IAAIqD,KAAKyiB,KAAOwW,MAC1Dr4B,OAAOjE,IAAIoE,WAAW0hB,GAEzB,KAAC,GACF,GACF,IAGJwV,EAAS,kBAAkB,KAEzBC,EAAG,iBAAiB,KAClBC,EAAO3/B,OAAO4mB,KAAK6oB,WAAWC,UAAUrP,QAF3B,UAE0C,IAGzDX,EAAG,iBAAiB,KAClBC,EAAO8P,WAAWC,QAAQh5B,SAAQ,EAAM,GAAI,KAAK+pB,MAAM,KACvDd,EAAO8P,WAAWC,QAAQh5B,SAAQ,GAAO,GAAI,KAAK+pB,MAAM,GACxDd,EAAO8P,WAAWC,QAAQh5B,SAAQ,EAAM,EAAG,KAAK+pB,MAAM,IACtDd,EAAO8P,WAAWC,QAAQh5B,SAAQ,EAAM,GAAI,MAAM+pB,MAAM,IACxDd,EAAO8P,WAAWC,QAAQh5B,SAAQ,EAAM,IAAK,MAAM+pB,MAAM,IACzDd,EAAO8P,WAAWC,QAAQh5B,SAAQ,EAAO,GAAI,KAAK+pB,MAAM,GACxDd,EAAO8P,WAAWC,QAAQh5B,SAAQ,GAAQ,GAAI,KAAK+pB,MAAM,KACzDd,EAAO8P,WAAWC,QAAQh5B,SAAQ,EAAO,EAAG,KAAK+pB,MAAM,IACvDd,EAAO8P,WAAWC,QAAQh5B,SAAQ,EAAO,GAAI,MAAM+pB,MAAM,IACzDd,EAAO8P,WAAWC,QAAQh5B,SAAQ,EAAO,IAAK,MAAM+pB,MAAM,GAAG,GAC7D,IAGJhB,EAAS,gBAAgB,KAEvBC,EAAG,iBAAiB,KAClBC,EAAO3/B,OAAO4mB,KAAK6oB,WAAWC,UAAUrP,QAF3B,QAE0C,IAGzDX,EAAG,iBAAiB,KAClB,MAAMsQ,EAAQ,CACZC,GAAK9tC,GAAMA,GAEbw9B,EAAO8P,WAAWC,QAAQQ,MAAM,EAAGF,IAAQvP,MAAM,MACjDd,EAAO8P,WAAWC,QAAQQ,MAAM,EAAGF,IAAQvP,MAAM,QAAQ,GACzD,IAGJhB,EAAS,eAAe,KAEtBC,EAAG,iBAAiB,KAClBC,EAAO3/B,OAAO4mB,KAAK6oB,WAAWC,UAAUrP,QAF3B,OAE0C,IAGzDX,EAAG,iBAAiB,KAClBC,EAAO8P,WAAWC,QAAQlF,KAAK,UAAU/J,MACvC,GAAGr4B,OAAOjE,IAAIC,oBACf,GACD,IAGJq7B,EAAS,gBAAgB,KAEvBC,EAAG,iBAAiB,KAClBC,EAAO3/B,OAAO4mB,KAAK6oB,WAAWC,UAAUrP,QAF3B,QAE0C,IAGzDX,EAAG,iBAAiB,KAClBC,EAAO8P,WAAWC,QAAQS,MAAM,UAAU1P,MACxC,GAAGr4B,OAAOjE,IAAIK,kBACf,GACD,GACF,GACF,EC/KG,MAAMuU,GAAM,oBACN5Y,GAAU,CAAEm/B,YAAa,uBAGhCC,GAAkB,CAAOl/B,EAAc6I,EAAe,CAAE,IAAIxM,OAAA,OAAA,OAAA,GAAA,YAChE,OAAAyhC,GAAmB99B,EAAM6I,EAAM6P,GAAI,IAG/Bq3B,GAAgB,IAAMpR,GAAmBjmB,IAE/C,IAAAs3B,GAAe,EACb5Q,WACAC,KACAC,SACAC,SACA/H,QACAyM,gBAEA1E,GAAO,IAAWljC,OAAA,OAAA,OAAA,GAAA,sBACM,QAAtB+pB,EAAY,UAAR,OAAJniB,WAAA,IAAAA,UAAA,EAAAA,KAAMwpB,cAAM,IAAA7L,OAAA,EAAAA,EAAEquB,cAAQ,IAAA7pB,GAAAA,EAAA5T,OAAO,CAAEy9B,QAAQ,UACf,UAAlBljC,GAAGC,qBAAe,IAAA2mB,OAAA,EAAAA,EAAAplB,OACzB,MAED01B,GAAU,IAAW5nC,OAAA,OAAA,OAAA,GAAA,YACnBmiC,KACAuR,KACAnR,KACAE,IACD,MAEDtH,GAAM,IAAWn7B,OAAA,OAAA,OAAA,GAAA,kBACfuhC,KACAY,KACAuR,KACAnR,KACAE,WACwB,QAAlB5K,EAAAnnB,GAAGC,qBAAe,IAAAknB,OAAA,EAAAA,EAAA3pB,QAAO,EAChC,MAED60B,EAAS,8BAA8B,KACrCC,EAAG,oBAAoB,IAAWhjC,OAAA,OAAA,OAAA,GAAA,kBAChC,MAAM89B,QAAc8D,KACpBqB,EAAkB,QAAX1d,EAAA3d,KAAKq2B,cAAM,IAAA1Y,OAAA,EAAAA,EAAE7I,SAASvI,MAAM+pB,GAAMA,EAAE1hB,QAASshB,aAAK,EAALA,EAAOthB,SAAO8mB,IAC/Dxc,SACJ,MAEDkc,EAAG,4BAA4B,IAAWhjC,OAAA,OAAA,OAAA,GAAA,kBACxC,MAAM89B,QAAc8D,KACdp1B,EAAO,CAAE7I,KAAM,QAAS6Y,KAAMshB,aAAK,EAALA,EAAOthB,YAGrCkhB,GAAelxB,EAFH,GAGlB,MAAMqnC,EAAkB,QAAT9pB,EAAAniB,KAAKoF,YAAI,IAAA+c,OAAA,EAAAA,EAAE+pB,gBAAgB,GAE1C7Q,EAAO4Q,EAAOE,GAAejW,OAAOiG,MAAMjG,EAC3C,MAEDkF,EAAG,8CAA8C,IAAWhjC,OAAA,OAAA,OAAA,GAAA,0BAC1D,MAAM6P,QAAcgzB,GAAgB,aAC9Br2B,EAAO,CAAE7I,KAAMkM,aAAK,EAALA,EAAOlM,KAAM6Y,KAAM3M,eAAAA,EAAO2M,MAE/CymB,EAAyB,QAAlB3L,EAAA5mB,GAAGC,qBAAe,IAAA2mB,OAAA,EAAAA,EAAAob,MAAMjiC,QAAQszB,MAAM,SACvCrG,GAAelxB,EAFH,GAGlBy2B,EAAyB,QAAlBpL,EAAAnnB,GAAGC,qBAAe,IAAAknB,OAAA,EAAAA,EAAA6a,MAAMjiC,QAAQszB,MAAM,GAC7Cd,EAAsC,QAA/BP,EAAgB,QAAhBF,EAAA9xB,GAAGC,qBAAa,IAAA6xB,OAAA,EAAAA,EAAEkQ,MAAM30B,aAAO,IAAA2kB,OAAA,EAAAA,EAAAhS,SAASqT,MAC7Cn8B,KAAKuI,KAAKuB,SAAS,6BAErBuxB,EAAyB,QAAlBkG,EAAAz4B,GAAGC,qBAAe,IAAAw4B,OAAA,EAAAA,EAAAuJ,MAAMjiC,QAAQszB,MAAM,SACvCl0B,aAAK,EAALA,EAAOwyB,QACd,MAEDW,EAAG,mDAAmD,IAAWhjC,OAAA,OAAA,OAAA,GAAA,0BAC/D,MAAM6P,QAAcgzB,GAAgB,aAC9BqL,QAAkBxM,GAAoB,UACtCl1B,EAAO,CAAE7I,KAAM,OAAQ6Y,KAAM0xB,aAAS,EAATA,EAAW1xB,MAE9CymB,EAAyB,QAAlBmG,EAAA14B,GAAGC,qBAAe,IAAAy4B,OAAA,EAAAA,EAAAsJ,MAAMjiC,QAAQszB,MAAM,SACvCrG,GAAelxB,EAFH,GAGlBy2B,EAAyB,QAAlBoG,EAAA34B,GAAGC,qBAAe,IAAA04B,OAAA,EAAAA,EAAAqJ,MAAMjiC,QAAQszB,MAAM,GAC7Cd,EAAsC,QAA/BsG,EAAgB,QAAhBD,EAAA54B,GAAGC,qBAAa,IAAA24B,OAAA,EAAAA,EAAEoJ,MAAM30B,aAAO,IAAAwrB,OAAA,EAAAA,EAAA7Y,SAASqT,MAC7Cn8B,KAAKuI,KAAKuB,SAAS,qCAErBuxB,EAAyB,QAAlBuG,EAAA94B,GAAGC,qBAAe,IAAA64B,OAAA,EAAAA,EAAAkJ,MAAMjiC,QAAQszB,MAAM,SACvCl0B,aAAK,EAALA,EAAOwyB,eACP6L,aAAS,EAATA,EAAW7L,QAClB,MAEDU,EAAS,0CAA0C,KAC/B,IAAI/rB,IAAI,CACxB,QACA,UACA,QACA,SACA,OACA,cAEQC,SAAStT,IACjBq/B,EAAG,kBAAkBr/B,EAAKmb,wCAAwC,IAAW9e,OAAA,OAAA,OAAA,GAAA,oBAC3E,MAAM6P,QAAcgzB,GAAgB,mBAC9BlB,GAAoB9xB,EAAOlM,GACjC,MAAMiT,EAAO/G,aAAA,EAAAA,EAAO3N,MAAMwa,SAAS,GAC7BlQ,EAAO,CACX7I,KAAM,OACN6Y,KAAM5F,aAAA,EAAAA,EAAM4F,KACZ5F,KAAM,CACJjE,KAAMiE,aAAA,EAAAA,EAAMjE,KACZmD,IAAK,WAKH4nB,GAAelxB,EAFH,GAGlB,MAAMsxB,EAAmB,QAAXvY,EAAA3d,KAAKoF,YAAM,IAAAuY,OAAA,EAAAA,EAAAuuB,kBAAkBC,GAC3C9Q,EAAqB,UAAdnF,aAAA,EAAAA,EAAOA,aAAO,IAAA/T,OAAA,EAAAA,EAAA8T,SAASkG,MAC5B,0CAA0CpgC,EAAKmb,yBAE3CjP,aAAK,EAALA,EAAOwyB,QACd,KAAC,GACF,GACF,IAGJU,EAAS,2BAA2B,KAClCC,EAAG,4BAA4B,IAAWhjC,OAAA,OAAA,OAAA,GAAA,4BACxC,MAAM2D,EAAO,SACPkM,QAAcgzB,GAAgB,mBAC9BlB,GAAoB9xB,EAAOlM,SAChB,UAAXiE,KAAKoF,YAAM,IAAAuY,OAAA,EAAAA,EAAApP,OAAO,CAAEsb,UAAW5hB,aAAA,EAAAA,EAAOhI,KAC5Co7B,EAAOp1B,YAAY+G,aAAa8G,OAAO2oB,GAAG4F,KAC1ChH,EAAOp1B,YAAY+G,aAAa/E,OAAOw0B,GAAGf,IAAI2G,KAC9ChH,EAAyB,QAAlBlZ,EAAArZ,GAAGC,qBAAe,IAAAoZ,OAAA,EAAAA,EAAA2oB,MAAMjiC,QAAQszB,MAAM,SACvC1F,GAAc,kBAAkB16B,EAAKmb,gBAC3CmkB,EAAyB,QAAlB3L,EAAA5mB,GAAGC,qBAAe,IAAA2mB,OAAA,EAAAA,EAAAob,MAAMjiC,QAAQszB,MAAM,GAC7Cd,EAAsC,QAA/BT,EAAgB,QAAhB3K,EAAAnnB,GAAGC,qBAAa,IAAAknB,OAAA,EAAAA,EAAE6a,MAAM30B,aAAO,IAAAykB,OAAA,EAAAA,EAAA9R,SAASqT,MAC7Cn8B,KAAKuI,KAAKuB,SAAS,uCAErBuxB,EAAyB,QAAlBP,EAAAhyB,GAAGC,qBAAe,IAAA+xB,OAAA,EAAAA,EAAAgQ,MAAMjiC,QAAQszB,MAAM,SACvCl0B,aAAK,EAALA,EAAOwyB,QACd,MAEDW,EAAG,qCAAqC,IAAWhjC,OAAA,OAAA,OAAA,GAAA,4BACjD,MAAM2D,EAAO,SACPkM,QAAcgzB,GAAgB,aAC9BnnB,QAAcomB,KACpBmB,EAAOvnB,eAAAA,EAAOsmB,aAAa+B,OAAM,SAC3BpC,GAAoB9xB,EAAOlM,SAChB,QAAXwlC,EAAAvhC,KAAKoF,YAAM,IAAAm8B,OAAA,EAAAA,EAAAhzB,OAAO,CAAEsb,UAAW,OACrCwR,EAAOp1B,YAAY+G,aAAa8G,OAAO2oB,GAAGf,IAAI2G,KAC9ChH,EAAOp1B,YAAY+G,aAAa/E,OAAOw0B,GAAG4F,KAC1ChH,EAAyB,QAAlBmG,EAAA14B,GAAGC,qBAAe,IAAAy4B,OAAA,EAAAA,EAAAsJ,MAAMjiC,QAAQszB,MAAM,SACvC1F,GAAc,kBAAkB16B,EAAKmb,gBAC3CmkB,EAAyB,QAAlBoG,EAAA34B,GAAGC,qBAAe,IAAA04B,OAAA,EAAAA,EAAAqJ,MAAMjiC,QAAQszB,MAAM,GAC7Cd,EAAsC,QAA/BsG,EAAgB,QAAhBD,EAAA54B,GAAGC,qBAAa,IAAA24B,OAAA,EAAAA,EAAEoJ,MAAM30B,aAAO,IAAAwrB,OAAA,EAAAA,EAAA7Y,SAASqT,MAC7Cn8B,KAAKuI,KAAKuB,SAAS,uCAErBuxB,EAAyB,QAAlBuG,EAAA94B,GAAGC,qBAAe,IAAA64B,OAAA,EAAAA,EAAAkJ,MAAMjiC,QAAQszB,MAAM,SACvCl0B,aAAK,EAALA,EAAOwyB,eACP3mB,aAAK,EAALA,EAAO2mB,QACd,MAEDW,EAAG,uCAAuC,IAAWhjC,OAAA,OAAA,OAAA,GAAA,kBACnD,MAAM2D,EAAO,SACPkM,QAAcgzB,GAAgB,aAC9BnnB,QAAcomB,KACpBmB,EAAOvnB,eAAAA,EAAOsmB,aAAa+B,OAAM,SAC3BpC,GAAoB9xB,EAAOlM,SAChB,UAAXiE,KAAKoF,YAAM,IAAAy8B,OAAA,EAAAA,EAAAtzB,OAAO,CAAEsb,UAAW5hB,aAAA,EAAAA,EAAOhI,KAC5Co7B,EAAOp1B,YAAY+G,aAAa8G,OAAO2oB,GAAGf,IAAI2G,KAC9ChH,EAAOp1B,YAAY+G,aAAa/E,OAAOw0B,GAAGf,IAAI2G,WACxC5L,GAAc,kBAAkB16B,EAAKmb,sBACrCoiB,KACN+B,EAAO3B,KAAc7wB,QAAQszB,MAAM,SAC7BxC,WACA1xB,aAAK,EAALA,EAAOwyB,eACP3mB,aAAK,EAALA,EAAO2mB,QACd,MAEDW,EAAG,yDAAyD,IAAWhjC,OAAA,OAAA,OAAA,GAAA,4BACrE,MAAM2D,EAAO,SACPkM,QAAcgzB,GAAgB,aAC9BnnB,QAAcomB,KACpBmB,EAAOvnB,eAAAA,EAAOsmB,aAAa+B,OAAM,SAC3BpC,GAAoB9xB,EAAOlM,SAC3Bg+B,GAAoB9xB,EAAOlM,SAChB,UAAXiE,KAAKoF,YAAM,IAAA08B,OAAA,EAAAA,EAAAvzB,OAAO,CAAEsb,UAAW5hB,aAAA,EAAAA,EAAOhI,KAC5Co7B,EAAyB,QAAlBiH,EAAAx5B,GAAGC,qBAAe,IAAAu5B,OAAA,EAAAA,EAAAwI,MAAMjiC,QAAQszB,MAAM,SACvC1F,GAAc,kBAAkB16B,EAAKmb,sBACrCoiB,KACN+B,EAAyB,QAAlBkH,EAAAz5B,GAAGC,qBAAe,IAAAw5B,OAAA,EAAAA,EAAAuI,MAAMjiC,QAAQszB,MAAM,GAC7Cd,EAAoC,QAA7BoH,EAAkB,QAAlBD,EAAA15B,GAAGC,qBAAe,IAAAy5B,OAAA,EAAAA,EAAAsI,MAAM30B,aAAK,IAAAssB,OAAA,EAAAA,EAAE3Z,SAASqT,MAC7Cn8B,KAAKuI,KAAKC,OAAO,mCAAoC,CACnD4gB,UAAWnhB,aAAA,EAAAA,EAAO8C,KAClB2rB,SAAU,kBAAkB36B,EAAKmb,kBAGrCmkB,EAAyB,QAAlBqH,EAAA55B,GAAGC,qBAAe,IAAA25B,OAAA,EAAAA,EAAAoI,MAAMjiC,QAAQszB,MAAM,SACvC7C,KACN+B,EAAO3B,KAAc7wB,QAAQszB,MAAM,SAC7BxC,WACA1xB,aAAK,EAALA,EAAOwyB,eACP3mB,aAAK,EAALA,EAAO2mB,QACd,MAEDW,EAAG,gCAAgC,IAAWhjC,OAAA,OAAA,OAAA,GAAA,4BAC5C,MAAM2D,EAAO,SACPkM,QAAcgzB,GAAgB,aAC9BnnB,QAAcomB,KACpBmB,EAAOvnB,eAAAA,EAAOsmB,aAAa+B,OAAM,SAC3BpC,GAAoB9xB,EAAOlM,SAChB,UAAXiE,KAAKoF,YAAM,IAAAu9B,OAAA,EAAAA,EAAAp0B,OAAO,CAAEsb,UAAW5hB,aAAA,EAAAA,EAAOhI,WAGxC,UAFEgI,aAAA,EAAAA,EAAO3N,MACVggC,QAAQ,kBAAkBv+B,EAAKmb,uBAC9B,IAAA0rB,OAAA,EAAAA,EAAAnI,SACJY,EAAyB,QAAlBwH,EAAA/5B,GAAGC,qBAAe,IAAA85B,OAAA,EAAAA,EAAAiI,MAAMjiC,QAAQszB,MAAM,SACvC1F,GAAc,kBAAkB16B,EAAKmb,sBACrCoiB,KACN+B,EAAyB,QAAlB+Q,EAAAtjC,GAAGC,qBAAe,IAAAqjC,OAAA,EAAAA,EAAAtB,MAAMjiC,QAAQszB,MAAM,GAC7C,MAAMnzB,EAAwB,QAAhBqjC,EAAAvjC,GAAGC,qBAAa,IAAAsjC,OAAA,EAAAA,EAAEvB,MAAM30B,MACtCklB,EAAyB,QAAlBiR,EAAAxjC,GAAGC,qBAAe,IAAAujC,OAAA,EAAAA,EAAAxB,MAAMjiC,QAAQszB,MAAM,GAC7Cd,EAAOryB,eAAAA,EAAOjN,MAAMogC,MAAM,SAC1Bd,EAAOryB,aAAA,EAAAA,EAAO8f,SAASqT,MACrBn8B,KAAKuI,KAAKC,OAAO,2BAA4B,CAC3C4gB,UAAWnhB,aAAA,EAAAA,EAAO8C,KAClB2rB,SAAU,kBAAkB36B,EAAKmb,wBAG/BjP,aAAK,EAALA,EAAOwyB,eACP3mB,aAAK,EAALA,EAAO2mB,QACd,KAAC,GACF,EC3OG,MAAMhmB,GAAM,oBACN5Y,GAAU,CACrBm/B,YAAa,uBAITC,GAAkB,CAAOl/B,EAAc6I,EAAe,CAAE,IAAIxM,OAAA,OAAA,OAAA,GAAA,YAChE,OAAAyhC,GAAmB99B,EAAM6I,EAAM6P,GAAI,IAKrC,IAAe83B,GAAA,EAAGpR,WAAUC,KAAIC,SAAQ9H,YACtCA,GAAM,KAHoBmH,GAAmBjmB,GAI5B,IAIjB0mB,EAAS,4BAA4B,SAErCA,EAAS,iBAAiB,KACxBC,EAAG,iDAAiD,IAAWhjC,OAAA,OAAA,OAAA,GAAA,YAC7D,MAAM6P,QAAcgzB,GAAgB,aACpC1sB,GAAOtG,GACPozB,EAAO3B,KAAc7wB,QAAQszB,MAAM,SAC7Bl0B,aAAK,EAALA,EAAOwyB,QACd,MAEDW,EAAG,oCAAoC,IAAWhjC,OAAA,OAAA,OAAA,GAAA,oBAChD,MAAM6P,QAAcgzB,GAAgB,aACpChzB,SAAAA,EAAOosB,QAAQr0B,KAAK1D,OAAO2D,GAAI,SAAS,GACxCsO,GAAOtG,SACDqxB,mBACA3b,EAAAqa,cAAA,EAAAA,GAAeD,iCAAYzxB,QAAO,SAClCgzB,KACN,MAAMkT,EACmC,QADrBrqB,EAAAtG,SACjB5R,cAAc,gCAAwB,IAAAkY,OAAA,EAAAA,EACrCsqB,aAAa,iBACjBpR,EAAOmR,GAAarQ,MAAMl0B,aAAA,EAAAA,EAAOhI,IACjCo7B,EAAO3B,KAAc7wB,QAAQszB,MAAM,SAC7BxC,KACN1xB,SAAAA,EAAOwyB,SACPY,EAAO3B,KAAc7wB,QAAQszB,MAAM,EACpC,KAAC,GACF,ECnDJ,MAAMlH,aAAEA,GAAYU,aAAEA,IAAiBE,GAE1BphB,GAAM,uBACN5Y,GAAU,CACrBm/B,YAAa,0BAGT0R,GAAkB,IAAWt0C,OAAA,OAAA,OAAA,GAAA,YACjC,OAAA2uC,UAAUjgC,OAAO,CACfiE,KAAM,cAAc0J,UAGlBk4B,GAA0B,IAAWv0C,OAAA,OAAA,OAAA,GAAA,YACzC,MAAMqP,QAA0BilC,KAGhC,aAFMjlC,EAAM8G,OAAO,CAAExD,KAAM,uBAAuB0J,aAC5ChN,EAAM4sB,QAAQr0B,KAAK1D,OAAO2D,GAAI,YAAY,GACzCwH,CACT,IAUA,IAAemlC,GAAA,EAAGzR,WAAUC,KAAIC,SAAQ9H,YAEtC4H,EAAS,6BAA6B,SAEtCA,EAAS,6BAA6B,KACpCC,EAAG,oBAAoB,IAAWhjC,OAAA,OAAA,OAAA,GAAA,YAChC,MAAMqP,QAAcklC,WACdllC,EAAM2G,wBAAwB,cAAe,CACjD,CACE5B,KAAM,aACN6Z,MAAO,CAAC,EAAG,GACX5pB,OAAQ,MAGZ4+B,EAAO5zB,EAAMD,QAAQ0kB,MAAMiQ,MAAM,SAC3B10B,EAAMgzB,QACb,MAEDW,EAAG,4CAA4C,IAAWhjC,OAAA,OAAA,OAAA,GAAA,YACxD,MAAMqP,QAAcklC,WACdllC,EAAM2G,wBAAwB,cAAe,CACjD,CACE5B,KAAM,cACN6Z,MAAO,CAAC,EAAG,GACX5pB,OAAQ,OAGZ,MAAMmI,QAAaqwB,GAAaxtB,EAAO,CAAE,SACnC6xB,KACN+B,EAAOz2B,EAAKrI,UAAUkgC,GAAGf,IAAIxc,UAC7B,MAAM2tB,EAAYnxC,OAAO4mB,KAAK1d,EAAKrI,UAAU,GAC7C8+B,EAAOz2B,EAAKrI,SAASswC,GAAWrgC,MAAM2vB,MAAM,cAC7C,MAgBDf,EAAG,wCAAwC,IAAWhjC,OAAA,OAAA,OAAA,GAAA,YACpD,MAAMqP,QAAcilC,KACpBjlC,SAAAA,EAAO8G,OAAO,CAAEhF,QAAS,gBACnB9B,aAAK,EAALA,EAAO2G,wBAAwB,cAAe,CAClD,CACE5B,KAAM,cACN6Z,MAAO,CAAC,EAAG,QAGf,MAAMzhB,QAAaqwB,GAAaxtB,EAAO,CAAE,SACnC6xB,KACN+B,EAAOz2B,EAAKrI,UAAUkgC,GAAGf,IAAIxc,UAC7B,MAAM2tB,EAAYnxC,OAAO4mB,KAAK1d,EAAKrI,UAAU,GAC7C8+B,EAAOz2B,EAAKrI,SAASswC,GAAWrgC,MAAM2vB,MAAM,cAC7C,KAAC,IAGJhB,EAAS,gCAAgC,KACvCC,EAAG,qDAAqD,IAAWhjC,OAAA,OAAA,OAAA,GAAA,oBACjE8gC,KACA,MAAMzxB,QAAcklC,WACdllC,EAAM2G,wBAAwB,cAAe,CACjD,CACE5B,KAAM,cACN6Z,MAAO,CAAC,EAAG,GACX5pB,OAAQ,aAGNk5B,GAAaluB,SACb6xB,KACN+B,EAAoB,QAAb1d,EAAA3d,KAAK+oB,gBAAQ,IAAApL,OAAA,EAAAA,EAAEuO,MAAMiQ,MAAM,GAClCd,UAAOlZ,EAAAniB,KAAK+oB,+BAAUjU,SAAS,GAAGpO,SAAS8M,SAAS,cACrD,KAAC,IAGJ+f,GAAM,KA3FyBn7B,OAAA,OAAA,OAAA,GAAA,kBAC/B,MAAMq9B,EAAsB,QAAb9X,EAAA3d,KAAKy1B,cAAQ,IAAA9X,OAAA,EAAAA,EAAAhV,QACzB6Y,GACCA,EAAEzW,OAAS,cAAc0J,MAAS+M,EAAEzW,OAAS,uBAAuB0J,OAExEghB,SAAAA,EAAQpmB,SAASmS,GAAMA,EAAEiZ,UAC3B,IAuFIvB,IAAW,GACX,EC8BJ4T,MAAM/mB,GAAG,eAAsBgnB,GAAkB30C,OAAA,OAAA,OAAA,GAAA,YAI/C20C,EAAOC,cACLC,GACA/R,GACAgS,IAEFH,EAAOC,c/B1JU,mC+B4JfrQ,GACAwQ,IAEFJ,EAAOC,c9B1JU,4C8B4Jf3P,GACA+P,IAEFL,EAAOC,c7BhKU,qC6BkKf/O,GACAoP,IAEFN,EAAOC,c5BzKU,uC4B2Kf1O,GACAgP,IAEFP,EAAOC,c3B9KU,uC2BgLftN,GACA6N,IAEFR,EAAOC,cACLQ,GACAzN,GACA0N,IAGFV,EAAOC,cAAcU,GAAgBvN,GAAkBwN,IAEvDZ,EAAOC,cAAcY,GAAe7K,GAAiB8K,IACrDd,EAAOC,cACLc,GACAtI,GACAuI,IAEFhB,EAAOC,cACLgB,GACAvH,GACAwH,IAEFlB,EAAOC,cACLkB,GACAvH,GACAwH,IAOFpB,EAAOC,cACLoB,GACA/G,GACAgH,IAEFtB,EAAOC,cACLsB,GACA/G,GACAgH,IAOFxB,EAAOC,clB9NU,6BkBgOfvF,GACA+G,IAEFzB,EAAOC,cjBnOU,2BiBqOftF,GACA+G,IAEF1B,EAAOC,chBxOU,+BgB0OfpF,GACA8G,IAEF3B,EAAOC,cf7OU,0Be+OfnF,GACA8G,IAEF5B,EAAOC,cdlPU,2BcoPfjF,GACA6G,IAEF7B,EAAOC,cbvPU,4BayPfhF,GACA6G,IAGF9B,EAAOC,cZnPU,kBYmPmB/E,GAAiB6G,IAErD/B,EAAOC,cX/PU,iBW+PkBlE,GAAgBiG,IAMnDhC,EAAOC,cAAcgC,GAAgBjG,GAAkBkG,IACvDlC,EAAOC,cAAckC,GAAehG,GAAiBiG,IACrDpC,EAAOC,cRtQU,qBQsQqBrD,GAAmByF,IAMzDrC,EAAOC,cP7QU,wBO+QfnD,GACAwF,IAEFtC,EAAOC,cN5QU,mBM4QoB/C,GAAkBqF,IACvDvC,EAAOC,cLlRU,mBKkRoB5C,GAAkBmF,IACvDxC,EAAOC,cJrRU,yBIuRf9B,GACAsE,IAEFzC,EAAOC,cACLyC,GACA1D,GACA2D,IAEF3C,EAAOC,cAAc2C,GAAiBpD,GAAmBqD,IACzD7C,EAAOC,cACL6C,GACAjD,GACAkD,GAEJ,MCrQAhD,MAAMiD,KAAK,QAAQrrC,UAMjBZ,OAAOksC,OAAO5/B,WAAa,CACzB7G,QAAS,cACT0mC,SAAU,GAGZnsC,OAAOjE,IAAMA,EAEbG,KAAKwsB,IAAM,CACTiK,cAAeyZ,GACfvZ,eAAgBwZ,GAChBC,UAAWhgB,IAIb4H,GAAcpd,OCrDmBxiB,OAAA,OAAA,OAAA,GAAA,YAEjC+yC,WAAWkF,eAAe,MAAM,CAACv1B,EAAGxW,IAAMwW,IAAMxW,IAEhD6mC,WAAWkF,eAAe,OAAQ9iC,GAC5BA,EAAM,EACD,IAAIA,IAETA,EAAM,EACD,GAAGA,IAEL,MAGT49B,WAAWkF,eACT,OACA,CAACC,EAAIC,IAAOv+B,SAASs+B,EAAI,IAAMt+B,SAASu+B,EAAI,MAG9CpF,WAAWkF,eACT,YACA,CAACC,EAAIC,IAAOv+B,SAASs+B,EAAI,IAAMt+B,SAASu+B,EAAI,MAG9CpF,WAAWkF,eAAe,UAAU,CAACC,EAAIC,IACvC11C,KAAKmwB,MAAM9e,WAAWokC,GAAMpkC,WAAWqkC,MAGzCpF,WAAWkF,eACT,QACA,CAACC,EAAIC,IAAO11C,KAAK4R,MAAM,IAAMP,WAAWokC,GAAMpkC,WAAWqkC,IAAO,MAGlEpF,WAAWkF,eACT,eACC5zC,GAAW5B,KAAK4R,MAAMP,WAAWzP,GAAU,KAAO,KAGrD0uC,WAAWkF,eAAe,cAAeG,IACvC,MAAMC,EAAU/0C,OAAO4mB,KAAKxe,OAAOjE,IAAIqD,MAEpCqJ,MAAMmkC,GAAgB5sC,OAAOjE,IAAIqD,KAAKwtC,KAAiBF,IAE1D,OAAOC,EAAS3sC,OAAOjE,IAAIoE,WAAWwsC,GAAU,IAAI,IAGtDtF,WAAWkF,eAAe,WAAW,CAACM,EAAQ93C,EAAOuB,IACnDu2C,EACI91C,KAAKC,QAAS,IAAMjC,EAASuB,EAAK,EAAG,KACrCS,KAAKC,QAAQ,IAAO,IAAMjC,EAASuB,EAAK,EAAG,OAGjD+wC,WAAWkF,eAAe,SAAS,CAACrkC,EAAG0/B,KACrC,IAAIkF,EAAQ,GAEZ,IAAK,IAAI/yC,EAAI,EAAGA,EAAImO,IAAKnO,EAAG+yC,GAASlF,EAAMC,GAAG9tC,GAC9C,OAAO+yC,CAAK,IAGdzF,WAAWkF,eACT,QACCQ,GAAiB,GAAGhxC,EAAIC,eAAe+wC,MAG1C1F,WAAWkF,eACT,SACCQ,GAAiB,GAAGhxC,EAAIK,aAAa2wC,MAGxC1F,WAAWkF,eAAe,QAAS9iC,GAAQ1S,KAAKgE,KAAK0O,IACvD,IDTEu/B,MAAMjzC,KAAK,yBEvDXmG,KAAKI,SAAS0wC,SAAS9wC,KAAK1D,OAAO2D,GAAI,aAAc,CACnD8K,KAAM/K,KAAKuI,KAAKuB,SAAS,0BACzBinC,KAAM/wC,KAAKuI,KAAKuB,SAAS,8BACzBO,QAAS,QACT2mC,MAAO,QACPj1C,KAAM6oC,OACNt/B,QAAQ,EACRqR,QAAS,CACPs6B,WAAY,mCACZhgB,MAAO,iCAIXjxB,KAAKI,SAAS0wC,SAAS9wC,KAAK1D,OAAO2D,GAAI,mBAAoB,CACzD8K,KAAM/K,KAAKuI,KAAKuB,SAAS,gCACzBinC,KAAM/wC,KAAKuI,KAAKuB,SAAS,oCACzBO,QAAS,QACT2mC,MAAO,QACPj1C,KAAM6oC,OACNt/B,QAAQ,EACRqR,QAAS,CACPu6B,KAAM,6BACNC,MAAO,8BACP7f,OAAQ,kCAIZtxB,KAAKI,SAAS0wC,SAAS9wC,KAAK1D,OAAO2D,GAAI,cAAe,CACpD8K,KAAM/K,KAAKuI,KAAKuB,SAAS,2BACzBinC,KAAM/wC,KAAKuI,KAAKuB,SAAS,+BACzBO,SAAS,EACT2mC,MAAO,QACPj1C,KAAMq1C,QACN9rC,QAAQ,IAGVtF,KAAKI,SAAS0wC,SAAS9wC,KAAK1D,OAAO2D,GAAI,SAAU,CAC/C8K,KAAM/K,KAAKuI,KAAKuB,SAAS,sBACzBinC,KAAM/wC,KAAKuI,KAAKuB,SAAS,0BACzBO,SAAS,EACT2mC,MAAO,QACPj1C,KAAMq1C,QACN9rC,QAAQ,IAGVtF,KAAKI,SAAS0wC,SAAS9wC,KAAK1D,OAAO2D,GAAI,oBAAqB,CAC1D8K,KAAM/K,KAAKuI,KAAKuB,SAAS,2BACzBinC,KAAM/wC,KAAKuI,KAAKuB,SAAS,+BACzBO,QAAS,WACT2mC,MAAO,QACPj1C,KAAM6oC,OACNt/B,QAAQ,EACRqR,QAASjb,OAAO8B,OAAOsG,OAAOjE,IAAIQ,oBACjCjE,QAAO,CAACi1C,EAAK/T,IACD5hC,OAAAgnB,OAAAhnB,OAAAgnB,OAAA,CAAA,EAAA2uB,GAAK,CAAA,CAAC/T,EAAIvhC,MAAOuhC,EAAIgU,kBAC/B,MAGLtxC,KAAKI,SAAS0wC,SAAS9wC,KAAK1D,OAAO2D,GAAI,sBAAuB,CAC5D8K,KAAM/K,KAAKuI,KAAKuB,SAAS,mCACzBinC,KAAM/wC,KAAKuI,KAAKuB,SAAS,uCACzBO,QAAS,IACT2mC,MAAO,QACPj1C,KAAMinB,OACN1d,QAAQ,IAGVtF,KAAKI,SAAS0wC,SAAS9wC,KAAK1D,OAAO2D,GAAI,YAAa,CAClD8K,KAAM/K,KAAKuI,KAAKuB,SAAS,yBACzBinC,KAAM/wC,KAAKuI,KAAKuB,SAAS,6BACzBO,QAAS,GACT2mC,MAAO,QACPj1C,KAAM6oC,OACNt/B,QAAQ,IAEVtF,KAAKI,SAAS0wC,SAAS9wC,KAAK1D,OAAO2D,GAAI,oBAAqB,CAC1D8K,KAAM/K,KAAKuI,KAAKuB,SAAS,iCACzBinC,KAAM/wC,KAAKuI,KAAKuB,SAAS,qCACzBO,QAAS,WACT2mC,MAAO,QACPj1C,KAAM6oC,OACNt/B,QAAQ,EACRqR,QAAU,CACRrU,SAAWtC,KAAKuI,KAAKuB,SAAS,8BAC9BvH,SAAWvC,KAAKuI,KAAKuB,SAAS,4BAC9BtH,eAAiBxC,KAAKuI,KAAKuB,SAAS,uCAGxC9J,KAAKI,SAAS0wC,SAAS9wC,KAAK1D,OAAO2D,GAAI,uBAAwB,CAC7D8K,KAAM/K,KAAKuI,KAAKuB,SAAS,oCACzBinC,KAAM/wC,KAAKuI,KAAKuB,SAAS,wCACzBO,SAAS,EACT2mC,MAAO,QACPj1C,KAAMq1C,QACN9rC,QAAQ,ICnGVwnC,MAAMiD,KAAK,oBAAoBrrC,UAE7B1E,KAAKuxC,UAAUC,IAAIC,qBAAqB,CAEtCC,QAAW,QAGXC,iBAAoB,YAGpBC,wBAA2B,wBAG3BC,qBAAwB,cAGxBC,aAAgB,CACd,CACE5L,KAAQ,OACR6L,QAAW,kBAIfC,uBAA0B,CAAC,SAAU,QAAS,aAG9CC,kBAAqB,CAAC,OAAQ,OAAQ,mBAKtCC,WAAc,CACZ,CACEn2C,KAAM,OACNgP,KAAM,oBACNmD,IAAK,8BACLikC,aAAc,QACdvtC,KAAM,CACJoK,KAAM,CACJjE,KAAQ,aACRhP,KAAQ,OACRmS,IAAO,8BACP5R,OAAU,CACRE,SAAY,CAAE3D,MAAS,EAAGuB,IAAO,MACjCqC,OAAU,GACV0R,KAAQ,EACR5R,UAAY,KAIlB61C,SAAS,EACTC,aAAc,KAGlB,IHcJvuC,OAAOqmB,MAAMgP,cAAgBjP,GAC7BpmB,OAAOsR,KAAK+jB,cAAgB7T,GAE5BxhB,OAAOqmB,MAAMmoB,iBAAmB,CAC9BzoB,UAAWrG,GACX+uB,QAASvtB,IAEXlhB,OAAOsR,KAAKk9B,iBAAmB,CAC7B7sB,OAAQmJ,GACRzsB,MAAO6rB,GACPhf,KAAMuf,GACNtsB,MAAO0sB,GACPnJ,QAASqI,GACTjY,UAAWyY,IAIbmkB,OAAOC,gBAAgB,OAAQ1iC,YAC/ByiC,OAAOE,cAAc1yC,KAAK1D,OAAO2D,GAAIqZ,EAAwB,CAC3D1C,MAAO,CAAC,aACR+7B,aAAa,EACb9uC,MAAO,4BAET2uC,OAAOE,cAAc1yC,KAAK1D,OAAO2D,GAAI0sB,GAAsB,CACzD/V,MAAO,CAAC,WACR+7B,aAAa,EACb9uC,MAAO,0BAGT+uC,MAAMH,gBAAgB,OAAQvjB,WAC9B0jB,MAAMF,cAAc1yC,KAAK1D,OAAO2D,GAAIgvB,GAAc,CAChD0jB,aAAa,EACb9uC,MAAO,6BIrGmCzL,OAAA,OAAA,OAAA,GAAA,YAC5C,MAAMy6C,EAAgB,CAEpB,GAAGhzC,EAAIC,qDACP,GAAGD,EAAIC,mDAEP,GAAGD,EAAIC,+DACP,GAAGD,EAAIC,uEACP,GAAGD,EAAIC,sEACP,GAAGD,EAAIC,mEACP,GAAGD,EAAIC,sEACP,GAAGD,EAAIC,iEACP,GAAGD,EAAIC,kEACP,GAAGD,EAAIC,6DACP,GAAGD,EAAIC,qEAEP,GAAGD,EAAIC,qEAEP,GAAGD,EAAIC,gDAGT,OAAOgzC,cAAcD,EACvB,GJkFmB,IAMnB/F,MAAMiD,KAAK,SAAS,KAElB,CAAC,cAAe,aAAc,SAAU,QAAS,SAAU,QAAQ1gC,SAChEuC,IACC9N,OAAOjE,IAAI+R,GAAKlW,OAAO42B,QAAQxuB,OAAOjE,IAAI+R,IAAIxV,QAAO,CAACi1C,EAAKr4C,KACzD,MAAM+5C,EAAY,IAAK1B,GAEvB,OADA0B,EAAU/5C,EAAE,IAAMgH,KAAKuI,KAAKuB,SAAS9Q,EAAE,IAChC+5C,CAAS,GACf,CAAE,EAAC,IAKV,MAAM9vC,EAAYjD,KAAKI,SAAStG,IAAIkG,KAAK1D,OAAO2D,GAAI,aACpD,GAAkB,KAAdgD,EAAkB,CACpB,MAAM+vC,EAAY/vC,EAAUkU,MAAM,KAAK/K,KAAK7H,GAAMA,EAAEwjB,SACpDjkB,OAAOjE,IAAIoD,UAAY+vC,CACxB,KAGHlG,MAAMiD,KAAK,SAASrrC,UAClBooC,MAAM/mB,GAAG,cAAc,CAACktB,EAAKruC,EAAMmxB,KACjCmd,GAAsBtuC,EAAMmxB,IAErB,IACP,IAIJ+W,MAAM/mB,GAAG,oBAAoBrhB,MAAOoG,EAAQd,KAI1C,GAHIc,aAAkBqoC,gBnC5IE,EAACroC,EAAQd,KACjC,MAAMopC,EAAU,wDAAwDpzC,KAAKuI,KAAKuB,SAChF,kEAEFE,EAAKuC,KAAK,kBAAkB8mC,YAAYxnC,EAAEunC,IAC1CppC,EAAKuC,KAAK,oBAAoBY,OAAOxB,IACnCA,EAAG2C,iBACHw+B,MAAMjzC,KAAK,sBAAsB,GACjC,EmCqIAy5C,CAAiBxoC,EAAQd,GAEvBc,aAAkByoC,SAAU,CAC9B,MAAMC,EAAaxpC,EAAKuC,KAAK,iBAEjBinC,EAAWjnC,KAAK,MAAMgjB,OAC9BzT,OACF,4FAIF,MAAM5W,EAAW,GAAGrF,EAAIC,2CAClB2zC,QAAiBhtC,eAAevB,GACtCsuC,EAAWjnC,KAAK,WAAWuP,OAAO23B,GAGlC,MAAMC,EAAO1pC,EAAKuC,KAAK,8BACjBonC,EACJ,uEACF9nC,EACE,2DAA2DhM,EAAIK,wDAAwDyzC,iCACvHC,YAAYF,GACd1pC,EAAKuC,KAAK,mCAAmCY,OAAM,KACjD,IAAI0mC,YAAY,uBAAwB,CACtCr8B,WAAW,IACVlR,QAAO,EAAK,GAElB,KAGHwmC,MAAM/mB,GAAG,sBAAsB,CAAC8K,EAAQjsB,EAAM/I,EAASoE,KAExC,UADAD,KAAKI,SAAStG,IAAIkG,KAAK1D,OAAO2D,GAAI,eAE7CmwB,GAAUmE,aAAa1D,EAAQjsB,EAAM/I,EAASoE,EAC/C,IAGH6sC,MAAM/mB,GAAG,kBAAmBqK,GAAUG,SAASH,GAAU4D,iBAAkB,KAC3E8Y,MAAM/mB,GAAG,sBAAuBqK,GAAUG,SAASH,GAAU5nB,OAAQ,MACrEskC,MAAM/mB,GAAG,kBAAmBqK,GAAU0jB,iBACtChH,MAAM/mB,GACJ,+BACAqK,GAAUG,SAASH,GAAUwE,gBAAiB,MAGhDkY,MAAM/mB,GAAG,iBAAiB,CAACguB,EAAK/pC,IAASsb,GAAQ0uB,cAAchqC,KAC/D8iC,MAAM/mB,GAAG,0B1C3HmC,CAC1C7T,EACArW,KAEAA,EAAQ2J,KACN,CACEuF,KAAM/K,KAAKuI,KAAKuB,SAAS,4BACzB9F,KAAM,oCACNiwC,UAAWnkB,GACX/lB,SAAW0G,GAAO6e,GAAoB7e,EAAI,IAE5C,CACE1F,KAAM/K,KAAKuI,KAAKuB,SAAS,6BACzB9F,KAAM,mCACNiwC,UAAWnkB,GACX/lB,SAAW0G,GAAO6e,GAAoB7e,GAAK,KAGxC5U,K0C0GTixC,MAAM/mB,GAAG,qB1CrG4B,CAACmuB,EAAkBlqC,WAEtD,MAAMmqC,EAAYnqC,EAAKuC,KAAK,eAG1B2nC,aAAA,EAAAA,EAAK9tC,UACK,QAATuX,EAAA3d,KAAKoF,YAAI,IAAAuY,OAAA,EAAAA,EAAE5X,OACZouC,IAC4B,IAA5BA,EAAUvvC,KAAK,UAEfuvC,EAAUd,YACR,mGAIJ,MAAM5tC,EAAOuE,EAAKuC,KAAK,gBACnB9G,EAAKoD,OAAS,GAAKknB,GAAe/lB,KACpCvE,EAAKqW,OACHjQ,EACE,yHAGJpG,EAAK8G,KAAK,sCAAsCwZ,GAAG,SAAUpa,IAC3DA,EAAG2C,iBACHghB,GAAoBtlB,EAAM,EAAE,IAE/B,I0C4EH8iC,MAAM/mB,GAAG,yBxC5LmB,CAACte,EAAOuC,KAElC,MAAMoqC,EAAkBhD,QACtB3pC,EAAMqD,OAAOomB,QAAQlxB,KAAK1D,OAAO2D,GAAI,aAGjCo0C,EAAsBxoC,EAC1B,qEAEFwoC,EAAoBC,YAAY,SAAUF,GAa1C,GAXapqC,EAAKuC,KAAK,iBAClBuP,OAAOu4B,GAEZrqC,EAAKuC,KAAK,oBAAoBY,OAAOxB,IACnC,MAAM4oC,EAAanD,QACjB3pC,EAAMqD,OAAOomB,QAAQlxB,KAAK1D,OAAO2D,GAAI,aAEvCwH,EAAMqD,OAAOupB,QAAQr0B,KAAK1D,OAAO2D,GAAI,YAAas0C,EAAW,KAI1DH,EACH,OAIFpqC,EAAKuC,KAAK,iBAAiBioC,OAC3BxqC,EAAKuC,KAAK,sBAAsBmnB,SAEX1pB,EAAKuC,KAAK,gCAClBC,KAAK,cAEGxC,EAAKuC,KAAK,kBAClBqE,IAAI,OAAQ,YAEzB,MAAMrH,EAAUS,EAAKuC,KAAK,uBAC1BhD,EAAQkrC,KAAK,QAAS,SACtBlrC,EAAQkrC,KAAK,YAAY,GAGzB,MAAMhvC,EAAO,0EAA0EzF,KAAKuI,KAAKuB,SAC/F,sCAEFE,EAAKuC,KAAK,uBAAuB8mC,YAAY5tC,GAE7CuE,EAAKuC,KAAK,kBAAkBY,OAAOxB,IACjCgqB,GAAaluB,EAAMqD,OAAQ,CAAEiC,MAAOpB,GAAK,GACzC,IwC6IJmhC,MAAM/mB,GAAG,cAAe2uB,IAExB5H,MAAM/mB,GAAG,oBKhMuBrhB,MAAOoG,EAAQd,EAAM7F,KACnD,GAA6B,SAAzB2G,EAAO6pC,SAAS54C,KAClB,OAGF,MAAMuK,EAAS0D,EAAK,GAAG4qC,iBAAiB,SAClClB,QAAavvC,EAAEoxB,WAAWsf,eAEhCvuC,EAAO+I,SAAQ3K,MAAOsK,EAAMnR,KAC1B,MAAMoC,EAAKqG,EAAOzI,GAAGyP,QAAQwnC,WAEvBriC,EAAUihC,EAAKnnC,MAAMwoC,GAAQA,EAAI90C,KAAOA,IACxC+0C,EAAcnpC,EAAEopC,gBACdxuC,eACJ,GAAG5G,EAAIC,qEACP,CAAEoD,KAAMuP,EAAQnW,OAAOqqB,YAI3B9a,EAAEmD,GAAM8M,OAAOk5B,EAAY,GAC3B,IL6KJlI,MAAM/mB,GAAG,0BK1KsBrhB,MAAOoG,EAAQd,KAC5C,GAAkB,UAAdc,EAAO7K,GACT,OAGF,MAAMqG,EAAS0D,EAAK,GAAG4qC,iBAAiB,SAClCluC,EAAUoE,EAAOu5B,UAEvB/9B,EAAO+I,SAAQ3K,MAAOsK,IACpB,MAAMkmC,EAAkBxuC,EAAQ6F,MAC7BvT,GAAMA,EAAEiH,KAAO+O,EAAK1B,QAAQwnC,aAGzBE,EAAcnpC,EAAEopC,gBACdxuC,eACJ,GAAG5G,EAAIC,qEACP,CAAEoD,KAAMgyC,EAAgB54C,OAAOqqB,UAAY,MAG/C9a,EAAEmD,GAAM8M,OAAOk5B,EAAY,GAC3B,ILwJJlI,MAAM/mB,GAAG,sBAAuBiS,GAAcmR"}